import"../chunks/DsnmJJEf.js";import{i as _r}from"../chunks/TLHdX_sP.js";import{l as Ai,b as fs,c as hs,w as Ei,d as or,e as Mi,g as lt,o as Xn,f as Lt,s as D,i as ps}from"../chunks/jdj6VRHW.js";import{C as Ii,v as ms,A as Ca,w as tr,ah as ys,x as gs,h as o,$ as cn,y as _s,H as bs,z as fi,B as Pa,K as bn,ai as ws,am as ks,D as Ta,G as xs,F as rn,aD as hi,P as ze,aE as pi,aq as ji,af as Ti,aF as Yn,I as Ri,J as Ss,aG as Qn,aH as Cs,aI as Aa,aJ as qi,ak as Ps,aK as As,ap as Es,aL as Ms,Z as Oi,aM as Di,N as $i,aN as Is,L as Fi,aO as js,aP as Ts,R as Rs,aQ as qs,aR as Os,aS as Ds,aT as $s,aU as Fs,E as Ks,aV as Ns,aW as Bs,e as I,aX as Ls,aY as zs,O as wn,aZ as Us,a_ as Hs,a$ as Vs,M as Gs,p as br,Q as ye,b0 as Tt,b1 as ln,l as Fe,b2 as Ki,q as p,n as v,o as d,t as Le,i as ie,a as re,b3 as Vn,m as wr,aa as Ws,b4 as mi,ab as er,b5 as Xs,c as dr,f as ir}from"../chunks/DoB2URIv.js";import{_ as yi,i as pt,b as Ys,s as Fr,a as Xr,p as Wr}from"../chunks/BVfJwSKq.js";function Ir(l,r){return r}function Qs(l,r,i){for(var c=l.items,h=[],g=r.length,_=0;_<g;_++)As(r[_].e,h,!0);var A=g>0&&h.length===0&&i!==null;if(A){var q=i.parentNode;Es(q),q.append(i),c.clear(),mr(l,r[0].prev,r[g-1].next)}Ms(h,()=>{for(var R=0;R<g;R++){var $=r[R];A||(c.delete($.k),mr(l,$.prev,$.next)),qi($.e,!A)}})}function vr(l,r,i,c,h,g=null){var _=l,A={flags:r,items:new Map,first:null},q=(r&Di)!==0;if(q){var R=l;_=tr?Ca(ys(R)):R.appendChild(Ii())}tr&&gs();var $=null,K=!1,W=new Map,ue=cn(()=>{var ce=i();return Ti(ce)?ce:ce==null?[]:ji(ce)}),X,ee;function te(){Js(ee,X,A,W,_,h,r,c,i),g!==null&&(X.length===0?$?Ri($):$=Ta(()=>g(_)):$!==null&&Ss($,()=>{$=null}))}ms(()=>{ee??=Oi,X=o(ue);var ce=X.length;if(K&&ce===0)return;K=ce===0;let oe=!1;if(tr){var we=_s(_)===bs;we!==(ce===0)&&(_=fi(),Ca(_),Pa(!1),oe=!0)}if(tr){for(var Ce=null,_e,V=0;V<ce;V++){if(bn.nodeType===ws&&bn.data===ks){_=bn,oe=!0,Pa(!1);break}var ne=X[V],Ie=c(ne,V);_e=Ra(bn,A,Ce,null,ne,Ie,V,h,r,i),A.items.set(Ie,_e),Ce=_e}ce>0&&Ca(fi())}if(tr)ce===0&&g&&($=Ta(()=>g(_)));else if(xs()){var Ze=new Set,ut=rn;for(V=0;V<ce;V+=1){ne=X[V],Ie=c(ne,V);var dt=A.items.get(Ie)??W.get(Ie);dt?(r&(Qn|Yn))!==0&&Ni(dt,ne,V,r):(_e=Ra(null,A,null,null,ne,Ie,V,h,r,i,!0),W.set(Ie,_e)),Ze.add(Ie)}for(const[je,Te]of A.items)Ze.has(je)||ut.skipped_effects.add(Te.e);ut.add_callback(te)}else te();oe&&Pa(!0),o(ue)}),tr&&(_=bn)}function Js(l,r,i,c,h,g,_,A,q){var R=(_&Is)!==0,$=(_&(Qn|Yn))!==0,K=r.length,W=i.items,ue=i.first,X=ue,ee,te=null,ce,oe=[],we=[],Ce,_e,V,ne;if(R)for(ne=0;ne<K;ne+=1)Ce=r[ne],_e=A(Ce,ne),V=W.get(_e),V!==void 0&&(V.a?.measure(),(ce??=new Set).add(V));for(ne=0;ne<K;ne+=1){if(Ce=r[ne],_e=A(Ce,ne),V=W.get(_e),V===void 0){var Ie=c.get(_e);if(Ie!==void 0){c.delete(_e),W.set(_e,Ie);var Ze=te?te.next:X;mr(i,te,Ie),mr(i,Ie,Ze),Ea(Ie,Ze,h),te=Ie}else{var ut=X?X.e.nodes_start:h;te=Ra(ut,i,te,te===null?i.first:te.next,Ce,_e,ne,g,_,q)}W.set(_e,te),oe=[],we=[],X=te.next;continue}if($&&Ni(V,Ce,ne,_),(V.e.f&Aa)!==0&&(Ri(V.e),R&&(V.a?.unfix(),(ce??=new Set).delete(V))),V!==X){if(ee!==void 0&&ee.has(V)){if(oe.length<we.length){var dt=we[0],je;te=dt.prev;var Te=oe[0],We=oe[oe.length-1];for(je=0;je<oe.length;je+=1)Ea(oe[je],dt,h);for(je=0;je<we.length;je+=1)ee.delete(we[je]);mr(i,Te.prev,We.next),mr(i,te,Te),mr(i,We,dt),X=dt,te=We,ne-=1,oe=[],we=[]}else ee.delete(V),Ea(V,X,h),mr(i,V.prev,V.next),mr(i,V,te===null?i.first:te.next),mr(i,te,V),te=V;continue}for(oe=[],we=[];X!==null&&X.k!==_e;)(X.e.f&Aa)===0&&(ee??=new Set).add(X),we.push(X),X=X.next;if(X===null)continue;V=X}oe.push(V),te=V,X=V.next}if(X!==null||ee!==void 0){for(var et=ee===void 0?[]:ji(ee);X!==null;)(X.e.f&Aa)===0&&et.push(X),X=X.next;var gt=et.length;if(gt>0){var St=(_&Di)!==0&&K===0?h:null;if(R){for(ne=0;ne<gt;ne+=1)et[ne].a?.measure();for(ne=0;ne<gt;ne+=1)et[ne].a?.fix()}Qs(i,et,St)}}R&&$i(()=>{if(ce!==void 0)for(V of ce)V.a?.apply()}),l.first=i.first&&i.first.e,l.last=te&&te.e;for(var Xe of c.values())qi(Xe.e);c.clear()}function Ni(l,r,i,c){(c&Qn)!==0&&hi(l.v,r),(c&Yn)!==0?hi(l.i,i):l.i=i}function Ra(l,r,i,c,h,g,_,A,q,R,$){var K=(q&Qn)!==0,W=(q&Cs)===0,ue=K?W?ze(h,!1,!1):pi(h):h,X=(q&Yn)===0?_:pi(_),ee={i:X,v:ue,k:g,a:null,e:null,prev:i,next:c};try{if(l===null){var te=document.createDocumentFragment();te.append(l=Ii())}return ee.e=Ta(()=>A(l,ue,X,R),tr),ee.e.prev=i&&i.e,ee.e.next=c&&c.e,i===null?$||(r.first=ee):(i.next=ee,i.e.next=ee.e),c!==null&&(c.prev=ee,c.e.prev=ee.e),ee}finally{}}function Ea(l,r,i){for(var c=l.next?l.next.e.nodes_start:i,h=r?r.e.nodes_start:i,g=l.e.nodes_start;g!==null&&g!==c;){var _=Ps(g);h.before(g),g=_}}function mr(l,r,i){r===null?l.first=i:(r.next=i,r.e.next=i&&i.e),i!==null&&(i.prev=r,i.e.prev=r&&r.e)}const gi=[...` 	
\r\fÂ \v\uFEFF`];function Zs(l,r,i){var c=l==null?"":""+l;if(r&&(c=c?c+" "+r:r),i){for(var h in i)if(i[h])c=c?c+" "+h:h;else if(c.length)for(var g=h.length,_=0;(_=c.indexOf(h,_))>=0;){var A=_+g;(_===0||gi.includes(c[_-1]))&&(A===c.length||gi.includes(c[A]))?c=(_===0?"":c.substring(0,_))+c.substring(A+1):_=A}}return c===""?null:c}function eo(l,r){return l==null?null:String(l)}function yr(l,r,i,c,h,g){var _=l.__className;if(tr||_!==i||_===void 0){var A=Zs(i,c,g);(!tr||A!==l.getAttribute("class"))&&(A==null?l.removeAttribute("class"):l.className=A),l.__className=i}else if(g&&h!==g)for(var q in g){var R=!!g[q];(h==null||R!==!!h[q])&&l.classList.toggle(q,R)}return g}function Nt(l,r,i,c){var h=l.__style;if(tr||h!==r){var g=eo(r);(!tr||g!==l.getAttribute("style"))&&(g==null?l.removeAttribute("style"):l.style.cssText=g),l.__style=r}return c}function Bi(l,r,i=!1){if(l.multiple){if(r==null)return;if(!Ti(r))return js();for(var c of l.options)c.selected=r.includes(xn(c));return}for(c of l.options){var h=xn(c);if(Ts(h,r)){c.selected=!0;return}}(!i||r!==void 0)&&(l.selectedIndex=-1)}function to(l){var r=new MutationObserver(()=>{Bi(l,l.__value)});r.observe(l,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Rs(()=>{r.disconnect()})}function _i(l,r,i=r){var c=!0;Ai(l,"change",h=>{var g=h?"[selected]":":checked",_;if(l.multiple)_=[].map.call(l.querySelectorAll(g),xn);else{var A=l.querySelector(g)??l.querySelector("option:not([disabled])");_=A&&xn(A)}i(_)}),Fi(()=>{var h=r();if(Bi(l,h,c),c&&h===void 0){var g=l.querySelector(":checked");g!==null&&(h=xn(g),i(h))}l.__value=h,c=!1}),to(l)}function xn(l){return"__value"in l?l.__value:l.value}const ro=Symbol("is custom element"),no=Symbol("is html");function ao(l){if(tr){var r=!1,i=()=>{if(!r){if(r=!0,l.hasAttribute("value")){var c=l.value;qa(l,"value",null),l.value=c}if(l.hasAttribute("checked")){var h=l.checked;qa(l,"checked",null),l.checked=h}}};l.__on_r=i,$s(i),fs()}}function qa(l,r,i,c){var h=io(l);tr&&(h[r]=l.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&l.nodeName==="LINK")||h[r]!==(h[r]=i)&&(r==="loading"&&(l[Fs]=i),i==null?l.removeAttribute(r):typeof i!="string"&&so(l).includes(r)?l[r]=i:l.setAttribute(r,i))}function io(l){return l.__attributes??={[ro]:l.nodeName.includes("-"),[no]:l.namespaceURI===qs}}var bi=new Map;function so(l){var r=bi.get(l.nodeName);if(r)return r;bi.set(l.nodeName,r=[]);for(var i,c=l,h=Element.prototype;h!==c;){i=Ds(c);for(var g in i)i[g].set&&r.push(g);c=Os(c)}return r}const oo=()=>performance.now(),Er={tick:l=>requestAnimationFrame(l),now:()=>oo(),tasks:new Set};function Li(){const l=Er.now();Er.tasks.forEach(r=>{r.c(l)||(Er.tasks.delete(r),r.f())}),Er.tasks.size!==0&&Er.tick(Li)}function co(l){let r;return Er.tasks.size===0&&Er.tick(Li),{promise:new Promise(i=>{Er.tasks.add(r={c:l,f:i})}),abort(){Er.tasks.delete(r)}}}function zn(l,r){Ei(()=>{l.dispatchEvent(new CustomEvent(r))})}function lo(l){if(l==="float")return"cssFloat";if(l==="offset")return"cssOffset";if(l.startsWith("--"))return l;const r=l.split("-");return r.length===1?r[0]:r[0]+r.slice(1).map(i=>i[0].toUpperCase()+i.slice(1)).join("")}function wi(l){const r={},i=l.split(";");for(const c of i){const[h,g]=c.split(":");if(!h||g===void 0)break;const _=lo(h.trim());r[_]=g.trim()}return r}const uo=l=>l;function sr(l,r,i,c){var h=(l&Us)!==0,g=(l&Hs)!==0,_=h&&g,A=(l&Ls)!==0,q=_?"both":h?"in":"out",R,$=r.inert,K=r.style.overflow,W,ue;function X(){return Ei(()=>R??=i()(r,c?.()??{},{direction:q}))}var ee={is_global:A,in(){if(r.inert=$,!h){ue?.abort(),ue?.reset?.();return}g||W?.abort(),zn(r,"introstart"),W=Oa(r,X(),ue,1,()=>{zn(r,"introend"),W?.abort(),W=R=void 0,r.style.overflow=K})},out(we){if(!g){we?.(),R=void 0;return}r.inert=!0,zn(r,"outrostart"),ue=Oa(r,X(),W,0,()=>{zn(r,"outroend"),we?.()})},stop:()=>{W?.abort(),ue?.abort()}},te=Oi;if((te.transitions??=[]).push(ee),h&&hs){var ce=A;if(!ce){for(var oe=te.parent;oe&&(oe.f&Ks)!==0;)for(;(oe=oe.parent)&&(oe.f&Ns)===0;);ce=!oe||(oe.f&Bs)!==0}ce&&Fi(()=>{I(()=>ee.in())})}}function Oa(l,r,i,c,h){var g=c===1;if(zs(r)){var _,A=!1;return $i(()=>{if(!A){var te=r({direction:g?"in":"out"});_=Oa(l,te,i,c,h)}}),{abort:()=>{A=!0,_?.abort()},deactivate:()=>_.deactivate(),reset:()=>_.reset(),t:()=>_.t()}}if(i?.deactivate(),!r?.duration)return h(),{abort:wn,deactivate:wn,reset:wn,t:()=>c};const{delay:q=0,css:R,tick:$,easing:K=uo}=r;var W=[];if(g&&i===void 0&&($&&$(0,1),R)){var ue=wi(R(0,1));W.push(ue,ue)}var X=()=>1-c,ee=l.animate(W,{duration:q,fill:"forwards"});return ee.onfinish=()=>{ee.cancel();var te=i?.t()??1-c;i?.abort();var ce=c-te,oe=r.duration*Math.abs(ce),we=[];if(oe>0){var Ce=!1;if(R)for(var _e=Math.ceil(oe/16.666666666666668),V=0;V<=_e;V+=1){var ne=te+ce*K(V/_e),Ie=wi(R(ne,1-ne));we.push(Ie),Ce||=Ie.overflow==="hidden"}Ce&&(l.style.overflow="hidden"),X=()=>{var Ze=ee.currentTime;return te+ce*K(Ze/oe)},$&&co(()=>{if(ee.playState!=="running")return!1;var Ze=X();return $(Ze,1-Ze),!0})}ee=l.animate(we,{duration:oe,fill:"forwards"}),ee.onfinish=()=>{X=()=>c,$?.(c,1-c),h()}},{abort:()=>{ee&&(ee.cancel(),ee.effect=null,ee.onfinish=wn)},deactivate:()=>{h=wn},reset:()=>{c===0&&$?.(1,0)},t:()=>X()}}function vo(l,r,i=r){var c=Vs(),h=new WeakSet;Ai(l,"input",g=>{var _=g?l.defaultValue:l.value;if(_=Ma(l)?Ia(_):_,i(_),rn!==null&&h.add(rn),c&&_!==(_=r())){var A=l.selectionStart,q=l.selectionEnd;l.value=_??"",q!==null&&(l.selectionStart=A,l.selectionEnd=Math.min(q,l.value.length))}}),(tr&&l.defaultValue!==l.value||I(r)==null&&l.value)&&(i(Ma(l)?Ia(l.value):l.value),rn!==null&&h.add(rn)),Gs(()=>{var g=r();l===document.activeElement&&h.has(rn)||Ma(l)&&g===Ia(l.value)||l.type==="date"&&!g&&!l.value||g!==l.value&&(l.value=g??"")})}function Ma(l){var r=l.type;return r==="number"||r==="range"}function Ia(l){return l===""?null:+l}function fo(l){return function(...r){var i=r[0];return i.stopPropagation(),l?.apply(this,r)}}const ho=l=>l;function zi(l){const r=l-1;return r*r*r+1}function ki(l){const r=typeof l=="string"&&l.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return r?[parseFloat(r[1]),r[2]||"px"]:[l,"px"]}function Da(l,{delay:r=0,duration:i=400,easing:c=ho}={}){const h=+getComputedStyle(l).opacity;return{delay:r,duration:i,easing:c,css:g=>`opacity: ${g*h}`}}function Ur(l,{delay:r=0,duration:i=400,easing:c=zi,x:h=0,y:g=0,opacity:_=0}={}){const A=getComputedStyle(l),q=+A.opacity,R=A.transform==="none"?"":A.transform,$=q*(1-_),[K,W]=ki(h),[ue,X]=ki(g);return{delay:r,duration:i,easing:c,css:(ee,te)=>`
			transform: ${R} translate(${(1-ee)*K}${W}, ${(1-ee)*ue}${X});
			opacity: ${q-$*te}`}}function Ka(l,{delay:r=0,duration:i=400,easing:c=zi,start:h=0,opacity:g=0}={}){const _=getComputedStyle(l),A=+_.opacity,q=_.transform==="none"?"":_.transform,R=1-h,$=A*(1-g);return{delay:r,duration:i,easing:c,css:(K,W)=>`
			transform: ${q} scale(${1-R*W});
			opacity: ${A-$*W}
		`}}function Dr(l){return--l*l*l*l*l+1}class Et{static MAX_SAFE=BigInt("2")**BigInt("1000")-BigInt("1");static add(r,i){const c=r+i;return c>this.MAX_SAFE?this.MAX_SAFE:c}static subtract(r,i){const c=r-i;return c<0n?0n:c}static multiply(r,i){try{const c=r*i;return c>this.MAX_SAFE?this.MAX_SAFE:c}catch{return this.MAX_SAFE}}static divide(r,i){return i===0n?0n:r/i}static power(r,i){if(i===0n)return 1n;if(i===1n)return r;if(r===0n)return 0n;if(r===1n)return 1n;try{let c=r;for(let h=1n;h<i;h++)if(c=this.multiply(c,r),c>=this.MAX_SAFE)return this.MAX_SAFE;return c}catch{return this.MAX_SAFE}}static compare(r,i){return r<i?-1:r>i?1:0}static isSafe(r){return r<=this.MAX_SAFE&&r>=0n}}class $r extends Error{id;category;severity;timestamp;details;constructor(r,i="unknown",c="medium",h){super(r),this.name="MatchstickError",this.id=Hi(),this.category=i,this.severity=c,this.timestamp=Date.now(),this.details=h,Error.captureStackTrace&&Error.captureStackTrace(this,$r)}toGameError(){return{id:this.id,category:this.category,severity:this.severity,message:this.message,details:this.details,timestamp:this.timestamp,stack:this.stack}}toNotification(){return Ui(this.toGameError())}}class po{errorHistory=[];maxHistorySize=100;notificationCallbacks=[];handleError(r){const i=this.normalizeError(r);this.logError(i);const c=this.determineRecoveryStrategy(i);return this.shouldNotifyUser(i)&&(c.notification=Ui(i),this.sendNotification(c.notification)),c}logError(r){const i=this.normalizeError(r);switch(this.errorHistory.unshift(i),this.errorHistory.length>this.maxHistorySize&&(this.errorHistory=this.errorHistory.slice(0,this.maxHistorySize)),i.severity){case"critical":console.error("ðŸ”´ Critical Error:",i);break;case"high":console.error("ðŸŸ  High Severity Error:",i);break;case"medium":console.warn("ðŸŸ¡ Warning:",i);break;case"low":console.info("ðŸ”µ Info:",i);break}}notifyUser(r,i){const c={id:Vi(),type:i==="error"?"error":i==="warning"?"warning":"info",title:i==="error"?"Error":i==="warning"?"Warning":"Information",message:r,timestamp:Date.now(),isRead:!1};this.sendNotification(c)}getErrorHistory(){return[...this.errorHistory]}clearErrorHistory(){this.errorHistory=[]}onNotification(r){this.notificationCallbacks.push(r)}offNotification(r){const i=this.notificationCallbacks.indexOf(r);i>-1&&this.notificationCallbacks.splice(i,1)}normalizeError(r){return"category"in r&&"severity"in r?r instanceof $r?r.toGameError():r:{id:Hi(),category:"unknown",severity:"medium",message:r.message||"Unknown error occurred",timestamp:Date.now(),stack:r.stack}}determineRecoveryStrategy(r){switch(r.category){case"storage":return this.handleStorageError(r);case"game_logic":return this.handleGameLogicError(r);case"network":return this.handleNetworkError(r);case"ui":return this.handleUIError(r);default:return this.handleUnknownError(r)}}handleStorageError(r){return r.severity==="critical"?{handled:!0,recovery:"save_backup",shouldRetry:!1,fallbackData:null}:{handled:!0,recovery:"retry_operation",shouldRetry:!0}}handleGameLogicError(r){return{handled:!0,recovery:r.severity==="critical"?"reload_state":"use_fallback",shouldRetry:r.severity!=="critical",fallbackData:_o(r.details?.feature)}}handleNetworkError(r){return{handled:!0,recovery:"retry_operation",shouldRetry:!0}}handleUIError(r){return{handled:!0,recovery:"none",shouldRetry:!1}}handleUnknownError(r){return{handled:!1,recovery:"none",shouldRetry:!1}}shouldNotifyUser(r){return r.severity==="low"?!1:r.severity==="critical"?!0:this.errorHistory.filter(c=>c.category===r.category&&c.message===r.message).filter(c=>Date.now()-c.timestamp<6e4).length<=1}sendNotification(r){this.notificationCallbacks.forEach(i=>{try{i(r)}catch(c){console.error("Error in notification callback:",c)}})}}function Ui(l){const r=mo(l),i=go(l);return{id:Vi(),type:l.severity==="critical"?"error":"warning",title:yo(l),message:r,timestamp:Date.now(),duration:l.severity==="critical"?void 0:5e3,isRead:!1,actions:i}}function mo(l){switch(l.category){case"storage":return"There was a problem saving your progress. Your game data is safe.";case"game_logic":return"Something unexpected happened in the game. We'll try to fix it automatically.";case"network":return"Connection problem. Some features may not work until reconnected.";case"ui":return"Display issue detected. Try refreshing if problems persist.";default:return"An unexpected error occurred. The game should continue working normally."}}function yo(l){if(l.severity==="critical")return"Critical Error";switch(l.category){case"storage":return"Save Issue";case"game_logic":return"Game Error";case"network":return"Connection Issue";case"ui":return"Display Issue";default:return"Warning"}}function go(l){const r=[];return l.severity==="critical"&&r.push({label:"Reload Game",action:"reload_game",style:"primary"}),l.category==="storage"&&r.push({label:"Retry Save",action:"retry_save",style:"primary"}),l.category==="network"&&r.push({label:"Retry",action:"retry_operation",style:"primary"}),r.push({label:"Dismiss",action:"dismiss",style:"secondary"}),r}function _o(l){switch(l){case"production":return{matchsticks:0n,rate:0};case"market":return{price:1,demand:"normal"};case"automation":return{autoClickers:[],multipliers:[]};default:return null}}function Hi(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Vi(){return`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const ke=new po,xe={storage:(l,r)=>new $r(l,"storage","high",r),gameLogic:(l,r)=>new $r(l,"game_logic","medium",r),network:(l,r)=>new $r(l,"network","medium",r),ui:(l,r)=>new $r(l,"ui","low",r),critical:(l,r)=>new $r(l,"unknown","critical",r)};function Gn(){const l=Date.now();return{resources:{matchsticks:0n,money:0,wood:0,reputation:0},production:{manualRate:1,automatedRate:0,multipliers:{},lastUpdate:l,totalProduced:0n},market:{currentPrice:1,basePrice:1,priceHistory:[],condition:{priceMultiplier:1,demandLevel:"normal",trend:"stable",duration:0,description:"Normal market conditions"},autoSellEnabled:!1,autoSellThreshold:100,totalSold:0n,totalRevenue:0},automation:{autoClickers:[],autoSellEnabled:!1,autoSellSettings:{enabled:!1,threshold:100,maxPercentage:50,priceThreshold:.5,smartSelling:!1},multipliers:[],totalMoneySpent:0,lastUpdate:l},achievements:{unlocked:[],progress:{},notifications:[],stats:{totalUnlocked:0,totalHidden:0,completionPercentage:0,unlockedToday:0}},progression:{currentPhase:"manual",unlockedFeatures:["manual_production"],completedTutorials:[],milestones:[],worldConversionProgress:0,prestigeLevel:0},tutorial:{currentStep:0,completedTutorials:[],skippedTutorials:[],isActive:!0},settings:{theme:"light",soundEnabled:!0,musicEnabled:!0,hapticEnabled:!0,animations:{enabled:!0,reducedMotion:!1,particleEffects:!0,transitionSpeed:"normal"},notifications:{enabled:!0,achievements:!0,milestones:!0,marketAlerts:!0,production:!0,sound:!0},accessibility:{highContrast:!1,screenReader:!1,keyboardNavigation:!0,largeText:!1,colorBlindFriendly:!1},language:"en",autoSave:!0,saveInterval:3e4},easterEggs:{discovered:[],sequences:[],totalFound:0},metadata:{version:"1.0.0",createdAt:l,lastSaved:l,totalPlayTime:0,sessionStartTime:l,playerId:"1",gameSpeed:1,debugMode:!1}}}const de=Mi(Gn()),bo=or(de,l=>l.resources),wo=or(de,l=>l.production),ko=or(de,l=>l.market),xo=or(de,l=>l.automation);or(de,l=>l.achievements);const So=or(de,l=>l.progression),Co=or(de,l=>l.tutorial);or(de,l=>l.settings);or(de,l=>l.easterEggs);or(de,l=>l.metadata);const Sn=Mi([]);function ja(){return`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const Se={reset(){try{de.set(Gn()),Sn.set([])}catch(l){ke.handleError(xe.gameLogic("Failed to reset game state",{error:l}))}},load(l){try{de.update(r=>{const i={...r,...l.resources&&{resources:{...r.resources,...l.resources}},...l.production&&{production:{...r.production,...l.production}},...l.market&&{market:{...r.market,...l.market}},...l.automation&&{automation:{...r.automation,...l.automation}}};return Po(i)}),Se.emitEvent({id:ja(),type:"state_loaded",timestamp:Date.now(),data:{success:!0},source:"game_system"})}catch(r){ke.handleError(xe.storage("Failed to load game state",{error:r,data:l}))}},updateResources(l){try{de.update(r=>({...r,resources:{...r.resources,...l,matchsticks:l.matchsticks&&Et.isSafe(l.matchsticks)?l.matchsticks:r.resources.matchsticks}}))}catch(r){ke.handleError(xe.gameLogic("Failed to update resources",{error:r,updates:l}))}},addResources(l){try{de.update(r=>({...r,resources:{matchsticks:l.matchsticks?Et.add(r.resources.matchsticks,l.matchsticks):r.resources.matchsticks,money:r.resources.money+(l.money||0),wood:r.resources.wood+(l.wood||0),reputation:r.resources.reputation+(l.reputation||0)}}))}catch(r){ke.handleError(xe.gameLogic("Failed to add resources",{error:r,additions:l}))}},subtractResources(l){try{const r=lt(de);return l.matchsticks&&Et.compare(r.resources.matchsticks,l.matchsticks)<0||l.money&&r.resources.money<l.money||l.wood&&r.resources.wood<l.wood||l.reputation&&r.resources.reputation<l.reputation?!1:(de.update(i=>({...i,resources:{matchsticks:l.matchsticks?Et.subtract(i.resources.matchsticks,l.matchsticks):i.resources.matchsticks,money:i.resources.money-(l.money||0),wood:i.resources.wood-(l.wood||0),reputation:i.resources.reputation-(l.reputation||0)}})),!0)}catch(r){return ke.handleError(xe.gameLogic("Failed to subtract resources",{error:r,subtractions:l})),!1}},updateProduction(l){try{de.update(r=>({...r,production:{...r.production,...l,lastUpdate:Date.now()}}))}catch(r){ke.handleError(xe.gameLogic("Failed to update production",{error:r,updates:l}))}},updateMarket(l){try{de.update(r=>({...r,market:{...r.market,...l}}))}catch(r){ke.handleError(xe.gameLogic("Failed to update market",{error:r,updates:l}))}},emitEvent(l){try{Sn.update(r=>[l,...r].slice(0,100))}catch(r){ke.handleError(xe.gameLogic("Failed to emit event",{error:r,event:l}))}},clearEvents(){Sn.set([])},produceMatchsticks(l=1){try{const r=lt(de),i=BigInt(Math.floor(l*r.production.manualRate));Se.addResources({matchsticks:i}),Se.updateProduction({totalProduced:Et.add(r.production.totalProduced,i)}),Se.emitEvent({id:ja(),type:"matchsticks_produced",timestamp:Date.now(),data:{amount:i,method:"manual"},source:"production_system"})}catch(r){ke.handleError(xe.gameLogic("Failed to produce matchsticks",{error:r,amount:l}))}},sellMatchsticks(l){try{const r=lt(de);if(Et.compare(r.resources.matchsticks,l)<0)return!1;const i=Number(l)*r.market.currentPrice;return Se.subtractResources({matchsticks:l})?(Se.addResources({money:i}),Se.updateMarket({totalSold:Et.add(r.market.totalSold,l),totalRevenue:r.market.totalRevenue+i}),Se.emitEvent({id:ja(),type:"matchsticks_sold",timestamp:Date.now(),data:{amount:l,revenue:i,price:r.market.currentPrice},source:"market_system"}),!0):!1}catch(r){return ke.handleError(xe.gameLogic("Failed to sell matchsticks",{error:r,amount:l})),!1}},updateAutomation(l){try{de.update(r=>({...r,automation:{...r.automation,...l}}))}catch(r){ke.handleError(xe.gameLogic("Failed to update automation",{error:r,updates:l}))}},updateAchievements(l){try{de.update(r=>({...r,achievements:{...r.achievements,...l}}))}catch(r){ke.handleError(xe.gameLogic("Failed to update achievements",{error:r,updates:l}))}}};or([wo,xo],([l,r])=>{try{const i=l.manualRate,c=l.automatedRate,h=Object.values(l.multipliers).reduce((g,_)=>g+_,1);return(i+c)*h}catch(i){return ke.handleError(xe.gameLogic("Failed to calculate production rate",{error:i})),0}}),or([bo,ko],([l,r])=>{try{const i=Number(l.matchsticks)*r.currentPrice;return l.money+i+l.wood*10+l.reputation*5}catch(i){return ke.handleError(xe.gameLogic("Failed to calculate net worth",{error:i})),0}}),or([Co,So],([l,r])=>l.isActive&&r.currentPhase==="manual");function Po(l){try{const r={...Gn(),...l};return typeof r.resources.matchsticks=="string"&&(r.resources.matchsticks=BigInt(r.resources.matchsticks)),Et.isSafe(r.resources.matchsticks)||(r.resources.matchsticks=0n),r.resources.money=Math.max(0,r.resources.money||0),r.resources.wood=Math.max(0,r.resources.wood||0),r.resources.reputation=Math.max(0,r.resources.reputation||0),r.metadata.lastSaved=r.metadata.lastSaved||Date.now(),r.metadata.createdAt=r.metadata.createdAt||Date.now(),r.metadata.sessionStartTime=Date.now(),r}catch(r){return ke.handleError(xe.gameLogic("Failed to validate game state",{error:r})),Gn()}}const Ao={stateUpdateCount:0,lastUpdateTime:Date.now(),trackUpdate(){this.stateUpdateCount++,this.lastUpdateTime=Date.now()},getStats(){return{updateCount:this.stateUpdateCount,lastUpdate:this.lastUpdateTime,updatesPerMinute:this.stateUpdateCount/((Date.now()-this.lastUpdateTime)/6e4)}}};de.subscribe(()=>{Ao.trackUpdate()});var Eo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mo(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Hn={exports:{}},Io=Hn.exports,xi;function jo(){return xi||(xi=1,function(l,r){(function(i,c){l.exports=c()})(Io,function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(e,t)},c=function(){return(c=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function h(e,t,n){for(var a,s=0,u=t.length;s<u;s++)!a&&s in t||((a=a||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(a||Array.prototype.slice.call(t))}var g=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Eo,_=Object.keys,A=Array.isArray;function q(e,t){return typeof t!="object"||_(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||g.Promise||(g.Promise=Promise);var R=Object.getPrototypeOf,$={}.hasOwnProperty;function K(e,t){return $.call(e,t)}function W(e,t){typeof t=="function"&&(t=t(R(e))),(typeof Reflect>"u"?_:Reflect.ownKeys)(t).forEach(function(n){X(e,n,t[n])})}var ue=Object.defineProperty;function X(e,t,n,a){ue(e,t,q(n&&K(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},a))}function ee(e){return{from:function(t){return e.prototype=Object.create(t.prototype),X(e.prototype,"constructor",e),{extend:W.bind(null,e.prototype)}}}}var te=Object.getOwnPropertyDescriptor,ce=[].slice;function oe(e,t,n){return ce.call(e,t,n)}function we(e,t){return t(e)}function Ce(e){if(!e)throw new Error("Assertion Failed")}function _e(e){g.setImmediate?setImmediate(e):setTimeout(e,0)}function V(e,t){if(typeof t=="string"&&K(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],a=0,s=t.length;a<s;++a){var u=V(e,t[a]);n.push(u)}return n}var f=t.indexOf(".");if(f!==-1){var m=e[t.substr(0,f)];return m==null?void 0:V(m,t.substr(f+1))}}function ne(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Ce(typeof n!="string"&&"length"in n);for(var a=0,s=t.length;a<s;++a)ne(e,t[a],n[a])}else{var u,f,m=t.indexOf(".");m!==-1?(u=t.substr(0,m),(f=t.substr(m+1))===""?n===void 0?A(e)&&!isNaN(parseInt(u))?e.splice(u,1):delete e[u]:e[u]=n:ne(m=!(m=e[u])||!K(e,u)?e[u]={}:m,f,n)):n===void 0?A(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Ie(e){var t,n={};for(t in e)K(e,t)&&(n[t]=e[t]);return n}var Ze=[].concat;function ut(e){return Ze.apply([],e)}var pe="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ut([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return g[e]}),dt=new Set(pe.map(function(e){return g[e]})),je=null;function Te(e){return je=new WeakMap,e=function t(n){if(!n||typeof n!="object")return n;var a=je.get(n);if(a)return a;if(A(n)){a=[],je.set(n,a);for(var s=0,u=n.length;s<u;++s)a.push(t(n[s]))}else if(dt.has(n.constructor))a=n;else{var f,m=R(n);for(f in a=m===Object.prototype?{}:Object.create(m),je.set(n,a),n)K(n,f)&&(a[f]=t(n[f]))}return a}(e),je=null,e}var We={}.toString;function et(e){return We.call(e).slice(8,-1)}var gt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",St=typeof gt=="symbol"?function(e){var t;return e!=null&&(t=e[gt])&&t.apply(e)}:function(){return null};function Xe(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var tt={};function se(e){var t,n,a,s;if(arguments.length===1){if(A(e))return e.slice();if(this===tt&&typeof e=="string")return[e];if(s=St(e)){for(n=[];!(a=s.next()).done;)n.push(a.value);return n}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var G=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},fe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ur=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(fe),at={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ge(e,t){this.name=e,this.message=t}function it(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,a,s){return s.indexOf(n)===a}).join(`
`)}function vt(e,t,n,a){this.failures=t,this.failedKeys=a,this.successCount=n,this.message=it(e,t)}function st(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=it(e,this.failures)}ee(ge).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ee(vt).from(ge),ee(st).from(ge);var _t=ur.reduce(function(e,t){return e[t]=t+"Error",e},{}),Ct=ge,J=ur.reduce(function(e,t){var n=t+"Error";function a(s,u){this.name=n,s?typeof s=="string"?(this.message="".concat(s).concat(u?`
 `+u:""),this.inner=u||null):typeof s=="object"&&(this.message="".concat(s.name," ").concat(s.message),this.inner=s):(this.message=at[t]||n,this.inner=null)}return ee(a).from(Ct),e[t]=a,e},{});J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError;var Mt=fe.reduce(function(e,t){return e[t+"Error"]=J[t],e},{}),le=ur.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=J[t]),e},{});function U(){}function Ae(e){return e}function Re(e,t){return e==null||e===Ae?t:function(n){return t(e(n))}}function qe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ve(e,t){return e===U?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var a=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var u=t.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?qe(a,this.onsuccess):a),s&&(this.onerror=this.onerror?qe(s,this.onerror):s),u!==void 0?u:n}}function Ye(e,t){return e===U?t:function(){e.apply(this,arguments);var n=this.onsuccess,a=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?qe(n,this.onsuccess):n),a&&(this.onerror=this.onerror?qe(a,this.onerror):a)}}function bt(e,t){return e===U?t:function(n){var a=e.apply(this,arguments);q(n,a);var s=this.onsuccess,u=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),s&&(this.onsuccess=this.onsuccess?qe(s,this.onsuccess):s),u&&(this.onerror=this.onerror?qe(u,this.onerror):u),a===void 0?n===void 0?void 0:n:q(a,n)}}function wt(e,t){return e===U?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function ve(e,t){return e===U?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var a=this,s=arguments.length,u=new Array(s);s--;)u[s]=arguments[s];return n.then(function(){return t.apply(a,u)})}return t.apply(this,arguments)}}le.ModifyError=vt,le.DexieError=ge,le.BulkError=st;var z=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Pe(e){z=e}var De={},he=100,pe=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,R(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,R(t),e]}(),fe=pe[0],ur=pe[1],pe=pe[2],ur=ur&&ur.then,Oe=fe&&fe.constructor,Pt=!!pe,ft=function(e,t){kt.push([e,t]),mt&&(queueMicrotask(rt),mt=!1)},ot=!0,mt=!0,yt=[],Rt=[],Ne=Ae,me={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:U,pgp:!1,env:{},finalize:U},F=me,kt=[],ht=0,qt=[];function N(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=F;if(typeof e!="function"){if(e!==De)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&rr(this,this._value))}this._state=null,this._value=null,++t.ref,function n(a,s){try{s(function(u){if(a._state===null){if(u===a)throw new TypeError("A promise cannot be resolved with itself.");var f=a._lib&&It();u&&typeof u.then=="function"?n(a,function(m,b){u instanceof N?u._then(m,b):u.then(m,b)}):(a._state=!0,a._value=u,fr(a)),f&&Wt()}},rr.bind(null,a))}catch(u){rr(a,u)}}(this,e)}var Gt={get:function(){var e=F,t=Ft;function n(a,s){var u=this,f=!e.global&&(e!==F||t!==Ft),m=f&&!Kt(),b=new N(function(k,C){cr(u,new Qt(Sr(a,e,f,m),Sr(s,e,f,m),k,C,e))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return n.prototype=De,n},set:function(e){X(this,"then",e&&e.prototype===De?Gt:{get:function(){return e},set:Gt.set})}};function Qt(e,t,n,a,s){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=a,this.psd=s}function rr(e,t){var n,a;Rt.push(t),e._state===null&&(n=e._lib&&It(),t=Ne(t),e._state=!1,e._value=t,a=e,yt.some(function(s){return s._value===a._value})||yt.push(a),fr(e),n&&Wt())}function fr(e){var t=e._listeners;e._listeners=[];for(var n=0,a=t.length;n<a;++n)cr(e,t[n]);var s=e._PSD;--s.ref||s.finalize(),ht===0&&(++ht,ft(function(){--ht==0&&Be()},[]))}function cr(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++ht,ft(kr,[n,e,t])}else e._listeners.push(t)}function kr(e,t,n){try{var a,s=t._value;!t._state&&Rt.length&&(Rt=[]),a=z&&t._consoleTask?t._consoleTask.run(function(){return e(s)}):e(s),t._state||Rt.indexOf(s)!==-1||function(u){for(var f=yt.length;f;)if(yt[--f]._value===u._value)return yt.splice(f,1)}(t),n.resolve(a)}catch(u){n.reject(u)}finally{--ht==0&&Be(),--n.psd.ref||n.psd.finalize()}}function rt(){zt(me,function(){It()&&Wt()})}function It(){var e=ot;return mt=ot=!1,e}function Wt(){var e,t,n;do for(;0<kt.length;)for(e=kt,kt=[],n=e.length,t=0;t<n;++t){var a=e[t];a[0].apply(null,a[1])}while(0<kt.length);mt=ot=!0}function Be(){var e=yt;yt=[],e.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)});for(var t=qt.slice(0),n=t.length;n;)t[--n]()}function Ge(e){return new N(De,!1,e)}function Ee(e,t){var n=F;return function(){var a=It(),s=F;try{return Zt(n,!0),e.apply(this,arguments)}catch(u){t&&t(u)}finally{Zt(s,!1),a&&Wt()}}}W(N.prototype,{then:Gt,_then:function(e,t){cr(this,new Qt(null,null,e,t,F))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t=="function"?this.then(null,function(a){return(a instanceof t?n:Ge)(a)}):this.then(null,function(a){return(a&&a.name===t?n:Ge)(a)})},finally:function(e){return this.then(function(t){return N.resolve(e()).then(function(){return t})},function(t){return N.resolve(e()).then(function(){return Ge(t)})})},timeout:function(e,t){var n=this;return e<1/0?new N(function(a,s){var u=setTimeout(function(){return s(new J.Timeout(t))},e);n.then(a,s).finally(clearTimeout.bind(null,u))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&X(N.prototype,Symbol.toStringTag,"Dexie.Promise"),me.env=Yr(),W(N,{all:function(){var e=se.apply(null,arguments).map(Jt);return new N(function(t,n){e.length===0&&t([]);var a=e.length;e.forEach(function(s,u){return N.resolve(s).then(function(f){e[u]=f,--a||t(e)},n)})})},resolve:function(e){return e instanceof N?e:e&&typeof e.then=="function"?new N(function(t,n){e.then(t,n)}):new N(De,!0,e)},reject:Ge,race:function(){var e=se.apply(null,arguments).map(Jt);return new N(function(t,n){e.map(function(a){return N.resolve(a).then(t,n)})})},PSD:{get:function(){return F},set:function(e){return F=e}},totalEchoes:{get:function(){return Ft}},newPSD:Xt,usePSD:zt,scheduler:{get:function(){return ft},set:function(e){ft=e}},rejectionMapper:{get:function(){return Ne},set:function(e){Ne=e}},follow:function(e,t){return new N(function(n,a){return Xt(function(s,u){var f=F;f.unhandleds=[],f.onunhandled=u,f.finalize=qe(function(){var m,b=this;m=function(){b.unhandleds.length===0?s():u(b.unhandleds[0])},qt.push(function k(){m(),qt.splice(qt.indexOf(k),1)}),++ht,ft(function(){--ht==0&&Be()},[])},f.finalize),e()},t,n,a)})}}),Oe&&(Oe.allSettled&&X(N,"allSettled",function(){var e=se.apply(null,arguments).map(Jt);return new N(function(t){e.length===0&&t([]);var n=e.length,a=new Array(n);e.forEach(function(s,u){return N.resolve(s).then(function(f){return a[u]={status:"fulfilled",value:f}},function(f){return a[u]={status:"rejected",reason:f}}).then(function(){return--n||t(a)})})})}),Oe.any&&typeof AggregateError<"u"&&X(N,"any",function(){var e=se.apply(null,arguments).map(Jt);return new N(function(t,n){e.length===0&&n(new AggregateError([]));var a=e.length,s=new Array(a);e.forEach(function(u,f){return N.resolve(u).then(function(m){return t(m)},function(m){s[f]=m,--a||n(new AggregateError(s))})})})}),Oe.withResolvers&&(N.withResolvers=Oe.withResolvers));var Qe={awaits:0,echoes:0,id:0},xt=0,Ot=[],Dt=0,Ft=0,xr=0;function Xt(e,t,n,a){var s=F,u=Object.create(s);return u.parent=s,u.ref=0,u.global=!1,u.id=++xr,me.env,u.env=Pt?{Promise:N,PromiseProp:{value:N,configurable:!0,writable:!0},all:N.all,race:N.race,allSettled:N.allSettled,any:N.any,resolve:N.resolve,reject:N.reject}:{},t&&q(u,t),++s.ref,u.finalize=function(){--this.parent.ref||this.parent.finalize()},a=zt(u,e,n,a),u.ref===0&&u.finalize(),a}function lr(){return Qe.id||(Qe.id=++xt),++Qe.awaits,Qe.echoes+=he,Qe.id}function Kt(){return!!Qe.awaits&&(--Qe.awaits==0&&(Qe.id=0),Qe.echoes=Qe.awaits*he,!0)}function Jt(e){return Qe.echoes&&e&&e.constructor===Oe?(lr(),e.then(function(t){return Kt(),t},function(t){return Kt(),jt(t)})):e}function Kr(){var e=Ot[Ot.length-1];Ot.pop(),Zt(e,!1)}function Zt(e,t){var n,a=F;(t?!Qe.echoes||Dt++&&e===F:!Dt||--Dt&&e===F)||queueMicrotask(t?(function(s){++Ft,Qe.echoes&&--Qe.echoes!=0||(Qe.echoes=Qe.awaits=Qe.id=0),Ot.push(F),Zt(s,!0)}).bind(null,e):Kr),e!==F&&(F=e,a===me&&(me.env=Yr()),Pt&&(n=me.env.Promise,t=e.env,(a.global||e.global)&&(Object.defineProperty(g,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function Yr(){var e=g.Promise;return Pt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(g,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function zt(e,t,n,a,s){var u=F;try{return Zt(e,!0),t(n,a,s)}finally{Zt(u,!1)}}function Sr(e,t,n,a){return typeof e!="function"?e:function(){var s=F;n&&lr(),Zt(t,!0);try{return e.apply(this,arguments)}finally{Zt(s,!1),a&&queueMicrotask(Kt)}}}function un(e){Promise===Oe&&Qe.echoes===0?Dt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+ur).indexOf("[native code]")===-1&&(lr=Kt=U);var jt=N.reject,Cr="ï¿¿",Pr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Na="String expected.",Qr=[],Cn="__dbnames",Jn="readonly",Zn="readwrite";function Nr(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Ba={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Pn(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=Te(t))[e],t}}function La(){throw J.Type()}function Je(e,t){try{var n=za(e),a=za(t);if(n!==a)return n==="Array"?1:a==="Array"?-1:n==="binary"?1:a==="binary"?-1:n==="string"?1:a==="string"?-1:n==="Date"?1:a!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(s,u){for(var f=s.length,m=u.length,b=f<m?f:m,k=0;k<b;++k)if(s[k]!==u[k])return s[k]<u[k]?-1:1;return f===m?0:f<m?-1:1}(Ua(e),Ua(t));case"Array":return function(s,u){for(var f=s.length,m=u.length,b=f<m?f:m,k=0;k<b;++k){var C=Je(s[k],u[k]);if(C!==0)return C}return f===m?0:f<m?-1:1}(e,t)}}catch{}return NaN}function za(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=et(e),e==="ArrayBuffer"?"binary":e)}function Ua(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Ha=(At.prototype._trans=function(e,t,n){var a=this._tx||F.trans,s=this.name,u=z&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function f(k,C,y){if(!y.schema[s])throw new J.NotFound("Table "+s+" not part of transaction");return t(y.idbtrans,y)}var m=It();try{var b=a&&a.db._novip===this.db._novip?a===F.trans?a._promise(e,f,n):Xt(function(){return a._promise(e,f,n)},{trans:a,transless:F.transless||F}):function k(C,y,E,w){if(C.idbdb&&(C._state.openComplete||F.letThrough||C._vip)){var S=C._createTransaction(y,E,C._dbSchema);try{S.create(),C._state.PR1398_maxLoop=3}catch(P){return P.name===_t.InvalidState&&C.isOpen()&&0<--C._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),C.close({disableAutoOpen:!1}),C.open().then(function(){return k(C,y,E,w)})):jt(P)}return S._promise(y,function(P,x){return Xt(function(){return F.trans=S,w(P,x,S)})}).then(function(P){if(y==="readwrite")try{S.idbtrans.commit()}catch{}return y==="readonly"?P:S._completion.then(function(){return P})})}if(C._state.openComplete)return jt(new J.DatabaseClosed(C._state.dbOpenError));if(!C._state.isBeingOpened){if(!C._state.autoOpen)return jt(new J.DatabaseClosed);C.open().catch(U)}return C._state.dbReadyPromise.then(function(){return k(C,y,E,w)})}(this.db,e,[this.name],f);return u&&(b._consoleTask=u,b=b.catch(function(k){return console.trace(k),jt(k)})),b}finally{m&&Wt()}},At.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?jt(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(a){return n.core.get({trans:a,key:e}).then(function(s){return n.hook.reading.fire(s)})}).then(t)},At.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(A(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=_(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(m){if(m.compound&&t.every(function(k){return 0<=m.keyPath.indexOf(k)})){for(var b=0;b<t.length;++b)if(t.indexOf(m.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(m,b){return m.keyPath.length-b.keyPath.length})[0];if(n&&this.db._maxKey!==Cr){var u=n.keyPath.slice(0,t.length);return this.where(u).equals(u.map(function(b){return e[b]}))}!n&&z&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var a=this.schema.idxByName;function s(m,b){return Je(m,b)===0}var f=t.reduce(function(y,b){var k=y[0],C=y[1],y=a[b],E=e[b];return[k||y,k||!y?Nr(C,y&&y.multi?function(w){return w=V(w,b),A(w)&&w.some(function(S){return s(E,S)})}:function(w){return s(E,V(w,b))}):C]},[null,null]),u=f[0],f=f[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(f):n?this.filter(f):this.where(t).equals("")},At.prototype.filter=function(e){return this.toCollection().and(e)},At.prototype.count=function(e){return this.toCollection().count(e)},At.prototype.offset=function(e){return this.toCollection().offset(e)},At.prototype.limit=function(e){return this.toCollection().limit(e)},At.prototype.each=function(e){return this.toCollection().each(e)},At.prototype.toArray=function(e){return this.toCollection().toArray(e)},At.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},At.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,A(e)?"[".concat(e.join("+"),"]"):e))},At.prototype.reverse=function(){return this.toCollection().reverse()},At.prototype.mapToClass=function(e){var t,n=this.db,a=this.name;function s(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof La&&(function(b,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function C(){this.constructor=b}i(b,k),b.prototype=k===null?Object.create(k):(C.prototype=k.prototype,new C)}(s,t=e),Object.defineProperty(s.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),s.prototype.table=function(){return a},e=s);for(var u=new Set,f=e.prototype;f;f=R(f))Object.getOwnPropertyNames(f).forEach(function(b){return u.add(b)});function m(b){if(!b)return b;var k,C=Object.create(e.prototype);for(k in b)if(!u.has(k))try{C[k]=b[k]}catch{}return C}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=m,this.hook("reading",m),e},At.prototype.defineClass=function(){return this.mapToClass(function(e){q(this,e)})},At.prototype.add=function(e,t){var n=this,a=this.schema.primKey,s=a.auto,u=a.keyPath,f=e;return u&&s&&(f=Pn(u)(e)),this._trans("readwrite",function(m){return n.core.mutate({trans:m,type:"add",keys:t!=null?[t]:null,values:[f]})}).then(function(m){return m.numFailures?N.reject(m.failures[0]):m.lastResult}).then(function(m){if(u)try{ne(e,u,m)}catch{}return m})},At.prototype.update=function(e,t){return typeof e!="object"||A(e)?this.where(":id").equals(e).modify(t):(e=V(e,this.schema.primKey.keyPath),e===void 0?jt(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},At.prototype.put=function(e,t){var n=this,a=this.schema.primKey,s=a.auto,u=a.keyPath,f=e;return u&&s&&(f=Pn(u)(e)),this._trans("readwrite",function(m){return n.core.mutate({trans:m,type:"put",values:[f],keys:t!=null?[t]:null})}).then(function(m){return m.numFailures?N.reject(m.failures[0]):m.lastResult}).then(function(m){if(u)try{ne(e,u,m)}catch{}return m})},At.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})}).then(function(n){return n.numFailures?N.reject(n.failures[0]):void 0})},At.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Ba})}).then(function(t){return t.numFailures?N.reject(t.failures[0]):void 0})},At.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(a){return a.map(function(s){return t.hook.reading.fire(s)})})})},At.prototype.bulkAdd=function(e,t,n){var a=this,s=Array.isArray(t)?t:void 0,u=(n=n||(s?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(f){var k=a.schema.primKey,m=k.auto,k=k.keyPath;if(k&&s)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var b=e.length,k=k&&m?e.map(Pn(k)):e;return a.core.mutate({trans:f,type:"add",keys:s,values:k,wantResults:u}).then(function(S){var y=S.numFailures,E=S.results,w=S.lastResult,S=S.failures;if(y===0)return u?E:w;throw new st("".concat(a.name,".bulkAdd(): ").concat(y," of ").concat(b," operations failed"),S)})})},At.prototype.bulkPut=function(e,t,n){var a=this,s=Array.isArray(t)?t:void 0,u=(n=n||(s?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(f){var k=a.schema.primKey,m=k.auto,k=k.keyPath;if(k&&s)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var b=e.length,k=k&&m?e.map(Pn(k)):e;return a.core.mutate({trans:f,type:"put",keys:s,values:k,wantResults:u}).then(function(S){var y=S.numFailures,E=S.results,w=S.lastResult,S=S.failures;if(y===0)return u?E:w;throw new st("".concat(a.name,".bulkPut(): ").concat(y," of ").concat(b," operations failed"),S)})})},At.prototype.bulkUpdate=function(e){var t=this,n=this.core,a=e.map(function(f){return f.key}),s=e.map(function(f){return f.changes}),u=[];return this._trans("readwrite",function(f){return n.getMany({trans:f,keys:a,cache:"clone"}).then(function(m){var b=[],k=[];e.forEach(function(y,E){var w=y.key,S=y.changes,P=m[E];if(P){for(var x=0,M=Object.keys(S);x<M.length;x++){var j=M[x],T=S[j];if(j===t.schema.primKey.keyPath){if(Je(T,w)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else ne(P,j,T)}u.push(E),b.push(w),k.push(P)}});var C=b.length;return n.mutate({trans:f,type:"put",keys:b,values:k,updates:{keys:a,changeSpecs:s}}).then(function(y){var E=y.numFailures,w=y.failures;if(E===0)return C;for(var S=0,P=Object.keys(w);S<P.length;S++){var x,M=P[S],j=u[Number(M)];j!=null&&(x=w[M],delete w[M],w[j]=x)}throw new st("".concat(t.name,".bulkUpdate(): ").concat(E," of ").concat(C," operations failed"),w)})})})},At.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(a){return t.core.mutate({trans:a,type:"delete",keys:e})}).then(function(f){var s=f.numFailures,u=f.lastResult,f=f.failures;if(s===0)return u;throw new st("".concat(t.name,".bulkDelete(): ").concat(s," of ").concat(n," operations failed"),f)})},At);function At(){}function dn(e){function t(f,m){if(m){for(var b=arguments.length,k=new Array(b-1);--b;)k[b-1]=arguments[b];return n[f].subscribe.apply(null,k),e}if(typeof f=="string")return n[f]}var n={};t.addEventType=u;for(var a=1,s=arguments.length;a<s;++a)u(arguments[a]);return t;function u(f,m,b){if(typeof f!="object"){var k;m=m||wt;var C={subscribers:[],fire:b=b||U,subscribe:function(y){C.subscribers.indexOf(y)===-1&&(C.subscribers.push(y),C.fire=m(C.fire,y))},unsubscribe:function(y){C.subscribers=C.subscribers.filter(function(E){return E!==y}),C.fire=C.subscribers.reduce(m,b)}};return n[f]=t[f]=C}_(k=f).forEach(function(y){var E=k[y];if(A(E))u(y,k[y][0],k[y][1]);else{if(E!=="asap")throw new J.InvalidArgument("Invalid event config");var w=u(y,Ae,function(){for(var S=arguments.length,P=new Array(S);S--;)P[S]=arguments[S];w.subscribers.forEach(function(x){_e(function(){x.apply(null,P)})})})}})}}function vn(e,t){return ee(t).from({prototype:e}),t}function Jr(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function ea(e,t){e.filter=Nr(e.filter,t)}function ta(e,t,n){var a=e.replayFilter;e.replayFilter=a?function(){return Nr(a(),t())}:t,e.justLimit=n&&!a}function An(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new J.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Va(e,t,n){var a=An(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:a,range:e.range}})}function En(e,t,n,a){var s=e.replayFilter?Nr(e.filter,e.replayFilter()):e.filter;if(e.or){var u={},f=function(m,b,k){var C,y;s&&!s(b,k,function(E){return b.stop(E)},function(E){return b.fail(E)})||((y=""+(C=b.primaryKey))=="[object ArrayBuffer]"&&(y=""+new Uint8Array(C)),K(u,y)||(u[y]=!0,t(m,b,k)))};return Promise.all([e.or._iterate(f,n),Ga(Va(e,a,n),e.algorithm,f,!e.keysOnly&&e.valueMapper)])}return Ga(Va(e,a,n),Nr(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Ga(e,t,n,a){var s=Ee(a?function(u,f,m){return n(a(u),f,m)}:n);return e.then(function(u){if(u)return u.start(function(){var f=function(){return u.continue()};t&&!t(u,function(m){return f=m},function(m){u.stop(m),f=U},function(m){u.fail(m),f=U})||s(u.value,u,function(m){return f=m}),f()})})}var fn=(Wa.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var n=t.add;if(A(n))return h(h([],A(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(t.remove!==void 0){var a=t.remove;if(A(a))return A(e)?e.filter(function(s){return!a.includes(s)}).sort():[];if(typeof a=="number")return Number(e)-a;if(typeof a=="bigint")try{return BigInt(e)-a}catch{return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return n=(n=t.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e},Wa);function Wa(e){this["@@propmod"]=e}var Gi=(nt.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,jt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},nt.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,jt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},nt.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Nr(t.algorithm,e)},nt.prototype._iterate=function(e,t){return En(this._ctx,e,t,this._ctx.table.core)},nt.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&q(n,e),t._ctx=n,t},nt.prototype.raw=function(){return this._ctx.valueMapper=null,this},nt.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return En(t,e,n,t.table.core)})},nt.prototype.count=function(e){var t=this;return this._read(function(n){var a=t._ctx,s=a.table.core;if(Jr(a,!0))return s.count({trans:n,query:{index:An(a,s.schema),range:a.range}}).then(function(f){return Math.min(f,a.limit)});var u=0;return En(a,function(){return++u,!1},n,s).then(function(){return u})}).then(e)},nt.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),a=n[0],s=n.length-1;function u(b,k){return k?u(b[n[k]],k-1):b[a]}var f=this._ctx.dir==="next"?1:-1;function m(b,k){return Je(u(b,s),u(k,s))*f}return this.toArray(function(b){return b.sort(m)}).then(t)},nt.prototype.toArray=function(e){var t=this;return this._read(function(n){var a=t._ctx;if(a.dir==="next"&&Jr(a,!0)&&0<a.limit){var s=a.valueMapper,u=An(a,a.table.core.schema);return a.table.core.query({trans:n,limit:a.limit,values:!0,query:{index:u,range:a.range}}).then(function(m){return m=m.result,s?m.map(s):m})}var f=[];return En(a,function(m){return f.push(m)},n,a.table.core).then(function(){return f})},e)},nt.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Jr(t)?ta(t,function(){var n=e;return function(a,s){return n===0||(n===1?--n:s(function(){a.advance(n),n=0}),!1)}}):ta(t,function(){var n=e;return function(){return--n<0}})),this},nt.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),ta(this._ctx,function(){var t=e;return function(n,a,s){return--t<=0&&a(s),0<=t}},!0),this},nt.prototype.until=function(e,t){return ea(this._ctx,function(n,a,s){return!e(n.value)||(a(s),t)}),this},nt.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},nt.prototype.last=function(e){return this.reverse().first(e)},nt.prototype.filter=function(e){var t;return ea(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=Nr(t.isMatch,e),this},nt.prototype.and=function(e){return this.filter(e)},nt.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},nt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},nt.prototype.desc=function(){return this.reverse()},nt.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,a){e(a.key,a)})},nt.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},nt.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,a){e(a.primaryKey,a)})},nt.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(a,s){n.push(s.key)}).then(function(){return n}).then(e)},nt.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Jr(t,!0)&&0<t.limit)return this._read(function(a){var s=An(t,t.table.core.schema);return t.table.core.query({trans:a,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(function(a){return a.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(a,s){n.push(s.primaryKey)}).then(function(){return n}).then(e)},nt.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},nt.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},nt.prototype.lastKey=function(e){return this.reverse().firstKey(e)},nt.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return ea(this._ctx,function(s){var a=s.primaryKey.toString(),s=K(t,a);return t[a]=!0,!s}),this},nt.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(a){var s,u,f;f=typeof e=="function"?e:(s=_(e),u=s.length,function(x){for(var M=!1,j=0;j<u;++j){var T=s[j],O=e[T],B=V(x,T);O instanceof fn?(ne(x,T,O.execute(B)),M=!0):B!==O&&(ne(x,T,O),M=!0)}return M});var m=n.table.core,y=m.schema.primaryKey,b=y.outbound,k=y.extractKey,C=200,y=t.db._options.modifyChunkSize;y&&(C=typeof y=="object"?y[m.name]||y["*"]||200:y);function E(x,T){var j=T.failures,T=T.numFailures;S+=x-T;for(var O=0,B=_(j);O<B.length;O++){var Q=B[O];w.push(j[Q])}}var w=[],S=0,P=[];return t.clone().primaryKeys().then(function(x){function M(T){var O=Math.min(C,x.length-T);return m.getMany({trans:a,keys:x.slice(T,T+O),cache:"immutable"}).then(function(B){for(var Q=[],L=[],H=b?[]:null,Z=[],Y=0;Y<O;++Y){var ae=B[Y],Ke={value:Te(ae),primKey:x[T+Y]};f.call(Ke,Ke.value,Ke)!==!1&&(Ke.value==null?Z.push(x[T+Y]):b||Je(k(ae),k(Ke.value))===0?(L.push(Ke.value),b&&H.push(x[T+Y])):(Z.push(x[T+Y]),Q.push(Ke.value)))}return Promise.resolve(0<Q.length&&m.mutate({trans:a,type:"add",values:Q}).then(function(Ue){for(var He in Ue.failures)Z.splice(parseInt(He),1);E(Q.length,Ue)})).then(function(){return(0<L.length||j&&typeof e=="object")&&m.mutate({trans:a,type:"put",keys:H,values:L,criteria:j,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<T}).then(function(Ue){return E(L.length,Ue)})}).then(function(){return(0<Z.length||j&&e===ra)&&m.mutate({trans:a,type:"delete",keys:Z,criteria:j,isAdditionalChunk:0<T}).then(function(Ue){return E(Z.length,Ue)})}).then(function(){return x.length>T+O&&M(T+C)})})}var j=Jr(n)&&n.limit===1/0&&(typeof e!="function"||e===ra)&&{index:n.index,range:n.range};return M(0).then(function(){if(0<w.length)throw new vt("Error modifying one or more objects",w,S,P);return x.length})})})},nt.prototype.delete=function(){var e=this._ctx,t=e.range;return Jr(e)&&(e.isPrimKey||t.type===3)?this._write(function(n){var a=e.table.core.schema.primaryKey,s=t;return e.table.core.count({trans:n,query:{index:a,range:s}}).then(function(u){return e.table.core.mutate({trans:n,type:"deleteRange",range:s}).then(function(f){var m=f.failures;if(f.lastResult,f.results,f=f.numFailures,f)throw new vt("Could not delete some values",Object.keys(m).map(function(b){return m[b]}),u-f);return u-f})})}):this.modify(ra)},nt);function nt(){}var ra=function(e,t){return t.value=null};function Wi(e,t){return e<t?-1:e===t?0:1}function Xi(e,t){return t<e?-1:e===t?0:1}function nr(e,t,n){return e=e instanceof Ya?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function Zr(e){return new e.Collection(e,function(){return Xa("")}).limit(0)}function Mn(e,t,n,a){var s,u,f,m,b,k,C,y=n.length;if(!n.every(function(S){return typeof S=="string"}))return nr(e,Na);function E(S){s=S==="next"?function(x){return x.toUpperCase()}:function(x){return x.toLowerCase()},u=S==="next"?function(x){return x.toLowerCase()}:function(x){return x.toUpperCase()},f=S==="next"?Wi:Xi;var P=n.map(function(x){return{lower:u(x),upper:s(x)}}).sort(function(x,M){return f(x.lower,M.lower)});m=P.map(function(x){return x.upper}),b=P.map(function(x){return x.lower}),C=(k=S)==="next"?"":a}E("next"),e=new e.Collection(e,function(){return jr(m[0],b[y-1]+a)}),e._ondirectionchange=function(S){E(S)};var w=0;return e._addAlgorithm(function(S,P,x){var M=S.key;if(typeof M!="string")return!1;var j=u(M);if(t(j,b,w))return!0;for(var T=null,O=w;O<y;++O){var B=function(Q,L,H,Z,Y,ae){for(var Ke=Math.min(Q.length,Z.length),Ue=-1,He=0;He<Ke;++He){var ar=L[He];if(ar!==Z[He])return Y(Q[He],H[He])<0?Q.substr(0,He)+H[He]+H.substr(He+1):Y(Q[He],Z[He])<0?Q.substr(0,He)+Z[He]+H.substr(He+1):0<=Ue?Q.substr(0,Ue)+L[Ue]+H.substr(Ue+1):null;Y(Q[He],ar)<0&&(Ue=He)}return Ke<Z.length&&ae==="next"?Q+H.substr(Q.length):Ke<Q.length&&ae==="prev"?Q.substr(0,H.length):Ue<0?null:Q.substr(0,Ue)+Z[Ue]+H.substr(Ue+1)}(M,j,m[O],b[O],f,k);B===null&&T===null?w=O+1:(T===null||0<f(T,B))&&(T=B)}return P(T!==null?function(){S.continue(T+C)}:x),!1}),e}function jr(e,t,n,a){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:a}}function Xa(e){return{type:1,lower:e,upper:e}}var Ya=(Object.defineProperty(Bt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Bt.prototype.between=function(e,t,n,a){n=n!==!1,a=a===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||a)&&(!n||!a)?Zr(this):new this.Collection(this,function(){return jr(e,t,!n,!a)})}catch{return nr(this,Pr)}},Bt.prototype.equals=function(e){return e==null?nr(this,Pr):new this.Collection(this,function(){return Xa(e)})},Bt.prototype.above=function(e){return e==null?nr(this,Pr):new this.Collection(this,function(){return jr(e,void 0,!0)})},Bt.prototype.aboveOrEqual=function(e){return e==null?nr(this,Pr):new this.Collection(this,function(){return jr(e,void 0,!1)})},Bt.prototype.below=function(e){return e==null?nr(this,Pr):new this.Collection(this,function(){return jr(void 0,e,!1,!0)})},Bt.prototype.belowOrEqual=function(e){return e==null?nr(this,Pr):new this.Collection(this,function(){return jr(void 0,e)})},Bt.prototype.startsWith=function(e){return typeof e!="string"?nr(this,Na):this.between(e,e+Cr,!0,!0)},Bt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Mn(this,function(t,n){return t.indexOf(n[0])===0},[e],Cr)},Bt.prototype.equalsIgnoreCase=function(e){return Mn(this,function(t,n){return t===n[0]},[e],"")},Bt.prototype.anyOfIgnoreCase=function(){var e=se.apply(tt,arguments);return e.length===0?Zr(this):Mn(this,function(t,n){return n.indexOf(t)!==-1},e,"")},Bt.prototype.startsWithAnyOfIgnoreCase=function(){var e=se.apply(tt,arguments);return e.length===0?Zr(this):Mn(this,function(t,n){return n.some(function(a){return t.indexOf(a)===0})},e,Cr)},Bt.prototype.anyOf=function(){var e=this,t=se.apply(tt,arguments),n=this._cmp;try{t.sort(n)}catch{return nr(this,Pr)}if(t.length===0)return Zr(this);var a=new this.Collection(this,function(){return jr(t[0],t[t.length-1])});a._ondirectionchange=function(u){n=u==="next"?e._ascending:e._descending,t.sort(n)};var s=0;return a._addAlgorithm(function(u,f,m){for(var b=u.key;0<n(b,t[s]);)if(++s===t.length)return f(m),!1;return n(b,t[s])===0||(f(function(){u.continue(t[s])}),!1)}),a},Bt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Bt.prototype.noneOf=function(){var e=se.apply(tt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return nr(this,Pr)}var t=e.reduce(function(n,a){return n?n.concat([[n[n.length-1][1],a]]):[[-1/0,a]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Bt.prototype.inAnyRange=function(M,t){var n=this,a=this._cmp,s=this._ascending,u=this._descending,f=this._min,m=this._max;if(M.length===0)return Zr(this);if(!M.every(function(j){return j[0]!==void 0&&j[1]!==void 0&&s(j[0],j[1])<=0}))return nr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var b=!t||t.includeLowers!==!1,k=t&&t.includeUppers===!0,C,y=s;function E(j,T){return y(j[0],T[0])}try{(C=M.reduce(function(j,T){for(var O=0,B=j.length;O<B;++O){var Q=j[O];if(a(T[0],Q[1])<0&&0<a(T[1],Q[0])){Q[0]=f(Q[0],T[0]),Q[1]=m(Q[1],T[1]);break}}return O===B&&j.push(T),j},[])).sort(E)}catch{return nr(this,Pr)}var w=0,S=k?function(j){return 0<s(j,C[w][1])}:function(j){return 0<=s(j,C[w][1])},P=b?function(j){return 0<u(j,C[w][0])}:function(j){return 0<=u(j,C[w][0])},x=S,M=new this.Collection(this,function(){return jr(C[0][0],C[C.length-1][1],!b,!k)});return M._ondirectionchange=function(j){y=j==="next"?(x=S,s):(x=P,u),C.sort(E)},M._addAlgorithm(function(j,T,O){for(var B,Q=j.key;x(Q);)if(++w===C.length)return T(O),!1;return!S(B=Q)&&!P(B)||(n._cmp(Q,C[w][1])===0||n._cmp(Q,C[w][0])===0||T(function(){y===s?j.continue(C[w][0]):j.continue(C[w][1])}),!1)}),M},Bt.prototype.startsWithAnyOf=function(){var e=se.apply(tt,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?Zr(this):this.inAnyRange(e.map(function(t){return[t,t+Cr]})):nr(this,"startsWithAnyOf() only works with strings")},Bt);function Bt(){}function hr(e){return Ee(function(t){return hn(t),e(t.target.error),!1})}function hn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var pn="storagemutated",na="x-storagemutated-1",Tr=dn(null,pn),Yi=(pr.prototype._lock=function(){return Ce(!F.global),++this._reculock,this._reculock!==1||F.global||(F.lockOwnerFor=this),this},pr.prototype._unlock=function(){if(Ce(!F.global),--this._reculock==0)for(F.global||(F.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{zt(e[1],e[0])}catch{}}return this},pr.prototype._locked=function(){return this._reculock&&F.lockOwnerFor!==this},pr.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,a=this.db._state.dbOpenError;if(Ce(!this.idbtrans),!e&&!n)switch(a&&a.name){case"DatabaseClosedError":throw new J.DatabaseClosed(a);case"MissingAPIError":throw new J.MissingAPI(a.message,a);default:throw new J.OpenFailed(a)}if(!this.active)throw new J.TransactionInactive;return Ce(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ee(function(s){hn(s),t._reject(e.error)}),e.onabort=Ee(function(s){hn(s),t.active&&t._reject(new J.Abort(e.error)),t.active=!1,t.on("abort").fire(s)}),e.oncomplete=Ee(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Tr.storagemutated.fire(e.mutatedParts)}),this},pr.prototype._promise=function(e,t,n){var a=this;if(e==="readwrite"&&this.mode!=="readwrite")return jt(new J.ReadOnly("Transaction is readonly"));if(!this.active)return jt(new J.TransactionInactive);if(this._locked())return new N(function(u,f){a._blockedFuncs.push([function(){a._promise(e,t,n).then(u,f)},F])});if(n)return Xt(function(){var u=new N(function(f,m){a._lock();var b=t(f,m,a);b&&b.then&&b.then(f,m)});return u.finally(function(){return a._unlock()}),u._lib=!0,u});var s=new N(function(u,f){var m=t(u,f,a);m&&m.then&&m.then(u,f)});return s._lib=!0,s},pr.prototype._root=function(){return this.parent?this.parent._root():this},pr.prototype.waitFor=function(e){var t,n=this._root(),a=N.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return a}):(n._waitingFor=a,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function u(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=u)}());var s=n._waitingFor;return new N(function(u,f){a.then(function(m){return n._waitingQueue.push(Ee(u.bind(null,m)))},function(m){return n._waitingQueue.push(Ee(f.bind(null,m)))}).finally(function(){n._waitingFor===s&&(n._waitingFor=null)})})},pr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},pr.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(K(t,e))return t[e];var n=this.schema[e];if(!n)throw new J.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},pr);function pr(){}function aa(e,t,n,a,s,u,f){return{name:e,keyPath:t,unique:n,multi:a,auto:s,compound:u,src:(n&&!f?"&":"")+(a?"*":"")+(s?"++":"")+Qa(t)}}function Qa(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function ia(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(a=function(s){return[s.name,s]},n.reduce(function(s,u,f){return f=a(u,f),f&&(s[f[0]]=f[1]),s},{}))};var a}var mn=function(e){try{return e.only([[]]),mn=function(){return[[]]},[[]]}catch{return mn=function(){return Cr},Cr}};function sa(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return V(n,t)}:function(n){return V(n,e)};var t}function Ja(e){return[].slice.call(e)}var Qi=0;function yn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Ji(e,t,b){function a(x){if(x.type===3)return null;if(x.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var w=x.lower,S=x.upper,P=x.lowerOpen,x=x.upperOpen;return w===void 0?S===void 0?null:t.upperBound(S,!!x):S===void 0?t.lowerBound(w,!!P):t.bound(w,S,!!P,!!x)}function s(E){var w,S=E.name;return{name:S,schema:E,mutate:function(P){var x=P.trans,M=P.type,j=P.keys,T=P.values,O=P.range;return new Promise(function(B,Q){B=Ee(B);var L=x.objectStore(S),H=L.keyPath==null,Z=M==="put"||M==="add";if(!Z&&M!=="delete"&&M!=="deleteRange")throw new Error("Invalid operation type: "+M);var Y,ae=(j||T||{length:1}).length;if(j&&T&&j.length!==T.length)throw new Error("Given keys array must have same length as given values array.");if(ae===0)return B({numFailures:0,failures:{},results:[],lastResult:void 0});function Ke(Yt){++ar,hn(Yt)}var Ue=[],He=[],ar=0;if(M==="deleteRange"){if(O.type===4)return B({numFailures:ar,failures:He,results:[],lastResult:void 0});O.type===3?Ue.push(Y=L.clear()):Ue.push(Y=L.delete(a(O)))}else{var H=Z?H?[T,j]:[T,null]:[j,null],$e=H[0],Ht=H[1];if(Z)for(var Vt=0;Vt<ae;++Vt)Ue.push(Y=Ht&&Ht[Vt]!==void 0?L[M]($e[Vt],Ht[Vt]):L[M]($e[Vt])),Y.onerror=Ke;else for(Vt=0;Vt<ae;++Vt)Ue.push(Y=L[M]($e[Vt])),Y.onerror=Ke}function Ln(Yt){Yt=Yt.target.result,Ue.forEach(function(zr,Sa){return zr.error!=null&&(He[Sa]=zr.error)}),B({numFailures:ar,failures:He,results:M==="delete"?j:Ue.map(function(zr){return zr.result}),lastResult:Yt})}Y.onerror=function(Yt){Ke(Yt),Ln(Yt)},Y.onsuccess=Ln})},getMany:function(P){var x=P.trans,M=P.keys;return new Promise(function(j,T){j=Ee(j);for(var O,B=x.objectStore(S),Q=M.length,L=new Array(Q),H=0,Z=0,Y=function(Ue){Ue=Ue.target,L[Ue._pos]=Ue.result,++Z===H&&j(L)},ae=hr(T),Ke=0;Ke<Q;++Ke)M[Ke]!=null&&((O=B.get(M[Ke]))._pos=Ke,O.onsuccess=Y,O.onerror=ae,++H);H===0&&j(L)})},get:function(P){var x=P.trans,M=P.key;return new Promise(function(j,T){j=Ee(j);var O=x.objectStore(S).get(M);O.onsuccess=function(B){return j(B.target.result)},O.onerror=hr(T)})},query:(w=k,function(P){return new Promise(function(x,M){x=Ee(x);var j,T,O,H=P.trans,B=P.values,Q=P.limit,Y=P.query,L=Q===1/0?void 0:Q,Z=Y.index,Y=Y.range,H=H.objectStore(S),Z=Z.isPrimaryKey?H:H.index(Z.name),Y=a(Y);if(Q===0)return x({result:[]});w?((L=B?Z.getAll(Y,L):Z.getAllKeys(Y,L)).onsuccess=function(ae){return x({result:ae.target.result})},L.onerror=hr(M)):(j=0,T=!B&&"openKeyCursor"in Z?Z.openKeyCursor(Y):Z.openCursor(Y),O=[],T.onsuccess=function(ae){var Ke=T.result;return Ke?(O.push(B?Ke.value:Ke.primaryKey),++j===Q?x({result:O}):void Ke.continue()):x({result:O})},T.onerror=hr(M))})}),openCursor:function(P){var x=P.trans,M=P.values,j=P.query,T=P.reverse,O=P.unique;return new Promise(function(B,Q){B=Ee(B);var Z=j.index,L=j.range,H=x.objectStore(S),H=Z.isPrimaryKey?H:H.index(Z.name),Z=T?O?"prevunique":"prev":O?"nextunique":"next",Y=!M&&"openKeyCursor"in H?H.openKeyCursor(a(L),Z):H.openCursor(a(L),Z);Y.onerror=hr(Q),Y.onsuccess=Ee(function(ae){var Ke,Ue,He,ar,$e=Y.result;$e?($e.___id=++Qi,$e.done=!1,Ke=$e.continue.bind($e),Ue=(Ue=$e.continuePrimaryKey)&&Ue.bind($e),He=$e.advance.bind($e),ar=function(){throw new Error("Cursor not stopped")},$e.trans=x,$e.stop=$e.continue=$e.continuePrimaryKey=$e.advance=function(){throw new Error("Cursor not started")},$e.fail=Ee(Q),$e.next=function(){var Ht=this,Vt=1;return this.start(function(){return Vt--?Ht.continue():Ht.stop()}).then(function(){return Ht})},$e.start=function(Ht){function Vt(){if(Y.result)try{Ht()}catch(Yt){$e.fail(Yt)}else $e.done=!0,$e.start=function(){throw new Error("Cursor behind last entry")},$e.stop()}var Ln=new Promise(function(Yt,zr){Yt=Ee(Yt),Y.onerror=hr(zr),$e.fail=zr,$e.stop=function(Sa){$e.stop=$e.continue=$e.continuePrimaryKey=$e.advance=ar,Yt(Sa)}});return Y.onsuccess=Ee(function(Yt){Y.onsuccess=Vt,Vt()}),$e.continue=Ke,$e.continuePrimaryKey=Ue,$e.advance=He,Vt(),Ln},B($e)):B(null)},Q)})},count:function(P){var x=P.query,M=P.trans,j=x.index,T=x.range;return new Promise(function(O,B){var Q=M.objectStore(S),L=j.isPrimaryKey?Q:Q.index(j.name),Q=a(T),L=Q?L.count(Q):L.count();L.onsuccess=Ee(function(H){return O(H.target.result)}),L.onerror=hr(B)})}}}var u,f,m,C=(f=b,m=Ja((u=e).objectStoreNames),{schema:{name:u.name,tables:m.map(function(E){return f.objectStore(E)}).map(function(E){var w=E.keyPath,x=E.autoIncrement,S=A(w),P={},x={name:E.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w==null,compound:S,keyPath:w,autoIncrement:x,unique:!0,extractKey:sa(w)},indexes:Ja(E.indexNames).map(function(M){return E.index(M)}).map(function(O){var j=O.name,T=O.unique,B=O.multiEntry,O=O.keyPath,B={name:j,compound:A(O),keyPath:O,unique:T,multiEntry:B,extractKey:sa(O)};return P[yn(O)]=B}),getIndexByKeyPath:function(M){return P[yn(M)]}};return P[":id"]=x.primaryKey,w!=null&&(P[yn(w)]=x.primaryKey),x})},hasGetAll:0<m.length&&"getAll"in f.objectStore(m[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),b=C.schema,k=C.hasGetAll,C=b.tables.map(s),y={};return C.forEach(function(E){return y[E.name]=E}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(E){if(!y[E])throw new Error("Table '".concat(E,"' not found"));return y[E]},MIN_KEY:-1/0,MAX_KEY:mn(t),schema:b}}function Zi(e,t,n,a){var s=n.IDBKeyRange;return n.indexedDB,{dbcore:(a=Ji(t,s,a),e.dbcore.reduce(function(u,f){return f=f.create,c(c({},u),f(u))},a))}}function In(e,a){var n=a.db,a=Zi(e._middlewares,n,e._deps,a);e.core=a.dbcore,e.tables.forEach(function(s){var u=s.name;e.core.schema.tables.some(function(f){return f.name===u})&&(s.core=e.core.table(u),e[u]instanceof e.Table&&(e[u].core=s.core))})}function jn(e,t,n,a){n.forEach(function(s){var u=a[s];t.forEach(function(f){var m=function b(k,C){return te(k,C)||(k=R(k))&&b(k,C)}(f,s);(!m||"value"in m&&m.value===void 0)&&(f===e.Transaction.prototype||f instanceof e.Transaction?X(f,s,{get:function(){return this.table(s)},set:function(b){ue(this,s,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):f[s]=new e.Table(s,u))})})}function oa(e,t){t.forEach(function(n){for(var a in n)n[a]instanceof e.Table&&delete n[a]})}function es(e,t){return e._cfg.version-t._cfg.version}function ts(e,t,n,a){var s=e._dbSchema;n.objectStoreNames.contains("$meta")&&!s.$meta&&(s.$meta=ia("$meta",ei("")[0],[]),e._storeNames.push("$meta"));var u=e._createTransaction("readwrite",e._storeNames,s);u.create(n),u._completion.catch(a);var f=u._reject.bind(u),m=F.transless||F;Xt(function(){return F.trans=u,F.transless=m,t!==0?(In(e,n),k=t,((b=u).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(C){return C??k}):N.resolve(k)).then(function(C){return E=C,w=u,S=n,P=[],C=(y=e)._versions,x=y._dbSchema=Rn(0,y.idbdb,S),(C=C.filter(function(M){return M._cfg.version>=E})).length!==0?(C.forEach(function(M){P.push(function(){var j=x,T=M._cfg.dbschema;qn(y,j,S),qn(y,T,S),x=y._dbSchema=T;var O=ca(j,T);O.add.forEach(function(Z){la(S,Z[0],Z[1].primKey,Z[1].indexes)}),O.change.forEach(function(Z){if(Z.recreate)throw new J.Upgrade("Not yet support for changing primary key");var Y=S.objectStore(Z.name);Z.add.forEach(function(ae){return Tn(Y,ae)}),Z.change.forEach(function(ae){Y.deleteIndex(ae.name),Tn(Y,ae)}),Z.del.forEach(function(ae){return Y.deleteIndex(ae)})});var B=M._cfg.contentUpgrade;if(B&&M._cfg.version>E){In(y,S),w._memoizedTables={};var Q=Ie(T);O.del.forEach(function(Z){Q[Z]=j[Z]}),oa(y,[y.Transaction.prototype]),jn(y,[y.Transaction.prototype],_(Q),Q),w.schema=Q;var L,H=G(B);return H&&lr(),O=N.follow(function(){var Z;(L=B(w))&&H&&(Z=Kt.bind(null,null),L.then(Z,Z))}),L&&typeof L.then=="function"?N.resolve(L):O.then(function(){return L})}}),P.push(function(j){var T,O,B=M._cfg.dbschema;T=B,O=j,[].slice.call(O.db.objectStoreNames).forEach(function(Q){return T[Q]==null&&O.db.deleteObjectStore(Q)}),oa(y,[y.Transaction.prototype]),jn(y,[y.Transaction.prototype],y._storeNames,y._dbSchema),w.schema=y._dbSchema}),P.push(function(j){y.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(y.idbdb.version/10)===M._cfg.version?(y.idbdb.deleteObjectStore("$meta"),delete y._dbSchema.$meta,y._storeNames=y._storeNames.filter(function(T){return T!=="$meta"})):j.objectStore("$meta").put(M._cfg.version,"version"))})}),function M(){return P.length?N.resolve(P.shift()(w.idbtrans)).then(M):N.resolve()}().then(function(){Za(x,S)})):N.resolve();var y,E,w,S,P,x}).catch(f)):(_(s).forEach(function(C){la(n,C,s[C].primKey,s[C].indexes)}),In(e,n),void N.follow(function(){return e.on.populate.fire(u)}).catch(f));var b,k})}function rs(e,t){Za(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Rn(0,e.idbdb,t);qn(e,e._dbSchema,t);for(var a=0,s=ca(n,e._dbSchema).change;a<s.length;a++){var u=function(f){if(f.change.length||f.recreate)return console.warn("Unable to patch indexes of table ".concat(f.name," because it has changes on the type of index or primary key.")),{value:void 0};var m=t.objectStore(f.name);f.add.forEach(function(b){z&&console.debug("Dexie upgrade patch: Creating missing index ".concat(f.name,".").concat(b.src)),Tn(m,b)})}(s[a]);if(typeof u=="object")return u.value}}function ca(e,t){var n,a={del:[],add:[],change:[]};for(n in e)t[n]||a.del.push(n);for(n in t){var s=e[n],u=t[n];if(s){var f={name:n,def:u,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(u.primKey.keyPath||"")||s.primKey.auto!==u.primKey.auto)f.recreate=!0,a.change.push(f);else{var m=s.idxByName,b=u.idxByName,k=void 0;for(k in m)b[k]||f.del.push(k);for(k in b){var C=m[k],y=b[k];C?C.src!==y.src&&f.change.push(y):f.add.push(y)}(0<f.del.length||0<f.add.length||0<f.change.length)&&a.change.push(f)}}else a.add.push([n,u])}return a}function la(e,t,n,a){var s=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return a.forEach(function(u){return Tn(s,u)}),s}function Za(e,t){_(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(z&&console.debug("Dexie: Creating missing table",n),la(t,n,e[n].primKey,e[n].indexes))})}function Tn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Rn(e,t,n){var a={};return oe(t.objectStoreNames,0).forEach(function(s){for(var u=n.objectStore(s),f=aa(Qa(k=u.keyPath),k||"",!0,!1,!!u.autoIncrement,k&&typeof k!="string",!0),m=[],b=0;b<u.indexNames.length;++b){var C=u.index(u.indexNames[b]),k=C.keyPath,C=aa(C.name,k,!!C.unique,!!C.multiEntry,!1,k&&typeof k!="string",!1);m.push(C)}a[s]=ia(s,f,m)}),a}function qn(e,t,n){for(var a=n.db.objectStoreNames,s=0;s<a.length;++s){var u=a[s],f=n.objectStore(u);e._hasGetAll="getAll"in f;for(var m=0;m<f.indexNames.length;++m){var b=f.indexNames[m],k=f.index(b).keyPath,C=typeof k=="string"?k:"["+oe(k).join("+")+"]";!t[u]||(k=t[u].idxByName[C])&&(k.name=b,delete t[u].idxByName[C],t[u].idxByName[b]=k)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&g.WorkerGlobalScope&&g instanceof g.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function ei(e){return e.split(",").map(function(t,n){var a=(t=t.trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return aa(a,s||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),A(s),n===0)})}var ns=(On.prototype._parseStoresSpec=function(e,t){_(e).forEach(function(n){if(e[n]!==null){var a=ei(e[n]),s=a.shift();if(s.unique=!0,s.multi)throw new J.Schema("Primary key cannot be multi-valued");a.forEach(function(u){if(u.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),t[n]=ia(n,s,a)}})},On.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?q(this._cfg.storesSource,n):n;var n=t._versions,a={},s={};return n.forEach(function(u){q(a,u._cfg.storesSource),s=u._cfg.dbschema={},u._parseStoresSpec(a,s)}),t._dbSchema=s,oa(t,[t._allTables,t,t.Transaction.prototype]),jn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],_(s),s),t._storeNames=_(s),this},On.prototype.upgrade=function(e){return this._cfg.contentUpgrade=ve(this._cfg.contentUpgrade||U,e),this},On);function On(){}function ua(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ar(Cn,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function da(e){return e&&typeof e.databases=="function"}function va(e){return Xt(function(){return F.letThrough=!0,e()})}function fa(e){return!("from"in e)}var Ut=function(e,t){if(!this){var n=new Ut;return e&&"d"in e&&q(n,e),n}q(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function gn(e,t,n){var a=Je(t,n);if(!isNaN(a)){if(0<a)throw RangeError();if(fa(e))return q(e,{from:t,to:n,d:1});var s=e.l,a=e.r;if(Je(n,e.from)<0)return s?gn(s,t,n):e.l={from:t,to:n,d:1,l:null,r:null},ri(e);if(0<Je(t,e.to))return a?gn(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},ri(e);Je(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),0<Je(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,s&&!e.l&&_n(e,s),a&&n&&_n(e,a)}}function _n(e,t){fa(t)||function n(a,b){var u=b.from,f=b.to,m=b.l,b=b.r;gn(a,u,f),m&&n(a,m),b&&n(a,b)}(e,t)}function ti(e,t){var n=Dn(t),a=n.next();if(a.done)return!1;for(var s=a.value,u=Dn(e),f=u.next(s.from),m=f.value;!a.done&&!f.done;){if(Je(m.from,s.to)<=0&&0<=Je(m.to,s.from))return!0;Je(s.from,m.from)<0?s=(a=n.next(m.from)).value:m=(f=u.next(s.from)).value}return!1}function Dn(e){var t=fa(e)?null:{s:0,n:e};return{next:function(n){for(var a=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,a)for(;t.n.l&&Je(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!a||Je(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function ri(e){var t,n,a=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),s=1<a?"r":a<-1?"l":"";s&&(t=s=="r"?"l":"r",n=c({},e),a=e[s],e.from=a.from,e.to=a.to,e[s]=a[s],n[s]=a[t],(e[t]=n).d=ni(n)),e.d=ni(e)}function ni(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function $n(e,t){return _(t).forEach(function(n){e[n]?_n(e[n],t[n]):e[n]=function a(s){var u,f,m={};for(u in s)K(s,u)&&(f=s[u],m[u]=!f||typeof f!="object"||dt.has(f.constructor)?f:a(f));return m}(t[n])}),e}function ha(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&ti(t[n],e[n])})}W(Ut.prototype,((ur={add:function(e){return _n(this,e),this},addKey:function(e){return gn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return gn(t,n,n)}),this},hasKey:function(e){var t=Dn(this).next(e).value;return t&&Je(t.from,e)<=0&&0<=Je(t.to,e)}})[gt]=function(){return Dn(this)},ur));var Br={},pa={},ma=!1;function Fn(e){$n(pa,e),ma||(ma=!0,setTimeout(function(){ma=!1,ya(pa,!(pa={}))},0))}function ya(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var a=0,s=Object.values(Br);a<s.length;a++)ai(f=s[a],e,n,t);else for(var u in e){var f,m=/^idb\:\/\/(.*)\/(.*)\//.exec(u);m&&(u=m[1],m=m[2],(f=Br["idb://".concat(u,"/").concat(m)])&&ai(f,e,n,t))}n.forEach(function(b){return b()})}function ai(e,t,n,a){for(var s=[],u=0,f=Object.entries(e.queries.query);u<f.length;u++){for(var m=f[u],b=m[0],k=[],C=0,y=m[1];C<y.length;C++){var E=y[C];ha(t,E.obsSet)?E.subscribers.forEach(function(x){return n.add(x)}):a&&k.push(E)}a&&s.push([b,k])}if(a)for(var w=0,S=s;w<S.length;w++){var P=S[w],b=P[0],k=P[1];e.queries.query[b]=k}}function as(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?jt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var a=t.openCanceller,s=Math.round(10*e.verno),u=!1;function f(){if(t.openCanceller!==a)throw new J.DatabaseClosed("db.open() was cancelled")}function m(){return new N(function(E,w){if(f(),!n)throw new J.MissingAPI;var S=e.name,P=t.autoSchema||!s?n.open(S):n.open(S,s);if(!P)throw new J.MissingAPI;P.onerror=hr(w),P.onblocked=Ee(e._fireOnBlocked),P.onupgradeneeded=Ee(function(x){var M;C=P.transaction,t.autoSchema&&!e._options.allowEmptyDB?(P.onerror=hn,C.abort(),P.result.close(),(M=n.deleteDatabase(S)).onsuccess=M.onerror=Ee(function(){w(new J.NoSuchDatabase("Database ".concat(S," doesnt exist")))})):(C.onerror=hr(w),x=x.oldVersion>Math.pow(2,62)?0:x.oldVersion,y=x<1,e.idbdb=P.result,u&&rs(e,C),ts(e,x/10,C,w))},w),P.onsuccess=Ee(function(){C=null;var x,M,j,T,O,B=e.idbdb=P.result,Q=oe(B.objectStoreNames);if(0<Q.length)try{var L=B.transaction((T=Q).length===1?T[0]:T,"readonly");if(t.autoSchema)M=B,j=L,(x=e).verno=M.version/10,j=x._dbSchema=Rn(0,M,j),x._storeNames=oe(M.objectStoreNames,0),jn(x,[x._allTables],_(j),j);else if(qn(e,e._dbSchema,L),((O=ca(Rn(0,(O=e).idbdb,L),O._dbSchema)).add.length||O.change.some(function(H){return H.add.length||H.change.length}))&&!u)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),B.close(),s=B.version+1,u=!0,E(m());In(e,L)}catch{}Qr.push(e),B.onversionchange=Ee(function(H){t.vcFired=!0,e.on("versionchange").fire(H)}),B.onclose=Ee(function(H){e.on("close").fire(H)}),y&&(O=e._deps,L=S,B=O.indexedDB,O=O.IDBKeyRange,da(B)||L===Cn||ua(B,O).put({name:L}).catch(U)),E()},w)}).catch(function(E){switch(E?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),m();break;case"VersionError":if(0<s)return s=0,m()}return N.reject(E)})}var b,k=t.dbReadyResolve,C=null,y=!1;return N.race([a,(typeof navigator>"u"?N.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(E){function w(){return indexedDB.databases().finally(E)}b=setInterval(w,100),w()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(m)]).then(function(){return f(),t.onReadyBeingFired=[],N.resolve(va(function(){return e.on.ready.fire(e.vip)})).then(function E(){if(0<t.onReadyBeingFired.length){var w=t.onReadyBeingFired.reduce(ve,U);return t.onReadyBeingFired=[],N.resolve(va(function(){return w(e.vip)})).then(E)}})}).finally(function(){t.openCanceller===a&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(E){t.dbOpenError=E;try{C&&C.abort()}catch{}return a===t.openCanceller&&e._close(),jt(E)}).finally(function(){t.openComplete=!0,k()}).then(function(){var E;return y&&(E={},e.tables.forEach(function(w){w.schema.indexes.forEach(function(S){S.name&&(E["idb://".concat(e.name,"/").concat(w.name,"/").concat(S.name)]=new Ut(-1/0,[[[]]]))}),E["idb://".concat(e.name,"/").concat(w.name,"/")]=E["idb://".concat(e.name,"/").concat(w.name,"/:dels")]=new Ut(-1/0,[[[]]])}),Tr(pn).fire(E),ya(E,!0)),e})}function ga(e){function t(u){return e.next(u)}var n=s(t),a=s(function(u){return e.throw(u)});function s(u){return function(b){var m=u(b),b=m.value;return m.done?b:b&&typeof b.then=="function"?b.then(n,a):A(b)?Promise.all(b).then(n,a):n(b)}}return s(t)()}function Kn(e,t,n){for(var a=A(e)?e.slice():[e],s=0;s<n;++s)a.push(t);return a}var is={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return c(c({},e),{table:function(t){var n=e.table(t),a=n.schema,s={},u=[];function f(y,E,w){var S=yn(y),P=s[S]=s[S]||[],x=y==null?0:typeof y=="string"?1:y.length,M=0<E,M=c(c({},w),{name:M?"".concat(S,"(virtual-from:").concat(w.name,")"):w.name,lowLevelIndex:w,isVirtual:M,keyTail:E,keyLength:x,extractKey:sa(y),unique:!M&&w.unique});return P.push(M),M.isPrimaryKey||u.push(M),1<x&&f(x===2?y[0]:y.slice(0,x-1),E+1,w),P.sort(function(j,T){return j.keyTail-T.keyTail}),M}t=f(a.primaryKey.keyPath,0,a.primaryKey),s[":id"]=[t];for(var m=0,b=a.indexes;m<b.length;m++){var k=b[m];f(k.keyPath,0,k)}function C(y){var E,w=y.query.index;return w.isVirtual?c(c({},y),{query:{index:w.lowLevelIndex,range:(E=y.query.range,w=w.keyTail,{type:E.type===1?2:E.type,lower:Kn(E.lower,E.lowerOpen?e.MAX_KEY:e.MIN_KEY,w),lowerOpen:!0,upper:Kn(E.upper,E.upperOpen?e.MIN_KEY:e.MAX_KEY,w),upperOpen:!0})}}):y}return c(c({},n),{schema:c(c({},a),{primaryKey:t,indexes:u,getIndexByKeyPath:function(y){return(y=s[yn(y)])&&y[0]}}),count:function(y){return n.count(C(y))},query:function(y){return n.query(C(y))},openCursor:function(y){var E=y.query.index,w=E.keyTail,S=E.isVirtual,P=E.keyLength;return S?n.openCursor(C(y)).then(function(M){return M&&x(M)}):n.openCursor(y);function x(M){return Object.create(M,{continue:{value:function(j){j!=null?M.continue(Kn(j,y.reverse?e.MAX_KEY:e.MIN_KEY,w)):y.unique?M.continue(M.key.slice(0,P).concat(y.reverse?e.MIN_KEY:e.MAX_KEY,w)):M.continue()}},continuePrimaryKey:{value:function(j,T){M.continuePrimaryKey(Kn(j,e.MAX_KEY,w),T)}},primaryKey:{get:function(){return M.primaryKey}},key:{get:function(){var j=M.key;return P===1?j[0]:j.slice(0,P)}},value:{get:function(){return M.value}}})}}})}})}};function _a(e,t,n,a){return n=n||{},a=a||"",_(e).forEach(function(s){var u,f,m;K(t,s)?(u=e[s],f=t[s],typeof u=="object"&&typeof f=="object"&&u&&f?(m=et(u))!==et(f)?n[a+s]=t[s]:m==="Object"?_a(u,f,n,a+s+"."):u!==f&&(n[a+s]=t[s]):u!==f&&(n[a+s]=t[s])):n[a+s]=void 0}),_(t).forEach(function(s){K(e,s)||(n[a+s]=t[s])}),n}function ba(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var ss={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return c(c({},e),{table:function(t){var n=e.table(t),a=n.schema.primaryKey;return c(c({},n),{mutate:function(s){var u=F.trans,f=u.table(t).hook,m=f.deleting,b=f.creating,k=f.updating;switch(s.type){case"add":if(b.fire===U)break;return u._promise("readwrite",function(){return C(s)},!0);case"put":if(b.fire===U&&k.fire===U)break;return u._promise("readwrite",function(){return C(s)},!0);case"delete":if(m.fire===U)break;return u._promise("readwrite",function(){return C(s)},!0);case"deleteRange":if(m.fire===U)break;return u._promise("readwrite",function(){return function y(E,w,S){return n.query({trans:E,values:!1,query:{index:a,range:w},limit:S}).then(function(P){var x=P.result;return C({type:"delete",keys:x,trans:E}).then(function(M){return 0<M.numFailures?Promise.reject(M.failures[0]):x.length<S?{failures:[],numFailures:0,lastResult:void 0}:y(E,c(c({},w),{lower:x[x.length-1],lowerOpen:!0}),S)})})}(s.trans,s.range,1e4)},!0)}return n.mutate(s);function C(y){var E,w,S,P=F.trans,x=y.keys||ba(a,y);if(!x)throw new Error("Keys missing");return(y=y.type==="add"||y.type==="put"?c(c({},y),{keys:x}):c({},y)).type!=="delete"&&(y.values=h([],y.values)),y.keys&&(y.keys=h([],y.keys)),E=n,S=x,((w=y).type==="add"?Promise.resolve([]):E.getMany({trans:w.trans,keys:S,cache:"immutable"})).then(function(M){var j=x.map(function(T,O){var B,Q,L,H=M[O],Z={onerror:null,onsuccess:null};return y.type==="delete"?m.fire.call(Z,T,H,P):y.type==="add"||H===void 0?(B=b.fire.call(Z,T,y.values[O],P),T==null&&B!=null&&(y.keys[O]=T=B,a.outbound||ne(y.values[O],a.keyPath,T))):(B=_a(H,y.values[O]),(Q=k.fire.call(Z,B,T,H,P))&&(L=y.values[O],Object.keys(Q).forEach(function(Y){K(L,Y)?L[Y]=Q[Y]:ne(L,Y,Q[Y])}))),Z});return n.mutate(y).then(function(T){for(var O=T.failures,B=T.results,Q=T.numFailures,T=T.lastResult,L=0;L<x.length;++L){var H=(B||x)[L],Z=j[L];H==null?Z.onerror&&Z.onerror(O[L]):Z.onsuccess&&Z.onsuccess(y.type==="put"&&M[L]?y.values[L]:H)}return{failures:O,results:B,numFailures:Q,lastResult:T}}).catch(function(T){return j.forEach(function(O){return O.onerror&&O.onerror(T)}),Promise.reject(T)})})}}})}})}};function ii(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var a=[],s=0,u=0;s<t.keys.length&&u<e.length;++s)Je(t.keys[s],e[u])===0&&(a.push(n?Te(t.values[s]):t.values[s]),++u);return a.length===e.length?a:null}catch{return null}}var os={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return c(c({},n),{getMany:function(a){if(!a.cache)return n.getMany(a);var s=ii(a.keys,a.trans._cache,a.cache==="clone");return s?N.resolve(s):n.getMany(a).then(function(u){return a.trans._cache={keys:a.keys,values:a.cache==="clone"?Te(u):u},u})},mutate:function(a){return a.type!=="add"&&(a.trans._cache=null),n.mutate(a)}})}}}};function si(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function oi(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var cs={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new Ut(e.MIN_KEY,e.MAX_KEY);return c(c({},e),{transaction:function(a,s,u){if(F.subscr&&s!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(F.querier));return e.transaction(a,s,u)},table:function(a){var s=e.table(a),u=s.schema,f=u.primaryKey,y=u.indexes,m=f.extractKey,b=f.outbound,k=f.autoIncrement&&y.filter(function(w){return w.compound&&w.keyPath.includes(f.keyPath)}),C=c(c({},s),{mutate:function(w){function S(Y){return Y="idb://".concat(t,"/").concat(a,"/").concat(Y),T[Y]||(T[Y]=new Ut)}var P,x,M,j=w.trans,T=w.mutatedParts||(w.mutatedParts={}),O=S(""),B=S(":dels"),Q=w.type,Z=w.type==="deleteRange"?[w.range]:w.type==="delete"?[w.keys]:w.values.length<50?[ba(f,w).filter(function(Y){return Y}),w.values]:[],L=Z[0],H=Z[1],Z=w.trans._cache;return A(L)?(O.addKeys(L),(Z=Q==="delete"||L.length===H.length?ii(L,Z):null)||B.addKeys(L),(Z||H)&&(P=S,x=Z,M=H,u.indexes.forEach(function(Y){var ae=P(Y.name||"");function Ke(He){return He!=null?Y.extractKey(He):null}function Ue(He){return Y.multiEntry&&A(He)?He.forEach(function(ar){return ae.addKey(ar)}):ae.addKey(He)}(x||M).forEach(function(He,Ht){var $e=x&&Ke(x[Ht]),Ht=M&&Ke(M[Ht]);Je($e,Ht)!==0&&($e!=null&&Ue($e),Ht!=null&&Ue(Ht))})}))):L?(H={from:(H=L.lower)!==null&&H!==void 0?H:e.MIN_KEY,to:(H=L.upper)!==null&&H!==void 0?H:e.MAX_KEY},B.add(H),O.add(H)):(O.add(n),B.add(n),u.indexes.forEach(function(Y){return S(Y.name).add(n)})),s.mutate(w).then(function(Y){return!L||w.type!=="add"&&w.type!=="put"||(O.addKeys(Y.results),k&&k.forEach(function(ae){for(var Ke=w.values.map(function($e){return ae.extractKey($e)}),Ue=ae.keyPath.findIndex(function($e){return $e===f.keyPath}),He=0,ar=Y.results.length;He<ar;++He)Ke[He][Ue]=Y.results[He];S(ae.name).addKeys(Ke)})),j.mutatedParts=$n(j.mutatedParts||{},T),Y})}}),y=function(S){var P=S.query,S=P.index,P=P.range;return[S,new Ut((S=P.lower)!==null&&S!==void 0?S:e.MIN_KEY,(P=P.upper)!==null&&P!==void 0?P:e.MAX_KEY)]},E={get:function(w){return[f,new Ut(w.key)]},getMany:function(w){return[f,new Ut().addKeys(w.keys)]},count:y,query:y,openCursor:y};return _(E).forEach(function(w){C[w]=function(S){var P=F.subscr,x=!!P,M=si(F,s)&&oi(w,S)?S.obsSet={}:P;if(x){var j=function(H){return H="idb://".concat(t,"/").concat(a,"/").concat(H),M[H]||(M[H]=new Ut)},T=j(""),O=j(":dels"),P=E[w](S),x=P[0],P=P[1];if((w==="query"&&x.isPrimaryKey&&!S.values?O:j(x.name||"")).add(P),!x.isPrimaryKey){if(w!=="count"){var B=w==="query"&&b&&S.values&&s.query(c(c({},S),{values:!1}));return s[w].apply(this,arguments).then(function(H){if(w==="query"){if(b&&S.values)return B.then(function(Ke){return Ke=Ke.result,T.addKeys(Ke),H});var Z=S.values?H.result.map(m):H.result;(S.values?T:O).addKeys(Z)}else if(w==="openCursor"){var Y=H,ae=S.values;return Y&&Object.create(Y,{key:{get:function(){return O.addKey(Y.primaryKey),Y.key}},primaryKey:{get:function(){var Ke=Y.primaryKey;return O.addKey(Ke),Ke}},value:{get:function(){return ae&&T.addKey(Y.primaryKey),Y.value}}})}return H})}O.add(n)}}return s[w].apply(this,arguments)}}),C}})}};function ci(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var a=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return n.numFailures===a?null:(t=c({},t),A(t.keys)&&(t.keys=t.keys.filter(function(s,u){return!(u in n.failures)})),"values"in t&&A(t.values)&&(t.values=t.values.filter(function(s,u){return!(u in n.failures)})),t)}function wa(e,t){return n=e,((a=t).lower===void 0||(a.lowerOpen?0<Je(n,a.lower):0<=Je(n,a.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?Je(e,t.upper)<0:Je(e,t.upper)<=0));var n,a}function li(e,t,E,a,s,u){if(!E||E.length===0)return e;var f=t.query.index,m=f.multiEntry,b=t.query.range,k=a.schema.primaryKey.extractKey,C=f.extractKey,y=(f.lowLevelIndex||f).extractKey,E=E.reduce(function(w,S){var P=w,x=[];if(S.type==="add"||S.type==="put")for(var M=new Ut,j=S.values.length-1;0<=j;--j){var T,O=S.values[j],B=k(O);M.hasKey(B)||(T=C(O),(m&&A(T)?T.some(function(Y){return wa(Y,b)}):wa(T,b))&&(M.addKey(B),x.push(O)))}switch(S.type){case"add":var Q=new Ut().addKeys(t.values?w.map(function(ae){return k(ae)}):w),P=w.concat(t.values?x.filter(function(ae){return ae=k(ae),!Q.hasKey(ae)&&(Q.addKey(ae),!0)}):x.map(function(ae){return k(ae)}).filter(function(ae){return!Q.hasKey(ae)&&(Q.addKey(ae),!0)}));break;case"put":var L=new Ut().addKeys(S.values.map(function(ae){return k(ae)}));P=w.filter(function(ae){return!L.hasKey(t.values?k(ae):ae)}).concat(t.values?x:x.map(function(ae){return k(ae)}));break;case"delete":var H=new Ut().addKeys(S.keys);P=w.filter(function(ae){return!H.hasKey(t.values?k(ae):ae)});break;case"deleteRange":var Z=S.range;P=w.filter(function(ae){return!wa(k(ae),Z)})}return P},e);return E===e?e:(E.sort(function(w,S){return Je(y(w),y(S))||Je(k(w),k(S))}),t.limit&&t.limit<1/0&&(E.length>t.limit?E.length=t.limit:e.length===t.limit&&E.length<t.limit&&(s.dirty=!0)),u?Object.freeze(E):E)}function ui(e,t){return Je(e.lower,t.lower)===0&&Je(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function ls(e,t){return function(n,a,s,u){if(n===void 0)return a!==void 0?-1:0;if(a===void 0)return 1;if((a=Je(n,a))===0){if(s&&u)return 0;if(s)return 1;if(u)return-1}return a}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(n,a,s,u){if(n===void 0)return a!==void 0?1:0;if(a===void 0)return-1;if((a=Je(n,a))===0){if(s&&u)return 0;if(s)return-1;if(u)return 1}return a}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function us(e,t,n,a){e.subscribers.add(n),a.addEventListener("abort",function(){var s,u;e.subscribers.delete(n),e.subscribers.size===0&&(s=e,u=t,setTimeout(function(){s.subscribers.size===0&&Xe(u,s)},3e3))})}var ds={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return c(c({},e),{transaction:function(n,a,s){var u,f,m=e.transaction(n,a,s);return a==="readwrite"&&(f=(u=new AbortController).signal,s=function(b){return function(){if(u.abort(),a==="readwrite"){for(var k=new Set,C=0,y=n;C<y.length;C++){var E=y[C],w=Br["idb://".concat(t,"/").concat(E)];if(w){var S=e.table(E),P=w.optimisticOps.filter(function(ae){return ae.trans===m});if(m._explicit&&b&&m.mutatedParts)for(var x=0,M=Object.values(w.queries.query);x<M.length;x++)for(var j=0,T=(Q=M[x]).slice();j<T.length;j++)ha((L=T[j]).obsSet,m.mutatedParts)&&(Xe(Q,L),L.subscribers.forEach(function(ae){return k.add(ae)}));else if(0<P.length){w.optimisticOps=w.optimisticOps.filter(function(ae){return ae.trans!==m});for(var O=0,B=Object.values(w.queries.query);O<B.length;O++)for(var Q,L,H,Z=0,Y=(Q=B[O]).slice();Z<Y.length;Z++)(L=Y[Z]).res!=null&&m.mutatedParts&&(b&&!L.dirty?(H=Object.isFrozen(L.res),H=li(L.res,L.req,P,S,L,H),L.dirty?(Xe(Q,L),L.subscribers.forEach(function(ae){return k.add(ae)})):H!==L.res&&(L.res=H,L.promise=N.resolve({result:H}))):(L.dirty&&Xe(Q,L),L.subscribers.forEach(function(ae){return k.add(ae)})))}}}k.forEach(function(ae){return ae()})}}},m.addEventListener("abort",s(!1),{signal:f}),m.addEventListener("error",s(!1),{signal:f}),m.addEventListener("complete",s(!0),{signal:f})),m},table:function(n){var a=e.table(n),s=a.schema.primaryKey;return c(c({},a),{mutate:function(u){var f=F.trans;if(s.outbound||f.db._options.cache==="disabled"||f.explicit||f.idbtrans.mode!=="readwrite")return a.mutate(u);var m=Br["idb://".concat(t,"/").concat(n)];return m?(f=a.mutate(u),u.type!=="add"&&u.type!=="put"||!(50<=u.values.length||ba(s,u).some(function(b){return b==null}))?(m.optimisticOps.push(u),u.mutatedParts&&Fn(u.mutatedParts),f.then(function(b){0<b.numFailures&&(Xe(m.optimisticOps,u),(b=ci(0,u,b))&&m.optimisticOps.push(b),u.mutatedParts&&Fn(u.mutatedParts))}),f.catch(function(){Xe(m.optimisticOps,u),u.mutatedParts&&Fn(u.mutatedParts)})):f.then(function(b){var k=ci(0,c(c({},u),{values:u.values.map(function(C,y){var E;return b.failures[y]?C:(C=(E=s.keyPath)!==null&&E!==void 0&&E.includes(".")?Te(C):c({},C),ne(C,s.keyPath,b.results[y]),C)})}),b);m.optimisticOps.push(k),queueMicrotask(function(){return u.mutatedParts&&Fn(u.mutatedParts)})}),f):a.mutate(u)},query:function(u){if(!si(F,a)||!oi("query",u))return a.query(u);var f=((k=F.trans)===null||k===void 0?void 0:k.db._options.cache)==="immutable",y=F,m=y.requery,b=y.signal,k=function(S,P,x,M){var j=Br["idb://".concat(S,"/").concat(P)];if(!j)return[];if(!(P=j.queries[x]))return[null,!1,j,null];var T=P[(M.query?M.query.index.name:null)||""];if(!T)return[null,!1,j,null];switch(x){case"query":var O=T.find(function(B){return B.req.limit===M.limit&&B.req.values===M.values&&ui(B.req.query.range,M.query.range)});return O?[O,!0,j,T]:[T.find(function(B){return("limit"in B.req?B.req.limit:1/0)>=M.limit&&(!M.values||B.req.values)&&ls(B.req.query.range,M.query.range)}),!1,j,T];case"count":return O=T.find(function(B){return ui(B.req.query.range,M.query.range)}),[O,!!O,j,T]}}(t,n,"query",u),C=k[0],y=k[1],E=k[2],w=k[3];return C&&y?C.obsSet=u.obsSet:(y=a.query(u).then(function(S){var P=S.result;if(C&&(C.res=P),f){for(var x=0,M=P.length;x<M;++x)Object.freeze(P[x]);Object.freeze(P)}else S.result=Te(P);return S}).catch(function(S){return w&&C&&Xe(w,C),Promise.reject(S)}),C={obsSet:u.obsSet,promise:y,subscribers:new Set,type:"query",req:u,dirty:!1},w?w.push(C):(w=[C],(E=E||(Br["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[u.query.index.name||""]=w)),us(C,w,m,b),C.promise.then(function(S){return{result:li(S.result,u,E?.optimisticOps,a,C,f)}})}})}})}};function Nn(e,t){return new Proxy(e,{get:function(n,a,s){return a==="db"?t:Reflect.get(n,a,s)}})}var Ar=($t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new J.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(a){return a._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(es),n.stores({}),this._state.autoSchema=!1,n)},$t.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||F.letThrough||this._vip)?e():new N(function(n,a){if(t._state.openComplete)return a(new J.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void a(new J.DatabaseClosed);t.open().catch(U)}t._state.dbReadyPromise.then(n,a)}).then(e)},$t.prototype.use=function(e){var t=e.stack,n=e.create,a=e.level,s=e.name;return s&&this.unuse({stack:t,name:s}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:a??10,name:s}),e.sort(function(u,f){return u.level-f.level}),this},$t.prototype.unuse=function(e){var t=e.stack,n=e.name,a=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(s){return a?s.create!==a:!!n&&s.name!==n})),this},$t.prototype.open=function(){var e=this;return zt(me,function(){return as(e)})},$t.prototype._close=function(){var e=this._state,t=Qr.indexOf(this);if(0<=t&&Qr.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new N(function(n){e.dbReadyResolve=n}),e.openCanceller=new N(function(n,a){e.cancelOpen=a}))},$t.prototype.close=function(n){var t=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new J.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new J.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},$t.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",a=this._state;return new N(function(s,u){function f(){t.close(e);var m=t._deps.indexedDB.deleteDatabase(t.name);m.onsuccess=Ee(function(){var b,k,C;b=t._deps,k=t.name,C=b.indexedDB,b=b.IDBKeyRange,da(C)||k===Cn||ua(C,b).delete(k).catch(U),s()}),m.onerror=hr(u),m.onblocked=t._fireOnBlocked}if(n)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");a.isBeingOpened?a.dbReadyPromise.then(f):f()})},$t.prototype.backendDB=function(){return this.idbdb},$t.prototype.isOpen=function(){return this.idbdb!==null},$t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},$t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},$t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty($t.prototype,"tables",{get:function(){var e=this;return _(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),$t.prototype.transaction=function(){var e=(function(t,n,a){var s=arguments.length;if(s<2)throw new J.InvalidArgument("Too few arguments");for(var u=new Array(s-1);--s;)u[s-1]=arguments[s];return a=u.pop(),[t,ut(u),a]}).apply(this,arguments);return this._transaction.apply(this,e)},$t.prototype._transaction=function(e,t,n){var a=this,s=F.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);var u,f,m=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(f=t.map(function(k){if(k=k instanceof a.Table?k.name:k,typeof k!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return k}),e=="r"||e===Jn)u=Jn;else{if(e!="rw"&&e!=Zn)throw new J.InvalidArgument("Invalid transaction mode: "+e);u=Zn}if(s){if(s.mode===Jn&&u===Zn){if(!m)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&f.forEach(function(k){if(s&&s.storeNames.indexOf(k)===-1){if(!m)throw new J.SubTransaction("Table "+k+" not included in parent transaction.");s=null}}),m&&s&&!s.active&&(s=null)}}catch(k){return s?s._promise(null,function(C,y){y(k)}):jt(k)}var b=(function k(C,y,E,w,S){return N.resolve().then(function(){var P=F.transless||F,x=C._createTransaction(y,E,C._dbSchema,w);if(x.explicit=!0,P={trans:x,transless:P},w)x.idbtrans=w.idbtrans;else try{x.create(),x.idbtrans._explicit=!0,C._state.PR1398_maxLoop=3}catch(T){return T.name===_t.InvalidState&&C.isOpen()&&0<--C._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),C.close({disableAutoOpen:!1}),C.open().then(function(){return k(C,y,E,null,S)})):jt(T)}var M,j=G(S);return j&&lr(),P=N.follow(function(){var T;(M=S.call(x,x))&&(j?(T=Kt.bind(null,null),M.then(T,T)):typeof M.next=="function"&&typeof M.throw=="function"&&(M=ga(M)))},P),(M&&typeof M.then=="function"?N.resolve(M).then(function(T){return x.active?T:jt(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):P.then(function(){return M})).then(function(T){return w&&x._resolve(),x._completion.then(function(){return T})}).catch(function(T){return x._reject(T),jt(T)})})}).bind(null,this,u,f,s,n);return s?s._promise(u,b,"lock"):F.trans?zt(F.transless,function(){return a._whenReady(b)}):this._whenReady(b)},$t.prototype.table=function(e){if(!K(this._allTables,e))throw new J.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},$t);function $t(e,t){var n=this;this._middlewares={},this.verno=0;var a=$t.dependencies;this._options=t=c({addons:$t.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},a=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s,u,f,m,b,k={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:U,dbReadyPromise:null,cancelOpen:U,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};k.dbReadyPromise=new N(function(y){k.dbReadyResolve=y}),k.openCanceller=new N(function(y,E){k.cancelOpen=E}),this._state=k,this.name=e,this.on=dn(this,"populate","blocked","versionchange","close",{ready:[ve,U]}),this.on.ready.subscribe=we(this.on.ready.subscribe,function(y){return function(E,w){$t.vip(function(){var S,P=n._state;P.openComplete?(P.dbOpenError||N.resolve().then(E),w&&y(E)):P.onReadyBeingFired?(P.onReadyBeingFired.push(E),w&&y(E)):(y(E),S=n,w||y(function x(){S.on.ready.unsubscribe(E),S.on.ready.unsubscribe(x)}))})}}),this.Collection=(s=this,vn(Gi.prototype,function(M,x){this.db=s;var w=Ba,S=null;if(x)try{w=x()}catch(j){S=j}var P=M._ctx,x=P.table,M=x.hook.reading.fire;this._ctx={table:x,index:P.index,isPrimKey:!P.index||x.schema.primKey.keyPath&&P.index===x.schema.primKey.name,range:w,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:S,or:P.or,valueMapper:M!==Ae?M:null}})),this.Table=(u=this,vn(Ha.prototype,function(y,E,w){this.db=u,this._tx=w,this.name=y,this.schema=E,this.hook=u._allTables[y]?u._allTables[y].hook:dn(null,{creating:[Ve,U],reading:[Re,Ae],updating:[bt,U],deleting:[Ye,U]})})),this.Transaction=(f=this,vn(Yi.prototype,function(y,E,w,S,P){var x=this;this.db=f,this.mode=y,this.storeNames=E,this.schema=w,this.chromeTransactionDurability=S,this.idbtrans=null,this.on=dn(this,"complete","error","abort"),this.parent=P||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new N(function(M,j){x._resolve=M,x._reject=j}),this._completion.then(function(){x.active=!1,x.on.complete.fire()},function(M){var j=x.active;return x.active=!1,x.on.error.fire(M),x.parent?x.parent._reject(M):j&&x.idbtrans&&x.idbtrans.abort(),jt(M)})})),this.Version=(m=this,vn(ns.prototype,function(y){this.db=m,this._cfg={version:y,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(b=this,vn(Ya.prototype,function(y,E,w){if(this.db=b,this._ctx={table:y,index:E===":id"?null:E,or:w},this._cmp=this._ascending=Je,this._descending=function(S,P){return Je(P,S)},this._max=function(S,P){return 0<Je(S,P)?S:P},this._min=function(S,P){return Je(S,P)<0?S:P},this._IDBKeyRange=b._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(y){0<y.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(y){!y.newVersion||y.newVersion<y.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(y.oldVersion/10))}),this._maxKey=mn(t.IDBKeyRange),this._createTransaction=function(y,E,w,S){return new n.Transaction(y,E,w,n._options.chromeTransactionDurability,S)},this._fireOnBlocked=function(y){n.on("blocked").fire(y),Qr.filter(function(E){return E.name===n.name&&E!==n&&!E._state.vcFired}).map(function(E){return E.on("versionchange").fire(y)})},this.use(os),this.use(ds),this.use(cs),this.use(is),this.use(ss);var C=new Proxy(this,{get:function(y,E,w){if(E==="_vip")return!0;if(E==="table")return function(P){return Nn(n.table(P),C)};var S=Reflect.get(y,E,w);return S instanceof Ha?Nn(S,C):E==="tables"?S.map(function(P){return Nn(P,C)}):E==="_createTransaction"?function(){return Nn(S.apply(this,arguments),C)}:S}});this.vip=C,a.forEach(function(y){return y(n)})}var Bn,ur=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",vs=(ka.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},ka.prototype[ur]=function(){return this},ka);function ka(e){this._subscribe=e}try{Bn={indexedDB:g.indexedDB||g.mozIndexedDB||g.webkitIndexedDB||g.msIndexedDB,IDBKeyRange:g.IDBKeyRange||g.webkitIDBKeyRange}}catch{Bn={indexedDB:null,IDBKeyRange:null}}function di(e){var t,n=!1,a=new vs(function(s){var u=G(e),f,m=!1,b={},k={},C={get closed(){return m},unsubscribe:function(){m||(m=!0,f&&f.abort(),y&&Tr.storagemutated.unsubscribe(w))}};s.start&&s.start(C);var y=!1,E=function(){return un(S)},w=function(P){$n(b,P),ha(k,b)&&E()},S=function(){var P,x,M;!m&&Bn.indexedDB&&(b={},P={},f&&f.abort(),f=new AbortController,M=function(j){var T=It();try{u&&lr();var O=Xt(e,j);return O=u?O.finally(Kt):O}finally{T&&Wt()}}(x={subscr:P,signal:f.signal,requery:E,querier:e,trans:null}),Promise.resolve(M).then(function(j){n=!0,t=j,m||x.signal.aborted||(b={},function(T){for(var O in T)if(K(T,O))return;return 1}(k=P)||y||(Tr(pn,w),y=!0),un(function(){return!m&&s.next&&s.next(j)}))},function(j){n=!1,["DatabaseClosedError","AbortError"].includes(j?.name)||m||un(function(){m||s.error&&s.error(j)})}))};return setTimeout(E,0),C});return a.hasValue=function(){return n},a.getValue=function(){return t},a}var Lr=Ar;function xa(e){var t=Rr;try{Rr=!0,Tr.storagemutated.fire(e),ya(e,!0)}finally{Rr=t}}W(Lr,c(c({},le),{delete:function(e){return new Lr(e,{addons:[]}).delete()},exists:function(e){return new Lr(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Lr.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(da(n)?Promise.resolve(n.databases()).then(function(a){return a.map(function(s){return s.name}).filter(function(s){return s!==Cn})}):ua(n,t).toCollection().primaryKeys()).then(e)}catch{return jt(new J.MissingAPI)}var t,n},defineClass:function(){return function(e){q(this,e)}},ignoreTransaction:function(e){return F.trans?zt(F.transless,e):e()},vip:va,async:function(e){return function(){try{var t=ga(e.apply(this,arguments));return t&&typeof t.then=="function"?t:N.resolve(t)}catch(n){return jt(n)}}},spawn:function(e,t,n){try{var a=ga(e.apply(n,t||[]));return a&&typeof a.then=="function"?a:N.resolve(a)}catch(s){return jt(s)}},currentTransaction:{get:function(){return F.trans||null}},waitFor:function(e,t){return t=N.resolve(typeof e=="function"?Lr.ignoreTransaction(e):e).timeout(t||6e4),F.trans?F.trans.waitFor(t):t},Promise:N,debug:{get:function(){return z},set:function(e){Pe(e)}},derive:ee,extend:q,props:W,override:we,Events:dn,on:Tr,liveQuery:di,extendObservabilitySet:$n,getByKeyPath:V,setByKeyPath:ne,delByKeyPath:function(e,t){typeof t=="string"?ne(e,t,void 0):"length"in t&&[].map.call(t,function(n){ne(e,n,void 0)})},shallowClone:Ie,deepClone:Te,getObjectDiff:_a,cmp:Je,asap:_e,minKey:-1/0,addons:[],connections:Qr,errnames:_t,dependencies:Bn,cache:Br,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),Lr.maxKey=mn(Lr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Tr(pn,function(e){Rr||(e=new CustomEvent(na,{detail:e}),Rr=!0,dispatchEvent(e),Rr=!1)}),addEventListener(na,function(e){e=e.detail,Rr||xa(e)}));var en,Rr=!1,vi=function(){};return typeof BroadcastChannel<"u"&&((vi=function(){(en=new BroadcastChannel(na)).onmessage=function(e){return e.data&&xa(e.data)}})(),typeof en.unref=="function"&&en.unref(),Tr(pn,function(e){Rr||en.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Ar.disableBfCache&&e.persisted){z&&console.debug("Dexie: handling persisted pagehide"),en?.close();for(var t=0,n=Qr;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Ar.disableBfCache&&e.persisted&&(z&&console.debug("Dexie: handling persisted pageshow"),vi(),xa({all:new Ut(-1/0,[[]])}))})),N.rejectionMapper=function(e,t){return!e||e instanceof ge||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Mt[e.name]?e:(t=new Mt[e.name](t||e.message,e),"stack"in e&&X(t,"stack",{get:function(){return this.inner.stack}}),t)},Pe(z),c(Ar,Object.freeze({__proto__:null,Dexie:Ar,liveQuery:di,Entity:La,cmp:Je,PropModification:fn,replacePrefix:function(e,t){return new fn({replacePrefix:[e,t]})},add:function(e){return new fn({add:e})},remove:function(e){return new fn({remove:e})},default:Ar,RangeSet:Ut,mergeRanges:_n,rangesOverlap:ti}),{default:Ar}),Ar})}(Hn)),Hn.exports}var To=jo();const $a=Mo(To),Si=Symbol.for("Dexie"),Wn=globalThis[Si]||(globalThis[Si]=$a);if($a.semVer!==Wn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${$a.semVer} and ${Wn.semVer}`);const{liveQuery:Nc,mergeRanges:Bc,rangesOverlap:Lc,RangeSet:zc,cmp:Uc,Entity:Hc,PropModification:Vc,replacePrefix:Gc,add:Wc,remove:Xc}=Wn;class Ro extends Wn{saves;settings;achievements;analytics;constructor(){super("MatchstickEmpireDB"),this.version(1).stores({saves:"id, name, timestamp, version, isAutoSave",settings:"id, key, timestamp",achievements:"id, achievementId, unlockedAt",analytics:"id, event, timestamp, sessionId"}),this.version(1).upgrade(r=>{})}}const Me=new Ro;class Hr{static instance;isInitialized=!1;sessionId;constructor(){this.sessionId=this.generateSessionId()}static getInstance(){return Hr.instance||(Hr.instance=new Hr),Hr.instance}async initialize(){try{await Me.open(),this.isInitialized=!0;const r=Date.now()-10080*60*1e3;await Me.analytics.where("timestamp").below(r).delete()}catch(r){throw ke.handleError(xe.storage("Failed to initialize storage",{error:r})),r}}async saveGame(r,i,c=!1){try{this.isInitialized||await this.initialize();const h=this.generateSaveId(),g=i||(c?`AutoSave_${new Date().toISOString()}`:`Save_${Date.now()}`),_=await this.createChecksum(r),A={id:h,name:g,gameState:this.sanitizeGameState(r),timestamp:Date.now(),version:r.metadata.version,checksum:_,isAutoSave:c};return await Me.saves.put(A),c&&await this.cleanupAutoSaves(),await this.trackEvent("game_saved",{saveId:h,isAutoSave:c,gamePhase:r.progression.currentPhase}),h}catch(h){throw ke.handleError(xe.storage("Failed to save game",{error:h,name:i,isAutoSave:c})),h}}async loadGame(r){try{this.isInitialized||await this.initialize();const i=await Me.saves.get(r);return i?i.checksum&&await this.createChecksum(i.gameState)!==i.checksum?(ke.handleError(xe.storage("Save file corrupted",{saveId:r})),null):(await this.trackEvent("game_loaded",{saveId:r,version:i.version,timeSinceSave:Date.now()-i.timestamp}),i.gameState):null}catch(i){return ke.handleError(xe.storage("Failed to load game",{error:i,saveId:r})),null}}async listSaves(){try{return this.isInitialized||await this.initialize(),(await Me.saves.orderBy("timestamp").reverse().toArray()).map(i=>({id:i.id,name:i.name,timestamp:i.timestamp,version:i.version,checksum:i.checksum,isAutoSave:i.isAutoSave}))}catch(r){return ke.handleError(xe.storage("Failed to list saves",{error:r})),[]}}async deleteSave(r){try{return this.isInitialized||await this.initialize(),await Me.saves.where("id").equals(r).count()===0?!1:(await Me.saves.delete(r),await this.trackEvent("game_deleted",{saveId:r}),!0)}catch(i){return ke.handleError(xe.storage("Failed to delete save",{error:i,saveId:r})),!1}}async saveSetting(r,i){try{this.isInitialized||await this.initialize();const c={id:r,key:r,value:i,timestamp:Date.now()};await Me.settings.put(c)}catch(c){ke.handleError(xe.storage("Failed to save setting",{error:c,key:r}))}}async loadSetting(r){try{return this.isInitialized||await this.initialize(),(await Me.settings.get(r))?.value??null}catch(i){return ke.handleError(xe.storage("Failed to load setting",{error:i,key:r})),null}}async saveAchievement(r,i){try{this.isInitialized||await this.initialize();const c={id:r,achievementId:r,unlockedAt:Date.now(),progress:i};await Me.achievements.put(c),await this.trackEvent("achievement_unlocked",{achievementId:r})}catch(c){ke.handleError(xe.storage("Failed to save achievement",{error:c,achievementId:r}))}}async loadAchievements(){try{return this.isInitialized||await this.initialize(),await Me.achievements.toArray()}catch(r){return ke.handleError(xe.storage("Failed to load achievements",{error:r})),[]}}async exportData(){try{this.isInitialized||await this.initialize();const r=await Me.saves.toArray(),i=await Me.settings.toArray(),c=await Me.achievements.toArray(),h={version:"1.0.0",exportedAt:Date.now(),saves:r,settings:i,achievements:c};return JSON.stringify(h,this.bigIntReplacer)}catch(r){throw ke.handleError(xe.storage("Failed to export data",{error:r})),r}}async importData(r){try{this.isInitialized||await this.initialize();const i=JSON.parse(r,this.bigIntReviver);if(!i.version||!i.saves)throw new Error("Invalid import data format");await Me.transaction("rw",[Me.saves,Me.settings,Me.achievements],async()=>{i.saves&&(await Me.saves.clear(),await Me.saves.bulkAdd(i.saves)),i.settings&&(await Me.settings.clear(),await Me.settings.bulkAdd(i.settings)),i.achievements&&(await Me.achievements.clear(),await Me.achievements.bulkAdd(i.achievements))}),await this.trackEvent("data_imported",{saveCount:i.saves?.length||0,settingCount:i.settings?.length||0,achievementCount:i.achievements?.length||0})}catch(i){throw ke.handleError(xe.storage("Failed to import data",{error:i})),i}}async clearAllData(){try{this.isInitialized||await this.initialize(),await Me.transaction("rw",[Me.saves,Me.settings,Me.achievements,Me.analytics],async()=>{await Me.saves.clear(),await Me.settings.clear(),await Me.achievements.clear(),await Me.analytics.clear()}),await this.trackEvent("data_cleared",{})}catch(r){throw ke.handleError(xe.storage("Failed to clear data",{error:r})),r}}async getStorageStats(){try{this.isInitialized||await this.initialize();const[r,i,c,h]=await Promise.all([Me.saves.count(),Me.settings.count(),Me.achievements.count(),Me.analytics.count()]),g=await this.estimateStorageSize();return{saves:r,settings:i,achievements:c,analytics:h,totalSize:g}}catch(r){return ke.handleError(xe.storage("Failed to get storage stats",{error:r})),{saves:0,settings:0,achievements:0,analytics:0,totalSize:0}}}generateSaveId(){return`save_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async createChecksum(r){const i=JSON.stringify(r,this.bigIntReplacer),h=new TextEncoder().encode(i),g=await crypto.subtle.digest("SHA-256",h);return Array.from(new Uint8Array(g)).map(A=>A.toString(16).padStart(2,"0")).join("")}sanitizeGameState(r){return JSON.parse(JSON.stringify(r,this.bigIntReplacer),this.bigIntReviver)}bigIntReplacer(r,i){return typeof i=="bigint"?{__type:"bigint",value:i.toString()}:i}bigIntReviver(r,i){return i&&i.__type==="bigint"?BigInt(i.value):i}async cleanupAutoSaves(){const r=await Me.saves.orderBy("timestamp").reverse().filter(i=>i.isAutoSave).toArray();if(r.length>5){const i=r.slice(5);await Me.saves.bulkDelete(i.map(c=>c.id))}}async trackEvent(r,i){try{const c={id:`${r}_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,event:r,data:i,timestamp:Date.now(),sessionId:this.sessionId};await Me.analytics.add(c)}catch(c){console.warn("Failed to track event:",r,c)}}async estimateStorageSize(){try{const r=await Me.saves.limit(1).first(),i=await Me.settings.limit(10).toArray(),c=await Me.achievements.limit(10).toArray();let h=0;if(r){const q=JSON.stringify(r).length,R=await Me.saves.count();h+=q*R}if(i.length>0){const q=JSON.stringify(i).length;h+=q}if(c.length>0){const q=JSON.stringify(c).length;h+=q}const[g,_,A]=await Promise.all([Me.saves.count(),Me.settings.count(),Me.achievements.count()]);return(g>0||_>0||A>0)&&(h=Math.max(h,100)),h}catch{return 0}}}Hr.getInstance();class an{static instance;achievements=[];constructor(){this.initializeAchievements()}static getInstance(){return an.instance||(an.instance=new an),an.instance}initializeAchievements(){this.achievements=[{id:"first_match",name:"First Light",description:"Create your very first matchstick",category:"production",difficulty:"easy",points:5,requirements:{type:"resource_total",resource:"matchsticks",amount:1n},reward:{type:"money",amount:10},unlocked:!1},{id:"first_hundred",name:"Century Maker",description:"Produce 100 matchsticks",category:"production",difficulty:"easy",points:10,requirements:{type:"resource_total",resource:"matchsticks",amount:100n},reward:{type:"money",amount:50},unlocked:!1},{id:"thousand_matches",name:"Master Craftsman",description:"Produce 1,000 matchsticks",category:"production",difficulty:"medium",points:25,requirements:{type:"resource_total",resource:"matchsticks",amount:1000n},reward:{type:"money",amount:200},unlocked:!1},{id:"first_sale",name:"First Sale",description:"Make your first sale",category:"trading",difficulty:"easy",points:5,requirements:{type:"stat_threshold",stat:"totalSold",value:1},reward:{type:"money",amount:25},unlocked:!1},{id:"merchant_apprentice",name:"Merchant Apprentice",description:"Earn $100 in total revenue",category:"trading",difficulty:"easy",points:10,requirements:{type:"stat_threshold",stat:"totalRevenue",value:100},reward:{type:"money",amount:50},unlocked:!1},{id:"bulk_trader",name:"Bulk Trader",description:"Sell 1,000 matchsticks in total",category:"trading",difficulty:"medium",points:20,requirements:{type:"stat_threshold",stat:"totalSold",value:1e3},reward:{type:"money",amount:100},unlocked:!1},{id:"automation_investor",name:"Automation Investor",description:"Spend $500 on automation",category:"automation",difficulty:"medium",points:15,requirements:{type:"stat_threshold",stat:"totalAutomationSpent",value:500},reward:{type:"money",amount:75},unlocked:!1},{id:"clicker_collector",name:"Clicker Collector",description:"Own 10 auto-clickers",category:"automation",difficulty:"medium",points:20,requirements:{type:"stat_threshold",stat:"totalAutoClickers",value:10},reward:{type:"money",amount:100},unlocked:!1},{id:"automation_phase",name:"Industrial Revolution",description:"Reach the automation phase",category:"progression",difficulty:"medium",points:30,requirements:{type:"phase_reached",phase:"automation"},reward:{type:"money",amount:150},unlocked:!1}]}async initialize(){}checkAchievements(){const r=lt(de),i=[];for(const c of this.achievements)c.unlocked||this.isAchievementMet(c,r)&&(c.unlocked=!0,i.push(c),this.applyReward(c.reward),Se.updateAchievements({unlocked:[...r.achievements.unlocked||[],c.id],stats:{...r.achievements.stats,totalUnlocked:(r.achievements.stats.totalUnlocked||0)+1}}),Se.emitEvent({id:`achievement_${c.id}_${Date.now()}`,type:"achievement_unlocked",timestamp:Date.now(),data:{achievementId:c.id,name:c.name,points:c.points,reward:c.reward},source:"achievement_service"}));return i}isAchievementMet(r,i){const c=r.requirements;switch(c.type){case"resource_total":return c.resource==="matchsticks"?(i.production?.totalProduced||0n)>=(c.amount||0n):!1;case"stat_threshold":switch(c.stat){case"totalSold":return Number(i.market?.totalSold||0n)>=(c.value||0);case"totalRevenue":return(i.market?.totalRevenue||0)>=(c.value||0);case"totalAutomationSpent":return(i.automation?.totalMoneySpent||0)>=(c.value||0);case"totalAutoClickers":return(i.automation?.autoClickers||[]).reduce((g,_)=>g+(_.level||0),0)>=(c.value||0)}return!1;case"phase_reached":return i.progression?.currentPhase===c.phase;default:return!1}}applyReward(r){switch(r.type){case"money":r.amount&&Se.addResources({money:r.amount});break}}getAllAchievements(){return[...this.achievements]}getUnlockedAchievements(){return this.achievements.filter(r=>r.unlocked)}getAchievement(r){return this.achievements.find(i=>i.id===r)}getAchievementsByCategory(r){return this.achievements.filter(i=>i.category===r)}getStats(){const r=this.achievements.length,i=this.achievements.filter(h=>h.unlocked).length,c=this.achievements.filter(h=>h.unlocked).reduce((h,g)=>h+g.points,0);return{totalAchievements:r,unlockedAchievements:i,completionPercentage:r>0?i/r*100:0,achievementPoints:c}}resetAchievements(){this.achievements.forEach(r=>r.unlocked=!1)}stopTracking(){}unlockAchievementById(r){const i=this.achievements.find(c=>c.id===r);if(i&&!i.unlocked){i.unlocked=!0,this.applyReward(i.reward);const c=lt(de);return Se.updateAchievements({unlocked:[...c.achievements.unlocked||[],i.id],stats:{...c.achievements.stats,totalUnlocked:(c.achievements.stats.totalUnlocked||0)+1}}),i}return null}getAchievementProgress(r){const i=this.achievements.find(g=>g.id===r);if(!i)return null;if(i.unlocked)return{achievementId:r,progress:1,isComplete:!0,currentValue:1,targetValue:1};const c=lt(de),h=this.calculateProgress(i,c);return{achievementId:r,progress:h,isComplete:!1,currentValue:h,targetValue:1}}calculateProgress(r,i){const c=r.requirements;switch(c.type){case"resource_total":if(c.resource==="matchsticks"){const h=Number(i.production?.totalProduced||0n),g=Number(c.amount||0n);return g>0?Math.min(h/g,1):0}return 0;case"stat_threshold":switch(c.stat){case"totalSold":const h=Number(i.market?.totalSold||0n);return(c.value||0)>0?Math.min(h/(c.value||0),1):0;case"totalRevenue":return(c.value||0)>0?Math.min((i.market?.totalRevenue||0)/(c.value||0),1):0;case"totalAutomationSpent":return(c.value||0)>0?Math.min((i.automation?.totalMoneySpent||0)/(c.value||0),1):0}return 0;default:return this.isAchievementMet(r,i)?1:0}}getAvailableAchievements(){return this.achievements.filter(r=>!r.unlocked)}addCustomAchievement(r){if(!r.id||!r.name||this.achievements.some(c=>c.id===r.id))return!1;const i={id:r.id,name:r.name,description:r.description||"",category:r.category||"custom",difficulty:r.difficulty||"medium",points:r.points||10,requirements:r.requirements||{type:"custom"},reward:r.reward||{type:"money",amount:10},unlocked:!1};return this.achievements.push(i),!0}}const Mr=an.getInstance();class Vr{static instance;clickCombo;productionStats;lastClickTime=0;recentClicks=[];constructor(){this.clickCombo={count:0,startTime:0,multiplier:1,maxCombo:50,decayRate:.5},this.productionStats={totalClicks:0,totalProduced:0n,averageClickRate:0,maxCombo:0,sessionProduction:0n,sessionClicks:0,sessionStartTime:Date.now()}}static getInstance(){return Vr.instance||(Vr.instance=new Vr),Vr.instance}produceMatchsticks(r=1){try{const i=Date.now(),c=lt(de);this.updateClickStats(r,i);let h=c.production.manualRate*r;const g=this.updateClickCombo(i),_=this.calculateTotalMultiplier(g),A=BigInt(Math.floor(h*_)),q=A>BigInt(r)?A:BigInt(r);return Se.addResources({matchsticks:q}),Se.updateProduction({totalProduced:Et.add(c.production.totalProduced,q)}),this.productionStats.totalProduced=Et.add(this.productionStats.totalProduced,q),this.productionStats.sessionProduction=Et.add(this.productionStats.sessionProduction,q),Se.emitEvent({id:`production_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,type:"manual_production",timestamp:i,data:{produced:q,clickCount:r,comboMultiplier:g,totalMultiplier:_,comboCount:this.clickCombo.count,name:"Like a donkey"},source:"production_service"}),Mr.checkAchievements(),this.triggerHapticFeedback(),{produced:q,comboMultiplier:g,totalMultiplier:_,comboCount:this.clickCombo.count}}catch(i){ke.handleError(xe.gameLogic("Failed to produce matchsticks",{error:i,clickCount:r}));const c=BigInt(r);return Se.addResources({matchsticks:c}),{produced:c,comboMultiplier:1,totalMultiplier:1,comboCount:0}}}getCurrentProductionRate(){try{const i=lt(de).production.manualRate,c=this.calculateTotalMultiplier(this.clickCombo.multiplier);return i*c}catch(r){return ke.handleError(xe.gameLogic("Failed to calculate production rate",{error:r})),1}}getComboInfo(){const i=Date.now()-this.lastClickTime,h=Math.max(0,2e3-i);return{count:this.clickCombo.count,multiplier:this.clickCombo.multiplier,timeRemaining:h,maxCombo:this.clickCombo.maxCombo}}getProductionStats(){return this.updateAverageClickRate(),{...this.productionStats}}resetStats(){this.productionStats={totalClicks:this.productionStats.totalClicks,totalProduced:this.productionStats.totalProduced,averageClickRate:0,maxCombo:this.productionStats.maxCombo,sessionProduction:0n,sessionClicks:0,sessionStartTime:Date.now()},this.recentClicks=[],this.resetCombo()}resetCombo(){this.clickCombo={count:0,startTime:0,multiplier:1,maxCombo:this.clickCombo.maxCombo,decayRate:this.clickCombo.decayRate}}applyTemporaryMultiplier(r,i){try{const c=lt(de),h={id:`temp_${Date.now()}`,name:"Temporary Boost",multiplier:r,duration:i,startTime:Date.now(),source:"temporary"},g={...c.production.multipliers};g[h.id]=r,Se.updateProduction({multipliers:g}),setTimeout(()=>{this.removeMultiplier(h.id)},i),Se.emitEvent({id:`multiplier_${Date.now()}`,type:"multiplier_applied",timestamp:Date.now(),data:{multiplier:r,duration:i,name:`Temporary Boost ${r}x`},source:"production_service"})}catch(c){ke.handleError(xe.gameLogic("Failed to apply multiplier",{error:c,multiplier:r,duration:i}))}}removeMultiplier(r){try{const c={...lt(de).production.multipliers};delete c[r],Se.updateProduction({multipliers:c})}catch(i){ke.handleError(xe.gameLogic("Failed to remove multiplier",{error:i,multiplierId:r}))}}updateClickStats(r,i){this.productionStats.totalClicks+=r,this.productionStats.sessionClicks+=r,this.lastClickTime=i,this.recentClicks.push(i);const c=i-1e4;this.recentClicks=this.recentClicks.filter(h=>h>c)}updateClickCombo(r){return r-this.lastClickTime>2e3?(this.clickCombo.count=1,this.clickCombo.startTime=r,this.clickCombo.multiplier=1):(this.clickCombo.count=Math.min(this.clickCombo.count+1,this.clickCombo.maxCombo),this.clickCombo.multiplier=1+(this.clickCombo.count-1)*.01),this.productionStats.maxCombo=Math.max(this.productionStats.maxCombo,this.clickCombo.count),this.clickCombo.multiplier}calculateTotalMultiplier(r){try{const i=lt(de);let c=r;const h=i.production.multipliers;for(const[g,_]of Object.entries(h))typeof _=="number"&&_>0&&(c*=_);return c}catch(i){return ke.handleError(xe.gameLogic("Failed to calculate total multiplier",{error:i})),r}}updateAverageClickRate(){const r=Date.now(),i=this.recentClicks.length,c=Math.min(1e4,r-this.productionStats.sessionStartTime);c>0&&(this.productionStats.averageClickRate=i/c*1e3)}triggerHapticFeedback(){try{lt(de).settings.hapticEnabled&&"vibrate"in navigator&&navigator.vibrate(10)}catch(r){console.debug("Haptic feedback not available:",r)}}}const Or=Vr.getInstance(),qo=Object.freeze(Object.defineProperty({__proto__:null,ProductionService:Vr,productionService:Or},Symbol.toStringTag,{value:"Module"}));class Gr{static instance;priceUpdateInterval=null;conditionCheckInterval=null;recentTrades=[];marketAnalysisCache=null;lastAnalysisTime=0;baseVolatility=.02;maxVolatility=.15;priceUpdateFrequency=5e3;conditionCheckFrequency=3e4;maxPriceHistory=100;marketConditions=[{id:"recession",name:"Economic Recession",description:"Demand for luxury items like matchsticks decreases",priceMultiplier:.7,demandLevel:"low",duration:12e4,probability:.05,triggers:["market_crash","oversupply"]},{id:"boom",name:"Economic Boom",description:"High demand for all goods including matchsticks",priceMultiplier:1.4,demandLevel:"high",duration:9e4,probability:.08,triggers:["market_boom","shortage"]},{id:"winter_season",name:"Winter Season",description:"Cold weather increases demand for fire-making tools",priceMultiplier:1.2,demandLevel:"high",duration:18e4,probability:.12,triggers:["seasonal","weather"]},{id:"fire_ban",name:"Fire Safety Restrictions",description:"Government restrictions reduce matchstick demand",priceMultiplier:.6,demandLevel:"low",duration:15e4,probability:.03,triggers:["regulation","safety"]},{id:"festival",name:"Festival Season",description:"Celebrations and events drive up matchstick demand",priceMultiplier:1.3,demandLevel:"peak",duration:6e4,probability:.1,triggers:["seasonal","celebration"]}];constructor(){this.startMarketSimulation()}static getInstance(){return Gr.instance||(Gr.instance=new Gr),Gr.instance}sellMatchsticks(r){try{const i=lt(de),c=i.resources.matchsticks;if(r<=0n)throw new Error("Amount must be greater than 0");if(r>c)throw new Error("Insufficient matchsticks");const h=this.getCurrentPrice(),g=this.calculateMarketImpact(r),_=h*g,A=Number(r)*_;if(!Se.sellMatchsticks(r))return{success:!1,revenue:0,pricePerUnit:h,remainingMatchsticks:c,marketShare:0};Se.addResources({money:A});const R=lt(de),$=Et.add(R.market.totalSold,r),K=R.market.totalRevenue+A;Se.updateMarket({totalSold:$,totalRevenue:K});const W={id:`trade_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:Date.now(),matchsticksSold:r,pricePerUnit:_,totalRevenue:A,marketCondition:i.market.condition?.description||"Normal",playerCash:R.resources.money,marketShare:this.calculateMarketShare($)};return this.recentTrades.unshift(W),this.recentTrades.length>50&&(this.recentTrades=this.recentTrades.slice(0,50)),this.updatePriceAfterTrade(r,_),Se.emitEvent({id:`trade_${Date.now()}`,type:"trade_executed",timestamp:Date.now(),data:{amount:r,revenue:A,pricePerUnit:_,marketShare:W.marketShare},source:"market_service"}),Mr.checkAchievements(),{success:!0,revenue:A,pricePerUnit:_,remainingMatchsticks:R.resources.matchsticks,marketShare:W.marketShare,transaction:W}}catch(i){ke.handleError(xe.gameLogic("Failed to sell matchsticks",{error:i,amount:r.toString()}));const c=lt(de);return{success:!1,revenue:0,pricePerUnit:this.getCurrentPrice(),remainingMatchsticks:c.resources.matchsticks,marketShare:0}}}getCurrentPrice(){try{return lt(de).market.currentPrice}catch(r){return ke.handleError(xe.gameLogic("Failed to get current price",{error:r})),1}}getMarketAnalysis(){const r=Date.now();if(this.marketAnalysisCache&&r-this.lastAnalysisTime<1e4)return this.marketAnalysisCache;try{const i=lt(de),c=i.market.currentPrice,h=i.market.priceHistory,g=this.calculateTrend(h),_=this.calculateVolatility(h),{support:A,resistance:q}=this.calculateSupportResistance(h),R=this.calculateAverageVolume(),$=this.generateRecommendation(c,g,_,A,q);return this.marketAnalysisCache={currentPrice:c,priceHistory:h,trend:g,volatility:_,resistance:q,support:A,marketCap:c*Number(i.market.totalSold||0n),averageVolume:R,recommendation:$},this.lastAnalysisTime=r,this.marketAnalysisCache}catch(i){return ke.handleError(xe.gameLogic("Failed to generate market analysis",{error:i})),{currentPrice:this.getCurrentPrice(),priceHistory:[],trend:"stable",volatility:0,resistance:0,support:0,marketCap:0,averageVolume:0n,recommendation:"hold"}}}getRecentTrades(r=10){return this.recentTrades.slice(0,r)}getAvailableConditions(){return[...this.marketConditions]}triggerMarketCondition(r){try{const i=this.marketConditions.find(c=>c.id===r);return i?(this.applyMarketCondition(i),!0):!1}catch(i){return ke.handleError(xe.gameLogic("Failed to trigger market condition",{error:i,conditionId:r})),!1}}stopSimulation(){this.priceUpdateInterval&&(clearInterval(this.priceUpdateInterval),this.priceUpdateInterval=null),this.conditionCheckInterval&&(clearInterval(this.conditionCheckInterval),this.conditionCheckInterval=null)}startMarketSimulation(){this.priceUpdateInterval=setInterval(()=>{this.updateMarketPrice()},this.priceUpdateFrequency),this.conditionCheckInterval=setInterval(()=>{this.checkForMarketConditions()},this.conditionCheckFrequency)}updateMarketPrice(){try{const r=lt(de),i=r.market.currentPrice,c=r.market.basePrice,h=r.market.condition?.priceMultiplier||1;let g=this.baseVolatility;r.market.condition&&(g*=1+Math.abs(h-1));const _=(Math.random()-.5)*2,A=i*g*_,R=(c*h-i)*.1,$=Math.max(.1,i+A+R),K=[...r.market.priceHistory];K.push({timestamp:Date.now(),price:$,volume:0,condition:r.market.condition?.description||"Normal"}),K.length>this.maxPriceHistory&&K.shift(),Se.updateMarket({currentPrice:$,priceHistory:K}),Se.emitEvent({id:`price_change_${Date.now()}`,type:"price_change",timestamp:Date.now(),data:{previousPrice:i,newPrice:$,change:$-i,changePercent:($-i)/i*100},source:"market_service"})}catch(r){ke.handleError(xe.gameLogic("Failed to update market price",{error:r}))}}checkForMarketConditions(){try{const r=lt(de);if(r.market.condition&&Math.random()<.1){this.clearMarketCondition();return}if(r.market.condition)return;for(const i of this.marketConditions)if(Math.random()<i.probability){this.applyMarketCondition(i);break}}catch(r){ke.handleError(xe.gameLogic("Failed to check market conditions",{error:r}))}}applyMarketCondition(r){const i={priceMultiplier:r.priceMultiplier,demandLevel:r.demandLevel,trend:r.priceMultiplier>1?"rising":"falling",duration:r.duration,description:r.name};Se.updateMarket({condition:i}),Se.emitEvent({id:`condition_${r.id}_${Date.now()}`,type:"condition_change",timestamp:Date.now(),data:{conditionId:r.id,name:r.name,description:r.description,priceMultiplier:r.priceMultiplier,duration:r.duration},source:"market_service"})}clearMarketCondition(){Se.updateMarket({condition:void 0}),Se.emitEvent({id:`condition_cleared_${Date.now()}`,type:"condition_change",timestamp:Date.now(),data:{cleared:!0},source:"market_service"})}calculateMarketImpact(r){const i=Number(r),c=1e3;if(i<=c)return 1;const h=i-c;return 1-Math.min(.2,h/1e4)}updatePriceAfterTrade(r,i){const c=Number(r),h=Math.min(.05,c/5e3),g=i*(1-h);Se.updateMarket({currentPrice:Math.max(.1,g)})}calculateMarketShare(r){return Math.min(100,Number(r)/1e6*100)}calculateTrend(r){if(r.length<5)return"stable";const i=r.slice(-5),c=i[0].price,g=(i[i.length-1].price-c)/c;return g>.02?"rising":g<-.02?"falling":"stable"}calculateVolatility(r){if(r.length<10)return 0;const c=r.slice(-20).map(_=>_.price),h=c.reduce((_,A)=>_+A)/c.length,g=c.reduce((_,A)=>_+Math.pow(A-h,2),0)/c.length;return Math.sqrt(g)/h}calculateSupportResistance(r){if(r.length<20)return{support:0,resistance:0};const c=r.slice(-50).map(_=>_.price),h=Math.min(...c),g=Math.max(...c);return{support:h,resistance:g}}calculateAverageVolume(){return this.recentTrades.length===0?0n:this.recentTrades.reduce((i,c)=>Et.add(i,c.matchsticksSold),0n)/BigInt(this.recentTrades.length)}generateRecommendation(r,i,c,h,g){return i==="rising"&&r<g*.9?"buy":i==="falling"&&r>h*1.1?"sell":(c>.1,"hold")}}const nn=Gr.getInstance(),Oo=Object.freeze(Object.defineProperty({__proto__:null,MarketService:Gr,marketService:nn},Symbol.toStringTag,{value:"Module"}));class sn{static instance;autoClickInterval=null;autoProductionInterval=null;autoSellInterval=null;maintenanceInterval=null;autoClickFrequency=1e3;autoProductionFrequency=1e3;autoSellFrequency=2e3;maintenanceFrequency=5e3;autoClickerConfigs=[{id:"basic_clicker",name:"Basic Auto-Clicker",description:"Automatically clicks once per second",baseCost:50,costMultiplier:1.15,baseClicksPerSecond:1,maxLevel:50},{id:"fast_clicker",name:"Fast Auto-Clicker",description:"Clicks 3 times per second with improved efficiency",baseCost:250,costMultiplier:1.2,baseClicksPerSecond:3,maxLevel:25,unlockRequirement:{totalProduced:1000n}},{id:"turbo_clicker",name:"Turbo Auto-Clicker",description:"High-speed clicking with 8 clicks per second",baseCost:1e3,costMultiplier:1.25,baseClicksPerSecond:8,maxLevel:10,unlockRequirement:{totalProduced:10000n,totalRevenue:1e3}},{id:"quantum_clicker",name:"Quantum Auto-Clicker",description:"Theoretical physics-powered clicking at 20/second",baseCost:5e3,costMultiplier:1.3,baseClicksPerSecond:20,maxLevel:5,unlockRequirement:{totalProduced:100000n,totalRevenue:1e4}}];facilityConfigs=[{id:"basic_factory",name:"Basic Matchstick Factory",description:"Produces 5 matchsticks per second automatically",cost:500,baseProduction:5n,owned:0,maxOwned:10,efficiency:1,maintenanceCost:2,unlockRequirement:{totalProduced:5000n}},{id:"advanced_factory",name:"Advanced Production Line",description:"High-efficiency production of 25 matchsticks/second",cost:2500,baseProduction:25n,owned:0,maxOwned:5,efficiency:1,maintenanceCost:8,unlockRequirement:{totalProduced:50000n,autoClickersOwned:5}},{id:"mega_plant",name:"Mega Production Plant",description:"Industrial-scale production at 100 matchsticks/second",cost:15e3,baseProduction:100n,owned:0,maxOwned:2,efficiency:1,maintenanceCost:30,unlockRequirement:{type:"resource",condition:"totalProduced",value:500000n,description:"Requires 500,000 total production"}}];constructor(){this.startAutomation()}static getInstance(){return sn.instance||(sn.instance=new sn),sn.instance}purchaseAutoClicker(r){try{const i=this.autoClickerConfigs.find(K=>K.id===r);if(!i)return{success:!1,error:"Auto-clicker not found"};const c=lt(de),h=c.automation.autoClickers.find(K=>K.id===r),g=h?.level||0;if(g>=i.maxLevel)return{success:!1,error:"Maximum level reached"};if(!this.checkUnlockRequirement(i.unlockRequirement,c))return{success:!1,error:"Unlock requirements not met"};const _=this.calculateAutoClickerCost(i,g);if(c.resources.money<_)return{success:!1,error:"Insufficient funds"};Se.addResources({money:-_});const A=g+1,q=[...c.automation.autoClickers];if(h){const K=q.findIndex(W=>W.id===r);q[K]={...h,level:A}}else q.push({id:r,level:A,isActive:!0,totalClicks:0n,efficiency:1});Se.updateAutomation({autoClickers:q});const $=(c.automation.totalMoneySpent||0)+_;return Se.updateAutomation({totalMoneySpent:$}),Se.emitEvent({id:`autoclicker_purchase_${Date.now()}`,type:"upgrade_purchased",timestamp:Date.now(),data:{itemType:"auto_clicker",itemId:r,cost:_,newLevel:A,totalSpent:$},source:"automation_service"}),Mr.checkAchievements(),{success:!0,cost:_,newLevel:A}}catch(i){return ke.handleError(xe.gameLogic("Failed to purchase auto-clicker",{error:i,clickerId:r})),{success:!1,error:"Purchase failed"}}}purchaseFacility(r){try{const i=this.facilityConfigs.find(q=>q.id===r);if(!i)return{success:!1,error:"Facility not found"};const c=lt(de),h=i.owned;if(h>=i.maxOwned)return{success:!1,error:"Maximum facilities owned"};if(!this.checkUnlockRequirement(i.unlockRequirement,c))return{success:!1,error:"Unlock requirements not met"};const g=Math.floor(i.cost*Math.pow(1.5,h));if(c.resources.money<g)return{success:!1,error:"Insufficient funds"};Se.addResources({money:-g});const _=this.facilityConfigs.findIndex(q=>q.id===r);this.facilityConfigs[_].owned=h+1;const A=c.automation.totalMoneySpent+g;return Se.updateAutomation({totalMoneySpent:A}),Se.emitEvent({id:`facility_purchase_${Date.now()}`,type:"upgrade_purchased",timestamp:Date.now(),data:{itemType:"facility",itemId:r,cost:g,newCount:h+1,totalSpent:A},source:"automation_service"}),Mr.checkAchievements(),{success:!0,cost:g,newCount:h+1}}catch(i){return ke.handleError(xe.gameLogic("Failed to purchase facility",{error:i,facilityId:r})),{success:!1,error:"Purchase failed"}}}configureAutoSell(r){try{if(r.threshold<=0n||r.percentage<=0||r.percentage>100||r.minPrice<0||r.maxPerSecond<=0n)return!1;const i=lt(de);return Se.updateMarket({autoSellEnabled:r.enabled,autoSellThreshold:Number(r.threshold)}),Se.updateAutomation({autoSellSettings:{threshold:r.threshold,percentage:r.percentage,minPrice:r.minPrice,maxPerSecond:r.maxPerSecond,enabled:r.enabled}}),!0}catch(i){return ke.handleError(xe.gameLogic("Failed to configure auto-sell",{error:i})),!1}}getAutomationStats(){try{const r=lt(de),i=r.automation.autoClickers.reduce(($,K)=>$+K.level,0),c=this.facilityConfigs.reduce(($,K)=>$+K.owned,0),h=this.facilityConfigs.reduce(($,K)=>Et.add($,Et.multiply(K.baseProduction,BigInt(K.owned))),0n),g=r.automation.autoClickers.reduce(($,K)=>{const W=this.autoClickerConfigs.find(ue=>ue.id===K.id);return $+(W?W.baseClicksPerSecond*K.level:0)},0),_=this.facilityConfigs.reduce(($,K)=>$+K.maintenanceCost*K.owned,0),A=this.calculateEfficiencyRating(i,c),q=BigInt(Math.floor(_*.5)),R=Et.subtract(h,q);return{totalAutoClickers:i,totalFacilities:c,autoProductionRate:h,autoClickRate:g,totalMoneySpent:r.automation.totalMoneySpent,efficiencyRating:A,maintenanceCost:_,netProduction:R>0n?R:0n}}catch(r){return ke.handleError(xe.gameLogic("Failed to get automation stats",{error:r})),{totalAutoClickers:0,totalFacilities:0,autoProductionRate:0n,autoClickRate:0,totalMoneySpent:0,efficiencyRating:0,maintenanceCost:0,netProduction:0n}}}getAvailableAutoClickers(){try{const r=lt(de);return this.autoClickerConfigs.map(i=>{const h=r.automation.autoClickers.find(q=>q.id===i.id)?.level||0,g=this.calculateAutoClickerCost(i,h),_=this.checkUnlockRequirement(i.unlockRequirement,r),A=h>=i.maxLevel;return{...i,cost:g,currentLevel:h,isUnlocked:_,isMaxed:A}})}catch(r){return ke.handleError(xe.gameLogic("Failed to get available auto-clickers",{error:r})),[]}}getAvailableFacilities(){try{const r=lt(de);return this.facilityConfigs.map(i=>{const c=Math.floor(i.cost*Math.pow(1.5,i.owned)),h=this.checkUnlockRequirement(i.unlockRequirement,r),g=i.owned>=i.maxOwned;return{...i,cost:c,isUnlocked:h,isMaxed:g}})}catch(r){return ke.handleError(xe.gameLogic("Failed to get available facilities",{error:r})),[]}}stopAutomation(){this.autoClickInterval&&(clearInterval(this.autoClickInterval),this.autoClickInterval=null),this.autoProductionInterval&&(clearInterval(this.autoProductionInterval),this.autoProductionInterval=null),this.autoSellInterval&&(clearInterval(this.autoSellInterval),this.autoSellInterval=null),this.maintenanceInterval&&(clearInterval(this.maintenanceInterval),this.maintenanceInterval=null)}startAutomation(){this.autoClickInterval=setInterval(()=>{this.processAutoClickers()},this.autoClickFrequency),this.autoProductionInterval=setInterval(()=>{this.processAutoProduction()},this.autoProductionFrequency),this.autoSellInterval=setInterval(()=>{this.processAutoSell()},this.autoSellFrequency),this.maintenanceInterval=setInterval(()=>{this.processMaintenance()},this.maintenanceFrequency)}async processAutoClickers(){try{const r=lt(de);for(const i of r.automation.autoClickers){if(!i.isActive)continue;const c=this.autoClickerConfigs.find(_=>_.id===i.id);if(!c)continue;const h=c.baseClicksPerSecond*(this.autoClickFrequency/1e3),g=Math.floor(h*i.level*i.efficiency);if(g>0){const A=(await yi(()=>Promise.resolve().then(()=>qo),void 0,import.meta.url)).productionService.produceMatchsticks(g),q=r.automation.autoClickers.map(R=>R.id===i.id?{...R,totalClicks:Et.add(R.totalClicks,BigInt(g))}:R);Se.updateAutomation({autoClickers:q})}}}catch(r){ke.handleError(xe.gameLogic("Auto-clicker processing failed",{error:r}))}}processAutoProduction(){try{const r=this.facilityConfigs.reduce((i,c)=>{const h=Et.multiply(c.baseProduction,BigInt(c.owned)),g=Et.divide(Et.multiply(h,BigInt(this.autoProductionFrequency)),1000n);return Et.add(i,g)},0n);if(r>0n){Se.addResources({matchsticks:r});const i=lt(de);Se.updateProduction({totalProduced:Et.add(i.production.totalProduced,r)})}}catch(r){ke.handleError(xe.gameLogic("Auto production processing failed",{error:r}))}}async processAutoSell(){try{const r=lt(de),i=r.automation.autoSellSettings;if(!i?.enabled||!r.market.autoSellEnabled)return;const c=r.resources.matchsticks;if(c<i.threshold||r.market.currentPrice<i.minPrice)return;const h=Et.divide(Et.multiply(c,BigInt(i.percentage)),100n),g=h>i.maxPerSecond?i.maxPerSecond:h;g>0n&&(await yi(()=>Promise.resolve().then(()=>Oo),void 0,import.meta.url)).marketService.sellMatchsticks(g)}catch(r){ke.handleError(xe.gameLogic("Auto-sell processing failed",{error:r}))}}processMaintenance(){try{const r=this.facilityConfigs.reduce((i,c)=>i+c.maintenanceCost*c.owned,0);if(r>0){const i=r*(this.maintenanceFrequency/1e3);lt(de).resources.money>=i?Se.addResources({money:-i}):this.reduceFacilityEfficiency()}}catch(r){ke.handleError(xe.gameLogic("Maintenance processing failed",{error:r}))}}reduceFacilityEfficiency(){this.facilityConfigs.forEach(r=>{r.efficiency=Math.max(.1,r.efficiency-.05)}),Se.emitEvent({id:`maintenance_warning_${Date.now()}`,type:"maintenance_required",timestamp:Date.now(),data:{message:"Facility efficiency reduced due to unpaid maintenance"},source:"automation_service"})}calculateAutoClickerCost(r,i){return Math.floor(r.baseCost*Math.pow(r.costMultiplier,i))}checkUnlockRequirement(r,i){return r?!(r.totalProduced&&i.production.totalProduced<r.totalProduced||r.totalRevenue&&i.market.totalRevenue<r.totalRevenue||r.autoClickersOwned&&i.automation.autoClickers.reduce((h,g)=>h+g.level,0)<r.autoClickersOwned||r.gamePhase&&i.progression.currentPhase!==r.gamePhase):!0}calculateEfficiencyRating(r,i){const c=Math.min(100,(r+i)*5),h=Math.min(20,Math.abs(r-i*2)<5?20:0);return Math.min(100,c+h)}}const qr=sn.getInstance(),kn=Hr.getInstance();class on{static instance;autoSaveInterval=null;config;initialized=!1;constructor(){this.config={autoSaveInterval:3e4,enableAutoSave:!0,debugMode:!1}}static getInstance(){return on.instance||(on.instance=new on),on.instance}async initialize(){try{console.log("ðŸŽ® Initializing Matchstick Empire..."),await kn.initialize(),lt(de).metadata.version||(this.initializeNewGame(),console.log("ðŸ†• New game initialized")),this.config.enableAutoSave&&this.startAutoSave(),this.initialized=!0,console.log("ðŸš€ Game initialization complete")}catch(r){console.error("âŒ Failed to initialize game:",r),this.initializeNewGame(),this.initialized=!0}}initializeNewGame(){Se.reset(),Se.emitEvent({id:`new_game_${Date.now()}`,type:"new_game_started",timestamp:Date.now(),data:{},source:"game_manager"})}startAutoSave(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval),this.autoSaveInterval=setInterval(async()=>{await this.saveGame("auto-save")},this.config.autoSaveInterval),this.config.debugMode&&console.log(`ðŸ’¾ Auto-save enabled (${this.config.autoSaveInterval/1e3}s interval)`)}stopAutoSave(){this.autoSaveInterval&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}async saveGame(r){try{if(!this.initialized)return console.warn("Cannot save: Game not initialized"),!1;const i=lt(de),c=r||`Save ${new Date().toLocaleString()}`,h=await kn.saveGame(i,c);return typeof h=="string"?(this.config.debugMode&&console.log("ðŸ’¾ Game saved:",c),Se.emitEvent({id:`game_saved_${Date.now()}`,type:"game_saved",timestamp:Date.now(),data:{saveName:c,saveId:h},source:"game_manager"}),!0):!1}catch(i){return console.error("âŒ Failed to save game:",i),!1}}async loadGame(r){try{const i=await kn.loadGame(r);return i?(Se.load(i),console.log("âœ… Game loaded from save:",r),Se.emitEvent({id:`game_loaded_${Date.now()}`,type:"game_loaded",timestamp:Date.now(),data:{saveId:r},source:"game_manager"}),!0):!1}catch(i){return console.error("âŒ Failed to load game:",i),!1}}async resetGame(){try{this.initializeNewGame(),console.log("ðŸ”„ Game reset to initial state"),Se.emitEvent({id:`game_reset_${Date.now()}`,type:"game_reset",timestamp:Date.now(),data:{},source:"game_manager"})}catch(r){console.error("âŒ Failed to reset game:",r)}}shutdown(){this.config.debugMode&&console.log("ðŸ›‘ Shutting down Game Manager..."),this.saveGame("shutdown-save"),this.stopAutoSave(),this.initialized=!1,this.config.debugMode&&console.log("ðŸ‘‹ Game Manager shutdown complete")}updateConfig(r){this.config={...this.config,...r},(r.autoSaveInterval!==void 0||r.enableAutoSave!==void 0)&&(this.stopAutoSave(),this.config.enableAutoSave&&this.startAutoSave())}getConfig(){return{...this.config}}isInitialized(){return this.initialized}async getSaves(){try{return await kn.listSaves()}catch(r){return console.error("âŒ Failed to get saves:",r),[]}}async deleteSave(r){try{return await kn.deleteSave(r),!0}catch(i){return console.error("âŒ Failed to delete save:",i),!1}}}const Fa=on.getInstance();typeof window<"u"&&(window.addEventListener("beforeunload",()=>{Fa.shutdown()}),document.addEventListener("visibilitychange",()=>{document.hidden&&Fa.saveGame("tab-hidden-save")}));function be(l){let r;if(typeof l=="bigint"){if(l>Number.MAX_SAFE_INTEGER)return Do(l);r=Number(l)}else r=l;if(r===0)return"0";const i=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc"],c=Math.floor(Math.log10(Math.abs(r))/3);if(c===0)return r.toLocaleString();if(c>=i.length)return r.toExponential(2);const h=i[c],g=Math.pow(10,c*3),_=r/g,A=_<10?2:_<100?1:0;return _.toFixed(A)+h}function Do(l){const r=l.toString(),i=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc"];if(r.length<=3)return r;const c=Math.floor((r.length-1)/3);if(c>=i.length)return`${r.slice(0,3)}...e${r.length-1}`;const h=r.length-c*3,g=r.slice(0,h),_=r.slice(h,h+2);let A=g;return _&&_!=="00"&&(A+="."+_.replace(/0+$/,"")),A+i[c]}function ct(l,r="$"){return!l||l===0?`${r}0.00`:Math.abs(l)>=1e3?`${r}${be(l)}`:`${r}${l.toFixed(2)}`}function gr(l,r=1){return`${(l*100).toFixed(r)}%`}function Ci(l){if(l<1e3)return`${l}ms`;const r=Math.floor(l/1e3),i=Math.floor(r/60),c=Math.floor(i/60),h=Math.floor(c/24);return h>0?`${h}d ${c%24}h`:c>0?`${c}h ${i%60}m`:i>0?`${i}m ${r%60}s`:`${r}s`}function Pi(l,r="sec"){return`${be(l)}/${r}`}function tn(l){return l===1?"1x":`${l.toFixed(l<10?2:1)}x`}function Un(l,r){return r===0?"100%":`${Math.min(l/r*100,100).toFixed(1)}% (${be(l)}/${be(r)})`}var $o=Fe('<div class="click-animation svelte-etcxcj"> </div>'),Fo=Fe('<div class="combo-display svelte-etcxcj"><span class="combo-count svelte-etcxcj"> </span> <span class="combo-multiplier svelte-etcxcj"> </span></div>'),Ko=Fe('<div class="multiplier-item svelte-etcxcj"><span class="multiplier-name svelte-etcxcj">Combo Bonus</span> <span class="multiplier-value svelte-etcxcj"> </span></div>'),No=Fe('<div class="production-panel svelte-etcxcj"><div class="panel-header svelte-etcxcj"><h2 class="svelte-etcxcj">ðŸ”¥ Production Center</h2> <p class="panel-description svelte-etcxcj">Click to create matchsticks and build your empire!</p></div> <div class="production-content svelte-etcxcj"><div class="production-main svelte-etcxcj"><div class="production-button-container svelte-etcxcj"><button><div class="button-background svelte-etcxcj"></div> <div class="button-content svelte-etcxcj"><div class="button-icon svelte-etcxcj">ðŸ”¥</div> <div class="button-text svelte-etcxcj"><span class="action-text svelte-etcxcj">Create Matchstick</span> <span class="rate-text svelte-etcxcj"> </span></div></div> <!> <!></button> <div class="keyboard-hint svelte-etcxcj">Press <kbd class="svelte-etcxcj">Space</kbd> to click</div></div> <div class="production-stats svelte-etcxcj"><div class="stat-grid svelte-etcxcj"><div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">ðŸ“Š</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Total Produced</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">âš¡</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Production Rate</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">ðŸŽ¯</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Total Clicks</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">ðŸ”¥</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Max Combo</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">â±ï¸</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Avg Click Rate</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">ðŸ“ˆ</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Session Production</div> <div class="stat-value svelte-etcxcj"> </div></div></div></div></div></div> <div class="production-sidebar svelte-etcxcj"><div class="session-info svelte-etcxcj"><h3 class="svelte-etcxcj">Current Session</h3> <div class="session-stats svelte-etcxcj"><div class="session-stat svelte-etcxcj"><span class="label svelte-etcxcj">Clicks:</span> <span class="value svelte-etcxcj"> </span></div> <div class="session-stat svelte-etcxcj"><span class="label svelte-etcxcj">Produced:</span> <span class="value svelte-etcxcj"> </span></div> <div class="session-stat svelte-etcxcj"><span class="label svelte-etcxcj">Current Combo:</span> <span class="value combo-highlight svelte-etcxcj"> </span></div></div></div> <div class="production-tips svelte-etcxcj"><h3 class="svelte-etcxcj">ðŸ’¡ Tips</h3> <ul class="tips-list svelte-etcxcj"><li class="svelte-etcxcj">Click rapidly to build up combo multipliers</li> <li class="svelte-etcxcj">Higher combos give exponential bonuses</li> <li class="svelte-etcxcj">Use the spacebar for faster clicking</li> <li class="svelte-etcxcj">Upgrade your automation to produce while away</li> <li class="svelte-etcxcj">Watch the market for optimal selling times</li></ul></div> <div class="multipliers-info svelte-etcxcj"><h3 class="svelte-etcxcj">ðŸš€ Active Multipliers</h3> <div class="multipliers-list svelte-etcxcj"><!> <div class="multiplier-item svelte-etcxcj"><span class="multiplier-name svelte-etcxcj">Base Rate</span> <span class="multiplier-value svelte-etcxcj"> </span></div></div></div></div></div></div>');function Bo(l,r){br(r,!1);const[i,c]=Xr(),h=()=>Fr(de,"$gameState",i),g=ze(),_=ze();let A=ze([]),q=ze(),R=ze({count:0,multiplier:1});Xn(()=>{const Ne=setInterval(()=>{ye(R,Or.getComboInfo())},100);return()=>{clearInterval(Ne)}});function $(Ne){const me=Date.now();if(Or.produceMatchsticks(1),o(q)){const F=o(q).getBoundingClientRect(),kt=Ne.clientX-F.left,ht=Ne.clientY-F.top,qt=`anim_${me}_${Math.random().toString(36).substr(2,9)}`;ye(A,[...o(A),{id:qt,x:kt,y:ht}]),setTimeout(()=>{ye(A,o(A).filter(N=>N.id!==qt))},1e3)}}function K(Ne){if(Ne.code==="Space"&&(Ne.preventDefault(),o(q))){const me=o(q).getBoundingClientRect(),F={clientX:me.left+me.width/2,clientY:me.top+me.height/2};$(F)}}Tt(()=>Or,()=>{ye(g,Or.getProductionStats())}),Tt(()=>Or,()=>{ye(_,Or.getCurrentProductionRate())}),ln(),_r();var W=No();Lt("keydown",Ki,K);var ue=p(v(W),2),X=v(ue),ee=v(X),te=v(ee);let ce;var oe=p(v(te),2),we=p(v(oe),2),Ce=p(v(we),2),_e=v(Ce);d(Ce),d(we),d(oe);var V=p(oe,2);vr(V,1,()=>o(A),Ne=>Ne.id,(Ne,me)=>{var F=$o(),kt=v(F);d(F),Le(ht=>{Nt(F,`left: ${o(me),I(()=>o(me).x)??""}px; top: ${o(me),I(()=>o(me).y)??""}px;`),D(kt,`+${ht??""}`)},[()=>(ie(be),o(_),I(()=>be(o(_))))]),sr(3,F,()=>Ur,()=>({y:-50,duration:1e3,easing:Dr})),re(Ne,F)});var ne=p(V,2);{var Ie=Ne=>{var me=Fo(),F=v(me),kt=v(F);d(F);var ht=p(F,2),qt=v(ht,!0);d(ht),d(me),Le(N=>{D(kt,`${o(R),I(()=>o(R).count)??""}x`),D(qt,N)},[()=>(ie(tn),o(R),I(()=>tn(o(R).multiplier)))]),sr(3,me,()=>Ka,()=>({duration:200})),re(Ne,me)};pt(ne,Ne=>{o(R),I(()=>o(R).count>0)&&Ne(Ie)})}d(te),Ys(te,Ne=>ye(q,Ne),()=>o(q)),Vn(2),d(ee);var Ze=p(ee,2),ut=v(Ze),dt=v(ut),je=p(v(dt),2),Te=p(v(je),2),We=v(Te,!0);d(Te),d(je),d(dt);var et=p(dt,2),gt=p(v(et),2),St=p(v(gt),2),Xe=v(St);d(St),d(gt),d(et);var tt=p(et,2),se=p(v(tt),2),G=p(v(se),2),at=v(G,!0);d(G),d(se),d(tt);var ge=p(tt,2),it=p(v(ge),2),vt=p(v(it),2),st=v(vt);d(vt),d(it),d(ge);var _t=p(ge,2),Ct=p(v(_t),2),J=p(v(Ct),2),Mt=v(J,!0);d(J),d(Ct),d(_t);var le=p(_t,2),U=p(v(le),2),Ae=p(v(U),2),Re=v(Ae,!0);d(Ae),d(U),d(le),d(ut),d(Ze),d(X);var qe=p(X,2),Ve=v(qe),Ye=p(v(Ve),2),bt=v(Ye),wt=p(v(bt),2),ve=v(wt,!0);d(wt),d(bt);var z=p(bt,2),Pe=p(v(z),2),De=v(Pe,!0);d(Pe),d(z);var he=p(z,2),fe=p(v(he),2),pe=v(fe);d(fe),d(he),d(Ye),d(Ve);var Oe=p(Ve,4),Pt=p(v(Oe),2),ft=v(Pt);{var ot=Ne=>{var me=Ko(),F=p(v(me),2),kt=v(F,!0);d(F),d(me),Le(ht=>D(kt,ht),[()=>(ie(tn),o(R),I(()=>tn(o(R).multiplier)))]),re(Ne,me)};pt(ft,Ne=>{o(R),I(()=>o(R).multiplier>1)&&Ne(ot)})}var mt=p(ft,2),yt=p(v(mt),2),Rt=v(yt,!0);d(yt),d(mt),d(Pt),d(Oe),d(qe),d(ue),d(W),Le((Ne,me,F,kt,ht,qt,N,Gt,Qt,rr)=>{ce=yr(te,1,"production-button svelte-etcxcj",null,ce,Ne),Nt(te,`transform: scale(${me??""})`),D(_e,`+${F??""} per click`),D(We,kt),D(Xe,`${ht??""}/click`),D(at,qt),D(st,`${o(g),I(()=>o(g).maxCombo)??""}x`),D(Mt,N),D(Re,Gt),D(ve,(o(g),I(()=>o(g).sessionClicks))),D(De,Qt),D(pe,`${o(R),I(()=>o(R).count)??""}x`),D(Rt,rr)},[()=>({"combo-active":o(R).count>0}),()=>(o(R),I(()=>1+Math.min(o(R).count*.01,.2))),()=>(ie(be),o(_),I(()=>be(o(_)))),()=>(ie(be),h(),I(()=>be(h().production.totalProduced))),()=>(ie(be),o(_),I(()=>be(o(_)))),()=>(ie(be),o(g),I(()=>be(o(g).totalClicks))),()=>(ie(Pi),o(g),I(()=>Pi(o(g).averageClickRate,"min"))),()=>(ie(be),o(g),I(()=>be(o(g).sessionProduction))),()=>(ie(be),o(g),I(()=>be(o(g).sessionProduction))),()=>(ie(tn),h(),I(()=>tn(h().production.manualRate)))]),Lt("click",te,$),re(l,W),wr(),c()}var Lo=Fe('<div class="trade-item svelte-rkw790"><div class="trade-info svelte-rkw790"><span class="trade-amount svelte-rkw790"> </span> <span class="trade-separator svelte-rkw790">@</span> <span class="trade-price svelte-rkw790"> </span></div> <div class="trade-revenue svelte-rkw790"> </div> <div class="trade-time svelte-rkw790"> </div></div>'),zo=Fe('<div class="trades-list svelte-rkw790"></div>'),Uo=Fe('<div class="empty-trades svelte-rkw790"><span class="empty-icon svelte-rkw790">ðŸ“Š</span> <span class="empty-text svelte-rkw790">No trades yet. Start selling to see your trading history!</span></div>'),Ho=Fe('<div class="market-panel svelte-rkw790"><div class="panel-header svelte-rkw790"><h2 class="svelte-rkw790">ðŸ“ˆ Market Trading</h2> <p class="panel-description svelte-rkw790">Sell your matchsticks and track market trends!</p></div> <div class="market-content svelte-rkw790"><div class="market-section trading-section svelte-rkw790"><h3 class="svelte-rkw790">ðŸ’° Sell Matchsticks</h3> <div class="trading-container svelte-rkw790"><div class="price-display svelte-rkw790"><div class="price-info svelte-rkw790"><span class="price-label svelte-rkw790">Current Price:</span> <span class="price-value svelte-rkw790"> </span></div> <div class="trend-info svelte-rkw790"> </div></div> <div class="sell-controls svelte-rkw790"><div class="amount-input svelte-rkw790"><label for="sell-amount" class="svelte-rkw790">Amount to Sell:</label> <input id="sell-amount" type="text" placeholder="Enter amount" class="svelte-rkw790"/></div> <div class="quick-amounts svelte-rkw790"><button class="quick-btn svelte-rkw790">25%</button> <button class="quick-btn svelte-rkw790">50%</button> <button class="quick-btn svelte-rkw790">All</button></div></div> <div class="sale-preview svelte-rkw790"><div class="preview-item svelte-rkw790"><span class="label svelte-rkw790">Selling:</span> <span class="value svelte-rkw790"> </span></div> <div class="preview-item svelte-rkw790"><span class="label svelte-rkw790">Revenue:</span> <span class="value svelte-rkw790"> </span></div> <div class="preview-item svelte-rkw790"><span class="label svelte-rkw790">Remaining:</span> <span class="value svelte-rkw790"> </span></div></div> <button class="sell-button svelte-rkw790">Sell Matchsticks</button></div></div> <div class="market-section svelte-rkw790"><h3 class="svelte-rkw790">ðŸ“Š Market Analysis</h3> <div class="analysis-grid svelte-rkw790"><div class="analysis-card svelte-rkw790"><div class="analysis-header svelte-rkw790"><span class="analysis-icon svelte-rkw790">ðŸ“ˆ</span> <span class="analysis-title svelte-rkw790">Price Trend</span></div> <div class="analysis-value svelte-rkw790"> </div></div> <div class="analysis-card svelte-rkw790"><div class="analysis-header svelte-rkw790"><span class="analysis-icon svelte-rkw790">ðŸ“‰</span> <span class="analysis-title svelte-rkw790">Volatility</span></div> <div class="analysis-value svelte-rkw790"> </div></div> <div class="analysis-card svelte-rkw790"><div class="analysis-header svelte-rkw790"><span class="analysis-icon svelte-rkw790">ðŸ’¹</span> <span class="analysis-title svelte-rkw790">Volume</span></div> <div class="analysis-value svelte-rkw790"> </div></div> <div class="analysis-card svelte-rkw790"><div class="analysis-header svelte-rkw790"><span class="analysis-icon svelte-rkw790">ðŸŽ¯</span> <span class="analysis-title svelte-rkw790">Recommendation</span></div> <div class="analysis-value svelte-rkw790"> </div></div></div></div> <div class="market-section svelte-rkw790"><h3 class="svelte-rkw790">ðŸ“‹ Recent Trades</h3> <div class="trades-container svelte-rkw790"><!></div></div> <div class="market-section svelte-rkw790"><h3 class="svelte-rkw790">ðŸ“ˆ Market Statistics</h3> <div class="stats-grid svelte-rkw790"><div class="stat-card svelte-rkw790"><div class="stat-icon svelte-rkw790">ðŸ’°</div> <div class="stat-content svelte-rkw790"><div class="stat-label svelte-rkw790">Total Revenue</div> <div class="stat-value svelte-rkw790"> </div></div></div> <div class="stat-card svelte-rkw790"><div class="stat-icon svelte-rkw790">ðŸ“¦</div> <div class="stat-content svelte-rkw790"><div class="stat-label svelte-rkw790">Total Sold</div> <div class="stat-value svelte-rkw790"> </div></div></div> <div class="stat-card svelte-rkw790"><div class="stat-icon svelte-rkw790">ðŸ“Š</div> <div class="stat-content svelte-rkw790"><div class="stat-label svelte-rkw790">Avg Price</div> <div class="stat-value svelte-rkw790"> </div></div></div> <div class="stat-card svelte-rkw790"><div class="stat-icon svelte-rkw790">ðŸŽ¯</div> <div class="stat-content svelte-rkw790"><div class="stat-label svelte-rkw790">Market Share</div> <div class="stat-value svelte-rkw790"> </div></div></div></div></div></div></div>');function Vo(l,r){br(r,!1);const[i,c]=Xr(),h=()=>Fr(de,"$gameState",i),g=ze(),_=ze(),A=ze(),q=ze();let R=ze(1n),$=ze("1");function K(){if(o(R)>0n&&o(R)<=o(q)){const rt=nn.sellMatchsticks(o(R));console.log("Sale result:",rt),ye(R,1n),ye($,"1")}}function W(rt){try{const It=BigInt(rt||"0");It>=0n&&(ye(R,It),ye($,rt))}catch{}}function ue(){ye(R,o(q)),ye($,o(q).toString())}function X(){const rt=o(q)/2n;ye(R,rt),ye($,rt.toString())}function ee(){const rt=o(q)/4n;ye(R,rt),ye($,rt.toString())}function te(rt){switch(rt){case"up":return"ðŸ“ˆ";case"down":return"ðŸ“‰";default:return"âž¡ï¸"}}function ce(rt){switch(rt){case"up":return"#4caf50";case"down":return"#f44336";default:return"#78909c"}}Tt(()=>nn,()=>{ye(g,nn.getMarketAnalysis())}),Tt(()=>nn,()=>{ye(_,nn.getRecentTrades().slice(0,10))}),Tt(()=>h(),()=>{ye(A,h().market.currentPrice)}),Tt(()=>h(),()=>{ye(q,h().resources.matchsticks)}),ln(),_r();var oe=Ho(),we=p(v(oe),2),Ce=v(we),_e=p(v(Ce),2),V=v(_e),ne=v(V),Ie=p(v(ne),2),Ze=v(Ie,!0);d(Ie),d(ne);var ut=p(ne,2),dt=v(ut);d(ut),d(V);var je=p(V,2),Te=v(je),We=p(v(Te),2);ao(We),d(Te);var et=p(Te,2),gt=v(et),St=p(gt,2),Xe=p(St,2);d(et),d(je);var tt=p(je,2),se=v(tt),G=p(v(se),2),at=v(G);d(G),d(se);var ge=p(se,2),it=p(v(ge),2),vt=v(it,!0);d(it),d(ge);var st=p(ge,2),_t=p(v(st),2),Ct=v(_t,!0);d(_t),d(st),d(tt);var J=p(tt,2);d(_e),d(Ce);var Mt=p(Ce,2),le=p(v(Mt),2),U=v(le),Ae=p(v(U),2),Re=v(Ae,!0);d(Ae),d(U);var qe=p(U,2),Ve=p(v(qe),2),Ye=v(Ve,!0);d(Ve),d(qe);var bt=p(qe,2),wt=p(v(bt),2),ve=v(wt,!0);d(wt),d(bt);var z=p(bt,2),Pe=p(v(z),2),De=v(Pe,!0);d(Pe),d(z),d(le),d(Mt);var he=p(Mt,2),fe=p(v(he),2),pe=v(fe);{var Oe=rt=>{var It=zo();vr(It,5,()=>o(_),Ir,(Wt,Be)=>{var Ge=Lo(),Ee=v(Ge),Qe=v(Ee),xt=v(Qe,!0);d(Qe);var Ot=p(Qe,4),Dt=v(Ot,!0);d(Ot),d(Ee);var Ft=p(Ee,2),xr=v(Ft,!0);d(Ft);var Xt=p(Ft,2),lr=v(Xt,!0);d(Xt),d(Ge),Le((Kt,Jt,Kr,Zt)=>{D(xt,Kt),D(Dt,Jt),D(xr,Kr),D(lr,Zt)},[()=>(ie(be),o(Be),I(()=>be(o(Be).matchsticksSold))),()=>(ie(ct),o(Be),I(()=>ct(o(Be).pricePerUnit))),()=>(ie(ct),o(Be),I(()=>ct(o(Be).totalRevenue))),()=>(o(Be),I(()=>new Date(o(Be).timestamp).toLocaleTimeString()))]),re(Wt,Ge)}),d(It),re(rt,It)},Pt=rt=>{var It=Uo();re(rt,It)};pt(pe,rt=>{o(_),I(()=>o(_).length>0)?rt(Oe):rt(Pt,!1)})}d(fe),d(he);var ft=p(he,2),ot=p(v(ft),2),mt=v(ot),yt=p(v(mt),2),Rt=p(v(yt),2),Ne=v(Rt,!0);d(Rt),d(yt),d(mt);var me=p(mt,2),F=p(v(me),2),kt=p(v(F),2),ht=v(kt,!0);d(kt),d(F),d(me);var qt=p(me,2),N=p(v(qt),2),Gt=p(v(N),2),Qt=v(Gt,!0);d(Gt),d(N),d(qt);var rr=p(qt,2),fr=p(v(rr),2),cr=p(v(fr),2),kr=v(cr,!0);d(cr),d(fr),d(rr),d(ot),d(ft),d(we),d(oe),Le((rt,It,Wt,Be,Ge,Ee,Qe,xt,Ot,Dt,Ft,xr)=>{D(Ze,rt),Nt(ut,`color: ${It??""}`),D(dt,`${Wt??""}
            ${h(),I(()=>h().market.trend||"stable")??""}`),D(at,`${Be??""} matchsticks`),D(vt,Ge),D(Ct,Ee),J.disabled=o(R)<=0n||o(R)>o(q)||o(q)===0n,D(Re,(o(g),I(()=>o(g)?.trend||"Stable"))),D(Ye,Qe),D(ve,xt),D(De,(o(g),I(()=>o(g)?.recommendation||"Hold"))),D(Ne,Ot),D(ht,Dt),D(Qt,Ft),D(kr,xr)},[()=>(ie(ct),o(A),I(()=>ct(o(A)))),()=>(h(),I(()=>ce(h().market.trend))),()=>(h(),I(()=>te(h().market.trend))),()=>(ie(be),o(R),I(()=>be(o(R)))),()=>(ie(ct),o(R),o(A),I(()=>ct(Number(o(R))*o(A)))),()=>(ie(be),o(q),o(R),I(()=>be(o(q)-o(R)))),()=>(ie(gr),o(g),I(()=>gr(o(g)?.volatility||0))),()=>(ie(be),o(g),I(()=>be(o(g)?.averageVolume||0))),()=>(ie(ct),h(),I(()=>ct(h().market.totalRevenue))),()=>(ie(be),h(),I(()=>be(h().market.totalSold))),()=>(ie(ct),h(),I(()=>ct(h().market.totalRevenue/Number(h().market.totalSold||1n)))),()=>(ie(gr),I(()=>gr(.05)))]),vo(We,()=>o($),rt=>ye($,rt)),Lt("input",We,rt=>W(rt.target.value)),Lt("click",gt,ee),Lt("click",St,X),Lt("click",Xe,ue),Lt("click",J,K),re(l,oe),wr(),c()}var Go=Fe('<div class="unlock-requirement svelte-h067jd"> </div>'),Wo=Fe('<div><div class="card-header svelte-h067jd"><div class="card-icon svelte-h067jd"> </div> <div class="card-info svelte-h067jd"><h4 class="svelte-h067jd"> </h4> <p class="svelte-h067jd"> </p> <!></div></div> <div class="card-stats svelte-h067jd"><div class="stat svelte-h067jd"><span class="label svelte-h067jd">Rate:</span> <span class="value svelte-h067jd"> </span></div> <div class="stat svelte-h067jd"><span class="label svelte-h067jd">Level:</span> <span class="value svelte-h067jd"> </span></div></div> <button> </button></div>'),Xo=Fe('<div class="unlock-requirement svelte-h067jd"> </div>'),Yo=Fe('<div><div class="card-header svelte-h067jd"><div class="card-icon svelte-h067jd"> </div> <div class="card-info svelte-h067jd"><h4 class="svelte-h067jd"> </h4> <p class="svelte-h067jd"> </p> <!></div></div> <div class="card-stats svelte-h067jd"><div class="stat svelte-h067jd"><span class="label svelte-h067jd">Production:</span> <span class="value svelte-h067jd"> </span></div> <div class="stat svelte-h067jd"><span class="label svelte-h067jd">Owned:</span> <span class="value svelte-h067jd"> </span></div></div> <button> </button></div>'),Qo=Fe(`<div class="automation-panel svelte-h067jd"><div class="panel-header svelte-h067jd"><h2 class="svelte-h067jd">âš™ï¸ Automation Center</h2> <p class="panel-description svelte-h067jd">Automate your production and scale your empire!</p></div> <div class="automation-content svelte-h067jd"><div class="automation-section svelte-h067jd"><h3 class="svelte-h067jd">ðŸ–±ï¸ Auto-Clickers</h3> <p class="section-description svelte-h067jd">Automatically click to produce matchsticks even when you're away</p> <div class="automation-grid svelte-h067jd"></div></div> <div class="automation-section svelte-h067jd"><h3 class="svelte-h067jd">ðŸ­ Production Facilities</h3> <p class="section-description svelte-h067jd">Build facilities that automatically produce matchsticks</p> <div class="automation-grid svelte-h067jd"></div></div> <div class="automation-section svelte-h067jd"><h3 class="svelte-h067jd">ðŸ“Š Automation Statistics</h3> <div class="stats-grid svelte-h067jd"><div class="stat-card svelte-h067jd"><div class="stat-icon svelte-h067jd">ðŸ’°</div> <div class="stat-content svelte-h067jd"><div class="stat-label svelte-h067jd">Total Investment</div> <div class="stat-value svelte-h067jd"> </div></div></div> <div class="stat-card svelte-h067jd"><div class="stat-icon svelte-h067jd">âš¡</div> <div class="stat-content svelte-h067jd"><div class="stat-label svelte-h067jd">Auto Production</div> <div class="stat-value svelte-h067jd"> </div></div></div> <div class="stat-card svelte-h067jd"><div class="stat-icon svelte-h067jd">ðŸ­</div> <div class="stat-content svelte-h067jd"><div class="stat-label svelte-h067jd">Facilities</div> <div class="stat-value svelte-h067jd"> </div></div></div> <div class="stat-card svelte-h067jd"><div class="stat-icon svelte-h067jd">ðŸ–±ï¸</div> <div class="stat-content svelte-h067jd"><div class="stat-label svelte-h067jd">Auto-Clickers</div> <div class="stat-value svelte-h067jd"> </div></div></div></div></div></div></div>`);function Jo(l,r){br(r,!1);const[i,c]=Xr(),h=()=>Fr(de,"$gameState",i),g=ze(),_=ze(),A=ze();function q(se){const G=qr.purchaseAutoClicker(se);console.log("Auto-clicker purchase result:",G)}function R(se){const G=qr.purchaseFacility(se);console.log("Facility purchase result:",G)}function $(se){if(!se)return"";const G=[];return se.totalProduced&&G.push(`${be(Number(se.totalProduced))} total production`),se.totalRevenue&&G.push(`${ct(se.totalRevenue)} total revenue`),se.autoClickersOwned&&G.push(`${se.autoClickersOwned} auto-clickers owned`),se.gamePhase&&G.push(`${se.gamePhase} phase`),G.length>0?`Requires: ${G.join(" + ")}`:"Requirements not met"}function K(se,G){return se.isUnlocked?se.isMaxed?{text:G==="clicker"?`Max Level (${se.currentLevel}/${se.maxLevel})`:`Max Owned (${se.owned}/${se.maxOwned})`,disabled:!0,variant:"maxed"}:h().resources.money<se.cost?{text:`Buy for ${ct(se.cost)}`,disabled:!0,variant:"insufficient"}:{text:`Buy for ${ct(se.cost)}`,disabled:!1,variant:"available"}:{text:$(se.unlockRequirement),disabled:!0,variant:"locked"}}Tt(()=>qr,()=>{ye(g,qr.getAvailableAutoClickers())}),Tt(()=>qr,()=>{ye(_,qr.getAvailableFacilities())}),Tt(()=>qr,()=>{ye(A,qr.getAutomationStats())}),ln(),_r();var W=Qo(),ue=p(v(W),2),X=v(ue),ee=p(v(X),4);vr(ee,5,()=>o(g),Ir,(se,G)=>{var at=Wo();const ge=cn(()=>(o(G),I(()=>K(o(G),"clicker"))));let it;var vt=v(at),st=v(vt),_t=v(st,!0);d(st);var Ct=p(st,2),J=v(Ct),Mt=v(J,!0);d(J);var le=p(J,2),U=v(le,!0);d(le);var Ae=p(le,2);{var Re=fe=>{var pe=Go(),Oe=v(pe);d(pe),Le(Pt=>D(Oe,`ðŸ”’ ${Pt??""}`),[()=>(o(G),I(()=>$(o(G).unlockRequirement)))]),re(fe,pe)};pt(Ae,fe=>{o(G),I(()=>!o(G).isUnlocked)&&fe(Re)})}d(Ct),d(vt);var qe=p(vt,2),Ve=v(qe),Ye=p(v(Ve),2),bt=v(Ye);d(Ye),d(Ve);var wt=p(Ve,2),ve=p(v(wt),2),z=v(ve);d(ve),d(wt),d(qe);var Pe=p(qe,2);let De;var he=v(Pe,!0);d(Pe),d(at),Le((fe,pe,Oe)=>{it=yr(at,1,"automation-card svelte-h067jd",null,it,fe),D(_t,(o(G),I(()=>o(G).icon||"ðŸ–±ï¸"))),D(Mt,(o(G),I(()=>o(G).name))),D(U,(o(G),I(()=>o(G).description))),D(bt,`${pe??""}/sec`),D(z,`${o(G),I(()=>o(G).currentLevel)??""}/${o(G),I(()=>o(G).maxLevel)??""}`),De=yr(Pe,1,"purchase-button svelte-h067jd",null,De,Oe),Pe.disabled=(ie(o(ge)),I(()=>o(ge).disabled)),D(he,(ie(o(ge)),I(()=>o(ge).text)))},[()=>({locked:!o(G).isUnlocked,maxed:o(G).isMaxed}),()=>(ie(be),o(G),I(()=>be(o(G).baseClicksPerSecond))),()=>({locked:o(ge).variant==="locked",maxed:o(ge).variant==="maxed",insufficient:o(ge).variant==="insufficient",available:o(ge).variant==="available"})]),Lt("click",Pe,()=>q(o(G).id)),re(se,at)}),d(ee),d(X);var te=p(X,2),ce=p(v(te),4);vr(ce,5,()=>o(_),Ir,(se,G)=>{var at=Yo();const ge=cn(()=>(o(G),I(()=>K(o(G),"facility"))));let it;var vt=v(at),st=v(vt),_t=v(st,!0);d(st);var Ct=p(st,2),J=v(Ct),Mt=v(J,!0);d(J);var le=p(J,2),U=v(le,!0);d(le);var Ae=p(le,2);{var Re=fe=>{var pe=Xo(),Oe=v(pe);d(pe),Le(Pt=>D(Oe,`ðŸ”’ ${Pt??""}`),[()=>(o(G),I(()=>$(o(G).unlockRequirement)))]),re(fe,pe)};pt(Ae,fe=>{o(G),I(()=>!o(G).isUnlocked)&&fe(Re)})}d(Ct),d(vt);var qe=p(vt,2),Ve=v(qe),Ye=p(v(Ve),2),bt=v(Ye);d(Ye),d(Ve);var wt=p(Ve,2),ve=p(v(wt),2),z=v(ve);d(ve),d(wt),d(qe);var Pe=p(qe,2);let De;var he=v(Pe,!0);d(Pe),d(at),Le((fe,pe,Oe)=>{it=yr(at,1,"automation-card svelte-h067jd",null,it,fe),D(_t,(o(G),I(()=>o(G).icon||"ðŸ­"))),D(Mt,(o(G),I(()=>o(G).name))),D(U,(o(G),I(()=>o(G).description))),D(bt,`${pe??""}/sec`),D(z,`${o(G),I(()=>o(G).owned)??""}/${o(G),I(()=>o(G).maxOwned)??""}`),De=yr(Pe,1,"purchase-button svelte-h067jd",null,De,Oe),Pe.disabled=(ie(o(ge)),I(()=>o(ge).disabled)),D(he,(ie(o(ge)),I(()=>o(ge).text)))},[()=>({locked:!o(G).isUnlocked,maxed:o(G).isMaxed}),()=>(ie(be),o(G),I(()=>be(Number(o(G).baseProduction)))),()=>({locked:o(ge).variant==="locked",maxed:o(ge).variant==="maxed",insufficient:o(ge).variant==="insufficient",available:o(ge).variant==="available"})]),Lt("click",Pe,()=>R(o(G).id)),re(se,at)}),d(ce),d(te);var oe=p(te,2),we=p(v(oe),2),Ce=v(we),_e=p(v(Ce),2),V=p(v(_e),2),ne=v(V,!0);d(V),d(_e),d(Ce);var Ie=p(Ce,2),Ze=p(v(Ie),2),ut=p(v(Ze),2),dt=v(ut);d(ut),d(Ze),d(Ie);var je=p(Ie,2),Te=p(v(je),2),We=p(v(Te),2),et=v(We,!0);d(We),d(Te),d(je);var gt=p(je,2),St=p(v(gt),2),Xe=p(v(St),2),tt=v(Xe,!0);d(Xe),d(St),d(gt),d(we),d(oe),d(ue),d(W),Le((se,G)=>{D(ne,se),D(dt,`${G??""}/sec`),D(et,(o(A),I(()=>o(A).totalFacilities))),D(tt,(o(A),I(()=>o(A).totalAutoClickers)))},[()=>(ie(ct),o(A),I(()=>ct(o(A).totalMoneySpent))),()=>(ie(be),o(A),I(()=>be(Number(o(A).autoProductionRate))))]),re(l,W),wr(),c()}var Zo=Fe('<div class="category-card svelte-cf42y9"><div class="category-header svelte-cf42y9"><span class="category-icon svelte-cf42y9"> </span> <span class="category-name svelte-cf42y9"> </span></div> <div class="category-stats svelte-cf42y9"><span class="category-count svelte-cf42y9"> </span> <div class="category-bar svelte-cf42y9"><div class="category-fill svelte-cf42y9"></div></div></div></div>'),ec=Fe('<li class="svelte-cf42y9"> </li>'),tc=Fe('<div class="achievement-hints svelte-cf42y9"><strong>Hints:</strong> <ul class="svelte-cf42y9"></ul></div>'),rc=Fe('<div class="achievement-progress svelte-cf42y9"><div class="progress-header svelte-cf42y9"><span class="progress-label svelte-cf42y9">Progress:</span> <span class="progress-value svelte-cf42y9"> </span></div> <div class="progress-bar svelte-cf42y9"><div class="progress-fill svelte-cf42y9"></div></div></div>'),nc=Fe('<div class="achievement-unlocked svelte-cf42y9"><span class="unlocked-icon svelte-cf42y9">âœ…</span> <span class="unlocked-text"> </span></div>'),ac=Fe('<div class="achievement-reward svelte-cf42y9"><span class="reward-label svelte-cf42y9">Reward:</span> <span class="reward-value svelte-cf42y9"><!></span></div>'),ic=Fe('<div><div class="achievement-main svelte-cf42y9"><div class="achievement-icon svelte-cf42y9"><!></div> <div class="achievement-info svelte-cf42y9"><div class="achievement-header svelte-cf42y9"><h4 class="achievement-name svelte-cf42y9"> </h4> <div class="achievement-badges svelte-cf42y9"><span class="difficulty-badge svelte-cf42y9"> </span> <span class="points-badge svelte-cf42y9"> </span></div></div> <p class="achievement-description svelte-cf42y9"> </p> <!></div></div> <!> <!> <!></div>'),sc=Fe('<div class="milestone-progress svelte-cf42y9"><span> </span> <div class="progress-bar small svelte-cf42y9"><div class="progress-fill svelte-cf42y9"></div></div></div>'),oc=Fe('<div class="milestone-card svelte-cf42y9"><div class="milestone-icon svelte-cf42y9"> </div> <div class="milestone-info svelte-cf42y9"><h4 class="svelte-cf42y9"> </h4> <p class="svelte-cf42y9"> </p> <!></div></div>'),cc=Fe('<div class="next-milestones svelte-cf42y9"><h3 class="svelte-cf42y9">ðŸŽ¯ Upcoming Milestones</h3> <div class="milestone-list svelte-cf42y9"></div></div>'),lc=Fe('<div class="achievement-panel svelte-cf42y9"><div class="panel-header svelte-cf42y9"><h2 class="svelte-cf42y9">ðŸ† Achievements</h2> <p class="panel-description svelte-cf42y9">Track your progress and unlock rewards!</p></div> <div class="achievement-content svelte-cf42y9"><div class="stats-overview svelte-cf42y9"><div class="overview-card svelte-cf42y9"><div class="overview-header svelte-cf42y9"><span class="overview-icon svelte-cf42y9">ðŸ†</span> <span class="overview-title svelte-cf42y9">Total Progress</span></div> <div class="overview-value svelte-cf42y9"> </div> <div class="overview-progress svelte-cf42y9"><div class="progress-bar svelte-cf42y9"><div class="progress-fill svelte-cf42y9"></div></div> <span class="progress-text svelte-cf42y9"> </span></div></div> <div class="overview-card svelte-cf42y9"><div class="overview-header svelte-cf42y9"><span class="overview-icon svelte-cf42y9">â­</span> <span class="overview-title svelte-cf42y9">Achievement Points</span></div> <div class="overview-value svelte-cf42y9"> </div> <div class="overview-subtitle svelte-cf42y9">Total earned points</div></div> <div class="overview-card svelte-cf42y9"><div class="overview-header svelte-cf42y9"><span class="overview-icon svelte-cf42y9">ðŸŽ¯</span> <span class="overview-title svelte-cf42y9">Recent Unlocks</span></div> <div class="overview-value svelte-cf42y9"> </div> <div class="overview-subtitle svelte-cf42y9">Last 10 achievements</div></div></div> <div class="category-progress svelte-cf42y9"><h3 class="svelte-cf42y9">ðŸ“Š Progress by Category</h3> <div class="category-grid svelte-cf42y9"></div></div> <div class="achievement-filters svelte-cf42y9"><div class="filter-group svelte-cf42y9"><label class="svelte-cf42y9">Category:</label> <select class="svelte-cf42y9"><option>All Categories</option><option>Production</option><option>Trading</option><option>Automation</option><option>Progression</option><option>Special</option><option>Hidden</option></select></div> <div class="filter-group svelte-cf42y9"><label class="svelte-cf42y9">Difficulty:</label> <select class="svelte-cf42y9"><option>All Difficulties</option><option>Easy</option><option>Medium</option><option>Hard</option><option>Extreme</option><option>Legendary</option></select></div></div> <div class="achievement-list svelte-cf42y9"></div> <!></div></div>');function uc(l,r){br(r,!1);const[i,c]=Xr(),h=()=>Fr(de,"$gameState",i),g=ze(),_=ze(),A=ze(),q=ze();let R=ze("all"),$=ze("all");function K(ve){return o(A).some(z=>z.id===ve)}function W(ve){return Mr.getAchievementProgress(ve)}function ue(ve){switch(ve){case"easy":return"#4caf50";case"medium":return"#ff9800";case"hard":return"#f44336";case"extreme":return"#9c27b0";case"legendary":return"#ffd700";default:return"#78909c"}}function X(ve){switch(ve){case"easy":return 10;case"medium":return 25;case"hard":return 50;case"extreme":return 100;case"legendary":return 250;default:return 10}}function ee(ve){switch(ve){case"production":return"ðŸ”¥";case"trading":return"ðŸ’°";case"automation":return"âš™ï¸";case"progression":return"ðŸ“ˆ";case"special":return"âœ¨";case"hidden":return"ðŸ”";default:return"ðŸ†"}}Tt(()=>Mr,()=>{ye(g,Mr.getAvailableAchievements())}),Tt(()=>Mr,()=>{ye(_,Mr.getStats())}),Tt(()=>h(),()=>{ye(A,h().achievements.unlockedAchievements||[])}),Tt(()=>(o(g),o(R),o($)),()=>{ye(q,o(g).filter(ve=>{const z=o(R)==="all"||ve.category===o(R),Pe=o($)==="all"||ve.difficulty===o($);return z&&Pe}))}),ln(),_r();var te=lc(),ce=p(v(te),2),oe=v(ce),we=v(oe),Ce=p(v(we),2),_e=v(Ce);d(Ce);var V=p(Ce,2),ne=v(V),Ie=v(ne);d(ne);var Ze=p(ne,2),ut=v(Ze,!0);d(Ze),d(V),d(we);var dt=p(we,2),je=p(v(dt),2),Te=v(je,!0);d(je),Vn(2),d(dt);var We=p(dt,2),et=p(v(We),2),gt=v(et,!0);d(et),Vn(2),d(We),d(oe);var St=p(oe,2),Xe=p(v(St),2);vr(Xe,5,()=>(o(_),I(()=>Object.entries(o(_).categoryProgress||{}))),Ir,(ve,z)=>{var Pe=Ws(()=>Xs(o(z),2));let De=()=>o(Pe)[0],he=()=>o(Pe)[1];var fe=Zo(),pe=v(fe),Oe=v(pe),Pt=v(Oe,!0);d(Oe);var ft=p(Oe,2),ot=v(ft,!0);d(ft),d(pe);var mt=p(pe,2),yt=v(mt),Rt=v(yt);d(yt);var Ne=p(yt,2),me=v(Ne);d(Ne),d(mt),d(fe),Le(F=>{D(Pt,F),D(ot,De()),D(Rt,`${he(),I(()=>he().unlocked)??""}/${he(),I(()=>he().total)??""}`),Nt(me,`width: ${he(),I(()=>he().total>0?he().unlocked/he().total*100:0)??""}%`)},[()=>(De(),I(()=>ee(De())))]),re(ve,fe)}),d(Xe),d(St);var tt=p(St,2),se=v(tt),G=p(v(se),2);Le(()=>{o(R),mi(()=>{})});var at=v(G);at.value=at.__value="all";var ge=p(at);ge.value=ge.__value="production";var it=p(ge);it.value=it.__value="trading";var vt=p(it);vt.value=vt.__value="automation";var st=p(vt);st.value=st.__value="progression";var _t=p(st);_t.value=_t.__value="special";var Ct=p(_t);Ct.value=Ct.__value="hidden",d(G),d(se);var J=p(se,2),Mt=p(v(J),2);Le(()=>{o($),mi(()=>{})});var le=v(Mt);le.value=le.__value="all";var U=p(le);U.value=U.__value="easy";var Ae=p(U);Ae.value=Ae.__value="medium";var Re=p(Ae);Re.value=Re.__value="hard";var qe=p(Re);qe.value=qe.__value="extreme";var Ve=p(qe);Ve.value=Ve.__value="legendary",d(Mt),d(J),d(tt);var Ye=p(tt,2);vr(Ye,5,()=>o(q),Ir,(ve,z)=>{var Pe=ic();const De=cn(()=>(o(z),I(()=>K(o(z).id)))),he=cn(()=>(o(z),I(()=>W(o(z).id))));let fe;var pe=v(Pe),Oe=v(pe),Pt=v(Oe);{var ft=Be=>{var Ge=er();Le(()=>D(Ge,(o(z),I(()=>o(z).icon)))),re(Be,Ge)},ot=Be=>{var Ge=er("ðŸ”’");re(Be,Ge)};pt(Pt,Be=>{o(De)?Be(ft):Be(ot,!1)})}d(Oe);var mt=p(Oe,2),yt=v(mt),Rt=v(yt),Ne=v(Rt,!0);d(Rt);var me=p(Rt,2),F=v(me),kt=v(F,!0);d(F);var ht=p(F,2),qt=v(ht);d(ht),d(me),d(yt);var N=p(yt,2),Gt=v(N,!0);d(N);var Qt=p(N,2);{var rr=Be=>{var Ge=tc(),Ee=p(v(Ge),2);vr(Ee,5,()=>(o(z),I(()=>o(z).hints)),Ir,(Qe,xt)=>{var Ot=ec(),Dt=v(Ot,!0);d(Ot),Le(()=>D(Dt,o(xt))),re(Qe,Ot)}),d(Ee),d(Ge),re(Be,Ge)};pt(Qt,Be=>{o(z),ie(o(De)),I(()=>o(z).hints&&!o(De)&&o(z).isHidden)&&Be(rr)})}d(mt),d(pe);var fr=p(pe,2);{var cr=Be=>{var Ge=rc(),Ee=v(Ge),Qe=p(v(Ee),2),xt=v(Qe,!0);d(Qe),d(Ee);var Ot=p(Ee,2),Dt=v(Ot);d(Ot),d(Ge),Le(Ft=>{D(xt,Ft),Nt(Dt,`width: ${ie(o(he)),I(()=>o(he).progress*100)??""}%`)},[()=>(ie(Un),ie(o(he)),I(()=>Un(o(he).currentValue,o(he).targetValue)))]),re(Be,Ge)};pt(fr,Be=>{!o(De)&&o(he)&&Be(cr)})}var kr=p(fr,2);{var rt=Be=>{var Ge=nc(),Ee=p(v(Ge),2),Qe=v(Ee);d(Ee),d(Ge),Le(xt=>D(Qe,`Unlocked ${xt??""}`),[()=>(o(A),o(z),I(()=>new Date(o(A).find(xt=>xt.id===o(z).id)?.unlockedAt||0).toLocaleDateString()))]),re(Be,Ge)};pt(kr,Be=>{o(De)&&Be(rt)})}var It=p(kr,2);{var Wt=Be=>{var Ge=ac(),Ee=p(v(Ge),2),Qe=v(Ee);{var xt=Dt=>{var Ft=er();Le(()=>D(Ft,`ðŸ’° $${o(z),I(()=>o(z).reward.amount)??""}`)),re(Dt,Ft)},Ot=Dt=>{var Ft=dr(),xr=ir(Ft);{var Xt=Kt=>{var Jt=er();Le(()=>D(Jt,`âš¡ ${o(z),I(()=>o(z).reward.amount)??""}x Production`)),re(Kt,Jt)},lr=Kt=>{var Jt=dr(),Kr=ir(Jt);{var Zt=zt=>{var Sr=er();Le(()=>D(Sr,`ðŸŽ ${o(z),I(()=>o(z).reward.item)??""}`)),re(zt,Sr)},Yr=zt=>{var Sr=er("ðŸŽ Special Reward");re(zt,Sr)};pt(Kr,zt=>{o(z),I(()=>o(z).reward.type==="special_unlock")?zt(Zt):zt(Yr,!1)},!0)}re(Kt,Jt)};pt(xr,Kt=>{o(z),I(()=>o(z).reward.type==="production_multiplier")?Kt(Xt):Kt(lr,!1)},!0)}re(Dt,Ft)};pt(Qe,Dt=>{o(z),I(()=>o(z).reward.type==="money")?Dt(xt):Dt(Ot,!1)})}d(Ee),d(Ge),re(Be,Ge)};pt(It,Be=>{o(z),I(()=>o(z).reward)&&Be(Wt)})}d(Pe),Le((Be,Ge,Ee)=>{fe=yr(Pe,1,"achievement-card svelte-cf42y9",null,fe,Be),D(Ne,(ie(o(De)),o(z),I(()=>o(De)||!o(z).isHidden?o(z).name:"???"))),Nt(F,`background-color: ${Ge??""}; color: white;`),D(kt,(o(z),I(()=>o(z).difficulty))),D(qt,`${Ee??""} pts`),D(Gt,(ie(o(De)),o(z),I(()=>o(De)||!o(z).isHidden?o(z).description:"Hidden achievement - unlock to reveal!")))},[()=>({unlocked:o(De)}),()=>(o(z),I(()=>ue(o(z).difficulty))),()=>(o(z),I(()=>X(o(z).difficulty)))]),re(ve,Pe)}),d(Ye);var bt=p(Ye,2);{var wt=ve=>{var z=cc(),Pe=p(v(z),2);vr(Pe,5,()=>(o(_),I(()=>o(_).nextMilestones)),Ir,(De,he)=>{var fe=oc();const pe=cn(()=>(o(he),I(()=>W(o(he).id))));var Oe=v(fe),Pt=v(Oe,!0);d(Oe);var ft=p(Oe,2),ot=v(ft),mt=v(ot,!0);d(ot);var yt=p(ot,2),Rt=v(yt,!0);d(yt);var Ne=p(yt,2);{var me=F=>{var kt=sc(),ht=v(kt),qt=v(ht,!0);d(ht);var N=p(ht,2),Gt=v(N);d(N),d(kt),Le(Qt=>{D(qt,Qt),Nt(Gt,`width: ${ie(o(pe)),I(()=>o(pe).progress*100)??""}%`)},[()=>(ie(Un),ie(o(pe)),I(()=>Un(o(pe).currentValue,o(pe).targetValue)))]),re(F,kt)};pt(Ne,F=>{o(pe)&&F(me)})}d(ft),d(fe),Le(()=>{D(Pt,(o(he),I(()=>o(he).icon))),D(mt,(o(he),I(()=>o(he).name))),D(Rt,(o(he),I(()=>o(he).description)))}),re(De,fe)}),d(Pe),d(z),re(ve,z)};pt(bt,ve=>{o(_),I(()=>o(_).nextMilestones?.length>0)&&ve(wt)})}d(ce),d(te),Le((ve,z)=>{D(_e,`${o(_),I(()=>o(_).unlockedAchievements)??""}/${o(_),I(()=>o(_).totalAchievements)??""}`),Nt(Ie,`width: ${o(_),I(()=>o(_).completionPercentage)??""}%`),D(ut,ve),D(Te,z),D(gt,(o(_),I(()=>o(_).recentUnlocks?.length)))},[()=>(ie(gr),o(_),I(()=>gr(o(_).completionPercentage/100))),()=>(ie(be),o(_),I(()=>be(o(_).achievementPoints)))]),_i(G,()=>o(R),ve=>ye(R,ve)),_i(Mt,()=>o($),ve=>ye($,ve)),re(l,te),wr(),c()}var dc=Fe('<div class="stats-display svelte-1ghfqw"><h3 class="svelte-1ghfqw">ðŸ“Š Game Stats</h3> <div class="stats-grid svelte-1ghfqw"><div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">ðŸ’° Resources</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Net Worth:</span> <span class="stat-value important svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Cash:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Inventory:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">ðŸ”¥ Production</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Total Made:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Manual Rate:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">ðŸ“ˆ Market</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Price:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Total Sold:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Revenue:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">âš™ï¸ Automation</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Auto-Clickers:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Total Spent:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Efficiency:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">ðŸ† Achievements</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Unlocked:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Points:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Progress:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">âš¡ Performance</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Game Version:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Session Time:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div></div> <div class="performance-indicators svelte-1ghfqw"><div class="indicator-item svelte-1ghfqw"><div class="indicator-label svelte-1ghfqw">Production</div> <div class="indicator-bar svelte-1ghfqw"><div class="indicator-fill production svelte-1ghfqw"></div></div></div> <div class="indicator-item svelte-1ghfqw"><div class="indicator-label svelte-1ghfqw">Automation</div> <div class="indicator-bar svelte-1ghfqw"><div class="indicator-fill automation svelte-1ghfqw"></div></div></div> <div class="indicator-item svelte-1ghfqw"><div class="indicator-label svelte-1ghfqw">Market</div> <div class="indicator-bar svelte-1ghfqw"><div class="indicator-fill market svelte-1ghfqw"></div></div></div> <div class="indicator-item svelte-1ghfqw"><div class="indicator-label svelte-1ghfqw">Achievements</div> <div class="indicator-bar svelte-1ghfqw"><div class="indicator-fill achievements svelte-1ghfqw"></div></div></div></div></div>');function vc(l,r){br(r,!1);const[i,c]=Xr(),h=()=>Fr(de,"$gameState",i),g=ze(),_=ze(),A=ze(),q=ze(),R=ze(),$=ze(),K=ze(),W=ze();function ue(xt){return xt>=.9?"#4caf50":xt>=.7?"#ff9800":"#f44336"}function X(xt){return xt>=.8?"#ffd700":xt>=.5?"#64ffda":xt>=.2?"#2196f3":"#78909c"}Tt(()=>h(),()=>{ye(g,h().resources)}),Tt(()=>h(),()=>{ye(_,h().production)}),Tt(()=>h(),()=>{ye(A,h().market)}),Tt(()=>h(),()=>{ye(q,h().automation)}),Tt(()=>h(),()=>{ye(R,h().achievements)}),Tt(()=>(o(g),o(A)),()=>{ye($,o(g).money+Number(o(g).matchsticks)*o(A).currentPrice)}),Tt(()=>o(q),()=>{ye(K,o(q).autoClickers.length>0?o(q).autoClickers.reduce((xt,Ot)=>xt+Ot.efficiency,0)/o(q).autoClickers.length:0)}),Tt(()=>o(R),()=>{ye(W,o(R).totalPoints>0&&o(R).unlockedAchievements?o(R).unlockedAchievements.length/Math.max(1,20):0)}),ln(),_r();var ee=dc(),te=p(v(ee),2),ce=v(te),oe=p(v(ce),2),we=v(oe),Ce=p(v(we),2),_e=v(Ce,!0);d(Ce),d(we);var V=p(we,2),ne=p(v(V),2),Ie=v(ne,!0);d(ne),d(V);var Ze=p(V,2),ut=p(v(Ze),2),dt=v(ut,!0);d(ut),d(Ze),d(oe),d(ce);var je=p(ce,2),Te=p(v(je),2),We=v(Te),et=p(v(We),2),gt=v(et,!0);d(et),d(We);var St=p(We,2),Xe=p(v(St),2),tt=v(Xe);d(Xe),d(St),d(Te),d(je);var se=p(je,2),G=p(v(se),2),at=v(G),ge=p(v(at),2),it=v(ge,!0);d(ge),d(at);var vt=p(at,2),st=p(v(vt),2),_t=v(st,!0);d(st),d(vt);var Ct=p(vt,2),J=p(v(Ct),2),Mt=v(J,!0);d(J),d(Ct),d(G),d(se);var le=p(se,2),U=p(v(le),2),Ae=v(U),Re=p(v(Ae),2),qe=v(Re,!0);d(Re),d(Ae);var Ve=p(Ae,2),Ye=p(v(Ve),2),bt=v(Ye,!0);d(Ye),d(Ve);var wt=p(Ve,2),ve=p(v(wt),2),z=v(ve,!0);d(ve),d(wt),d(U),d(le);var Pe=p(le,2),De=p(v(Pe),2),he=v(De),fe=p(v(he),2),pe=v(fe,!0);d(fe),d(he);var Oe=p(he,2),Pt=p(v(Oe),2),ft=v(Pt,!0);d(Pt),d(Oe);var ot=p(Oe,2),mt=p(v(ot),2),yt=v(mt,!0);d(mt),d(ot),d(De),d(Pe);var Rt=p(Pe,2),Ne=p(v(Rt),2),me=v(Ne),F=p(v(me),2),kt=v(F,!0);d(F),d(me);var ht=p(me,2),qt=p(v(ht),2),N=v(qt,!0);d(qt),d(ht),d(Ne),d(Rt),d(te);var Gt=p(te,2),Qt=v(Gt),rr=p(v(Qt),2),fr=v(rr);d(rr),d(Qt);var cr=p(Qt,2),kr=p(v(cr),2),rt=v(kr);d(kr),d(cr);var It=p(cr,2),Wt=p(v(It),2),Be=v(Wt);d(Wt),d(It);var Ge=p(It,2),Ee=p(v(Ge),2),Qe=v(Ee);d(Ee),d(Ge),d(Gt),d(ee),Le((xt,Ot,Dt,Ft,xr,Xt,lr,Kt,Jt,Kr,Zt,Yr,zt,Sr,un,jt,Cr)=>{D(_e,xt),D(Ie,Ot),D(dt,Dt),D(gt,Ft),D(tt,`${xr??""}/click`),D(it,Xt),D(_t,lr),D(Mt,Kt),D(qe,(o(q),I(()=>o(q).autoClickers.length))),D(bt,Jt),Nt(ve,`color: ${Kr??""}`),D(z,Zt),D(pe,(o(R),I(()=>o(R).unlockedAchievements?.length||0))),D(ft,(o(R),I(()=>o(R).totalPoints))),Nt(mt,`color: ${Yr??""}`),D(yt,zt),D(kt,(h(),I(()=>h().metadata.version||"1.0.0"))),D(N,Sr),Nt(fr,`width: ${un??""}%`),Nt(rt,`width: ${jt??""}%`),Nt(Be,`width: ${Cr??""}%`),Nt(Qe,`width: ${o(W)*100}%`)},[()=>(ie(ct),o($),I(()=>ct(o($)))),()=>(ie(ct),o(g),I(()=>ct(o(g).money))),()=>(ie(be),o(g),I(()=>be(o(g).matchsticks))),()=>(ie(be),o(_),I(()=>be(o(_).totalProduced))),()=>(ie(be),o(_),I(()=>be(o(_).manualRate))),()=>(ie(ct),o(A),I(()=>ct(o(A).currentPrice))),()=>(ie(be),o(A),I(()=>be(o(A).totalSold))),()=>(ie(ct),o(A),I(()=>ct(o(A).totalRevenue))),()=>(ie(ct),o(q),I(()=>ct(o(q).totalMoneySpent))),()=>(o(K),I(()=>ue(o(K)))),()=>(ie(gr),o(K),I(()=>gr(o(K)))),()=>(o(W),I(()=>X(o(W)))),()=>(ie(gr),o(W),I(()=>gr(o(W)))),()=>(ie(Ci),h(),I(()=>Ci(Date.now()-(h().metadata.createdAt||Date.now())))),()=>(o(_),I(()=>Math.min(100,Number(o(_).totalProduced)/1e3*100))),()=>(o(q),I(()=>Math.min(100,o(q).autoClickers.length*10))),()=>(o(A),I(()=>Math.min(100,o(A).totalRevenue/1e3*100)))]),re(l,ee),wr(),c()}var fc=Fe('<div role="button" tabindex="0"><div class="toast-content svelte-17bor4s"><div class="toast-icon svelte-17bor4s"> </div> <div class="toast-text svelte-17bor4s"><div class="toast-title svelte-17bor4s"> </div> <div class="toast-message svelte-17bor4s"> </div></div> <button class="toast-close svelte-17bor4s">âœ•</button></div> <div class="toast-progress svelte-17bor4s"><div class="progress-bar svelte-17bor4s"></div></div></div>');function hc(l,r){br(r,!1);let i=Wr(r,"notification",8),c=Wr(r,"onClose",8),h,g=ze(100);Xn(()=>{const _e=i().duration||5e3;h=setTimeout(()=>{c()()},_e);const V=setInterval(()=>{ye(g,Math.max(0,o(g)-100/(_e/100))),o(g)<=0&&clearInterval(V)},100);return()=>{h&&clearTimeout(h),V&&clearInterval(V)}});function _(){h&&clearTimeout(h),c()()}function A(_e){switch(_e){case"achievement":return"ðŸ†";case"success":return"âœ…";case"info":return"â„¹ï¸";case"warning":return"âš ï¸";case"error":return"âŒ";default:return"ðŸ“¢"}}function q(_e){switch(_e){case"achievement":return"achievement";case"success":return"success";case"info":return"info";case"warning":return"warning";case"error":return"error";default:return"info"}}_r();var R=fc(),$=v(R),K=v($),W=v(K,!0);d(K);var ue=p(K,2),X=v(ue),ee=v(X,!0);d(X);var te=p(X,2),ce=v(te,!0);d(te),d(ue);var oe=p(ue,2);d($);var we=p($,2),Ce=v(we);d(we),d(R),Le((_e,V)=>{yr(R,1,`notification-toast ${_e??""}`,"svelte-17bor4s"),D(W,V),D(ee,(ie(i()),I(()=>i().title))),D(ce,(ie(i()),I(()=>i().message))),Nt(Ce,`width: ${o(g)??""}%`)},[()=>(ie(i()),I(()=>q(i().type))),()=>(ie(i()),I(()=>A(i().type)))]),Lt("click",oe,fo(_)),sr(3,R,()=>Ur,()=>({x:300,duration:300,easing:Dr})),Lt("click",R,_),re(l,R),wr()}var pc=Fe('<header class="game-header svelte-k8bmwt"><div class="header-content svelte-k8bmwt"><div class="title-section svelte-k8bmwt"><h1 class="game-title svelte-k8bmwt"><span class="title-icon svelte-k8bmwt">ðŸ”¥</span> Matchstick Empire</h1> <div class="version-badge svelte-k8bmwt"> </div></div> <div class="resources-section svelte-k8bmwt"><div class="resource-group svelte-k8bmwt"><div class="resource-item primary svelte-k8bmwt"><span class="resource-icon svelte-k8bmwt">ðŸ”¥</span> <div class="resource-details svelte-k8bmwt"><span class="resource-label svelte-k8bmwt">Matchsticks</span> <span class="resource-value svelte-k8bmwt"> </span></div></div> <div class="resource-item svelte-k8bmwt"><span class="resource-icon svelte-k8bmwt">ðŸ’°</span> <div class="resource-details svelte-k8bmwt"><span class="resource-label svelte-k8bmwt">Money</span> <span class="resource-value svelte-k8bmwt"> </span></div></div> <div class="resource-item svelte-k8bmwt"><span class="resource-icon svelte-k8bmwt">ðŸ†</span> <div class="resource-details svelte-k8bmwt"><span class="resource-label svelte-k8bmwt">Achievement Points</span> <span class="resource-value svelte-k8bmwt"> </span></div></div></div></div> <div class="controls-section svelte-k8bmwt"><button class="control-button svelte-k8bmwt" title="Help &amp; Tutorial"><span class="control-icon svelte-k8bmwt">â“</span></button> <button class="control-button svelte-k8bmwt" title="Settings"><span class="control-icon svelte-k8bmwt">âš™ï¸</span></button> <div class="achievement-progress svelte-k8bmwt" title="Achievement Progress"><div class="progress-ring svelte-k8bmwt"><div class="progress-fill svelte-k8bmwt"></div></div> <span class="progress-text svelte-k8bmwt"> </span></div></div></div> <div class="stats-bar svelte-k8bmwt"><div class="stat-item svelte-k8bmwt"><span class="stat-label svelte-k8bmwt">Production Rate:</span> <span class="stat-value svelte-k8bmwt"> </span></div> <div class="stat-item svelte-k8bmwt"><span class="stat-label svelte-k8bmwt">Market Price:</span> <span class="stat-value svelte-k8bmwt"> </span></div> <div class="stat-item svelte-k8bmwt"><span class="stat-label svelte-k8bmwt">Auto-Clickers:</span> <span class="stat-value svelte-k8bmwt"> </span></div> <div class="stat-item svelte-k8bmwt"><span class="stat-label svelte-k8bmwt">Total Produced:</span> <span class="stat-value svelte-k8bmwt"> </span></div></div></header>');function mc(l,r){br(r,!1);const[i,c]=Xr(),h=()=>Fr(de,"$gameState",i),g=ze(),_=ze();function A(){console.log("Settings clicked")}function q(){console.log("Help clicked")}Tt(()=>h(),()=>{ye(g,h().resources)}),Tt(()=>h(),()=>{ye(_,h().achievements)}),ln(),_r();var R=pc(),$=v(R),K=v($),W=p(v(K),2),ue=v(W);d(W),d(K);var X=p(K,2),ee=v(X),te=v(ee),ce=p(v(te),2),oe=p(v(ce),2),we=v(oe,!0);d(oe),d(ce),d(te);var Ce=p(te,2),_e=p(v(Ce),2),V=p(v(_e),2),ne=v(V,!0);d(V),d(_e),d(Ce);var Ie=p(Ce,2),Ze=p(v(Ie),2),ut=p(v(Ze),2),dt=v(ut,!0);d(ut),d(Ze),d(Ie),d(ee),d(X);var je=p(X,2),Te=v(je),We=p(Te,2),et=p(We,2),gt=v(et),St=v(gt);d(gt);var Xe=p(gt,2),tt=v(Xe);d(Xe),d(et),d(je),d($);var se=p($,2),G=v(se),at=p(v(G),2),ge=v(at);d(at),d(G);var it=p(G,2),vt=p(v(it),2),st=v(vt,!0);d(vt),d(it);var _t=p(it,2),Ct=p(v(_t),2),J=v(Ct,!0);d(Ct),d(_t);var Mt=p(_t,2),le=p(v(Mt),2),U=v(le,!0);d(le),d(Mt),d(se),d(R),Le((Ae,Re,qe,Ve,Ye,bt)=>{D(ue,`v${h(),I(()=>h().metadata.version||"1.0.0")??""}`),D(we,Ae),D(ne,Re),D(dt,(o(_),I(()=>o(_).totalPoints))),Nt(St,`transform: rotate(${qe??""}deg)`),D(tt,`${o(_),I(()=>o(_).unlockedAchievements?.length||0)??""}/${o(_),I(()=>o(_).totalAchievements||0)??""}`),D(ge,`${Ve??""}/click`),D(st,Ye),D(J,(h(),I(()=>h().automation.autoClickers.length))),D(U,bt)},[()=>(ie(be),o(g),I(()=>be(o(g).matchsticks))),()=>(ie(ct),o(g),I(()=>ct(o(g).money))),()=>(o(_),I(()=>(o(_).unlockedAchievements?.length||0)/Math.max(1,o(_).totalAchievements||1)*360)),()=>(ie(be),h(),I(()=>be(h().production.manualRate))),()=>(ie(ct),h(),I(()=>ct(h().market.currentPrice))),()=>(ie(be),h(),I(()=>be(h().production.totalProduced)))]),Lt("click",Te,q),Lt("click",We,A),re(l,R),wr(),c()}var yc=Fe('<button><span class="tab-icon svelte-1t8fvmc"> </span> <span class="tab-label svelte-1t8fvmc"> </span> <span class="tab-shortcut svelte-1t8fvmc"> </span></button>'),gc=Fe('<nav class="tab-navigation svelte-1t8fvmc"><div class="tab-list svelte-1t8fvmc"></div> <div class="tab-indicator svelte-1t8fvmc"></div></nav>');function _c(l,r){br(r,!1);let i=Wr(r,"activeTab",8),c=Wr(r,"onTabChange",8);const h=[{id:"production",label:"Production",icon:"ðŸ”¥",shortcut:"1"},{id:"automation",label:"Automation",icon:"âš™ï¸",shortcut:"2"},{id:"market",label:"Market",icon:"ðŸ“ˆ",shortcut:"3"},{id:"achievements",label:"Achievements",icon:"ðŸ†",shortcut:"4"}];function g(R){c()(R)}_r();var _=gc(),A=v(_);vr(A,5,()=>h,Ir,(R,$)=>{var K=yc();let W;var ue=v(K),X=v(ue,!0);d(ue);var ee=p(ue,2),te=v(ee,!0);d(ee);var ce=p(ee,2),oe=v(ce,!0);d(ce),d(K),Le(we=>{W=yr(K,1,"tab-button svelte-1t8fvmc",null,W,we),qa(K,"title",`${o($),I(()=>o($).label)??""} (Shortcut: ${o($),I(()=>o($).shortcut)??""})`),D(X,(o($),I(()=>o($).icon))),D(te,(o($),I(()=>o($).label))),D(oe,(o($),I(()=>o($).shortcut)))},[()=>({active:i()===o($).id})]),Lt("click",K,()=>g(o($).id)),re(R,K)}),d(A);var q=p(A,2);d(_),Le(R=>Nt(q,`transform: translateX(${R??""}%)`),[()=>(ie(i()),I(()=>h.findIndex(R=>R.id===i())*100))]),re(l,_),wr()}var bc=Fe('<p class="svelte-m8pzh0">ðŸ’¡ Tip: Click rapidly to build combo multipliers!</p>'),wc=Fe('<p class="svelte-m8pzh0">ðŸ’¡ Tip: Watch the market trends for optimal selling times!</p>'),kc=Fe('<p class="svelte-m8pzh0">ðŸ’¡ Tip: Automate your production to earn while away!</p>'),xc=Fe('<p class="svelte-m8pzh0">ðŸ’¡ Tip: Complete achievements to unlock special rewards!</p>'),Sc=Fe('<div class="floating-matchstick svelte-m8pzh0">ðŸ”¥</div>'),Cc=Fe('<div class="loading-overlay svelte-m8pzh0"><div class="loading-container svelte-m8pzh0"><div class="loading-icon svelte-m8pzh0"><div class="matchstick-container svelte-m8pzh0"><div class="matchstick svelte-m8pzh0"><div class="matchstick-head svelte-m8pzh0"></div> <div class="matchstick-body svelte-m8pzh0"></div></div> <div>ðŸ”¥</div></div></div> <h1 class="loading-title svelte-m8pzh0"><span class="title-word svelte-m8pzh0">Matchstick</span> <span class="title-word empire svelte-m8pzh0">Empire</span></h1> <div class="loading-message svelte-m8pzh0"> </div> <div class="progress-container svelte-m8pzh0"><div class="progress-bar svelte-m8pzh0"><div class="progress-fill svelte-m8pzh0"></div></div> <div class="progress-text svelte-m8pzh0"> </div></div> <div class="loading-tips svelte-m8pzh0"><!></div> <div class="version-info svelte-m8pzh0">v1.0.0 â€¢ Built with ðŸ’– and Svelte</div></div> <div class="background-animation svelte-m8pzh0"></div></div>');function Pc(l,r){br(r,!1);let i=Wr(r,"show",8,!0),c=Wr(r,"message",8,"Initializing Matchstick Empire..."),h=Wr(r,"progress",8,0),g=ze(""),_;Xn(()=>{let $=0;const K=setInterval(()=>{$=($+1)%4,ye(g,".".repeat($))},500);let W=0;const ue=()=>{W<h()&&(W+=Math.random()*2,W>h()&&(W=h())),_=requestAnimationFrame(ue)};return ue(),()=>{clearInterval(K),_&&cancelAnimationFrame(_)}}),_r();var A=dr(),q=ir(A);{var R=$=>{var K=Cc(),W=v(K),ue=v(W),X=v(ue),ee=p(v(X),2);let te;d(X),d(ue);var ce=p(ue,4),oe=v(ce);d(ce);var we=p(ce,2),Ce=v(we),_e=v(Ce);d(Ce);var V=p(Ce,2),ne=v(V);d(V),d(we);var Ie=p(we,2),Ze=v(Ie);{var ut=Te=>{var We=bc();re(Te,We)},dt=Te=>{var We=dr(),et=ir(We);{var gt=Xe=>{var tt=wc();re(Xe,tt)},St=Xe=>{var tt=dr(),se=ir(tt);{var G=ge=>{var it=kc();re(ge,it)},at=ge=>{var it=xc();re(ge,it)};pt(se,ge=>{h()<75?ge(G):ge(at,!1)},!0)}re(Xe,tt)};pt(et,Xe=>{h()<50?Xe(gt):Xe(St,!1)},!0)}re(Te,We)};pt(Ze,Te=>{h()<25?Te(ut):Te(dt,!1)})}d(Ie),Vn(2),d(W);var je=p(W,2);vr(je,4,()=>Array(20),Ir,(Te,We)=>{var et=Sc();Nt(et,`
            left: ${I(()=>Math.random()*100)??""}%;
            animation-delay: ${I(()=>Math.random()*5)??""}s;
            animation-duration: ${I(()=>5+Math.random()*5)??""}s;
          `),re(Te,et)}),d(je),d(K),Le((Te,We)=>{te=yr(ee,1,"flame svelte-m8pzh0",null,te,Te),D(oe,`${c()??""}${o(g)??""}`),Nt(_e,`width: ${h()??""}%`),D(ne,`${We??""}%`)},[()=>({burning:h()>20}),()=>(ie(h()),I(()=>Math.round(h())))]),sr(3,W,()=>Ka,()=>({duration:800,easing:Dr})),sr(3,K,()=>Da,()=>({duration:500})),re($,K)};pt(q,$=>{i()&&$(R)})}re(l,A),wr()}var Ac=Fe('<div class="svelte-1reukpy"><!></div>'),Ec=Fe('<div class="svelte-1reukpy"><!></div>'),Mc=Fe('<div class="svelte-1reukpy"><!></div>'),Ic=Fe('<div class="svelte-1reukpy"><!></div>'),jc=Fe('<div class="activity-item svelte-1reukpy"><span class="activity-time svelte-1reukpy"> </span> <span class="activity-text svelte-1reukpy"><!></span></div>'),Tc=Fe('<div class="svelte-1reukpy"><!></div>'),Rc=Fe('<div class="celebration-overlay svelte-1reukpy"><div class="celebration-modal svelte-1reukpy"><div class="celebration-content svelte-1reukpy"><div class="celebration-icon svelte-1reukpy">ðŸ†</div> <h2 class="svelte-1reukpy">Achievement Unlocked!</h2> <h3 class="svelte-1reukpy"> </h3> <p class="svelte-1reukpy"> </p> <div class="celebration-reward svelte-1reukpy"><!></div> <button class="celebration-close svelte-1reukpy">Continue</button></div></div></div>'),qc=Fe('<!> <main class="game-container svelte-1reukpy"><!> <div class="game-content svelte-1reukpy"><aside class="sidebar left-sidebar svelte-1reukpy"><!> <div class="quick-actions svelte-1reukpy"><button class="production-button svelte-1reukpy"><div class="button-content svelte-1reukpy"><span class="icon svelte-1reukpy">ðŸ”¥</span> <span class="text svelte-1reukpy">Make Matchstick</span> <span class="shortcut svelte-1reukpy">[Space]</span></div></button></div></aside> <div class="main-content svelte-1reukpy"><!> <div class="content-panel svelte-1reukpy"><!></div></div> <aside class="sidebar right-sidebar svelte-1reukpy"><div class="market-summary svelte-1reukpy"><h3 class="svelte-1reukpy">Market Summary</h3> <div class="price-display svelte-1reukpy"><span class="label svelte-1reukpy">Current Price:</span> <span class="value svelte-1reukpy"> </span></div> <div> </div></div> <div class="recent-activity svelte-1reukpy"><h3 class="svelte-1reukpy">Recent Activity</h3> <div class="activity-feed svelte-1reukpy"></div></div></aside></div> <div class="notifications svelte-1reukpy"></div> <!></main>',1);function Yc(l,r){br(r,!1);const[i,c]=Xr(),h=()=>Fr(de,"$gameState",i),g=()=>Fr(Sn,"$gameEvents",i);let _=ze("production"),A=ze(new Set),q=ze(!1),R=ze(null),$=ze(!0),K=ze(0),W=ze("Initializing Matchstick Empire..."),ue=new Set,X;Xn(async()=>{const le=[{progress:20,message:"Loading storage system..."},{progress:40,message:"Starting market simulation..."},{progress:60,message:"Initializing automation..."},{progress:80,message:"Loading achievements..."},{progress:95,message:"Finishing setup..."},{progress:100,message:"Ready to play!"}];for(const U of le)ye(K,U.progress),ye(W,U.message),await new Promise(Ae=>setTimeout(Ae,300));await Fa.initialize(),await new Promise(U=>setTimeout(U,500)),ye($,!1),X=Sn.subscribe(U=>{if(U.filter(Re=>!ue.has(Re.id)).forEach(Re=>{if(ue.add(Re.id),Re.type==="achievement_unlocked"){ye(q,!0),ye(R,Re.data);const qe={id:`notif_${Re.id}`,type:"achievement",title:"ðŸŽ‰ Achievement Unlocked!",message:`${Re.data.name}`,timestamp:Re.timestamp,duration:5e3};o(A).add(qe),ye(A,o(A))}else if(Re.type==="trade_executed"){const qe={id:`notif_${Re.id}`,type:"success",title:"ðŸ’° Sale Complete",message:`Sold ${Re.data.amount} matchsticks for $${Re.data.revenue.toFixed(2)}`,timestamp:Re.timestamp,duration:3e3};o(A).add(qe),ye(A,o(A))}}),ue.size>200){const qe=Array.from(ue).slice(-100);ue=new Set(qe)}})}),ps(()=>{X&&X()});function ee(le){const U=Array.from(o(A)).find(Ae=>Ae.id===le);U&&(o(A).delete(U),ye(A,o(A)))}function te(){ye(q,!1),ye(R,null)}function ce(le){ye(_,le)}function oe(le){if(!le.altKey)switch(le.key){case"1":ce("production");break;case"2":ce("automation");break;case"3":ce("market");break;case"4":ce("achievements");break}}_r();var we=qc();Lt("keydown",Ki,oe);var Ce=ir(we);Pc(Ce,{get show(){return o($)},get message(){return o(W)},get progress(){return o(K)}});var _e=p(Ce,2),V=v(_e);mc(V,{});var ne=p(V,2),Ie=v(ne),Ze=v(Ie);vc(Ze,{});var ut=p(Ze,2),dt=v(ut);d(ut),d(Ie);var je=p(Ie,2),Te=v(je);_c(Te,{get activeTab(){return o(_)},onTabChange:ce});var We=p(Te,2),et=v(We);{var gt=le=>{var U=Ac(),Ae=v(U);Bo(Ae,{}),d(U),sr(1,U,()=>Ur,()=>({x:-300,duration:300,easing:Dr})),re(le,U)},St=le=>{var U=dr(),Ae=ir(U);{var Re=Ve=>{var Ye=Ec(),bt=v(Ye);Jo(bt,{}),d(Ye),sr(1,Ye,()=>Ur,()=>({x:-300,duration:300,easing:Dr})),re(Ve,Ye)},qe=Ve=>{var Ye=dr(),bt=ir(Ye);{var wt=z=>{var Pe=Mc(),De=v(Pe);Vo(De,{}),d(Pe),sr(1,Pe,()=>Ur,()=>({x:-300,duration:300,easing:Dr})),re(z,Pe)},ve=z=>{var Pe=dr(),De=ir(Pe);{var he=fe=>{var pe=Ic(),Oe=v(pe);uc(Oe,{}),d(pe),sr(1,pe,()=>Ur,()=>({x:-300,duration:300,easing:Dr})),re(fe,pe)};pt(De,fe=>{o(_)==="achievements"&&fe(he)},!0)}re(z,Pe)};pt(bt,z=>{o(_)==="market"?z(wt):z(ve,!1)},!0)}re(Ve,Ye)};pt(Ae,Ve=>{o(_)==="automation"?Ve(Re):Ve(qe,!1)},!0)}re(le,U)};pt(et,le=>{o(_)==="production"?le(gt):le(St,!1)})}d(We),d(je);var Xe=p(je,2),tt=v(Xe),se=p(v(tt),2),G=p(v(se),2),at=v(G);d(G),d(se);var ge=p(se,2);let it;var vt=v(ge);d(ge),d(tt);var st=p(tt,2),_t=p(v(st),2);vr(_t,5,()=>g().slice(0,5),le=>le.id,(le,U)=>{var Ae=jc(),Re=v(Ae),qe=v(Re,!0);d(Re);var Ve=p(Re,2),Ye=v(Ve);{var bt=ve=>{var z=er();Le(()=>D(z,`ðŸ”¥ Produced ${o(U).data.amount??""} matchsticks`)),re(ve,z)},wt=ve=>{var z=dr(),Pe=ir(z);{var De=fe=>{var pe=er();Le(Oe=>D(pe,`ðŸ’° Sold ${o(U).data.amount??""} for $${Oe??""}`),[()=>o(U).data.revenue.toFixed(2)]),re(fe,pe)},he=fe=>{var pe=dr(),Oe=ir(pe);{var Pt=ot=>{var mt=er();Le(()=>D(mt,`ðŸ† Unlocked: ${o(U).data.name??""}`)),re(ot,mt)},ft=ot=>{var mt=dr(),yt=ir(mt);{var Rt=me=>{var F=er();Le(()=>D(F,`âš™ï¸ Purchased: ${o(U).data.itemId??""}`)),re(me,F)},Ne=me=>{var F=er();Le(()=>D(F,`ðŸ“Š ${o(U).type??""}`)),re(me,F)};pt(yt,me=>{o(U).type==="upgrade_purchased"?me(Rt):me(Ne,!1)},!0)}re(ot,mt)};pt(Oe,ot=>{o(U).type==="achievement_unlocked"?ot(Pt):ot(ft,!1)},!0)}re(fe,pe)};pt(Pe,fe=>{o(U).type==="matchsticks_sold"?fe(De):fe(he,!1)},!0)}re(ve,z)};pt(Ye,ve=>{o(U).type==="matchsticks_produced"?ve(bt):ve(wt,!1)})}d(Ve),d(Ae),Le(ve=>D(qe,ve),[()=>new Date(o(U).timestamp).toLocaleTimeString()]),sr(3,Ae,()=>Da),re(le,Ae)}),d(_t),d(st),d(Xe),d(ne);var Ct=p(ne,2);vr(Ct,5,()=>Array.from(o(A)),le=>le.id,(le,U)=>{var Ae=Tc(),Re=v(Ae);hc(Re,{get notification(){return o(U)},onClose:()=>ee(o(U).id)}),d(Ae),sr(3,Ae,()=>Ur,()=>({y:-50,duration:300})),re(le,Ae)}),d(Ct);var J=p(Ct,2);{var Mt=le=>{var U=Rc(),Ae=v(U),Re=v(Ae),qe=p(v(Re),4),Ve=v(qe,!0);d(qe);var Ye=p(qe,2),bt=v(Ye,!0);d(Ye);var wt=p(Ye,2),ve=v(wt);{var z=he=>{var fe=er();Le(()=>D(fe,`ðŸ’° Earned $${o(R).reward.amount??""}`)),re(he,fe)},Pe=he=>{var fe=dr(),pe=ir(fe);{var Oe=ft=>{var ot=er();Le(()=>D(ot,`âš¡ Production boost: ${o(R).reward.amount??""}x`)),re(ft,ot)},Pt=ft=>{var ot=er("ðŸŽ Special reward unlocked!");re(ft,ot)};pt(pe,ft=>{o(R).reward?.type==="production_multiplier"?ft(Oe):ft(Pt,!1)},!0)}re(he,fe)};pt(ve,he=>{o(R).reward?.type==="money"?he(z):he(Pe,!1)})}d(wt);var De=p(wt,2);d(Re),d(Ae),d(U),Le(()=>{D(Ve,o(R).name),D(bt,o(R).description)}),Lt("click",De,te),sr(3,Ae,()=>Ka,()=>({duration:500,easing:Dr})),sr(3,U,()=>Da),re(le,U)};pt(J,le=>{o(q)&&o(R)&&le(Mt)})}d(_e),Le((le,U)=>{D(at,`$${le??""}`),it=yr(ge,1,"trend-indicator svelte-1reukpy",null,it,U),D(vt,`${h().market.trend==="up"?"ðŸ“ˆ":h().market.trend==="down"?"ðŸ“‰":"âž¡ï¸"}
          ${h().market.trend||"stable"}`)},[()=>h().market.currentPrice.toFixed(3),()=>({positive:h().market.trend==="up",negative:h().market.trend==="down"})]),Lt("click",dt,()=>Or.produceMatchsticks(1)),re(l,we),wr(),c()}export{Yc as component};
