import"../chunks/DsnmJJEf.js";import{i as br}from"../chunks/TLHdX_sP.js";import{l as Ei,b as hs,c as ps,w as Mi,d as or,e as Ii,g as lt,o as Xn,f as Lt,s as D,i as ms}from"../chunks/jdj6VRHW.js";import{C as ji,v as ys,A as Ca,w as tr,ah as gs,x as _s,h as o,$ as ln,y as bs,H as ws,z as fi,B as Pa,K as wn,ai as ks,am as xs,D as Ta,G as Ss,F as nn,aD as hi,P as ze,aE as pi,aq as Ti,af as Ri,aF as Yn,I as qi,J as Cs,aG as Qn,aH as Ps,aI as Aa,aJ as Oi,ak as As,aK as Es,ap as Ms,aL as Is,Z as Di,aM as $i,N as Fi,aN as js,L as Ki,aO as Ts,aP as Rs,R as qs,aQ as Os,aR as Ds,aS as $s,aT as Fs,aU as Ks,E as Ns,aV as Bs,aW as Ls,e as I,aX as zs,aY as Us,O as kn,aZ as Hs,a_ as Vs,a$ as Gs,M as Ws,p as wr,Q as ye,b0 as Tt,b1 as un,l as Fe,b2 as Ni,q as p,n as v,o as d,t as Le,i as ie,a as re,b3 as Vn,m as kr,aa as Xs,b4 as mi,ab as er,b5 as Ys,c as dr,f as ir}from"../chunks/DoB2URIv.js";import{_ as yi,i as pt,b as Qs,s as Fr,a as Xr,p as Wr}from"../chunks/BVfJwSKq.js";function Ir(u,r){return r}function Js(u,r,i){for(var c=u.items,f=[],g=r.length,y=0;y<g;y++)Es(r[y].e,f,!0);var P=g>0&&f.length===0&&i!==null;if(P){var q=i.parentNode;Ms(q),q.append(i),c.clear(),yr(u,r[0].prev,r[g-1].next)}Is(f,()=>{for(var R=0;R<g;R++){var $=r[R];P||(c.delete($.k),yr(u,$.prev,$.next)),Oi($.e,!P)}})}function vr(u,r,i,c,f,g=null){var y=u,P={flags:r,items:new Map,first:null},q=(r&$i)!==0;if(q){var R=u;y=tr?Ca(gs(R)):R.appendChild(ji())}tr&&_s();var $=null,K=!1,W=new Map,ue=ln(()=>{var ce=i();return Ri(ce)?ce:ce==null?[]:Ti(ce)}),X,ee;function te(){Zs(ee,X,P,W,y,f,r,c,i),g!==null&&(X.length===0?$?qi($):$=Ta(()=>g(y)):$!==null&&Cs($,()=>{$=null}))}ys(()=>{ee??=Di,X=o(ue);var ce=X.length;if(K&&ce===0)return;K=ce===0;let oe=!1;if(tr){var Se=bs(y)===ws;Se!==(ce===0)&&(y=fi(),Ca(y),Pa(!1),oe=!0)}if(tr){for(var Ce=null,ke,V=0;V<ce;V++){if(wn.nodeType===ks&&wn.data===xs){y=wn,oe=!0,Pa(!1);break}var ne=X[V],Ie=c(ne,V);ke=Ra(wn,P,Ce,null,ne,Ie,V,f,r,i),P.items.set(Ie,ke),Ce=ke}ce>0&&Ca(fi())}if(tr)ce===0&&g&&($=Ta(()=>g(y)));else if(Ss()){var Ze=new Set,ut=nn;for(V=0;V<ce;V+=1){ne=X[V],Ie=c(ne,V);var dt=P.items.get(Ie)??W.get(Ie);dt?(r&(Qn|Yn))!==0&&Bi(dt,ne,V,r):(ke=Ra(null,P,null,null,ne,Ie,V,f,r,i,!0),W.set(Ie,ke)),Ze.add(Ie)}for(const[je,Te]of P.items)Ze.has(je)||ut.skipped_effects.add(Te.e);ut.add_callback(te)}else te();oe&&Pa(!0),o(ue)}),tr&&(y=wn)}function Zs(u,r,i,c,f,g,y,P,q){var R=(y&js)!==0,$=(y&(Qn|Yn))!==0,K=r.length,W=i.items,ue=i.first,X=ue,ee,te=null,ce,oe=[],Se=[],Ce,ke,V,ne;if(R)for(ne=0;ne<K;ne+=1)Ce=r[ne],ke=P(Ce,ne),V=W.get(ke),V!==void 0&&(V.a?.measure(),(ce??=new Set).add(V));for(ne=0;ne<K;ne+=1){if(Ce=r[ne],ke=P(Ce,ne),V=W.get(ke),V===void 0){var Ie=c.get(ke);if(Ie!==void 0){c.delete(ke),W.set(ke,Ie);var Ze=te?te.next:X;yr(i,te,Ie),yr(i,Ie,Ze),Ea(Ie,Ze,f),te=Ie}else{var ut=X?X.e.nodes_start:f;te=Ra(ut,i,te,te===null?i.first:te.next,Ce,ke,ne,g,y,q)}W.set(ke,te),oe=[],Se=[],X=te.next;continue}if($&&Bi(V,Ce,ne,y),(V.e.f&Aa)!==0&&(qi(V.e),R&&(V.a?.unfix(),(ce??=new Set).delete(V))),V!==X){if(ee!==void 0&&ee.has(V)){if(oe.length<Se.length){var dt=Se[0],je;te=dt.prev;var Te=oe[0],We=oe[oe.length-1];for(je=0;je<oe.length;je+=1)Ea(oe[je],dt,f);for(je=0;je<Se.length;je+=1)ee.delete(Se[je]);yr(i,Te.prev,We.next),yr(i,te,Te),yr(i,We,dt),X=dt,te=We,ne-=1,oe=[],Se=[]}else ee.delete(V),Ea(V,X,f),yr(i,V.prev,V.next),yr(i,V,te===null?i.first:te.next),yr(i,te,V),te=V;continue}for(oe=[],Se=[];X!==null&&X.k!==ke;)(X.e.f&Aa)===0&&(ee??=new Set).add(X),Se.push(X),X=X.next;if(X===null)continue;V=X}oe.push(V),te=V,X=V.next}if(X!==null||ee!==void 0){for(var et=ee===void 0?[]:Ti(ee);X!==null;)(X.e.f&Aa)===0&&et.push(X),X=X.next;var gt=et.length;if(gt>0){var St=(y&$i)!==0&&K===0?f:null;if(R){for(ne=0;ne<gt;ne+=1)et[ne].a?.measure();for(ne=0;ne<gt;ne+=1)et[ne].a?.fix()}Js(i,et,St)}}R&&Fi(()=>{if(ce!==void 0)for(V of ce)V.a?.apply()}),u.first=i.first&&i.first.e,u.last=te&&te.e;for(var Xe of c.values())Oi(Xe.e);c.clear()}function Bi(u,r,i,c){(c&Qn)!==0&&hi(u.v,r),(c&Yn)!==0?hi(u.i,i):u.i=i}function Ra(u,r,i,c,f,g,y,P,q,R,$){var K=(q&Qn)!==0,W=(q&Ps)===0,ue=K?W?ze(f,!1,!1):pi(f):f,X=(q&Yn)===0?y:pi(y),ee={i:X,v:ue,k:g,a:null,e:null,prev:i,next:c};try{if(u===null){var te=document.createDocumentFragment();te.append(u=ji())}return ee.e=Ta(()=>P(u,ue,X,R),tr),ee.e.prev=i&&i.e,ee.e.next=c&&c.e,i===null?$||(r.first=ee):(i.next=ee,i.e.next=ee.e),c!==null&&(c.prev=ee,c.e.prev=ee.e),ee}finally{}}function Ea(u,r,i){for(var c=u.next?u.next.e.nodes_start:i,f=r?r.e.nodes_start:i,g=u.e.nodes_start;g!==null&&g!==c;){var y=As(g);f.before(g),g=y}}function yr(u,r,i){r===null?u.first=i:(r.next=i,r.e.next=i&&i.e),i!==null&&(i.prev=r,i.e.prev=r&&r.e)}const gi=[...` 	
\r\fÂ \v\uFEFF`];function eo(u,r,i){var c=u==null?"":""+u;if(r&&(c=c?c+" "+r:r),i){for(var f in i)if(i[f])c=c?c+" "+f:f;else if(c.length)for(var g=f.length,y=0;(y=c.indexOf(f,y))>=0;){var P=y+g;(y===0||gi.includes(c[y-1]))&&(P===c.length||gi.includes(c[P]))?c=(y===0?"":c.substring(0,y))+c.substring(P+1):y=P}}return c===""?null:c}function to(u,r){return u==null?null:String(u)}function gr(u,r,i,c,f,g){var y=u.__className;if(tr||y!==i||y===void 0){var P=eo(i,c,g);(!tr||P!==u.getAttribute("class"))&&(P==null?u.removeAttribute("class"):u.className=P),u.__className=i}else if(g&&f!==g)for(var q in g){var R=!!g[q];(f==null||R!==!!f[q])&&u.classList.toggle(q,R)}return g}function Nt(u,r,i,c){var f=u.__style;if(tr||f!==r){var g=to(r);(!tr||g!==u.getAttribute("style"))&&(g==null?u.removeAttribute("style"):u.style.cssText=g),u.__style=r}return c}function Li(u,r,i=!1){if(u.multiple){if(r==null)return;if(!Ri(r))return Ts();for(var c of u.options)c.selected=r.includes(xn(c));return}for(c of u.options){var f=xn(c);if(Rs(f,r)){c.selected=!0;return}}(!i||r!==void 0)&&(u.selectedIndex=-1)}function ro(u){var r=new MutationObserver(()=>{Li(u,u.__value)});r.observe(u,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),qs(()=>{r.disconnect()})}function _i(u,r,i=r){var c=!0;Ei(u,"change",f=>{var g=f?"[selected]":":checked",y;if(u.multiple)y=[].map.call(u.querySelectorAll(g),xn);else{var P=u.querySelector(g)??u.querySelector("option:not([disabled])");y=P&&xn(P)}i(y)}),Ki(()=>{var f=r();if(Li(u,f,c),c&&f===void 0){var g=u.querySelector(":checked");g!==null&&(f=xn(g),i(f))}u.__value=f,c=!1}),ro(u)}function xn(u){return"__value"in u?u.__value:u.value}const no=Symbol("is custom element"),ao=Symbol("is html");function io(u){if(tr){var r=!1,i=()=>{if(!r){if(r=!0,u.hasAttribute("value")){var c=u.value;qa(u,"value",null),u.value=c}if(u.hasAttribute("checked")){var f=u.checked;qa(u,"checked",null),u.checked=f}}};u.__on_r=i,Fs(i),hs()}}function qa(u,r,i,c){var f=so(u);tr&&(f[r]=u.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&u.nodeName==="LINK")||f[r]!==(f[r]=i)&&(r==="loading"&&(u[Ks]=i),i==null?u.removeAttribute(r):typeof i!="string"&&oo(u).includes(r)?u[r]=i:u.setAttribute(r,i))}function so(u){return u.__attributes??={[no]:u.nodeName.includes("-"),[ao]:u.namespaceURI===Os}}var bi=new Map;function oo(u){var r=bi.get(u.nodeName);if(r)return r;bi.set(u.nodeName,r=[]);for(var i,c=u,f=Element.prototype;f!==c;){i=$s(c);for(var g in i)i[g].set&&r.push(g);c=Ds(c)}return r}const co=()=>performance.now(),Mr={tick:u=>requestAnimationFrame(u),now:()=>co(),tasks:new Set};function zi(){const u=Mr.now();Mr.tasks.forEach(r=>{r.c(u)||(Mr.tasks.delete(r),r.f())}),Mr.tasks.size!==0&&Mr.tick(zi)}function lo(u){let r;return Mr.tasks.size===0&&Mr.tick(zi),{promise:new Promise(i=>{Mr.tasks.add(r={c:u,f:i})}),abort(){Mr.tasks.delete(r)}}}function zn(u,r){Mi(()=>{u.dispatchEvent(new CustomEvent(r))})}function uo(u){if(u==="float")return"cssFloat";if(u==="offset")return"cssOffset";if(u.startsWith("--"))return u;const r=u.split("-");return r.length===1?r[0]:r[0]+r.slice(1).map(i=>i[0].toUpperCase()+i.slice(1)).join("")}function wi(u){const r={},i=u.split(";");for(const c of i){const[f,g]=c.split(":");if(!f||g===void 0)break;const y=uo(f.trim());r[y]=g.trim()}return r}const vo=u=>u;function sr(u,r,i,c){var f=(u&Hs)!==0,g=(u&Vs)!==0,y=f&&g,P=(u&zs)!==0,q=y?"both":f?"in":"out",R,$=r.inert,K=r.style.overflow,W,ue;function X(){return Mi(()=>R??=i()(r,c?.()??{},{direction:q}))}var ee={is_global:P,in(){if(r.inert=$,!f){ue?.abort(),ue?.reset?.();return}g||W?.abort(),zn(r,"introstart"),W=Oa(r,X(),ue,1,()=>{zn(r,"introend"),W?.abort(),W=R=void 0,r.style.overflow=K})},out(Se){if(!g){Se?.(),R=void 0;return}r.inert=!0,zn(r,"outrostart"),ue=Oa(r,X(),W,0,()=>{zn(r,"outroend"),Se?.()})},stop:()=>{W?.abort(),ue?.abort()}},te=Di;if((te.transitions??=[]).push(ee),f&&ps){var ce=P;if(!ce){for(var oe=te.parent;oe&&(oe.f&Ns)!==0;)for(;(oe=oe.parent)&&(oe.f&Bs)===0;);ce=!oe||(oe.f&Ls)!==0}ce&&Ki(()=>{I(()=>ee.in())})}}function Oa(u,r,i,c,f){var g=c===1;if(Us(r)){var y,P=!1;return Fi(()=>{if(!P){var te=r({direction:g?"in":"out"});y=Oa(u,te,i,c,f)}}),{abort:()=>{P=!0,y?.abort()},deactivate:()=>y.deactivate(),reset:()=>y.reset(),t:()=>y.t()}}if(i?.deactivate(),!r?.duration)return f(),{abort:kn,deactivate:kn,reset:kn,t:()=>c};const{delay:q=0,css:R,tick:$,easing:K=vo}=r;var W=[];if(g&&i===void 0&&($&&$(0,1),R)){var ue=wi(R(0,1));W.push(ue,ue)}var X=()=>1-c,ee=u.animate(W,{duration:q,fill:"forwards"});return ee.onfinish=()=>{ee.cancel();var te=i?.t()??1-c;i?.abort();var ce=c-te,oe=r.duration*Math.abs(ce),Se=[];if(oe>0){var Ce=!1;if(R)for(var ke=Math.ceil(oe/16.666666666666668),V=0;V<=ke;V+=1){var ne=te+ce*K(V/ke),Ie=wi(R(ne,1-ne));Se.push(Ie),Ce||=Ie.overflow==="hidden"}Ce&&(u.style.overflow="hidden"),X=()=>{var Ze=ee.currentTime;return te+ce*K(Ze/oe)},$&&lo(()=>{if(ee.playState!=="running")return!1;var Ze=X();return $(Ze,1-Ze),!0})}ee=u.animate(Se,{duration:oe,fill:"forwards"}),ee.onfinish=()=>{X=()=>c,$?.(c,1-c),f()}},{abort:()=>{ee&&(ee.cancel(),ee.effect=null,ee.onfinish=kn)},deactivate:()=>{f=kn},reset:()=>{c===0&&$?.(1,0)},t:()=>X()}}function fo(u,r,i=r){var c=Gs(),f=new WeakSet;Ei(u,"input",g=>{var y=g?u.defaultValue:u.value;if(y=Ma(u)?Ia(y):y,i(y),nn!==null&&f.add(nn),c&&y!==(y=r())){var P=u.selectionStart,q=u.selectionEnd;u.value=y??"",q!==null&&(u.selectionStart=P,u.selectionEnd=Math.min(q,u.value.length))}}),(tr&&u.defaultValue!==u.value||I(r)==null&&u.value)&&(i(Ma(u)?Ia(u.value):u.value),nn!==null&&f.add(nn)),Ws(()=>{var g=r();u===document.activeElement&&f.has(nn)||Ma(u)&&g===Ia(u.value)||u.type==="date"&&!g&&!u.value||g!==u.value&&(u.value=g??"")})}function Ma(u){var r=u.type;return r==="number"||r==="range"}function Ia(u){return u===""?null:+u}function ho(u){return function(...r){var i=r[0];return i.stopPropagation(),u?.apply(this,r)}}const po=u=>u;function Ui(u){const r=u-1;return r*r*r+1}function ki(u){const r=typeof u=="string"&&u.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return r?[parseFloat(r[1]),r[2]||"px"]:[u,"px"]}function Da(u,{delay:r=0,duration:i=400,easing:c=po}={}){const f=+getComputedStyle(u).opacity;return{delay:r,duration:i,easing:c,css:g=>`opacity: ${g*f}`}}function Ur(u,{delay:r=0,duration:i=400,easing:c=Ui,x:f=0,y:g=0,opacity:y=0}={}){const P=getComputedStyle(u),q=+P.opacity,R=P.transform==="none"?"":P.transform,$=q*(1-y),[K,W]=ki(f),[ue,X]=ki(g);return{delay:r,duration:i,easing:c,css:(ee,te)=>`
			transform: ${R} translate(${(1-ee)*K}${W}, ${(1-ee)*ue}${X});
			opacity: ${q-$*te}`}}function Ka(u,{delay:r=0,duration:i=400,easing:c=Ui,start:f=0,opacity:g=0}={}){const y=getComputedStyle(u),P=+y.opacity,q=y.transform==="none"?"":y.transform,R=1-f,$=P*(1-g);return{delay:r,duration:i,easing:c,css:(K,W)=>`
			transform: ${q} scale(${1-R*W});
			opacity: ${P-$*W}
		`}}function Dr(u){return--u*u*u*u*u+1}class Et{static MAX_SAFE=BigInt("2")**BigInt("1000")-BigInt("1");static add(r,i){const c=r+i;return c>this.MAX_SAFE?this.MAX_SAFE:c}static subtract(r,i){const c=r-i;return c<0n?0n:c}static multiply(r,i){try{const c=r*i;return c>this.MAX_SAFE?this.MAX_SAFE:c}catch{return this.MAX_SAFE}}static divide(r,i){return i===0n?0n:r/i}static power(r,i){if(i===0n)return 1n;if(i===1n)return r;if(r===0n)return 0n;if(r===1n)return 1n;try{let c=r;for(let f=1n;f<i;f++)if(c=this.multiply(c,r),c>=this.MAX_SAFE)return this.MAX_SAFE;return c}catch{return this.MAX_SAFE}}static compare(r,i){return r<i?-1:r>i?1:0}static isSafe(r){return r<=this.MAX_SAFE&&r>=0n}}class $r extends Error{id;category;severity;timestamp;details;constructor(r,i="unknown",c="medium",f){super(r),this.name="MatchstickError",this.id=Vi(),this.category=i,this.severity=c,this.timestamp=Date.now(),this.details=f,Error.captureStackTrace&&Error.captureStackTrace(this,$r)}toGameError(){return{id:this.id,category:this.category,severity:this.severity,message:this.message,details:this.details,timestamp:this.timestamp,stack:this.stack}}toNotification(){return Hi(this.toGameError())}}class mo{errorHistory=[];maxHistorySize=100;notificationCallbacks=[];handleError(r){const i=this.normalizeError(r);this.logError(i);const c=this.determineRecoveryStrategy(i);return this.shouldNotifyUser(i)&&(c.notification=Hi(i),this.sendNotification(c.notification)),c}logError(r){const i=this.normalizeError(r);switch(this.errorHistory.unshift(i),this.errorHistory.length>this.maxHistorySize&&(this.errorHistory=this.errorHistory.slice(0,this.maxHistorySize)),i.severity){case"critical":console.error("ð´ Critical Error:",i);break;case"high":console.error("ð  High Severity Error:",i);break;case"medium":console.warn("ð¡ Warning:",i);break;case"low":console.info("ðµ Info:",i);break}}notifyUser(r,i){const c={id:Gi(),type:i==="error"?"error":i==="warning"?"warning":"info",title:i==="error"?"Error":i==="warning"?"Warning":"Information",message:r,timestamp:Date.now(),isRead:!1};this.sendNotification(c)}getErrorHistory(){return[...this.errorHistory]}clearErrorHistory(){this.errorHistory=[]}onNotification(r){this.notificationCallbacks.push(r)}offNotification(r){const i=this.notificationCallbacks.indexOf(r);i>-1&&this.notificationCallbacks.splice(i,1)}normalizeError(r){return"category"in r&&"severity"in r?r instanceof $r?r.toGameError():r:{id:Vi(),category:"unknown",severity:"medium",message:r.message||"Unknown error occurred",timestamp:Date.now(),stack:r.stack}}determineRecoveryStrategy(r){switch(r.category){case"storage":return this.handleStorageError(r);case"game_logic":return this.handleGameLogicError(r);case"network":return this.handleNetworkError(r);case"ui":return this.handleUIError(r);default:return this.handleUnknownError(r)}}handleStorageError(r){return r.severity==="critical"?{handled:!0,recovery:"save_backup",shouldRetry:!1,fallbackData:null}:{handled:!0,recovery:"retry_operation",shouldRetry:!0}}handleGameLogicError(r){return{handled:!0,recovery:r.severity==="critical"?"reload_state":"use_fallback",shouldRetry:r.severity!=="critical",fallbackData:bo(r.details?.feature)}}handleNetworkError(r){return{handled:!0,recovery:"retry_operation",shouldRetry:!0}}handleUIError(r){return{handled:!0,recovery:"none",shouldRetry:!1}}handleUnknownError(r){return{handled:!1,recovery:"none",shouldRetry:!1}}shouldNotifyUser(r){return r.severity==="low"?!1:r.severity==="critical"?!0:this.errorHistory.filter(c=>c.category===r.category&&c.message===r.message).filter(c=>Date.now()-c.timestamp<6e4).length<=1}sendNotification(r){this.notificationCallbacks.forEach(i=>{try{i(r)}catch(c){console.error("Error in notification callback:",c)}})}}function Hi(u){const r=yo(u),i=_o(u);return{id:Gi(),type:u.severity==="critical"?"error":"warning",title:go(u),message:r,timestamp:Date.now(),duration:u.severity==="critical"?void 0:5e3,isRead:!1,actions:i}}function yo(u){switch(u.category){case"storage":return"There was a problem saving your progress. Your game data is safe.";case"game_logic":return"Something unexpected happened in the game. We'll try to fix it automatically.";case"network":return"Connection problem. Some features may not work until reconnected.";case"ui":return"Display issue detected. Try refreshing if problems persist.";default:return"An unexpected error occurred. The game should continue working normally."}}function go(u){if(u.severity==="critical")return"Critical Error";switch(u.category){case"storage":return"Save Issue";case"game_logic":return"Game Error";case"network":return"Connection Issue";case"ui":return"Display Issue";default:return"Warning"}}function _o(u){const r=[];return u.severity==="critical"&&r.push({label:"Reload Game",action:"reload_game",style:"primary"}),u.category==="storage"&&r.push({label:"Retry Save",action:"retry_save",style:"primary"}),u.category==="network"&&r.push({label:"Retry",action:"retry_operation",style:"primary"}),r.push({label:"Dismiss",action:"dismiss",style:"secondary"}),r}function bo(u){switch(u){case"production":return{matchsticks:0n,rate:0};case"market":return{price:1,demand:"normal"};case"automation":return{autoClickers:[],multipliers:[]};default:return null}}function Vi(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Gi(){return`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const be=new mo,we={storage:(u,r)=>new $r(u,"storage","high",r),gameLogic:(u,r)=>new $r(u,"game_logic","medium",r),network:(u,r)=>new $r(u,"network","medium",r),ui:(u,r)=>new $r(u,"ui","low",r),critical:(u,r)=>new $r(u,"unknown","critical",r)};function Gn(){const u=Date.now();return{resources:{matchsticks:0n,money:0,wood:0,reputation:0},production:{manualRate:1,automatedRate:0,multipliers:{},lastUpdate:u,totalProduced:0n},market:{currentPrice:1,basePrice:1,priceHistory:[],condition:{priceMultiplier:1,demandLevel:"normal",trend:"stable",duration:0,description:"Normal market conditions"},autoSellEnabled:!1,autoSellThreshold:100,totalSold:0n,totalRevenue:0},automation:{autoClickers:[],autoSellEnabled:!1,autoSellSettings:{enabled:!1,threshold:100,maxPercentage:50,priceThreshold:.5,smartSelling:!1},multipliers:[],totalMoneySpent:0,lastUpdate:u},achievements:{unlocked:[],progress:{},notifications:[],stats:{totalUnlocked:0,totalHidden:0,completionPercentage:0,unlockedToday:0}},progression:{currentPhase:"manual",unlockedFeatures:["manual_production"],completedTutorials:[],milestones:[],worldConversionProgress:0,prestigeLevel:0},tutorial:{currentStep:0,completedTutorials:[],skippedTutorials:[],isActive:!0},settings:{theme:"light",soundEnabled:!0,musicEnabled:!0,hapticEnabled:!0,animations:{enabled:!0,reducedMotion:!1,particleEffects:!0,transitionSpeed:"normal"},notifications:{enabled:!0,achievements:!0,milestones:!0,marketAlerts:!0,production:!0,sound:!0},accessibility:{highContrast:!1,screenReader:!1,keyboardNavigation:!0,largeText:!1,colorBlindFriendly:!1},language:"en",autoSave:!0,saveInterval:3e4},easterEggs:{discovered:[],sequences:[],totalFound:0},metadata:{version:"1.0.0",createdAt:u,lastSaved:u,totalPlayTime:0,sessionStartTime:u,playerId:"1",gameSpeed:1,debugMode:!1}}}const de=Ii(Gn()),wo=or(de,u=>u.resources),ko=or(de,u=>u.production),xo=or(de,u=>u.market),So=or(de,u=>u.automation);or(de,u=>u.achievements);const Co=or(de,u=>u.progression),Po=or(de,u=>u.tutorial);or(de,u=>u.settings);or(de,u=>u.easterEggs);or(de,u=>u.metadata);const Sn=Ii([]);function ja(){return`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const ge={reset(){try{de.set(Gn()),Sn.set([])}catch(u){be.handleError(we.gameLogic("Failed to reset game state",{error:u}))}},load(u){try{de.update(r=>{if("metadata"in u&&"resources"in u&&"production"in u&&"market"in u)return xi(u);const i=u,c={...r,...i.resources&&{resources:{...r.resources,...i.resources}},...i.production&&{production:{...r.production,...i.production}},...i.market&&{market:{...r.market,...i.market}},...i.automation&&{automation:{...r.automation,...i.automation}}};return xi(c)}),ge.emitEvent({id:ja(),type:"state_loaded",timestamp:Date.now(),data:{success:!0},source:"game_system"})}catch(r){be.handleError(we.storage("Failed to load game state",{error:r,data:u}))}},updateResources(u){try{de.update(r=>({...r,resources:{...r.resources,...u,matchsticks:u.matchsticks&&Et.isSafe(u.matchsticks)?u.matchsticks:r.resources.matchsticks}}))}catch(r){be.handleError(we.gameLogic("Failed to update resources",{error:r,updates:u}))}},addResources(u){try{de.update(r=>({...r,resources:{matchsticks:u.matchsticks?Et.add(r.resources.matchsticks,u.matchsticks):r.resources.matchsticks,money:r.resources.money+(u.money||0),wood:r.resources.wood+(u.wood||0),reputation:r.resources.reputation+(u.reputation||0)}}))}catch(r){be.handleError(we.gameLogic("Failed to add resources",{error:r,additions:u}))}},subtractResources(u){try{const r=lt(de);return u.matchsticks&&Et.compare(r.resources.matchsticks,u.matchsticks)<0||u.money&&r.resources.money<u.money||u.wood&&r.resources.wood<u.wood||u.reputation&&r.resources.reputation<u.reputation?!1:(de.update(i=>({...i,resources:{matchsticks:u.matchsticks?Et.subtract(i.resources.matchsticks,u.matchsticks):i.resources.matchsticks,money:i.resources.money-(u.money||0),wood:i.resources.wood-(u.wood||0),reputation:i.resources.reputation-(u.reputation||0)}})),!0)}catch(r){return be.handleError(we.gameLogic("Failed to subtract resources",{error:r,subtractions:u})),!1}},updateProduction(u){try{de.update(r=>({...r,production:{...r.production,...u,lastUpdate:Date.now()}}))}catch(r){be.handleError(we.gameLogic("Failed to update production",{error:r,updates:u}))}},updateMarket(u){try{de.update(r=>({...r,market:{...r.market,...u}}))}catch(r){be.handleError(we.gameLogic("Failed to update market",{error:r,updates:u}))}},emitEvent(u){try{Sn.update(r=>[u,...r].slice(0,100))}catch(r){be.handleError(we.gameLogic("Failed to emit event",{error:r,event:u}))}},clearEvents(){Sn.set([])},produceMatchsticks(u=1){try{const r=lt(de),i=BigInt(Math.floor(u*r.production.manualRate));ge.addResources({matchsticks:i}),ge.updateProduction({totalProduced:Et.add(r.production.totalProduced,i)}),ge.emitEvent({id:ja(),type:"matchsticks_produced",timestamp:Date.now(),data:{amount:i,method:"manual"},source:"production_system"})}catch(r){be.handleError(we.gameLogic("Failed to produce matchsticks",{error:r,amount:u}))}},sellMatchsticks(u){try{const r=lt(de);if(Et.compare(r.resources.matchsticks,u)<0)return!1;const i=Number(u)*r.market.currentPrice;return ge.subtractResources({matchsticks:u})?(ge.addResources({money:i}),ge.updateMarket({totalSold:Et.add(r.market.totalSold,u),totalRevenue:r.market.totalRevenue+i}),ge.emitEvent({id:ja(),type:"matchsticks_sold",timestamp:Date.now(),data:{amount:u,revenue:i,price:r.market.currentPrice},source:"market_system"}),!0):!1}catch(r){return be.handleError(we.gameLogic("Failed to sell matchsticks",{error:r,amount:u})),!1}},updateAutomation(u){try{de.update(r=>({...r,automation:{...r.automation,...u}}))}catch(r){be.handleError(we.gameLogic("Failed to update automation",{error:r,updates:u}))}},updateAchievements(u){try{de.update(r=>({...r,achievements:{...r.achievements,...u}}))}catch(r){be.handleError(we.gameLogic("Failed to update achievements",{error:r,updates:u}))}}};or([ko,So],([u,r])=>{try{const i=u.manualRate,c=u.automatedRate,f=Object.values(u.multipliers).reduce((g,y)=>g+y,1);return(i+c)*f}catch(i){return be.handleError(we.gameLogic("Failed to calculate production rate",{error:i})),0}}),or([wo,xo],([u,r])=>{try{const i=Number(u.matchsticks)*r.currentPrice;return u.money+i+u.wood*10+u.reputation*5}catch(i){return be.handleError(we.gameLogic("Failed to calculate net worth",{error:i})),0}}),or([Po,Co],([u,r])=>u.isActive&&r.currentPhase==="manual");function xi(u){try{const r={...Gn(),...u};return typeof r.resources.matchsticks=="string"&&(r.resources.matchsticks=BigInt(r.resources.matchsticks)),Et.isSafe(r.resources.matchsticks)||(r.resources.matchsticks=0n),r.resources.money=Math.max(0,r.resources.money||0),r.resources.wood=Math.max(0,r.resources.wood||0),r.resources.reputation=Math.max(0,r.resources.reputation||0),r.metadata.lastSaved=r.metadata.lastSaved||Date.now(),r.metadata.createdAt=r.metadata.createdAt||Date.now(),r.metadata.sessionStartTime=Date.now(),r}catch(r){return be.handleError(we.gameLogic("Failed to validate game state",{error:r})),Gn()}}const Ao={stateUpdateCount:0,lastUpdateTime:Date.now(),trackUpdate(){this.stateUpdateCount++,this.lastUpdateTime=Date.now()},getStats(){return{updateCount:this.stateUpdateCount,lastUpdate:this.lastUpdateTime,updatesPerMinute:this.stateUpdateCount/((Date.now()-this.lastUpdateTime)/6e4)}}};de.subscribe(()=>{Ao.trackUpdate()});var Eo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mo(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Hn={exports:{}},Io=Hn.exports,Si;function jo(){return Si||(Si=1,function(u,r){(function(i,c){u.exports=c()})(Io,function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])})(e,t)},c=function(){return(c=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function f(e,t,n){for(var a,s=0,l=t.length;s<l;s++)!a&&s in t||((a=a||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(a||Array.prototype.slice.call(t))}var g=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Eo,y=Object.keys,P=Array.isArray;function q(e,t){return typeof t!="object"||y(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||g.Promise||(g.Promise=Promise);var R=Object.getPrototypeOf,$={}.hasOwnProperty;function K(e,t){return $.call(e,t)}function W(e,t){typeof t=="function"&&(t=t(R(e))),(typeof Reflect>"u"?y:Reflect.ownKeys)(t).forEach(function(n){X(e,n,t[n])})}var ue=Object.defineProperty;function X(e,t,n,a){ue(e,t,q(n&&K(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},a))}function ee(e){return{from:function(t){return e.prototype=Object.create(t.prototype),X(e.prototype,"constructor",e),{extend:W.bind(null,e.prototype)}}}}var te=Object.getOwnPropertyDescriptor,ce=[].slice;function oe(e,t,n){return ce.call(e,t,n)}function Se(e,t){return t(e)}function Ce(e){if(!e)throw new Error("Assertion Failed")}function ke(e){g.setImmediate?setImmediate(e):setTimeout(e,0)}function V(e,t){if(typeof t=="string"&&K(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],a=0,s=t.length;a<s;++a){var l=V(e,t[a]);n.push(l)}return n}var h=t.indexOf(".");if(h!==-1){var m=e[t.substr(0,h)];return m==null?void 0:V(m,t.substr(h+1))}}function ne(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Ce(typeof n!="string"&&"length"in n);for(var a=0,s=t.length;a<s;++a)ne(e,t[a],n[a])}else{var l,h,m=t.indexOf(".");m!==-1?(l=t.substr(0,m),(h=t.substr(m+1))===""?n===void 0?P(e)&&!isNaN(parseInt(l))?e.splice(l,1):delete e[l]:e[l]=n:ne(m=!(m=e[l])||!K(e,l)?e[l]={}:m,h,n)):n===void 0?P(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Ie(e){var t,n={};for(t in e)K(e,t)&&(n[t]=e[t]);return n}var Ze=[].concat;function ut(e){return Ze.apply([],e)}var pe="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ut([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return g[e]}),dt=new Set(pe.map(function(e){return g[e]})),je=null;function Te(e){return je=new WeakMap,e=function t(n){if(!n||typeof n!="object")return n;var a=je.get(n);if(a)return a;if(P(n)){a=[],je.set(n,a);for(var s=0,l=n.length;s<l;++s)a.push(t(n[s]))}else if(dt.has(n.constructor))a=n;else{var h,m=R(n);for(h in a=m===Object.prototype?{}:Object.create(m),je.set(n,a),n)K(n,h)&&(a[h]=t(n[h]))}return a}(e),je=null,e}var We={}.toString;function et(e){return We.call(e).slice(8,-1)}var gt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",St=typeof gt=="symbol"?function(e){var t;return e!=null&&(t=e[gt])&&t.apply(e)}:function(){return null};function Xe(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var tt={};function se(e){var t,n,a,s;if(arguments.length===1){if(P(e))return e.slice();if(this===tt&&typeof e=="string")return[e];if(s=St(e)){for(n=[];!(a=s.next()).done;)n.push(a.value);return n}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var G=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},fe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ur=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(fe),at={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function _e(e,t){this.name=e,this.message=t}function it(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,a,s){return s.indexOf(n)===a}).join(`
`)}function vt(e,t,n,a){this.failures=t,this.failedKeys=a,this.successCount=n,this.message=it(e,t)}function st(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=it(e,this.failures)}ee(_e).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ee(vt).from(_e),ee(st).from(_e);var _t=ur.reduce(function(e,t){return e[t]=t+"Error",e},{}),Ct=_e,J=ur.reduce(function(e,t){var n=t+"Error";function a(s,l){this.name=n,s?typeof s=="string"?(this.message="".concat(s).concat(l?`
 `+l:""),this.inner=l||null):typeof s=="object"&&(this.message="".concat(s.name," ").concat(s.message),this.inner=s):(this.message=at[t]||n,this.inner=null)}return ee(a).from(Ct),e[t]=a,e},{});J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError;var Mt=fe.reduce(function(e,t){return e[t+"Error"]=J[t],e},{}),le=ur.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=J[t]),e},{});function U(){}function Ae(e){return e}function Re(e,t){return e==null||e===Ae?t:function(n){return t(e(n))}}function qe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ve(e,t){return e===U?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var a=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var l=t.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?qe(a,this.onsuccess):a),s&&(this.onerror=this.onerror?qe(s,this.onerror):s),l!==void 0?l:n}}function Ye(e,t){return e===U?t:function(){e.apply(this,arguments);var n=this.onsuccess,a=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?qe(n,this.onsuccess):n),a&&(this.onerror=this.onerror?qe(a,this.onerror):a)}}function bt(e,t){return e===U?t:function(n){var a=e.apply(this,arguments);q(n,a);var s=this.onsuccess,l=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),s&&(this.onsuccess=this.onsuccess?qe(s,this.onsuccess):s),l&&(this.onerror=this.onerror?qe(l,this.onerror):l),a===void 0?n===void 0?void 0:n:q(a,n)}}function wt(e,t){return e===U?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function ve(e,t){return e===U?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var a=this,s=arguments.length,l=new Array(s);s--;)l[s]=arguments[s];return n.then(function(){return t.apply(a,l)})}return t.apply(this,arguments)}}le.ModifyError=vt,le.DexieError=_e,le.BulkError=st;var z=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Pe(e){z=e}var De={},he=100,pe=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,R(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,R(t),e]}(),fe=pe[0],ur=pe[1],pe=pe[2],ur=ur&&ur.then,Oe=fe&&fe.constructor,Pt=!!pe,ft=function(e,t){kt.push([e,t]),mt&&(queueMicrotask(rt),mt=!1)},ot=!0,mt=!0,yt=[],Rt=[],Ke=Ae,me={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:U,pgp:!1,env:{},finalize:U},F=me,kt=[],ht=0,qt=[];function N(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=F;if(typeof e!="function"){if(e!==De)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&rr(this,this._value))}this._state=null,this._value=null,++t.ref,function n(a,s){try{s(function(l){if(a._state===null){if(l===a)throw new TypeError("A promise cannot be resolved with itself.");var h=a._lib&&It();l&&typeof l.then=="function"?n(a,function(m,b){l instanceof N?l._then(m,b):l.then(m,b)}):(a._state=!0,a._value=l,hr(a)),h&&Wt()}},rr.bind(null,a))}catch(l){rr(a,l)}}(this,e)}var Gt={get:function(){var e=F,t=Ft;function n(a,s){var l=this,h=!e.global&&(e!==F||t!==Ft),m=h&&!Kt(),b=new N(function(k,C){cr(l,new Qt(Cr(a,e,h,m),Cr(s,e,h,m),k,C,e))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return n.prototype=De,n},set:function(e){X(this,"then",e&&e.prototype===De?Gt:{get:function(){return e},set:Gt.set})}};function Qt(e,t,n,a,s){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=a,this.psd=s}function rr(e,t){var n,a;Rt.push(t),e._state===null&&(n=e._lib&&It(),t=Ke(t),e._state=!1,e._value=t,a=e,yt.some(function(s){return s._value===a._value})||yt.push(a),hr(e),n&&Wt())}function hr(e){var t=e._listeners;e._listeners=[];for(var n=0,a=t.length;n<a;++n)cr(e,t[n]);var s=e._PSD;--s.ref||s.finalize(),ht===0&&(++ht,ft(function(){--ht==0&&Be()},[]))}function cr(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++ht,ft(xr,[n,e,t])}else e._listeners.push(t)}function xr(e,t,n){try{var a,s=t._value;!t._state&&Rt.length&&(Rt=[]),a=z&&t._consoleTask?t._consoleTask.run(function(){return e(s)}):e(s),t._state||Rt.indexOf(s)!==-1||function(l){for(var h=yt.length;h;)if(yt[--h]._value===l._value)return yt.splice(h,1)}(t),n.resolve(a)}catch(l){n.reject(l)}finally{--ht==0&&Be(),--n.psd.ref||n.psd.finalize()}}function rt(){zt(me,function(){It()&&Wt()})}function It(){var e=ot;return mt=ot=!1,e}function Wt(){var e,t,n;do for(;0<kt.length;)for(e=kt,kt=[],n=e.length,t=0;t<n;++t){var a=e[t];a[0].apply(null,a[1])}while(0<kt.length);mt=ot=!0}function Be(){var e=yt;yt=[],e.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)});for(var t=qt.slice(0),n=t.length;n;)t[--n]()}function Ge(e){return new N(De,!1,e)}function Ee(e,t){var n=F;return function(){var a=It(),s=F;try{return Zt(n,!0),e.apply(this,arguments)}catch(l){t&&t(l)}finally{Zt(s,!1),a&&Wt()}}}W(N.prototype,{then:Gt,_then:function(e,t){cr(this,new Qt(null,null,e,t,F))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t=="function"?this.then(null,function(a){return(a instanceof t?n:Ge)(a)}):this.then(null,function(a){return(a&&a.name===t?n:Ge)(a)})},finally:function(e){return this.then(function(t){return N.resolve(e()).then(function(){return t})},function(t){return N.resolve(e()).then(function(){return Ge(t)})})},timeout:function(e,t){var n=this;return e<1/0?new N(function(a,s){var l=setTimeout(function(){return s(new J.Timeout(t))},e);n.then(a,s).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&X(N.prototype,Symbol.toStringTag,"Dexie.Promise"),me.env=Yr(),W(N,{all:function(){var e=se.apply(null,arguments).map(Jt);return new N(function(t,n){e.length===0&&t([]);var a=e.length;e.forEach(function(s,l){return N.resolve(s).then(function(h){e[l]=h,--a||t(e)},n)})})},resolve:function(e){return e instanceof N?e:e&&typeof e.then=="function"?new N(function(t,n){e.then(t,n)}):new N(De,!0,e)},reject:Ge,race:function(){var e=se.apply(null,arguments).map(Jt);return new N(function(t,n){e.map(function(a){return N.resolve(a).then(t,n)})})},PSD:{get:function(){return F},set:function(e){return F=e}},totalEchoes:{get:function(){return Ft}},newPSD:Xt,usePSD:zt,scheduler:{get:function(){return ft},set:function(e){ft=e}},rejectionMapper:{get:function(){return Ke},set:function(e){Ke=e}},follow:function(e,t){return new N(function(n,a){return Xt(function(s,l){var h=F;h.unhandleds=[],h.onunhandled=l,h.finalize=qe(function(){var m,b=this;m=function(){b.unhandleds.length===0?s():l(b.unhandleds[0])},qt.push(function k(){m(),qt.splice(qt.indexOf(k),1)}),++ht,ft(function(){--ht==0&&Be()},[])},h.finalize),e()},t,n,a)})}}),Oe&&(Oe.allSettled&&X(N,"allSettled",function(){var e=se.apply(null,arguments).map(Jt);return new N(function(t){e.length===0&&t([]);var n=e.length,a=new Array(n);e.forEach(function(s,l){return N.resolve(s).then(function(h){return a[l]={status:"fulfilled",value:h}},function(h){return a[l]={status:"rejected",reason:h}}).then(function(){return--n||t(a)})})})}),Oe.any&&typeof AggregateError<"u"&&X(N,"any",function(){var e=se.apply(null,arguments).map(Jt);return new N(function(t,n){e.length===0&&n(new AggregateError([]));var a=e.length,s=new Array(a);e.forEach(function(l,h){return N.resolve(l).then(function(m){return t(m)},function(m){s[h]=m,--a||n(new AggregateError(s))})})})}),Oe.withResolvers&&(N.withResolvers=Oe.withResolvers));var Qe={awaits:0,echoes:0,id:0},xt=0,Ot=[],Dt=0,Ft=0,Sr=0;function Xt(e,t,n,a){var s=F,l=Object.create(s);return l.parent=s,l.ref=0,l.global=!1,l.id=++Sr,me.env,l.env=Pt?{Promise:N,PromiseProp:{value:N,configurable:!0,writable:!0},all:N.all,race:N.race,allSettled:N.allSettled,any:N.any,resolve:N.resolve,reject:N.reject}:{},t&&q(l,t),++s.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},a=zt(l,e,n,a),l.ref===0&&l.finalize(),a}function lr(){return Qe.id||(Qe.id=++xt),++Qe.awaits,Qe.echoes+=he,Qe.id}function Kt(){return!!Qe.awaits&&(--Qe.awaits==0&&(Qe.id=0),Qe.echoes=Qe.awaits*he,!0)}function Jt(e){return Qe.echoes&&e&&e.constructor===Oe?(lr(),e.then(function(t){return Kt(),t},function(t){return Kt(),jt(t)})):e}function Kr(){var e=Ot[Ot.length-1];Ot.pop(),Zt(e,!1)}function Zt(e,t){var n,a=F;(t?!Qe.echoes||Dt++&&e===F:!Dt||--Dt&&e===F)||queueMicrotask(t?(function(s){++Ft,Qe.echoes&&--Qe.echoes!=0||(Qe.echoes=Qe.awaits=Qe.id=0),Ot.push(F),Zt(s,!0)}).bind(null,e):Kr),e!==F&&(F=e,a===me&&(me.env=Yr()),Pt&&(n=me.env.Promise,t=e.env,(a.global||e.global)&&(Object.defineProperty(g,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function Yr(){var e=g.Promise;return Pt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(g,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function zt(e,t,n,a,s){var l=F;try{return Zt(e,!0),t(n,a,s)}finally{Zt(l,!1)}}function Cr(e,t,n,a){return typeof e!="function"?e:function(){var s=F;n&&lr(),Zt(t,!0);try{return e.apply(this,arguments)}finally{Zt(s,!1),a&&queueMicrotask(Kt)}}}function dn(e){Promise===Oe&&Qe.echoes===0?Dt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+ur).indexOf("[native code]")===-1&&(lr=Kt=U);var jt=N.reject,Pr="ï¿¿",Ar="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Na="String expected.",Qr=[],Cn="__dbnames",Jn="readonly",Zn="readwrite";function Nr(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Ba={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Pn(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=Te(t))[e],t}}function La(){throw J.Type()}function Je(e,t){try{var n=za(e),a=za(t);if(n!==a)return n==="Array"?1:a==="Array"?-1:n==="binary"?1:a==="binary"?-1:n==="string"?1:a==="string"?-1:n==="Date"?1:a!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(s,l){for(var h=s.length,m=l.length,b=h<m?h:m,k=0;k<b;++k)if(s[k]!==l[k])return s[k]<l[k]?-1:1;return h===m?0:h<m?-1:1}(Ua(e),Ua(t));case"Array":return function(s,l){for(var h=s.length,m=l.length,b=h<m?h:m,k=0;k<b;++k){var C=Je(s[k],l[k]);if(C!==0)return C}return h===m?0:h<m?-1:1}(e,t)}}catch{}return NaN}function za(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=et(e),e==="ArrayBuffer"?"binary":e)}function Ua(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Ha=(At.prototype._trans=function(e,t,n){var a=this._tx||F.trans,s=this.name,l=z&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function h(k,C,_){if(!_.schema[s])throw new J.NotFound("Table "+s+" not part of transaction");return t(_.idbtrans,_)}var m=It();try{var b=a&&a.db._novip===this.db._novip?a===F.trans?a._promise(e,h,n):Xt(function(){return a._promise(e,h,n)},{trans:a,transless:F.transless||F}):function k(C,_,E,w){if(C.idbdb&&(C._state.openComplete||F.letThrough||C._vip)){var S=C._createTransaction(_,E,C._dbSchema);try{S.create(),C._state.PR1398_maxLoop=3}catch(A){return A.name===_t.InvalidState&&C.isOpen()&&0<--C._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),C.close({disableAutoOpen:!1}),C.open().then(function(){return k(C,_,E,w)})):jt(A)}return S._promise(_,function(A,x){return Xt(function(){return F.trans=S,w(A,x,S)})}).then(function(A){if(_==="readwrite")try{S.idbtrans.commit()}catch{}return _==="readonly"?A:S._completion.then(function(){return A})})}if(C._state.openComplete)return jt(new J.DatabaseClosed(C._state.dbOpenError));if(!C._state.isBeingOpened){if(!C._state.autoOpen)return jt(new J.DatabaseClosed);C.open().catch(U)}return C._state.dbReadyPromise.then(function(){return k(C,_,E,w)})}(this.db,e,[this.name],h);return l&&(b._consoleTask=l,b=b.catch(function(k){return console.trace(k),jt(k)})),b}finally{m&&Wt()}},At.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?jt(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(a){return n.core.get({trans:a,key:e}).then(function(s){return n.hook.reading.fire(s)})}).then(t)},At.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(P(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=y(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(m){if(m.compound&&t.every(function(k){return 0<=m.keyPath.indexOf(k)})){for(var b=0;b<t.length;++b)if(t.indexOf(m.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(m,b){return m.keyPath.length-b.keyPath.length})[0];if(n&&this.db._maxKey!==Pr){var l=n.keyPath.slice(0,t.length);return this.where(l).equals(l.map(function(b){return e[b]}))}!n&&z&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var a=this.schema.idxByName;function s(m,b){return Je(m,b)===0}var h=t.reduce(function(_,b){var k=_[0],C=_[1],_=a[b],E=e[b];return[k||_,k||!_?Nr(C,_&&_.multi?function(w){return w=V(w,b),P(w)&&w.some(function(S){return s(E,S)})}:function(w){return s(E,V(w,b))}):C]},[null,null]),l=h[0],h=h[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(h):n?this.filter(h):this.where(t).equals("")},At.prototype.filter=function(e){return this.toCollection().and(e)},At.prototype.count=function(e){return this.toCollection().count(e)},At.prototype.offset=function(e){return this.toCollection().offset(e)},At.prototype.limit=function(e){return this.toCollection().limit(e)},At.prototype.each=function(e){return this.toCollection().each(e)},At.prototype.toArray=function(e){return this.toCollection().toArray(e)},At.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},At.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,P(e)?"[".concat(e.join("+"),"]"):e))},At.prototype.reverse=function(){return this.toCollection().reverse()},At.prototype.mapToClass=function(e){var t,n=this.db,a=this.name;function s(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof La&&(function(b,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function C(){this.constructor=b}i(b,k),b.prototype=k===null?Object.create(k):(C.prototype=k.prototype,new C)}(s,t=e),Object.defineProperty(s.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),s.prototype.table=function(){return a},e=s);for(var l=new Set,h=e.prototype;h;h=R(h))Object.getOwnPropertyNames(h).forEach(function(b){return l.add(b)});function m(b){if(!b)return b;var k,C=Object.create(e.prototype);for(k in b)if(!l.has(k))try{C[k]=b[k]}catch{}return C}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=m,this.hook("reading",m),e},At.prototype.defineClass=function(){return this.mapToClass(function(e){q(this,e)})},At.prototype.add=function(e,t){var n=this,a=this.schema.primKey,s=a.auto,l=a.keyPath,h=e;return l&&s&&(h=Pn(l)(e)),this._trans("readwrite",function(m){return n.core.mutate({trans:m,type:"add",keys:t!=null?[t]:null,values:[h]})}).then(function(m){return m.numFailures?N.reject(m.failures[0]):m.lastResult}).then(function(m){if(l)try{ne(e,l,m)}catch{}return m})},At.prototype.update=function(e,t){return typeof e!="object"||P(e)?this.where(":id").equals(e).modify(t):(e=V(e,this.schema.primKey.keyPath),e===void 0?jt(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},At.prototype.put=function(e,t){var n=this,a=this.schema.primKey,s=a.auto,l=a.keyPath,h=e;return l&&s&&(h=Pn(l)(e)),this._trans("readwrite",function(m){return n.core.mutate({trans:m,type:"put",values:[h],keys:t!=null?[t]:null})}).then(function(m){return m.numFailures?N.reject(m.failures[0]):m.lastResult}).then(function(m){if(l)try{ne(e,l,m)}catch{}return m})},At.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})}).then(function(n){return n.numFailures?N.reject(n.failures[0]):void 0})},At.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Ba})}).then(function(t){return t.numFailures?N.reject(t.failures[0]):void 0})},At.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(a){return a.map(function(s){return t.hook.reading.fire(s)})})})},At.prototype.bulkAdd=function(e,t,n){var a=this,s=Array.isArray(t)?t:void 0,l=(n=n||(s?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(h){var k=a.schema.primKey,m=k.auto,k=k.keyPath;if(k&&s)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var b=e.length,k=k&&m?e.map(Pn(k)):e;return a.core.mutate({trans:h,type:"add",keys:s,values:k,wantResults:l}).then(function(S){var _=S.numFailures,E=S.results,w=S.lastResult,S=S.failures;if(_===0)return l?E:w;throw new st("".concat(a.name,".bulkAdd(): ").concat(_," of ").concat(b," operations failed"),S)})})},At.prototype.bulkPut=function(e,t,n){var a=this,s=Array.isArray(t)?t:void 0,l=(n=n||(s?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(h){var k=a.schema.primKey,m=k.auto,k=k.keyPath;if(k&&s)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var b=e.length,k=k&&m?e.map(Pn(k)):e;return a.core.mutate({trans:h,type:"put",keys:s,values:k,wantResults:l}).then(function(S){var _=S.numFailures,E=S.results,w=S.lastResult,S=S.failures;if(_===0)return l?E:w;throw new st("".concat(a.name,".bulkPut(): ").concat(_," of ").concat(b," operations failed"),S)})})},At.prototype.bulkUpdate=function(e){var t=this,n=this.core,a=e.map(function(h){return h.key}),s=e.map(function(h){return h.changes}),l=[];return this._trans("readwrite",function(h){return n.getMany({trans:h,keys:a,cache:"clone"}).then(function(m){var b=[],k=[];e.forEach(function(_,E){var w=_.key,S=_.changes,A=m[E];if(A){for(var x=0,M=Object.keys(S);x<M.length;x++){var j=M[x],T=S[j];if(j===t.schema.primKey.keyPath){if(Je(T,w)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else ne(A,j,T)}l.push(E),b.push(w),k.push(A)}});var C=b.length;return n.mutate({trans:h,type:"put",keys:b,values:k,updates:{keys:a,changeSpecs:s}}).then(function(_){var E=_.numFailures,w=_.failures;if(E===0)return C;for(var S=0,A=Object.keys(w);S<A.length;S++){var x,M=A[S],j=l[Number(M)];j!=null&&(x=w[M],delete w[M],w[j]=x)}throw new st("".concat(t.name,".bulkUpdate(): ").concat(E," of ").concat(C," operations failed"),w)})})})},At.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(a){return t.core.mutate({trans:a,type:"delete",keys:e})}).then(function(h){var s=h.numFailures,l=h.lastResult,h=h.failures;if(s===0)return l;throw new st("".concat(t.name,".bulkDelete(): ").concat(s," of ").concat(n," operations failed"),h)})},At);function At(){}function vn(e){function t(h,m){if(m){for(var b=arguments.length,k=new Array(b-1);--b;)k[b-1]=arguments[b];return n[h].subscribe.apply(null,k),e}if(typeof h=="string")return n[h]}var n={};t.addEventType=l;for(var a=1,s=arguments.length;a<s;++a)l(arguments[a]);return t;function l(h,m,b){if(typeof h!="object"){var k;m=m||wt;var C={subscribers:[],fire:b=b||U,subscribe:function(_){C.subscribers.indexOf(_)===-1&&(C.subscribers.push(_),C.fire=m(C.fire,_))},unsubscribe:function(_){C.subscribers=C.subscribers.filter(function(E){return E!==_}),C.fire=C.subscribers.reduce(m,b)}};return n[h]=t[h]=C}y(k=h).forEach(function(_){var E=k[_];if(P(E))l(_,k[_][0],k[_][1]);else{if(E!=="asap")throw new J.InvalidArgument("Invalid event config");var w=l(_,Ae,function(){for(var S=arguments.length,A=new Array(S);S--;)A[S]=arguments[S];w.subscribers.forEach(function(x){ke(function(){x.apply(null,A)})})})}})}}function fn(e,t){return ee(t).from({prototype:e}),t}function Jr(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function ea(e,t){e.filter=Nr(e.filter,t)}function ta(e,t,n){var a=e.replayFilter;e.replayFilter=a?function(){return Nr(a(),t())}:t,e.justLimit=n&&!a}function An(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new J.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Va(e,t,n){var a=An(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:a,range:e.range}})}function En(e,t,n,a){var s=e.replayFilter?Nr(e.filter,e.replayFilter()):e.filter;if(e.or){var l={},h=function(m,b,k){var C,_;s&&!s(b,k,function(E){return b.stop(E)},function(E){return b.fail(E)})||((_=""+(C=b.primaryKey))=="[object ArrayBuffer]"&&(_=""+new Uint8Array(C)),K(l,_)||(l[_]=!0,t(m,b,k)))};return Promise.all([e.or._iterate(h,n),Ga(Va(e,a,n),e.algorithm,h,!e.keysOnly&&e.valueMapper)])}return Ga(Va(e,a,n),Nr(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Ga(e,t,n,a){var s=Ee(a?function(l,h,m){return n(a(l),h,m)}:n);return e.then(function(l){if(l)return l.start(function(){var h=function(){return l.continue()};t&&!t(l,function(m){return h=m},function(m){l.stop(m),h=U},function(m){l.fail(m),h=U})||s(l.value,l,function(m){return h=m}),h()})})}var hn=(Wa.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var n=t.add;if(P(n))return f(f([],P(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(t.remove!==void 0){var a=t.remove;if(P(a))return P(e)?e.filter(function(s){return!a.includes(s)}).sort():[];if(typeof a=="number")return Number(e)-a;if(typeof a=="bigint")try{return BigInt(e)-a}catch{return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return n=(n=t.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e},Wa);function Wa(e){this["@@propmod"]=e}var Wi=(nt.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,jt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},nt.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,jt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},nt.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Nr(t.algorithm,e)},nt.prototype._iterate=function(e,t){return En(this._ctx,e,t,this._ctx.table.core)},nt.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&q(n,e),t._ctx=n,t},nt.prototype.raw=function(){return this._ctx.valueMapper=null,this},nt.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return En(t,e,n,t.table.core)})},nt.prototype.count=function(e){var t=this;return this._read(function(n){var a=t._ctx,s=a.table.core;if(Jr(a,!0))return s.count({trans:n,query:{index:An(a,s.schema),range:a.range}}).then(function(h){return Math.min(h,a.limit)});var l=0;return En(a,function(){return++l,!1},n,s).then(function(){return l})}).then(e)},nt.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),a=n[0],s=n.length-1;function l(b,k){return k?l(b[n[k]],k-1):b[a]}var h=this._ctx.dir==="next"?1:-1;function m(b,k){return Je(l(b,s),l(k,s))*h}return this.toArray(function(b){return b.sort(m)}).then(t)},nt.prototype.toArray=function(e){var t=this;return this._read(function(n){var a=t._ctx;if(a.dir==="next"&&Jr(a,!0)&&0<a.limit){var s=a.valueMapper,l=An(a,a.table.core.schema);return a.table.core.query({trans:n,limit:a.limit,values:!0,query:{index:l,range:a.range}}).then(function(m){return m=m.result,s?m.map(s):m})}var h=[];return En(a,function(m){return h.push(m)},n,a.table.core).then(function(){return h})},e)},nt.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Jr(t)?ta(t,function(){var n=e;return function(a,s){return n===0||(n===1?--n:s(function(){a.advance(n),n=0}),!1)}}):ta(t,function(){var n=e;return function(){return--n<0}})),this},nt.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),ta(this._ctx,function(){var t=e;return function(n,a,s){return--t<=0&&a(s),0<=t}},!0),this},nt.prototype.until=function(e,t){return ea(this._ctx,function(n,a,s){return!e(n.value)||(a(s),t)}),this},nt.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},nt.prototype.last=function(e){return this.reverse().first(e)},nt.prototype.filter=function(e){var t;return ea(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=Nr(t.isMatch,e),this},nt.prototype.and=function(e){return this.filter(e)},nt.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},nt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},nt.prototype.desc=function(){return this.reverse()},nt.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,a){e(a.key,a)})},nt.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},nt.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,a){e(a.primaryKey,a)})},nt.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(a,s){n.push(s.key)}).then(function(){return n}).then(e)},nt.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Jr(t,!0)&&0<t.limit)return this._read(function(a){var s=An(t,t.table.core.schema);return t.table.core.query({trans:a,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(function(a){return a.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(a,s){n.push(s.primaryKey)}).then(function(){return n}).then(e)},nt.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},nt.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},nt.prototype.lastKey=function(e){return this.reverse().firstKey(e)},nt.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return ea(this._ctx,function(s){var a=s.primaryKey.toString(),s=K(t,a);return t[a]=!0,!s}),this},nt.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(a){var s,l,h;h=typeof e=="function"?e:(s=y(e),l=s.length,function(x){for(var M=!1,j=0;j<l;++j){var T=s[j],O=e[T],B=V(x,T);O instanceof hn?(ne(x,T,O.execute(B)),M=!0):B!==O&&(ne(x,T,O),M=!0)}return M});var m=n.table.core,_=m.schema.primaryKey,b=_.outbound,k=_.extractKey,C=200,_=t.db._options.modifyChunkSize;_&&(C=typeof _=="object"?_[m.name]||_["*"]||200:_);function E(x,T){var j=T.failures,T=T.numFailures;S+=x-T;for(var O=0,B=y(j);O<B.length;O++){var Q=B[O];w.push(j[Q])}}var w=[],S=0,A=[];return t.clone().primaryKeys().then(function(x){function M(T){var O=Math.min(C,x.length-T);return m.getMany({trans:a,keys:x.slice(T,T+O),cache:"immutable"}).then(function(B){for(var Q=[],L=[],H=b?[]:null,Z=[],Y=0;Y<O;++Y){var ae=B[Y],Ne={value:Te(ae),primKey:x[T+Y]};h.call(Ne,Ne.value,Ne)!==!1&&(Ne.value==null?Z.push(x[T+Y]):b||Je(k(ae),k(Ne.value))===0?(L.push(Ne.value),b&&H.push(x[T+Y])):(Z.push(x[T+Y]),Q.push(Ne.value)))}return Promise.resolve(0<Q.length&&m.mutate({trans:a,type:"add",values:Q}).then(function(Ue){for(var He in Ue.failures)Z.splice(parseInt(He),1);E(Q.length,Ue)})).then(function(){return(0<L.length||j&&typeof e=="object")&&m.mutate({trans:a,type:"put",keys:H,values:L,criteria:j,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<T}).then(function(Ue){return E(L.length,Ue)})}).then(function(){return(0<Z.length||j&&e===ra)&&m.mutate({trans:a,type:"delete",keys:Z,criteria:j,isAdditionalChunk:0<T}).then(function(Ue){return E(Z.length,Ue)})}).then(function(){return x.length>T+O&&M(T+C)})})}var j=Jr(n)&&n.limit===1/0&&(typeof e!="function"||e===ra)&&{index:n.index,range:n.range};return M(0).then(function(){if(0<w.length)throw new vt("Error modifying one or more objects",w,S,A);return x.length})})})},nt.prototype.delete=function(){var e=this._ctx,t=e.range;return Jr(e)&&(e.isPrimKey||t.type===3)?this._write(function(n){var a=e.table.core.schema.primaryKey,s=t;return e.table.core.count({trans:n,query:{index:a,range:s}}).then(function(l){return e.table.core.mutate({trans:n,type:"deleteRange",range:s}).then(function(h){var m=h.failures;if(h.lastResult,h.results,h=h.numFailures,h)throw new vt("Could not delete some values",Object.keys(m).map(function(b){return m[b]}),l-h);return l-h})})}):this.modify(ra)},nt);function nt(){}var ra=function(e,t){return t.value=null};function Xi(e,t){return e<t?-1:e===t?0:1}function Yi(e,t){return t<e?-1:e===t?0:1}function nr(e,t,n){return e=e instanceof Ya?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function Zr(e){return new e.Collection(e,function(){return Xa("")}).limit(0)}function Mn(e,t,n,a){var s,l,h,m,b,k,C,_=n.length;if(!n.every(function(S){return typeof S=="string"}))return nr(e,Na);function E(S){s=S==="next"?function(x){return x.toUpperCase()}:function(x){return x.toLowerCase()},l=S==="next"?function(x){return x.toLowerCase()}:function(x){return x.toUpperCase()},h=S==="next"?Xi:Yi;var A=n.map(function(x){return{lower:l(x),upper:s(x)}}).sort(function(x,M){return h(x.lower,M.lower)});m=A.map(function(x){return x.upper}),b=A.map(function(x){return x.lower}),C=(k=S)==="next"?"":a}E("next"),e=new e.Collection(e,function(){return jr(m[0],b[_-1]+a)}),e._ondirectionchange=function(S){E(S)};var w=0;return e._addAlgorithm(function(S,A,x){var M=S.key;if(typeof M!="string")return!1;var j=l(M);if(t(j,b,w))return!0;for(var T=null,O=w;O<_;++O){var B=function(Q,L,H,Z,Y,ae){for(var Ne=Math.min(Q.length,Z.length),Ue=-1,He=0;He<Ne;++He){var ar=L[He];if(ar!==Z[He])return Y(Q[He],H[He])<0?Q.substr(0,He)+H[He]+H.substr(He+1):Y(Q[He],Z[He])<0?Q.substr(0,He)+Z[He]+H.substr(He+1):0<=Ue?Q.substr(0,Ue)+L[Ue]+H.substr(Ue+1):null;Y(Q[He],ar)<0&&(Ue=He)}return Ne<Z.length&&ae==="next"?Q+H.substr(Q.length):Ne<Q.length&&ae==="prev"?Q.substr(0,H.length):Ue<0?null:Q.substr(0,Ue)+Z[Ue]+H.substr(Ue+1)}(M,j,m[O],b[O],h,k);B===null&&T===null?w=O+1:(T===null||0<h(T,B))&&(T=B)}return A(T!==null?function(){S.continue(T+C)}:x),!1}),e}function jr(e,t,n,a){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:a}}function Xa(e){return{type:1,lower:e,upper:e}}var Ya=(Object.defineProperty(Bt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Bt.prototype.between=function(e,t,n,a){n=n!==!1,a=a===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||a)&&(!n||!a)?Zr(this):new this.Collection(this,function(){return jr(e,t,!n,!a)})}catch{return nr(this,Ar)}},Bt.prototype.equals=function(e){return e==null?nr(this,Ar):new this.Collection(this,function(){return Xa(e)})},Bt.prototype.above=function(e){return e==null?nr(this,Ar):new this.Collection(this,function(){return jr(e,void 0,!0)})},Bt.prototype.aboveOrEqual=function(e){return e==null?nr(this,Ar):new this.Collection(this,function(){return jr(e,void 0,!1)})},Bt.prototype.below=function(e){return e==null?nr(this,Ar):new this.Collection(this,function(){return jr(void 0,e,!1,!0)})},Bt.prototype.belowOrEqual=function(e){return e==null?nr(this,Ar):new this.Collection(this,function(){return jr(void 0,e)})},Bt.prototype.startsWith=function(e){return typeof e!="string"?nr(this,Na):this.between(e,e+Pr,!0,!0)},Bt.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Mn(this,function(t,n){return t.indexOf(n[0])===0},[e],Pr)},Bt.prototype.equalsIgnoreCase=function(e){return Mn(this,function(t,n){return t===n[0]},[e],"")},Bt.prototype.anyOfIgnoreCase=function(){var e=se.apply(tt,arguments);return e.length===0?Zr(this):Mn(this,function(t,n){return n.indexOf(t)!==-1},e,"")},Bt.prototype.startsWithAnyOfIgnoreCase=function(){var e=se.apply(tt,arguments);return e.length===0?Zr(this):Mn(this,function(t,n){return n.some(function(a){return t.indexOf(a)===0})},e,Pr)},Bt.prototype.anyOf=function(){var e=this,t=se.apply(tt,arguments),n=this._cmp;try{t.sort(n)}catch{return nr(this,Ar)}if(t.length===0)return Zr(this);var a=new this.Collection(this,function(){return jr(t[0],t[t.length-1])});a._ondirectionchange=function(l){n=l==="next"?e._ascending:e._descending,t.sort(n)};var s=0;return a._addAlgorithm(function(l,h,m){for(var b=l.key;0<n(b,t[s]);)if(++s===t.length)return h(m),!1;return n(b,t[s])===0||(h(function(){l.continue(t[s])}),!1)}),a},Bt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Bt.prototype.noneOf=function(){var e=se.apply(tt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return nr(this,Ar)}var t=e.reduce(function(n,a){return n?n.concat([[n[n.length-1][1],a]]):[[-1/0,a]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Bt.prototype.inAnyRange=function(M,t){var n=this,a=this._cmp,s=this._ascending,l=this._descending,h=this._min,m=this._max;if(M.length===0)return Zr(this);if(!M.every(function(j){return j[0]!==void 0&&j[1]!==void 0&&s(j[0],j[1])<=0}))return nr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var b=!t||t.includeLowers!==!1,k=t&&t.includeUppers===!0,C,_=s;function E(j,T){return _(j[0],T[0])}try{(C=M.reduce(function(j,T){for(var O=0,B=j.length;O<B;++O){var Q=j[O];if(a(T[0],Q[1])<0&&0<a(T[1],Q[0])){Q[0]=h(Q[0],T[0]),Q[1]=m(Q[1],T[1]);break}}return O===B&&j.push(T),j},[])).sort(E)}catch{return nr(this,Ar)}var w=0,S=k?function(j){return 0<s(j,C[w][1])}:function(j){return 0<=s(j,C[w][1])},A=b?function(j){return 0<l(j,C[w][0])}:function(j){return 0<=l(j,C[w][0])},x=S,M=new this.Collection(this,function(){return jr(C[0][0],C[C.length-1][1],!b,!k)});return M._ondirectionchange=function(j){_=j==="next"?(x=S,s):(x=A,l),C.sort(E)},M._addAlgorithm(function(j,T,O){for(var B,Q=j.key;x(Q);)if(++w===C.length)return T(O),!1;return!S(B=Q)&&!A(B)||(n._cmp(Q,C[w][1])===0||n._cmp(Q,C[w][0])===0||T(function(){_===s?j.continue(C[w][0]):j.continue(C[w][1])}),!1)}),M},Bt.prototype.startsWithAnyOf=function(){var e=se.apply(tt,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?Zr(this):this.inAnyRange(e.map(function(t){return[t,t+Pr]})):nr(this,"startsWithAnyOf() only works with strings")},Bt);function Bt(){}function pr(e){return Ee(function(t){return pn(t),e(t.target.error),!1})}function pn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var mn="storagemutated",na="x-storagemutated-1",Tr=vn(null,mn),Qi=(mr.prototype._lock=function(){return Ce(!F.global),++this._reculock,this._reculock!==1||F.global||(F.lockOwnerFor=this),this},mr.prototype._unlock=function(){if(Ce(!F.global),--this._reculock==0)for(F.global||(F.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{zt(e[1],e[0])}catch{}}return this},mr.prototype._locked=function(){return this._reculock&&F.lockOwnerFor!==this},mr.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,a=this.db._state.dbOpenError;if(Ce(!this.idbtrans),!e&&!n)switch(a&&a.name){case"DatabaseClosedError":throw new J.DatabaseClosed(a);case"MissingAPIError":throw new J.MissingAPI(a.message,a);default:throw new J.OpenFailed(a)}if(!this.active)throw new J.TransactionInactive;return Ce(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ee(function(s){pn(s),t._reject(e.error)}),e.onabort=Ee(function(s){pn(s),t.active&&t._reject(new J.Abort(e.error)),t.active=!1,t.on("abort").fire(s)}),e.oncomplete=Ee(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Tr.storagemutated.fire(e.mutatedParts)}),this},mr.prototype._promise=function(e,t,n){var a=this;if(e==="readwrite"&&this.mode!=="readwrite")return jt(new J.ReadOnly("Transaction is readonly"));if(!this.active)return jt(new J.TransactionInactive);if(this._locked())return new N(function(l,h){a._blockedFuncs.push([function(){a._promise(e,t,n).then(l,h)},F])});if(n)return Xt(function(){var l=new N(function(h,m){a._lock();var b=t(h,m,a);b&&b.then&&b.then(h,m)});return l.finally(function(){return a._unlock()}),l._lib=!0,l});var s=new N(function(l,h){var m=t(l,h,a);m&&m.then&&m.then(l,h)});return s._lib=!0,s},mr.prototype._root=function(){return this.parent?this.parent._root():this},mr.prototype.waitFor=function(e){var t,n=this._root(),a=N.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return a}):(n._waitingFor=a,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function l(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=l)}());var s=n._waitingFor;return new N(function(l,h){a.then(function(m){return n._waitingQueue.push(Ee(l.bind(null,m)))},function(m){return n._waitingQueue.push(Ee(h.bind(null,m)))}).finally(function(){n._waitingFor===s&&(n._waitingFor=null)})})},mr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},mr.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(K(t,e))return t[e];var n=this.schema[e];if(!n)throw new J.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},mr);function mr(){}function aa(e,t,n,a,s,l,h){return{name:e,keyPath:t,unique:n,multi:a,auto:s,compound:l,src:(n&&!h?"&":"")+(a?"*":"")+(s?"++":"")+Qa(t)}}function Qa(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function ia(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(a=function(s){return[s.name,s]},n.reduce(function(s,l,h){return h=a(l,h),h&&(s[h[0]]=h[1]),s},{}))};var a}var yn=function(e){try{return e.only([[]]),yn=function(){return[[]]},[[]]}catch{return yn=function(){return Pr},Pr}};function sa(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return V(n,t)}:function(n){return V(n,e)};var t}function Ja(e){return[].slice.call(e)}var Ji=0;function gn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Zi(e,t,b){function a(x){if(x.type===3)return null;if(x.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var w=x.lower,S=x.upper,A=x.lowerOpen,x=x.upperOpen;return w===void 0?S===void 0?null:t.upperBound(S,!!x):S===void 0?t.lowerBound(w,!!A):t.bound(w,S,!!A,!!x)}function s(E){var w,S=E.name;return{name:S,schema:E,mutate:function(A){var x=A.trans,M=A.type,j=A.keys,T=A.values,O=A.range;return new Promise(function(B,Q){B=Ee(B);var L=x.objectStore(S),H=L.keyPath==null,Z=M==="put"||M==="add";if(!Z&&M!=="delete"&&M!=="deleteRange")throw new Error("Invalid operation type: "+M);var Y,ae=(j||T||{length:1}).length;if(j&&T&&j.length!==T.length)throw new Error("Given keys array must have same length as given values array.");if(ae===0)return B({numFailures:0,failures:{},results:[],lastResult:void 0});function Ne(Yt){++ar,pn(Yt)}var Ue=[],He=[],ar=0;if(M==="deleteRange"){if(O.type===4)return B({numFailures:ar,failures:He,results:[],lastResult:void 0});O.type===3?Ue.push(Y=L.clear()):Ue.push(Y=L.delete(a(O)))}else{var H=Z?H?[T,j]:[T,null]:[j,null],$e=H[0],Ht=H[1];if(Z)for(var Vt=0;Vt<ae;++Vt)Ue.push(Y=Ht&&Ht[Vt]!==void 0?L[M]($e[Vt],Ht[Vt]):L[M]($e[Vt])),Y.onerror=Ne;else for(Vt=0;Vt<ae;++Vt)Ue.push(Y=L[M]($e[Vt])),Y.onerror=Ne}function Ln(Yt){Yt=Yt.target.result,Ue.forEach(function(zr,Sa){return zr.error!=null&&(He[Sa]=zr.error)}),B({numFailures:ar,failures:He,results:M==="delete"?j:Ue.map(function(zr){return zr.result}),lastResult:Yt})}Y.onerror=function(Yt){Ne(Yt),Ln(Yt)},Y.onsuccess=Ln})},getMany:function(A){var x=A.trans,M=A.keys;return new Promise(function(j,T){j=Ee(j);for(var O,B=x.objectStore(S),Q=M.length,L=new Array(Q),H=0,Z=0,Y=function(Ue){Ue=Ue.target,L[Ue._pos]=Ue.result,++Z===H&&j(L)},ae=pr(T),Ne=0;Ne<Q;++Ne)M[Ne]!=null&&((O=B.get(M[Ne]))._pos=Ne,O.onsuccess=Y,O.onerror=ae,++H);H===0&&j(L)})},get:function(A){var x=A.trans,M=A.key;return new Promise(function(j,T){j=Ee(j);var O=x.objectStore(S).get(M);O.onsuccess=function(B){return j(B.target.result)},O.onerror=pr(T)})},query:(w=k,function(A){return new Promise(function(x,M){x=Ee(x);var j,T,O,H=A.trans,B=A.values,Q=A.limit,Y=A.query,L=Q===1/0?void 0:Q,Z=Y.index,Y=Y.range,H=H.objectStore(S),Z=Z.isPrimaryKey?H:H.index(Z.name),Y=a(Y);if(Q===0)return x({result:[]});w?((L=B?Z.getAll(Y,L):Z.getAllKeys(Y,L)).onsuccess=function(ae){return x({result:ae.target.result})},L.onerror=pr(M)):(j=0,T=!B&&"openKeyCursor"in Z?Z.openKeyCursor(Y):Z.openCursor(Y),O=[],T.onsuccess=function(ae){var Ne=T.result;return Ne?(O.push(B?Ne.value:Ne.primaryKey),++j===Q?x({result:O}):void Ne.continue()):x({result:O})},T.onerror=pr(M))})}),openCursor:function(A){var x=A.trans,M=A.values,j=A.query,T=A.reverse,O=A.unique;return new Promise(function(B,Q){B=Ee(B);var Z=j.index,L=j.range,H=x.objectStore(S),H=Z.isPrimaryKey?H:H.index(Z.name),Z=T?O?"prevunique":"prev":O?"nextunique":"next",Y=!M&&"openKeyCursor"in H?H.openKeyCursor(a(L),Z):H.openCursor(a(L),Z);Y.onerror=pr(Q),Y.onsuccess=Ee(function(ae){var Ne,Ue,He,ar,$e=Y.result;$e?($e.___id=++Ji,$e.done=!1,Ne=$e.continue.bind($e),Ue=(Ue=$e.continuePrimaryKey)&&Ue.bind($e),He=$e.advance.bind($e),ar=function(){throw new Error("Cursor not stopped")},$e.trans=x,$e.stop=$e.continue=$e.continuePrimaryKey=$e.advance=function(){throw new Error("Cursor not started")},$e.fail=Ee(Q),$e.next=function(){var Ht=this,Vt=1;return this.start(function(){return Vt--?Ht.continue():Ht.stop()}).then(function(){return Ht})},$e.start=function(Ht){function Vt(){if(Y.result)try{Ht()}catch(Yt){$e.fail(Yt)}else $e.done=!0,$e.start=function(){throw new Error("Cursor behind last entry")},$e.stop()}var Ln=new Promise(function(Yt,zr){Yt=Ee(Yt),Y.onerror=pr(zr),$e.fail=zr,$e.stop=function(Sa){$e.stop=$e.continue=$e.continuePrimaryKey=$e.advance=ar,Yt(Sa)}});return Y.onsuccess=Ee(function(Yt){Y.onsuccess=Vt,Vt()}),$e.continue=Ne,$e.continuePrimaryKey=Ue,$e.advance=He,Vt(),Ln},B($e)):B(null)},Q)})},count:function(A){var x=A.query,M=A.trans,j=x.index,T=x.range;return new Promise(function(O,B){var Q=M.objectStore(S),L=j.isPrimaryKey?Q:Q.index(j.name),Q=a(T),L=Q?L.count(Q):L.count();L.onsuccess=Ee(function(H){return O(H.target.result)}),L.onerror=pr(B)})}}}var l,h,m,C=(h=b,m=Ja((l=e).objectStoreNames),{schema:{name:l.name,tables:m.map(function(E){return h.objectStore(E)}).map(function(E){var w=E.keyPath,x=E.autoIncrement,S=P(w),A={},x={name:E.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w==null,compound:S,keyPath:w,autoIncrement:x,unique:!0,extractKey:sa(w)},indexes:Ja(E.indexNames).map(function(M){return E.index(M)}).map(function(O){var j=O.name,T=O.unique,B=O.multiEntry,O=O.keyPath,B={name:j,compound:P(O),keyPath:O,unique:T,multiEntry:B,extractKey:sa(O)};return A[gn(O)]=B}),getIndexByKeyPath:function(M){return A[gn(M)]}};return A[":id"]=x.primaryKey,w!=null&&(A[gn(w)]=x.primaryKey),x})},hasGetAll:0<m.length&&"getAll"in h.objectStore(m[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),b=C.schema,k=C.hasGetAll,C=b.tables.map(s),_={};return C.forEach(function(E){return _[E.name]=E}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(E){if(!_[E])throw new Error("Table '".concat(E,"' not found"));return _[E]},MIN_KEY:-1/0,MAX_KEY:yn(t),schema:b}}function es(e,t,n,a){var s=n.IDBKeyRange;return n.indexedDB,{dbcore:(a=Zi(t,s,a),e.dbcore.reduce(function(l,h){return h=h.create,c(c({},l),h(l))},a))}}function In(e,a){var n=a.db,a=es(e._middlewares,n,e._deps,a);e.core=a.dbcore,e.tables.forEach(function(s){var l=s.name;e.core.schema.tables.some(function(h){return h.name===l})&&(s.core=e.core.table(l),e[l]instanceof e.Table&&(e[l].core=s.core))})}function jn(e,t,n,a){n.forEach(function(s){var l=a[s];t.forEach(function(h){var m=function b(k,C){return te(k,C)||(k=R(k))&&b(k,C)}(h,s);(!m||"value"in m&&m.value===void 0)&&(h===e.Transaction.prototype||h instanceof e.Transaction?X(h,s,{get:function(){return this.table(s)},set:function(b){ue(this,s,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):h[s]=new e.Table(s,l))})})}function oa(e,t){t.forEach(function(n){for(var a in n)n[a]instanceof e.Table&&delete n[a]})}function ts(e,t){return e._cfg.version-t._cfg.version}function rs(e,t,n,a){var s=e._dbSchema;n.objectStoreNames.contains("$meta")&&!s.$meta&&(s.$meta=ia("$meta",ei("")[0],[]),e._storeNames.push("$meta"));var l=e._createTransaction("readwrite",e._storeNames,s);l.create(n),l._completion.catch(a);var h=l._reject.bind(l),m=F.transless||F;Xt(function(){return F.trans=l,F.transless=m,t!==0?(In(e,n),k=t,((b=l).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(C){return C??k}):N.resolve(k)).then(function(C){return E=C,w=l,S=n,A=[],C=(_=e)._versions,x=_._dbSchema=Rn(0,_.idbdb,S),(C=C.filter(function(M){return M._cfg.version>=E})).length!==0?(C.forEach(function(M){A.push(function(){var j=x,T=M._cfg.dbschema;qn(_,j,S),qn(_,T,S),x=_._dbSchema=T;var O=ca(j,T);O.add.forEach(function(Z){la(S,Z[0],Z[1].primKey,Z[1].indexes)}),O.change.forEach(function(Z){if(Z.recreate)throw new J.Upgrade("Not yet support for changing primary key");var Y=S.objectStore(Z.name);Z.add.forEach(function(ae){return Tn(Y,ae)}),Z.change.forEach(function(ae){Y.deleteIndex(ae.name),Tn(Y,ae)}),Z.del.forEach(function(ae){return Y.deleteIndex(ae)})});var B=M._cfg.contentUpgrade;if(B&&M._cfg.version>E){In(_,S),w._memoizedTables={};var Q=Ie(T);O.del.forEach(function(Z){Q[Z]=j[Z]}),oa(_,[_.Transaction.prototype]),jn(_,[_.Transaction.prototype],y(Q),Q),w.schema=Q;var L,H=G(B);return H&&lr(),O=N.follow(function(){var Z;(L=B(w))&&H&&(Z=Kt.bind(null,null),L.then(Z,Z))}),L&&typeof L.then=="function"?N.resolve(L):O.then(function(){return L})}}),A.push(function(j){var T,O,B=M._cfg.dbschema;T=B,O=j,[].slice.call(O.db.objectStoreNames).forEach(function(Q){return T[Q]==null&&O.db.deleteObjectStore(Q)}),oa(_,[_.Transaction.prototype]),jn(_,[_.Transaction.prototype],_._storeNames,_._dbSchema),w.schema=_._dbSchema}),A.push(function(j){_.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(_.idbdb.version/10)===M._cfg.version?(_.idbdb.deleteObjectStore("$meta"),delete _._dbSchema.$meta,_._storeNames=_._storeNames.filter(function(T){return T!=="$meta"})):j.objectStore("$meta").put(M._cfg.version,"version"))})}),function M(){return A.length?N.resolve(A.shift()(w.idbtrans)).then(M):N.resolve()}().then(function(){Za(x,S)})):N.resolve();var _,E,w,S,A,x}).catch(h)):(y(s).forEach(function(C){la(n,C,s[C].primKey,s[C].indexes)}),In(e,n),void N.follow(function(){return e.on.populate.fire(l)}).catch(h));var b,k})}function ns(e,t){Za(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Rn(0,e.idbdb,t);qn(e,e._dbSchema,t);for(var a=0,s=ca(n,e._dbSchema).change;a<s.length;a++){var l=function(h){if(h.change.length||h.recreate)return console.warn("Unable to patch indexes of table ".concat(h.name," because it has changes on the type of index or primary key.")),{value:void 0};var m=t.objectStore(h.name);h.add.forEach(function(b){z&&console.debug("Dexie upgrade patch: Creating missing index ".concat(h.name,".").concat(b.src)),Tn(m,b)})}(s[a]);if(typeof l=="object")return l.value}}function ca(e,t){var n,a={del:[],add:[],change:[]};for(n in e)t[n]||a.del.push(n);for(n in t){var s=e[n],l=t[n];if(s){var h={name:n,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||s.primKey.auto!==l.primKey.auto)h.recreate=!0,a.change.push(h);else{var m=s.idxByName,b=l.idxByName,k=void 0;for(k in m)b[k]||h.del.push(k);for(k in b){var C=m[k],_=b[k];C?C.src!==_.src&&h.change.push(_):h.add.push(_)}(0<h.del.length||0<h.add.length||0<h.change.length)&&a.change.push(h)}}else a.add.push([n,l])}return a}function la(e,t,n,a){var s=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return a.forEach(function(l){return Tn(s,l)}),s}function Za(e,t){y(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(z&&console.debug("Dexie: Creating missing table",n),la(t,n,e[n].primKey,e[n].indexes))})}function Tn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Rn(e,t,n){var a={};return oe(t.objectStoreNames,0).forEach(function(s){for(var l=n.objectStore(s),h=aa(Qa(k=l.keyPath),k||"",!0,!1,!!l.autoIncrement,k&&typeof k!="string",!0),m=[],b=0;b<l.indexNames.length;++b){var C=l.index(l.indexNames[b]),k=C.keyPath,C=aa(C.name,k,!!C.unique,!!C.multiEntry,!1,k&&typeof k!="string",!1);m.push(C)}a[s]=ia(s,h,m)}),a}function qn(e,t,n){for(var a=n.db.objectStoreNames,s=0;s<a.length;++s){var l=a[s],h=n.objectStore(l);e._hasGetAll="getAll"in h;for(var m=0;m<h.indexNames.length;++m){var b=h.indexNames[m],k=h.index(b).keyPath,C=typeof k=="string"?k:"["+oe(k).join("+")+"]";!t[l]||(k=t[l].idxByName[C])&&(k.name=b,delete t[l].idxByName[C],t[l].idxByName[b]=k)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&g.WorkerGlobalScope&&g instanceof g.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function ei(e){return e.split(",").map(function(t,n){var a=(t=t.trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return aa(a,s||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),P(s),n===0)})}var as=(On.prototype._parseStoresSpec=function(e,t){y(e).forEach(function(n){if(e[n]!==null){var a=ei(e[n]),s=a.shift();if(s.unique=!0,s.multi)throw new J.Schema("Primary key cannot be multi-valued");a.forEach(function(l){if(l.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!l.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),t[n]=ia(n,s,a)}})},On.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?q(this._cfg.storesSource,n):n;var n=t._versions,a={},s={};return n.forEach(function(l){q(a,l._cfg.storesSource),s=l._cfg.dbschema={},l._parseStoresSpec(a,s)}),t._dbSchema=s,oa(t,[t._allTables,t,t.Transaction.prototype]),jn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],y(s),s),t._storeNames=y(s),this},On.prototype.upgrade=function(e){return this._cfg.contentUpgrade=ve(this._cfg.contentUpgrade||U,e),this},On);function On(){}function ua(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Er(Cn,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function da(e){return e&&typeof e.databases=="function"}function va(e){return Xt(function(){return F.letThrough=!0,e()})}function fa(e){return!("from"in e)}var Ut=function(e,t){if(!this){var n=new Ut;return e&&"d"in e&&q(n,e),n}q(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function _n(e,t,n){var a=Je(t,n);if(!isNaN(a)){if(0<a)throw RangeError();if(fa(e))return q(e,{from:t,to:n,d:1});var s=e.l,a=e.r;if(Je(n,e.from)<0)return s?_n(s,t,n):e.l={from:t,to:n,d:1,l:null,r:null},ri(e);if(0<Je(t,e.to))return a?_n(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},ri(e);Je(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),0<Je(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,s&&!e.l&&bn(e,s),a&&n&&bn(e,a)}}function bn(e,t){fa(t)||function n(a,b){var l=b.from,h=b.to,m=b.l,b=b.r;_n(a,l,h),m&&n(a,m),b&&n(a,b)}(e,t)}function ti(e,t){var n=Dn(t),a=n.next();if(a.done)return!1;for(var s=a.value,l=Dn(e),h=l.next(s.from),m=h.value;!a.done&&!h.done;){if(Je(m.from,s.to)<=0&&0<=Je(m.to,s.from))return!0;Je(s.from,m.from)<0?s=(a=n.next(m.from)).value:m=(h=l.next(s.from)).value}return!1}function Dn(e){var t=fa(e)?null:{s:0,n:e};return{next:function(n){for(var a=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,a)for(;t.n.l&&Je(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!a||Je(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function ri(e){var t,n,a=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),s=1<a?"r":a<-1?"l":"";s&&(t=s=="r"?"l":"r",n=c({},e),a=e[s],e.from=a.from,e.to=a.to,e[s]=a[s],n[s]=a[t],(e[t]=n).d=ni(n)),e.d=ni(e)}function ni(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function $n(e,t){return y(t).forEach(function(n){e[n]?bn(e[n],t[n]):e[n]=function a(s){var l,h,m={};for(l in s)K(s,l)&&(h=s[l],m[l]=!h||typeof h!="object"||dt.has(h.constructor)?h:a(h));return m}(t[n])}),e}function ha(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&ti(t[n],e[n])})}W(Ut.prototype,((ur={add:function(e){return bn(this,e),this},addKey:function(e){return _n(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return _n(t,n,n)}),this},hasKey:function(e){var t=Dn(this).next(e).value;return t&&Je(t.from,e)<=0&&0<=Je(t.to,e)}})[gt]=function(){return Dn(this)},ur));var Br={},pa={},ma=!1;function Fn(e){$n(pa,e),ma||(ma=!0,setTimeout(function(){ma=!1,ya(pa,!(pa={}))},0))}function ya(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var a=0,s=Object.values(Br);a<s.length;a++)ai(h=s[a],e,n,t);else for(var l in e){var h,m=/^idb\:\/\/(.*)\/(.*)\//.exec(l);m&&(l=m[1],m=m[2],(h=Br["idb://".concat(l,"/").concat(m)])&&ai(h,e,n,t))}n.forEach(function(b){return b()})}function ai(e,t,n,a){for(var s=[],l=0,h=Object.entries(e.queries.query);l<h.length;l++){for(var m=h[l],b=m[0],k=[],C=0,_=m[1];C<_.length;C++){var E=_[C];ha(t,E.obsSet)?E.subscribers.forEach(function(x){return n.add(x)}):a&&k.push(E)}a&&s.push([b,k])}if(a)for(var w=0,S=s;w<S.length;w++){var A=S[w],b=A[0],k=A[1];e.queries.query[b]=k}}function is(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?jt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var a=t.openCanceller,s=Math.round(10*e.verno),l=!1;function h(){if(t.openCanceller!==a)throw new J.DatabaseClosed("db.open() was cancelled")}function m(){return new N(function(E,w){if(h(),!n)throw new J.MissingAPI;var S=e.name,A=t.autoSchema||!s?n.open(S):n.open(S,s);if(!A)throw new J.MissingAPI;A.onerror=pr(w),A.onblocked=Ee(e._fireOnBlocked),A.onupgradeneeded=Ee(function(x){var M;C=A.transaction,t.autoSchema&&!e._options.allowEmptyDB?(A.onerror=pn,C.abort(),A.result.close(),(M=n.deleteDatabase(S)).onsuccess=M.onerror=Ee(function(){w(new J.NoSuchDatabase("Database ".concat(S," doesnt exist")))})):(C.onerror=pr(w),x=x.oldVersion>Math.pow(2,62)?0:x.oldVersion,_=x<1,e.idbdb=A.result,l&&ns(e,C),rs(e,x/10,C,w))},w),A.onsuccess=Ee(function(){C=null;var x,M,j,T,O,B=e.idbdb=A.result,Q=oe(B.objectStoreNames);if(0<Q.length)try{var L=B.transaction((T=Q).length===1?T[0]:T,"readonly");if(t.autoSchema)M=B,j=L,(x=e).verno=M.version/10,j=x._dbSchema=Rn(0,M,j),x._storeNames=oe(M.objectStoreNames,0),jn(x,[x._allTables],y(j),j);else if(qn(e,e._dbSchema,L),((O=ca(Rn(0,(O=e).idbdb,L),O._dbSchema)).add.length||O.change.some(function(H){return H.add.length||H.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),B.close(),s=B.version+1,l=!0,E(m());In(e,L)}catch{}Qr.push(e),B.onversionchange=Ee(function(H){t.vcFired=!0,e.on("versionchange").fire(H)}),B.onclose=Ee(function(H){e.on("close").fire(H)}),_&&(O=e._deps,L=S,B=O.indexedDB,O=O.IDBKeyRange,da(B)||L===Cn||ua(B,O).put({name:L}).catch(U)),E()},w)}).catch(function(E){switch(E?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),m();break;case"VersionError":if(0<s)return s=0,m()}return N.reject(E)})}var b,k=t.dbReadyResolve,C=null,_=!1;return N.race([a,(typeof navigator>"u"?N.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(E){function w(){return indexedDB.databases().finally(E)}b=setInterval(w,100),w()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(m)]).then(function(){return h(),t.onReadyBeingFired=[],N.resolve(va(function(){return e.on.ready.fire(e.vip)})).then(function E(){if(0<t.onReadyBeingFired.length){var w=t.onReadyBeingFired.reduce(ve,U);return t.onReadyBeingFired=[],N.resolve(va(function(){return w(e.vip)})).then(E)}})}).finally(function(){t.openCanceller===a&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(E){t.dbOpenError=E;try{C&&C.abort()}catch{}return a===t.openCanceller&&e._close(),jt(E)}).finally(function(){t.openComplete=!0,k()}).then(function(){var E;return _&&(E={},e.tables.forEach(function(w){w.schema.indexes.forEach(function(S){S.name&&(E["idb://".concat(e.name,"/").concat(w.name,"/").concat(S.name)]=new Ut(-1/0,[[[]]]))}),E["idb://".concat(e.name,"/").concat(w.name,"/")]=E["idb://".concat(e.name,"/").concat(w.name,"/:dels")]=new Ut(-1/0,[[[]]])}),Tr(mn).fire(E),ya(E,!0)),e})}function ga(e){function t(l){return e.next(l)}var n=s(t),a=s(function(l){return e.throw(l)});function s(l){return function(b){var m=l(b),b=m.value;return m.done?b:b&&typeof b.then=="function"?b.then(n,a):P(b)?Promise.all(b).then(n,a):n(b)}}return s(t)()}function Kn(e,t,n){for(var a=P(e)?e.slice():[e],s=0;s<n;++s)a.push(t);return a}var ss={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return c(c({},e),{table:function(t){var n=e.table(t),a=n.schema,s={},l=[];function h(_,E,w){var S=gn(_),A=s[S]=s[S]||[],x=_==null?0:typeof _=="string"?1:_.length,M=0<E,M=c(c({},w),{name:M?"".concat(S,"(virtual-from:").concat(w.name,")"):w.name,lowLevelIndex:w,isVirtual:M,keyTail:E,keyLength:x,extractKey:sa(_),unique:!M&&w.unique});return A.push(M),M.isPrimaryKey||l.push(M),1<x&&h(x===2?_[0]:_.slice(0,x-1),E+1,w),A.sort(function(j,T){return j.keyTail-T.keyTail}),M}t=h(a.primaryKey.keyPath,0,a.primaryKey),s[":id"]=[t];for(var m=0,b=a.indexes;m<b.length;m++){var k=b[m];h(k.keyPath,0,k)}function C(_){var E,w=_.query.index;return w.isVirtual?c(c({},_),{query:{index:w.lowLevelIndex,range:(E=_.query.range,w=w.keyTail,{type:E.type===1?2:E.type,lower:Kn(E.lower,E.lowerOpen?e.MAX_KEY:e.MIN_KEY,w),lowerOpen:!0,upper:Kn(E.upper,E.upperOpen?e.MIN_KEY:e.MAX_KEY,w),upperOpen:!0})}}):_}return c(c({},n),{schema:c(c({},a),{primaryKey:t,indexes:l,getIndexByKeyPath:function(_){return(_=s[gn(_)])&&_[0]}}),count:function(_){return n.count(C(_))},query:function(_){return n.query(C(_))},openCursor:function(_){var E=_.query.index,w=E.keyTail,S=E.isVirtual,A=E.keyLength;return S?n.openCursor(C(_)).then(function(M){return M&&x(M)}):n.openCursor(_);function x(M){return Object.create(M,{continue:{value:function(j){j!=null?M.continue(Kn(j,_.reverse?e.MAX_KEY:e.MIN_KEY,w)):_.unique?M.continue(M.key.slice(0,A).concat(_.reverse?e.MIN_KEY:e.MAX_KEY,w)):M.continue()}},continuePrimaryKey:{value:function(j,T){M.continuePrimaryKey(Kn(j,e.MAX_KEY,w),T)}},primaryKey:{get:function(){return M.primaryKey}},key:{get:function(){var j=M.key;return A===1?j[0]:j.slice(0,A)}},value:{get:function(){return M.value}}})}}})}})}};function _a(e,t,n,a){return n=n||{},a=a||"",y(e).forEach(function(s){var l,h,m;K(t,s)?(l=e[s],h=t[s],typeof l=="object"&&typeof h=="object"&&l&&h?(m=et(l))!==et(h)?n[a+s]=t[s]:m==="Object"?_a(l,h,n,a+s+"."):l!==h&&(n[a+s]=t[s]):l!==h&&(n[a+s]=t[s])):n[a+s]=void 0}),y(t).forEach(function(s){K(e,s)||(n[a+s]=t[s])}),n}function ba(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var os={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return c(c({},e),{table:function(t){var n=e.table(t),a=n.schema.primaryKey;return c(c({},n),{mutate:function(s){var l=F.trans,h=l.table(t).hook,m=h.deleting,b=h.creating,k=h.updating;switch(s.type){case"add":if(b.fire===U)break;return l._promise("readwrite",function(){return C(s)},!0);case"put":if(b.fire===U&&k.fire===U)break;return l._promise("readwrite",function(){return C(s)},!0);case"delete":if(m.fire===U)break;return l._promise("readwrite",function(){return C(s)},!0);case"deleteRange":if(m.fire===U)break;return l._promise("readwrite",function(){return function _(E,w,S){return n.query({trans:E,values:!1,query:{index:a,range:w},limit:S}).then(function(A){var x=A.result;return C({type:"delete",keys:x,trans:E}).then(function(M){return 0<M.numFailures?Promise.reject(M.failures[0]):x.length<S?{failures:[],numFailures:0,lastResult:void 0}:_(E,c(c({},w),{lower:x[x.length-1],lowerOpen:!0}),S)})})}(s.trans,s.range,1e4)},!0)}return n.mutate(s);function C(_){var E,w,S,A=F.trans,x=_.keys||ba(a,_);if(!x)throw new Error("Keys missing");return(_=_.type==="add"||_.type==="put"?c(c({},_),{keys:x}):c({},_)).type!=="delete"&&(_.values=f([],_.values)),_.keys&&(_.keys=f([],_.keys)),E=n,S=x,((w=_).type==="add"?Promise.resolve([]):E.getMany({trans:w.trans,keys:S,cache:"immutable"})).then(function(M){var j=x.map(function(T,O){var B,Q,L,H=M[O],Z={onerror:null,onsuccess:null};return _.type==="delete"?m.fire.call(Z,T,H,A):_.type==="add"||H===void 0?(B=b.fire.call(Z,T,_.values[O],A),T==null&&B!=null&&(_.keys[O]=T=B,a.outbound||ne(_.values[O],a.keyPath,T))):(B=_a(H,_.values[O]),(Q=k.fire.call(Z,B,T,H,A))&&(L=_.values[O],Object.keys(Q).forEach(function(Y){K(L,Y)?L[Y]=Q[Y]:ne(L,Y,Q[Y])}))),Z});return n.mutate(_).then(function(T){for(var O=T.failures,B=T.results,Q=T.numFailures,T=T.lastResult,L=0;L<x.length;++L){var H=(B||x)[L],Z=j[L];H==null?Z.onerror&&Z.onerror(O[L]):Z.onsuccess&&Z.onsuccess(_.type==="put"&&M[L]?_.values[L]:H)}return{failures:O,results:B,numFailures:Q,lastResult:T}}).catch(function(T){return j.forEach(function(O){return O.onerror&&O.onerror(T)}),Promise.reject(T)})})}}})}})}};function ii(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var a=[],s=0,l=0;s<t.keys.length&&l<e.length;++s)Je(t.keys[s],e[l])===0&&(a.push(n?Te(t.values[s]):t.values[s]),++l);return a.length===e.length?a:null}catch{return null}}var cs={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return c(c({},n),{getMany:function(a){if(!a.cache)return n.getMany(a);var s=ii(a.keys,a.trans._cache,a.cache==="clone");return s?N.resolve(s):n.getMany(a).then(function(l){return a.trans._cache={keys:a.keys,values:a.cache==="clone"?Te(l):l},l})},mutate:function(a){return a.type!=="add"&&(a.trans._cache=null),n.mutate(a)}})}}}};function si(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function oi(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ls={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new Ut(e.MIN_KEY,e.MAX_KEY);return c(c({},e),{transaction:function(a,s,l){if(F.subscr&&s!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(F.querier));return e.transaction(a,s,l)},table:function(a){var s=e.table(a),l=s.schema,h=l.primaryKey,_=l.indexes,m=h.extractKey,b=h.outbound,k=h.autoIncrement&&_.filter(function(w){return w.compound&&w.keyPath.includes(h.keyPath)}),C=c(c({},s),{mutate:function(w){function S(Y){return Y="idb://".concat(t,"/").concat(a,"/").concat(Y),T[Y]||(T[Y]=new Ut)}var A,x,M,j=w.trans,T=w.mutatedParts||(w.mutatedParts={}),O=S(""),B=S(":dels"),Q=w.type,Z=w.type==="deleteRange"?[w.range]:w.type==="delete"?[w.keys]:w.values.length<50?[ba(h,w).filter(function(Y){return Y}),w.values]:[],L=Z[0],H=Z[1],Z=w.trans._cache;return P(L)?(O.addKeys(L),(Z=Q==="delete"||L.length===H.length?ii(L,Z):null)||B.addKeys(L),(Z||H)&&(A=S,x=Z,M=H,l.indexes.forEach(function(Y){var ae=A(Y.name||"");function Ne(He){return He!=null?Y.extractKey(He):null}function Ue(He){return Y.multiEntry&&P(He)?He.forEach(function(ar){return ae.addKey(ar)}):ae.addKey(He)}(x||M).forEach(function(He,Ht){var $e=x&&Ne(x[Ht]),Ht=M&&Ne(M[Ht]);Je($e,Ht)!==0&&($e!=null&&Ue($e),Ht!=null&&Ue(Ht))})}))):L?(H={from:(H=L.lower)!==null&&H!==void 0?H:e.MIN_KEY,to:(H=L.upper)!==null&&H!==void 0?H:e.MAX_KEY},B.add(H),O.add(H)):(O.add(n),B.add(n),l.indexes.forEach(function(Y){return S(Y.name).add(n)})),s.mutate(w).then(function(Y){return!L||w.type!=="add"&&w.type!=="put"||(O.addKeys(Y.results),k&&k.forEach(function(ae){for(var Ne=w.values.map(function($e){return ae.extractKey($e)}),Ue=ae.keyPath.findIndex(function($e){return $e===h.keyPath}),He=0,ar=Y.results.length;He<ar;++He)Ne[He][Ue]=Y.results[He];S(ae.name).addKeys(Ne)})),j.mutatedParts=$n(j.mutatedParts||{},T),Y})}}),_=function(S){var A=S.query,S=A.index,A=A.range;return[S,new Ut((S=A.lower)!==null&&S!==void 0?S:e.MIN_KEY,(A=A.upper)!==null&&A!==void 0?A:e.MAX_KEY)]},E={get:function(w){return[h,new Ut(w.key)]},getMany:function(w){return[h,new Ut().addKeys(w.keys)]},count:_,query:_,openCursor:_};return y(E).forEach(function(w){C[w]=function(S){var A=F.subscr,x=!!A,M=si(F,s)&&oi(w,S)?S.obsSet={}:A;if(x){var j=function(H){return H="idb://".concat(t,"/").concat(a,"/").concat(H),M[H]||(M[H]=new Ut)},T=j(""),O=j(":dels"),A=E[w](S),x=A[0],A=A[1];if((w==="query"&&x.isPrimaryKey&&!S.values?O:j(x.name||"")).add(A),!x.isPrimaryKey){if(w!=="count"){var B=w==="query"&&b&&S.values&&s.query(c(c({},S),{values:!1}));return s[w].apply(this,arguments).then(function(H){if(w==="query"){if(b&&S.values)return B.then(function(Ne){return Ne=Ne.result,T.addKeys(Ne),H});var Z=S.values?H.result.map(m):H.result;(S.values?T:O).addKeys(Z)}else if(w==="openCursor"){var Y=H,ae=S.values;return Y&&Object.create(Y,{key:{get:function(){return O.addKey(Y.primaryKey),Y.key}},primaryKey:{get:function(){var Ne=Y.primaryKey;return O.addKey(Ne),Ne}},value:{get:function(){return ae&&T.addKey(Y.primaryKey),Y.value}}})}return H})}O.add(n)}}return s[w].apply(this,arguments)}}),C}})}};function ci(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var a=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return n.numFailures===a?null:(t=c({},t),P(t.keys)&&(t.keys=t.keys.filter(function(s,l){return!(l in n.failures)})),"values"in t&&P(t.values)&&(t.values=t.values.filter(function(s,l){return!(l in n.failures)})),t)}function wa(e,t){return n=e,((a=t).lower===void 0||(a.lowerOpen?0<Je(n,a.lower):0<=Je(n,a.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?Je(e,t.upper)<0:Je(e,t.upper)<=0));var n,a}function li(e,t,E,a,s,l){if(!E||E.length===0)return e;var h=t.query.index,m=h.multiEntry,b=t.query.range,k=a.schema.primaryKey.extractKey,C=h.extractKey,_=(h.lowLevelIndex||h).extractKey,E=E.reduce(function(w,S){var A=w,x=[];if(S.type==="add"||S.type==="put")for(var M=new Ut,j=S.values.length-1;0<=j;--j){var T,O=S.values[j],B=k(O);M.hasKey(B)||(T=C(O),(m&&P(T)?T.some(function(Y){return wa(Y,b)}):wa(T,b))&&(M.addKey(B),x.push(O)))}switch(S.type){case"add":var Q=new Ut().addKeys(t.values?w.map(function(ae){return k(ae)}):w),A=w.concat(t.values?x.filter(function(ae){return ae=k(ae),!Q.hasKey(ae)&&(Q.addKey(ae),!0)}):x.map(function(ae){return k(ae)}).filter(function(ae){return!Q.hasKey(ae)&&(Q.addKey(ae),!0)}));break;case"put":var L=new Ut().addKeys(S.values.map(function(ae){return k(ae)}));A=w.filter(function(ae){return!L.hasKey(t.values?k(ae):ae)}).concat(t.values?x:x.map(function(ae){return k(ae)}));break;case"delete":var H=new Ut().addKeys(S.keys);A=w.filter(function(ae){return!H.hasKey(t.values?k(ae):ae)});break;case"deleteRange":var Z=S.range;A=w.filter(function(ae){return!wa(k(ae),Z)})}return A},e);return E===e?e:(E.sort(function(w,S){return Je(_(w),_(S))||Je(k(w),k(S))}),t.limit&&t.limit<1/0&&(E.length>t.limit?E.length=t.limit:e.length===t.limit&&E.length<t.limit&&(s.dirty=!0)),l?Object.freeze(E):E)}function ui(e,t){return Je(e.lower,t.lower)===0&&Je(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function us(e,t){return function(n,a,s,l){if(n===void 0)return a!==void 0?-1:0;if(a===void 0)return 1;if((a=Je(n,a))===0){if(s&&l)return 0;if(s)return 1;if(l)return-1}return a}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(n,a,s,l){if(n===void 0)return a!==void 0?1:0;if(a===void 0)return-1;if((a=Je(n,a))===0){if(s&&l)return 0;if(s)return-1;if(l)return 1}return a}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function ds(e,t,n,a){e.subscribers.add(n),a.addEventListener("abort",function(){var s,l;e.subscribers.delete(n),e.subscribers.size===0&&(s=e,l=t,setTimeout(function(){s.subscribers.size===0&&Xe(l,s)},3e3))})}var vs={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return c(c({},e),{transaction:function(n,a,s){var l,h,m=e.transaction(n,a,s);return a==="readwrite"&&(h=(l=new AbortController).signal,s=function(b){return function(){if(l.abort(),a==="readwrite"){for(var k=new Set,C=0,_=n;C<_.length;C++){var E=_[C],w=Br["idb://".concat(t,"/").concat(E)];if(w){var S=e.table(E),A=w.optimisticOps.filter(function(ae){return ae.trans===m});if(m._explicit&&b&&m.mutatedParts)for(var x=0,M=Object.values(w.queries.query);x<M.length;x++)for(var j=0,T=(Q=M[x]).slice();j<T.length;j++)ha((L=T[j]).obsSet,m.mutatedParts)&&(Xe(Q,L),L.subscribers.forEach(function(ae){return k.add(ae)}));else if(0<A.length){w.optimisticOps=w.optimisticOps.filter(function(ae){return ae.trans!==m});for(var O=0,B=Object.values(w.queries.query);O<B.length;O++)for(var Q,L,H,Z=0,Y=(Q=B[O]).slice();Z<Y.length;Z++)(L=Y[Z]).res!=null&&m.mutatedParts&&(b&&!L.dirty?(H=Object.isFrozen(L.res),H=li(L.res,L.req,A,S,L,H),L.dirty?(Xe(Q,L),L.subscribers.forEach(function(ae){return k.add(ae)})):H!==L.res&&(L.res=H,L.promise=N.resolve({result:H}))):(L.dirty&&Xe(Q,L),L.subscribers.forEach(function(ae){return k.add(ae)})))}}}k.forEach(function(ae){return ae()})}}},m.addEventListener("abort",s(!1),{signal:h}),m.addEventListener("error",s(!1),{signal:h}),m.addEventListener("complete",s(!0),{signal:h})),m},table:function(n){var a=e.table(n),s=a.schema.primaryKey;return c(c({},a),{mutate:function(l){var h=F.trans;if(s.outbound||h.db._options.cache==="disabled"||h.explicit||h.idbtrans.mode!=="readwrite")return a.mutate(l);var m=Br["idb://".concat(t,"/").concat(n)];return m?(h=a.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||ba(s,l).some(function(b){return b==null}))?(m.optimisticOps.push(l),l.mutatedParts&&Fn(l.mutatedParts),h.then(function(b){0<b.numFailures&&(Xe(m.optimisticOps,l),(b=ci(0,l,b))&&m.optimisticOps.push(b),l.mutatedParts&&Fn(l.mutatedParts))}),h.catch(function(){Xe(m.optimisticOps,l),l.mutatedParts&&Fn(l.mutatedParts)})):h.then(function(b){var k=ci(0,c(c({},l),{values:l.values.map(function(C,_){var E;return b.failures[_]?C:(C=(E=s.keyPath)!==null&&E!==void 0&&E.includes(".")?Te(C):c({},C),ne(C,s.keyPath,b.results[_]),C)})}),b);m.optimisticOps.push(k),queueMicrotask(function(){return l.mutatedParts&&Fn(l.mutatedParts)})}),h):a.mutate(l)},query:function(l){if(!si(F,a)||!oi("query",l))return a.query(l);var h=((k=F.trans)===null||k===void 0?void 0:k.db._options.cache)==="immutable",_=F,m=_.requery,b=_.signal,k=function(S,A,x,M){var j=Br["idb://".concat(S,"/").concat(A)];if(!j)return[];if(!(A=j.queries[x]))return[null,!1,j,null];var T=A[(M.query?M.query.index.name:null)||""];if(!T)return[null,!1,j,null];switch(x){case"query":var O=T.find(function(B){return B.req.limit===M.limit&&B.req.values===M.values&&ui(B.req.query.range,M.query.range)});return O?[O,!0,j,T]:[T.find(function(B){return("limit"in B.req?B.req.limit:1/0)>=M.limit&&(!M.values||B.req.values)&&us(B.req.query.range,M.query.range)}),!1,j,T];case"count":return O=T.find(function(B){return ui(B.req.query.range,M.query.range)}),[O,!!O,j,T]}}(t,n,"query",l),C=k[0],_=k[1],E=k[2],w=k[3];return C&&_?C.obsSet=l.obsSet:(_=a.query(l).then(function(S){var A=S.result;if(C&&(C.res=A),h){for(var x=0,M=A.length;x<M;++x)Object.freeze(A[x]);Object.freeze(A)}else S.result=Te(A);return S}).catch(function(S){return w&&C&&Xe(w,C),Promise.reject(S)}),C={obsSet:l.obsSet,promise:_,subscribers:new Set,type:"query",req:l,dirty:!1},w?w.push(C):(w=[C],(E=E||(Br["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=w)),ds(C,w,m,b),C.promise.then(function(S){return{result:li(S.result,l,E?.optimisticOps,a,C,h)}})}})}})}};function Nn(e,t){return new Proxy(e,{get:function(n,a,s){return a==="db"?t:Reflect.get(n,a,s)}})}var Er=($t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new J.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(a){return a._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(ts),n.stores({}),this._state.autoSchema=!1,n)},$t.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||F.letThrough||this._vip)?e():new N(function(n,a){if(t._state.openComplete)return a(new J.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void a(new J.DatabaseClosed);t.open().catch(U)}t._state.dbReadyPromise.then(n,a)}).then(e)},$t.prototype.use=function(e){var t=e.stack,n=e.create,a=e.level,s=e.name;return s&&this.unuse({stack:t,name:s}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:a??10,name:s}),e.sort(function(l,h){return l.level-h.level}),this},$t.prototype.unuse=function(e){var t=e.stack,n=e.name,a=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(s){return a?s.create!==a:!!n&&s.name!==n})),this},$t.prototype.open=function(){var e=this;return zt(me,function(){return is(e)})},$t.prototype._close=function(){var e=this._state,t=Qr.indexOf(this);if(0<=t&&Qr.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new N(function(n){e.dbReadyResolve=n}),e.openCanceller=new N(function(n,a){e.cancelOpen=a}))},$t.prototype.close=function(n){var t=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new J.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new J.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},$t.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",a=this._state;return new N(function(s,l){function h(){t.close(e);var m=t._deps.indexedDB.deleteDatabase(t.name);m.onsuccess=Ee(function(){var b,k,C;b=t._deps,k=t.name,C=b.indexedDB,b=b.IDBKeyRange,da(C)||k===Cn||ua(C,b).delete(k).catch(U),s()}),m.onerror=pr(l),m.onblocked=t._fireOnBlocked}if(n)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");a.isBeingOpened?a.dbReadyPromise.then(h):h()})},$t.prototype.backendDB=function(){return this.idbdb},$t.prototype.isOpen=function(){return this.idbdb!==null},$t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},$t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},$t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty($t.prototype,"tables",{get:function(){var e=this;return y(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),$t.prototype.transaction=function(){var e=(function(t,n,a){var s=arguments.length;if(s<2)throw new J.InvalidArgument("Too few arguments");for(var l=new Array(s-1);--s;)l[s-1]=arguments[s];return a=l.pop(),[t,ut(l),a]}).apply(this,arguments);return this._transaction.apply(this,e)},$t.prototype._transaction=function(e,t,n){var a=this,s=F.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);var l,h,m=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(h=t.map(function(k){if(k=k instanceof a.Table?k.name:k,typeof k!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return k}),e=="r"||e===Jn)l=Jn;else{if(e!="rw"&&e!=Zn)throw new J.InvalidArgument("Invalid transaction mode: "+e);l=Zn}if(s){if(s.mode===Jn&&l===Zn){if(!m)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&h.forEach(function(k){if(s&&s.storeNames.indexOf(k)===-1){if(!m)throw new J.SubTransaction("Table "+k+" not included in parent transaction.");s=null}}),m&&s&&!s.active&&(s=null)}}catch(k){return s?s._promise(null,function(C,_){_(k)}):jt(k)}var b=(function k(C,_,E,w,S){return N.resolve().then(function(){var A=F.transless||F,x=C._createTransaction(_,E,C._dbSchema,w);if(x.explicit=!0,A={trans:x,transless:A},w)x.idbtrans=w.idbtrans;else try{x.create(),x.idbtrans._explicit=!0,C._state.PR1398_maxLoop=3}catch(T){return T.name===_t.InvalidState&&C.isOpen()&&0<--C._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),C.close({disableAutoOpen:!1}),C.open().then(function(){return k(C,_,E,null,S)})):jt(T)}var M,j=G(S);return j&&lr(),A=N.follow(function(){var T;(M=S.call(x,x))&&(j?(T=Kt.bind(null,null),M.then(T,T)):typeof M.next=="function"&&typeof M.throw=="function"&&(M=ga(M)))},A),(M&&typeof M.then=="function"?N.resolve(M).then(function(T){return x.active?T:jt(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):A.then(function(){return M})).then(function(T){return w&&x._resolve(),x._completion.then(function(){return T})}).catch(function(T){return x._reject(T),jt(T)})})}).bind(null,this,l,h,s,n);return s?s._promise(l,b,"lock"):F.trans?zt(F.transless,function(){return a._whenReady(b)}):this._whenReady(b)},$t.prototype.table=function(e){if(!K(this._allTables,e))throw new J.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},$t);function $t(e,t){var n=this;this._middlewares={},this.verno=0;var a=$t.dependencies;this._options=t=c({addons:$t.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},a=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s,l,h,m,b,k={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:U,dbReadyPromise:null,cancelOpen:U,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};k.dbReadyPromise=new N(function(_){k.dbReadyResolve=_}),k.openCanceller=new N(function(_,E){k.cancelOpen=E}),this._state=k,this.name=e,this.on=vn(this,"populate","blocked","versionchange","close",{ready:[ve,U]}),this.on.ready.subscribe=Se(this.on.ready.subscribe,function(_){return function(E,w){$t.vip(function(){var S,A=n._state;A.openComplete?(A.dbOpenError||N.resolve().then(E),w&&_(E)):A.onReadyBeingFired?(A.onReadyBeingFired.push(E),w&&_(E)):(_(E),S=n,w||_(function x(){S.on.ready.unsubscribe(E),S.on.ready.unsubscribe(x)}))})}}),this.Collection=(s=this,fn(Wi.prototype,function(M,x){this.db=s;var w=Ba,S=null;if(x)try{w=x()}catch(j){S=j}var A=M._ctx,x=A.table,M=x.hook.reading.fire;this._ctx={table:x,index:A.index,isPrimKey:!A.index||x.schema.primKey.keyPath&&A.index===x.schema.primKey.name,range:w,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:S,or:A.or,valueMapper:M!==Ae?M:null}})),this.Table=(l=this,fn(Ha.prototype,function(_,E,w){this.db=l,this._tx=w,this.name=_,this.schema=E,this.hook=l._allTables[_]?l._allTables[_].hook:vn(null,{creating:[Ve,U],reading:[Re,Ae],updating:[bt,U],deleting:[Ye,U]})})),this.Transaction=(h=this,fn(Qi.prototype,function(_,E,w,S,A){var x=this;this.db=h,this.mode=_,this.storeNames=E,this.schema=w,this.chromeTransactionDurability=S,this.idbtrans=null,this.on=vn(this,"complete","error","abort"),this.parent=A||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new N(function(M,j){x._resolve=M,x._reject=j}),this._completion.then(function(){x.active=!1,x.on.complete.fire()},function(M){var j=x.active;return x.active=!1,x.on.error.fire(M),x.parent?x.parent._reject(M):j&&x.idbtrans&&x.idbtrans.abort(),jt(M)})})),this.Version=(m=this,fn(as.prototype,function(_){this.db=m,this._cfg={version:_,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(b=this,fn(Ya.prototype,function(_,E,w){if(this.db=b,this._ctx={table:_,index:E===":id"?null:E,or:w},this._cmp=this._ascending=Je,this._descending=function(S,A){return Je(A,S)},this._max=function(S,A){return 0<Je(S,A)?S:A},this._min=function(S,A){return Je(S,A)<0?S:A},this._IDBKeyRange=b._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(_){0<_.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(_){!_.newVersion||_.newVersion<_.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(_.oldVersion/10))}),this._maxKey=yn(t.IDBKeyRange),this._createTransaction=function(_,E,w,S){return new n.Transaction(_,E,w,n._options.chromeTransactionDurability,S)},this._fireOnBlocked=function(_){n.on("blocked").fire(_),Qr.filter(function(E){return E.name===n.name&&E!==n&&!E._state.vcFired}).map(function(E){return E.on("versionchange").fire(_)})},this.use(cs),this.use(vs),this.use(ls),this.use(ss),this.use(os);var C=new Proxy(this,{get:function(_,E,w){if(E==="_vip")return!0;if(E==="table")return function(A){return Nn(n.table(A),C)};var S=Reflect.get(_,E,w);return S instanceof Ha?Nn(S,C):E==="tables"?S.map(function(A){return Nn(A,C)}):E==="_createTransaction"?function(){return Nn(S.apply(this,arguments),C)}:S}});this.vip=C,a.forEach(function(_){return _(n)})}var Bn,ur=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",fs=(ka.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},ka.prototype[ur]=function(){return this},ka);function ka(e){this._subscribe=e}try{Bn={indexedDB:g.indexedDB||g.mozIndexedDB||g.webkitIndexedDB||g.msIndexedDB,IDBKeyRange:g.IDBKeyRange||g.webkitIDBKeyRange}}catch{Bn={indexedDB:null,IDBKeyRange:null}}function di(e){var t,n=!1,a=new fs(function(s){var l=G(e),h,m=!1,b={},k={},C={get closed(){return m},unsubscribe:function(){m||(m=!0,h&&h.abort(),_&&Tr.storagemutated.unsubscribe(w))}};s.start&&s.start(C);var _=!1,E=function(){return dn(S)},w=function(A){$n(b,A),ha(k,b)&&E()},S=function(){var A,x,M;!m&&Bn.indexedDB&&(b={},A={},h&&h.abort(),h=new AbortController,M=function(j){var T=It();try{l&&lr();var O=Xt(e,j);return O=l?O.finally(Kt):O}finally{T&&Wt()}}(x={subscr:A,signal:h.signal,requery:E,querier:e,trans:null}),Promise.resolve(M).then(function(j){n=!0,t=j,m||x.signal.aborted||(b={},function(T){for(var O in T)if(K(T,O))return;return 1}(k=A)||_||(Tr(mn,w),_=!0),dn(function(){return!m&&s.next&&s.next(j)}))},function(j){n=!1,["DatabaseClosedError","AbortError"].includes(j?.name)||m||dn(function(){m||s.error&&s.error(j)})}))};return setTimeout(E,0),C});return a.hasValue=function(){return n},a.getValue=function(){return t},a}var Lr=Er;function xa(e){var t=Rr;try{Rr=!0,Tr.storagemutated.fire(e),ya(e,!0)}finally{Rr=t}}W(Lr,c(c({},le),{delete:function(e){return new Lr(e,{addons:[]}).delete()},exists:function(e){return new Lr(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Lr.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(da(n)?Promise.resolve(n.databases()).then(function(a){return a.map(function(s){return s.name}).filter(function(s){return s!==Cn})}):ua(n,t).toCollection().primaryKeys()).then(e)}catch{return jt(new J.MissingAPI)}var t,n},defineClass:function(){return function(e){q(this,e)}},ignoreTransaction:function(e){return F.trans?zt(F.transless,e):e()},vip:va,async:function(e){return function(){try{var t=ga(e.apply(this,arguments));return t&&typeof t.then=="function"?t:N.resolve(t)}catch(n){return jt(n)}}},spawn:function(e,t,n){try{var a=ga(e.apply(n,t||[]));return a&&typeof a.then=="function"?a:N.resolve(a)}catch(s){return jt(s)}},currentTransaction:{get:function(){return F.trans||null}},waitFor:function(e,t){return t=N.resolve(typeof e=="function"?Lr.ignoreTransaction(e):e).timeout(t||6e4),F.trans?F.trans.waitFor(t):t},Promise:N,debug:{get:function(){return z},set:function(e){Pe(e)}},derive:ee,extend:q,props:W,override:Se,Events:vn,on:Tr,liveQuery:di,extendObservabilitySet:$n,getByKeyPath:V,setByKeyPath:ne,delByKeyPath:function(e,t){typeof t=="string"?ne(e,t,void 0):"length"in t&&[].map.call(t,function(n){ne(e,n,void 0)})},shallowClone:Ie,deepClone:Te,getObjectDiff:_a,cmp:Je,asap:ke,minKey:-1/0,addons:[],connections:Qr,errnames:_t,dependencies:Bn,cache:Br,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),Lr.maxKey=yn(Lr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Tr(mn,function(e){Rr||(e=new CustomEvent(na,{detail:e}),Rr=!0,dispatchEvent(e),Rr=!1)}),addEventListener(na,function(e){e=e.detail,Rr||xa(e)}));var en,Rr=!1,vi=function(){};return typeof BroadcastChannel<"u"&&((vi=function(){(en=new BroadcastChannel(na)).onmessage=function(e){return e.data&&xa(e.data)}})(),typeof en.unref=="function"&&en.unref(),Tr(mn,function(e){Rr||en.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Er.disableBfCache&&e.persisted){z&&console.debug("Dexie: handling persisted pagehide"),en?.close();for(var t=0,n=Qr;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Er.disableBfCache&&e.persisted&&(z&&console.debug("Dexie: handling persisted pageshow"),vi(),xa({all:new Ut(-1/0,[[]])}))})),N.rejectionMapper=function(e,t){return!e||e instanceof _e||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Mt[e.name]?e:(t=new Mt[e.name](t||e.message,e),"stack"in e&&X(t,"stack",{get:function(){return this.inner.stack}}),t)},Pe(z),c(Er,Object.freeze({__proto__:null,Dexie:Er,liveQuery:di,Entity:La,cmp:Je,PropModification:hn,replacePrefix:function(e,t){return new hn({replacePrefix:[e,t]})},add:function(e){return new hn({add:e})},remove:function(e){return new hn({remove:e})},default:Er,RangeSet:Ut,mergeRanges:bn,rangesOverlap:ti}),{default:Er}),Er})}(Hn)),Hn.exports}var To=jo();const $a=Mo(To),Ci=Symbol.for("Dexie"),Wn=globalThis[Ci]||(globalThis[Ci]=$a);if($a.semVer!==Wn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${$a.semVer} and ${Wn.semVer}`);const{liveQuery:Nc,mergeRanges:Bc,rangesOverlap:Lc,RangeSet:zc,cmp:Uc,Entity:Hc,PropModification:Vc,replacePrefix:Gc,add:Wc,remove:Xc}=Wn;class Ro extends Wn{saves;settings;achievements;analytics;constructor(){super("MatchstickEmpireDB"),this.version(1).stores({saves:"id, name, timestamp, version, isAutoSave",settings:"id, key, timestamp",achievements:"id, achievementId, unlockedAt",analytics:"id, event, timestamp, sessionId"}),this.version(1).upgrade(r=>{})}}const Me=new Ro;class Hr{static instance;isInitialized=!1;sessionId;constructor(){this.sessionId=this.generateSessionId()}static getInstance(){return Hr.instance||(Hr.instance=new Hr),Hr.instance}async initialize(){try{await Me.open(),this.isInitialized=!0;const r=Date.now()-10080*60*1e3;await Me.analytics.where("timestamp").below(r).delete()}catch(r){throw be.handleError(we.storage("Failed to initialize storage",{error:r})),r}}async saveGame(r,i,c=!1){try{this.isInitialized||await this.initialize();const f=this.generateSaveId(),g=i||(c?`AutoSave_${new Date().toISOString()}`:`Save_${Date.now()}`),y=await this.createChecksum(r),P={id:f,name:g,gameState:this.sanitizeGameState(r),timestamp:Date.now(),version:r.metadata.version,checksum:y,isAutoSave:c};return await Me.saves.put(P),c&&await this.cleanupAutoSaves(),await this.trackEvent("game_saved",{saveId:f,isAutoSave:c,gamePhase:r.progression.currentPhase}),f}catch(f){throw be.handleError(we.storage("Failed to save game",{error:f,name:i,isAutoSave:c})),f}}async loadGame(r){try{this.isInitialized||await this.initialize();const i=await Me.saves.get(r);return i?i.checksum&&await this.createChecksum(i.gameState)!==i.checksum?(be.handleError(we.storage("Save file corrupted",{saveId:r})),null):(await this.trackEvent("game_loaded",{saveId:r,version:i.version,timeSinceSave:Date.now()-i.timestamp}),i.gameState):null}catch(i){return be.handleError(we.storage("Failed to load game",{error:i,saveId:r})),null}}async loadMostRecentSave(){try{this.isInitialized||await this.initialize();const r=await Me.saves.orderBy("timestamp").reverse().toArray();if(r.length===0)return null;const i=r.filter(f=>f.isAutoSave),c=i.length>0?i[0]:r[0];if(c.checksum&&await this.createChecksum(c.gameState)!==c.checksum){be.handleError(we.storage("Most recent save corrupted, trying next save",{saveId:c.id}));for(let g=1;g<r.length;g++){const y=r[g];if(y.checksum){if(await this.createChecksum(y.gameState)===y.checksum)return await this.trackEvent("game_loaded",{saveId:y.id,version:y.version,timeSinceSave:Date.now()-y.timestamp,wasCorruptedFallback:!0}),{saveId:y.id,gameState:y.gameState}}else return await this.trackEvent("game_loaded",{saveId:y.id,version:y.version,timeSinceSave:Date.now()-y.timestamp,wasCorruptedFallback:!0}),{saveId:y.id,gameState:y.gameState}}return null}return await this.trackEvent("game_loaded",{saveId:c.id,version:c.version,timeSinceSave:Date.now()-c.timestamp,autoLoaded:!0}),{saveId:c.id,gameState:c.gameState}}catch(r){return be.handleError(we.storage("Failed to load most recent save",{error:r})),null}}async listSaves(){try{return this.isInitialized||await this.initialize(),(await Me.saves.orderBy("timestamp").reverse().toArray()).map(i=>({id:i.id,name:i.name,timestamp:i.timestamp,version:i.version,checksum:i.checksum,isAutoSave:i.isAutoSave}))}catch(r){return be.handleError(we.storage("Failed to list saves",{error:r})),[]}}async deleteSave(r){try{return this.isInitialized||await this.initialize(),await Me.saves.where("id").equals(r).count()===0?!1:(await Me.saves.delete(r),await this.trackEvent("game_deleted",{saveId:r}),!0)}catch(i){return be.handleError(we.storage("Failed to delete save",{error:i,saveId:r})),!1}}async saveSetting(r,i){try{this.isInitialized||await this.initialize();const c={id:r,key:r,value:i,timestamp:Date.now()};await Me.settings.put(c)}catch(c){be.handleError(we.storage("Failed to save setting",{error:c,key:r}))}}async loadSetting(r){try{return this.isInitialized||await this.initialize(),(await Me.settings.get(r))?.value??null}catch(i){return be.handleError(we.storage("Failed to load setting",{error:i,key:r})),null}}async saveAchievement(r,i){try{this.isInitialized||await this.initialize();const c={id:r,achievementId:r,unlockedAt:Date.now(),progress:i};await Me.achievements.put(c),await this.trackEvent("achievement_unlocked",{achievementId:r})}catch(c){be.handleError(we.storage("Failed to save achievement",{error:c,achievementId:r}))}}async loadAchievements(){try{return this.isInitialized||await this.initialize(),await Me.achievements.toArray()}catch(r){return be.handleError(we.storage("Failed to load achievements",{error:r})),[]}}async exportData(){try{this.isInitialized||await this.initialize();const r=await Me.saves.toArray(),i=await Me.settings.toArray(),c=await Me.achievements.toArray(),f={version:"1.0.0",exportedAt:Date.now(),saves:r,settings:i,achievements:c};return JSON.stringify(f,this.bigIntReplacer)}catch(r){throw be.handleError(we.storage("Failed to export data",{error:r})),r}}async importData(r){try{this.isInitialized||await this.initialize();const i=JSON.parse(r,this.bigIntReviver);if(!i.version||!i.saves)throw new Error("Invalid import data format");await Me.transaction("rw",[Me.saves,Me.settings,Me.achievements],async()=>{i.saves&&(await Me.saves.clear(),await Me.saves.bulkAdd(i.saves)),i.settings&&(await Me.settings.clear(),await Me.settings.bulkAdd(i.settings)),i.achievements&&(await Me.achievements.clear(),await Me.achievements.bulkAdd(i.achievements))}),await this.trackEvent("data_imported",{saveCount:i.saves?.length||0,settingCount:i.settings?.length||0,achievementCount:i.achievements?.length||0})}catch(i){throw be.handleError(we.storage("Failed to import data",{error:i})),i}}async clearAllData(){try{this.isInitialized||await this.initialize(),await Me.transaction("rw",[Me.saves,Me.settings,Me.achievements,Me.analytics],async()=>{await Me.saves.clear(),await Me.settings.clear(),await Me.achievements.clear(),await Me.analytics.clear()}),await this.trackEvent("data_cleared",{})}catch(r){throw be.handleError(we.storage("Failed to clear data",{error:r})),r}}async getStorageStats(){try{this.isInitialized||await this.initialize();const[r,i,c,f]=await Promise.all([Me.saves.count(),Me.settings.count(),Me.achievements.count(),Me.analytics.count()]),g=await this.estimateStorageSize();return{saves:r,settings:i,achievements:c,analytics:f,totalSize:g}}catch(r){return be.handleError(we.storage("Failed to get storage stats",{error:r})),{saves:0,settings:0,achievements:0,analytics:0,totalSize:0}}}generateSaveId(){return`save_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async createChecksum(r){const i=JSON.stringify(r,this.bigIntReplacer),f=new TextEncoder().encode(i),g=await crypto.subtle.digest("SHA-256",f);return Array.from(new Uint8Array(g)).map(P=>P.toString(16).padStart(2,"0")).join("")}sanitizeGameState(r){return JSON.parse(JSON.stringify(r,this.bigIntReplacer),this.bigIntReviver)}bigIntReplacer(r,i){return typeof i=="bigint"?{__type:"bigint",value:i.toString()}:i}bigIntReviver(r,i){return i&&i.__type==="bigint"?BigInt(i.value):i}async cleanupAutoSaves(){const r=await Me.saves.orderBy("timestamp").reverse().filter(i=>i.isAutoSave).toArray();if(r.length>5){const i=r.slice(5);await Me.saves.bulkDelete(i.map(c=>c.id))}}async trackEvent(r,i){try{const c={id:`${r}_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,event:r,data:i,timestamp:Date.now(),sessionId:this.sessionId};await Me.analytics.add(c)}catch(c){console.warn("Failed to track event:",r,c)}}async estimateStorageSize(){try{const r=await Me.saves.limit(1).first(),i=await Me.settings.limit(10).toArray(),c=await Me.achievements.limit(10).toArray();let f=0;if(r){const q=JSON.stringify(r).length,R=await Me.saves.count();f+=q*R}if(i.length>0){const q=JSON.stringify(i).length;f+=q}if(c.length>0){const q=JSON.stringify(c).length;f+=q}const[g,y,P]=await Promise.all([Me.saves.count(),Me.settings.count(),Me.achievements.count()]);return(g>0||y>0||P>0)&&(f=Math.max(f,100)),f}catch{return 0}}}Hr.getInstance();class sn{static instance;achievements=[];constructor(){this.initializeAchievements()}static getInstance(){return sn.instance||(sn.instance=new sn),sn.instance}initializeAchievements(){this.achievements=[{id:"first_match",name:"First Light",description:"Create your very first matchstick",category:"production",difficulty:"easy",points:5,requirements:{type:"resource_total",resource:"matchsticks",amount:1n},reward:{type:"money",amount:10},unlocked:!1},{id:"first_hundred",name:"Century Maker",description:"Produce 100 matchsticks",category:"production",difficulty:"easy",points:10,requirements:{type:"resource_total",resource:"matchsticks",amount:100n},reward:{type:"money",amount:50},unlocked:!1},{id:"thousand_matches",name:"Master Craftsman",description:"Produce 1,000 matchsticks",category:"production",difficulty:"medium",points:25,requirements:{type:"resource_total",resource:"matchsticks",amount:1000n},reward:{type:"money",amount:200},unlocked:!1},{id:"first_sale",name:"First Sale",description:"Make your first sale",category:"trading",difficulty:"easy",points:5,requirements:{type:"stat_threshold",stat:"totalSold",value:1},reward:{type:"money",amount:25},unlocked:!1},{id:"merchant_apprentice",name:"Merchant Apprentice",description:"Earn $100 in total revenue",category:"trading",difficulty:"easy",points:10,requirements:{type:"stat_threshold",stat:"totalRevenue",value:100},reward:{type:"money",amount:50},unlocked:!1},{id:"bulk_trader",name:"Bulk Trader",description:"Sell 1,000 matchsticks in total",category:"trading",difficulty:"medium",points:20,requirements:{type:"stat_threshold",stat:"totalSold",value:1e3},reward:{type:"money",amount:100},unlocked:!1},{id:"automation_investor",name:"Automation Investor",description:"Spend $500 on automation",category:"automation",difficulty:"medium",points:15,requirements:{type:"stat_threshold",stat:"totalAutomationSpent",value:500},reward:{type:"money",amount:75},unlocked:!1},{id:"clicker_collector",name:"Clicker Collector",description:"Own 10 auto-clickers",category:"automation",difficulty:"medium",points:20,requirements:{type:"stat_threshold",stat:"totalAutoClickers",value:10},reward:{type:"money",amount:100},unlocked:!1},{id:"automation_phase",name:"Industrial Revolution",description:"Reach the automation phase",category:"progression",difficulty:"medium",points:30,requirements:{type:"phase_reached",phase:"automation"},reward:{type:"money",amount:150},unlocked:!1}]}async initialize(){}syncWithGameState(){try{const i=lt(de).achievements?.unlocked||[];this.achievements.forEach(c=>{c.unlocked=i.includes(c.id)}),console.log(`ð Synced ${i.length} unlocked achievements with service state`)}catch(r){console.error("â Failed to sync achievement state:",r)}}checkAchievements(){const r=lt(de),i=[];for(const c of this.achievements)c.unlocked||this.isAchievementMet(c,r)&&(c.unlocked=!0,i.push(c),this.applyReward(c.reward),ge.updateAchievements({unlocked:[...r.achievements.unlocked||[],c.id],stats:{...r.achievements.stats,totalUnlocked:(r.achievements.stats.totalUnlocked||0)+1}}),ge.emitEvent({id:`achievement_${c.id}_${Date.now()}`,type:"achievement_unlocked",timestamp:Date.now(),data:{achievementId:c.id,name:c.name,points:c.points,reward:c.reward},source:"achievement_service"}));return i}isAchievementMet(r,i){const c=r.requirements;switch(c.type){case"resource_total":return c.resource==="matchsticks"?(i.production?.totalProduced||0n)>=(c.amount||0n):!1;case"stat_threshold":switch(c.stat){case"totalSold":return Number(i.market?.totalSold||0n)>=(c.value||0);case"totalRevenue":return(i.market?.totalRevenue||0)>=(c.value||0);case"totalAutomationSpent":return(i.automation?.totalMoneySpent||0)>=(c.value||0);case"totalAutoClickers":return(i.automation?.autoClickers||[]).reduce((g,y)=>g+(y.level||0),0)>=(c.value||0)}return!1;case"phase_reached":return i.progression?.currentPhase===c.phase;default:return!1}}applyReward(r){switch(r.type){case"money":r.amount&&ge.addResources({money:r.amount});break}}getAllAchievements(){return[...this.achievements]}getUnlockedAchievements(){return this.achievements.filter(r=>r.unlocked)}getAchievement(r){return this.achievements.find(i=>i.id===r)}getAchievementsByCategory(r){return this.achievements.filter(i=>i.category===r)}getStats(){const r=this.achievements.length,i=this.achievements.filter(f=>f.unlocked).length,c=this.achievements.filter(f=>f.unlocked).reduce((f,g)=>f+g.points,0);return{totalAchievements:r,unlockedAchievements:i,completionPercentage:r>0?i/r*100:0,achievementPoints:c}}resetAchievements(){this.achievements.forEach(r=>r.unlocked=!1)}stopTracking(){}unlockAchievementById(r){const i=this.achievements.find(c=>c.id===r);if(i&&!i.unlocked){i.unlocked=!0,this.applyReward(i.reward);const c=lt(de);return ge.updateAchievements({unlocked:[...c.achievements.unlocked||[],i.id],stats:{...c.achievements.stats,totalUnlocked:(c.achievements.stats.totalUnlocked||0)+1}}),i}return null}getAchievementProgress(r){const i=this.achievements.find(g=>g.id===r);if(!i)return null;if(i.unlocked)return{achievementId:r,progress:1,isComplete:!0,currentValue:1,targetValue:1};const c=lt(de),f=this.calculateProgress(i,c);return{achievementId:r,progress:f,isComplete:!1,currentValue:f,targetValue:1}}calculateProgress(r,i){const c=r.requirements;switch(c.type){case"resource_total":if(c.resource==="matchsticks"){const f=Number(i.production?.totalProduced||0n),g=Number(c.amount||0n);return g>0?Math.min(f/g,1):0}return 0;case"stat_threshold":switch(c.stat){case"totalSold":const f=Number(i.market?.totalSold||0n);return(c.value||0)>0?Math.min(f/(c.value||0),1):0;case"totalRevenue":return(c.value||0)>0?Math.min((i.market?.totalRevenue||0)/(c.value||0),1):0;case"totalAutomationSpent":return(c.value||0)>0?Math.min((i.automation?.totalMoneySpent||0)/(c.value||0),1):0}return 0;default:return this.isAchievementMet(r,i)?1:0}}getAvailableAchievements(){return this.achievements.filter(r=>!r.unlocked)}addCustomAchievement(r){if(!r.id||!r.name||this.achievements.some(c=>c.id===r.id))return!1;const i={id:r.id,name:r.name,description:r.description||"",category:r.category||"custom",difficulty:r.difficulty||"medium",points:r.points||10,requirements:r.requirements||{type:"custom"},reward:r.reward||{type:"money",amount:10},unlocked:!1};return this.achievements.push(i),!0}}const fr=sn.getInstance();class Vr{static instance;clickCombo;productionStats;lastClickTime=0;recentClicks=[];constructor(){this.clickCombo={count:0,startTime:0,multiplier:1,maxCombo:50,decayRate:.5},this.productionStats={totalClicks:0,totalProduced:0n,averageClickRate:0,maxCombo:0,sessionProduction:0n,sessionClicks:0,sessionStartTime:Date.now()}}static getInstance(){return Vr.instance||(Vr.instance=new Vr),Vr.instance}produceMatchsticks(r=1){try{const i=Date.now(),c=lt(de);this.updateClickStats(r,i);let f=c.production.manualRate*r;const g=this.updateClickCombo(i),y=this.calculateTotalMultiplier(g),P=BigInt(Math.floor(f*y)),q=P>BigInt(r)?P:BigInt(r);return ge.addResources({matchsticks:q}),ge.updateProduction({totalProduced:Et.add(c.production.totalProduced,q)}),this.productionStats.totalProduced=Et.add(this.productionStats.totalProduced,q),this.productionStats.sessionProduction=Et.add(this.productionStats.sessionProduction,q),ge.emitEvent({id:`production_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,type:"manual_production",timestamp:i,data:{produced:q,clickCount:r,comboMultiplier:g,totalMultiplier:y,comboCount:this.clickCombo.count,name:"Like a donkey"},source:"production_service"}),fr.checkAchievements(),this.triggerHapticFeedback(),{produced:q,comboMultiplier:g,totalMultiplier:y,comboCount:this.clickCombo.count}}catch(i){be.handleError(we.gameLogic("Failed to produce matchsticks",{error:i,clickCount:r}));const c=BigInt(r);return ge.addResources({matchsticks:c}),{produced:c,comboMultiplier:1,totalMultiplier:1,comboCount:0}}}getCurrentProductionRate(){try{const i=lt(de).production.manualRate,c=this.calculateTotalMultiplier(this.clickCombo.multiplier);return i*c}catch(r){return be.handleError(we.gameLogic("Failed to calculate production rate",{error:r})),1}}getComboInfo(){const i=Date.now()-this.lastClickTime,f=Math.max(0,2e3-i);return{count:this.clickCombo.count,multiplier:this.clickCombo.multiplier,timeRemaining:f,maxCombo:this.clickCombo.maxCombo}}getProductionStats(){return this.updateAverageClickRate(),{...this.productionStats}}resetStats(){this.productionStats={totalClicks:this.productionStats.totalClicks,totalProduced:this.productionStats.totalProduced,averageClickRate:0,maxCombo:this.productionStats.maxCombo,sessionProduction:0n,sessionClicks:0,sessionStartTime:Date.now()},this.recentClicks=[],this.resetCombo()}resetCombo(){this.clickCombo={count:0,startTime:0,multiplier:1,maxCombo:this.clickCombo.maxCombo,decayRate:this.clickCombo.decayRate}}applyTemporaryMultiplier(r,i){try{const c=lt(de),f={id:`temp_${Date.now()}`,name:"Temporary Boost",multiplier:r,duration:i,startTime:Date.now(),source:"temporary"},g={...c.production.multipliers};g[f.id]=r,ge.updateProduction({multipliers:g}),setTimeout(()=>{this.removeMultiplier(f.id)},i),ge.emitEvent({id:`multiplier_${Date.now()}`,type:"multiplier_applied",timestamp:Date.now(),data:{multiplier:r,duration:i,name:`Temporary Boost ${r}x`},source:"production_service"})}catch(c){be.handleError(we.gameLogic("Failed to apply multiplier",{error:c,multiplier:r,duration:i}))}}removeMultiplier(r){try{const c={...lt(de).production.multipliers};delete c[r],ge.updateProduction({multipliers:c})}catch(i){be.handleError(we.gameLogic("Failed to remove multiplier",{error:i,multiplierId:r}))}}updateClickStats(r,i){this.productionStats.totalClicks+=r,this.productionStats.sessionClicks+=r,this.lastClickTime=i,this.recentClicks.push(i);const c=i-1e4;this.recentClicks=this.recentClicks.filter(f=>f>c)}updateClickCombo(r){return r-this.lastClickTime>2e3?(this.clickCombo.count=1,this.clickCombo.startTime=r,this.clickCombo.multiplier=1):(this.clickCombo.count=Math.min(this.clickCombo.count+1,this.clickCombo.maxCombo),this.clickCombo.multiplier=1+(this.clickCombo.count-1)*.01),this.productionStats.maxCombo=Math.max(this.productionStats.maxCombo,this.clickCombo.count),this.clickCombo.multiplier}calculateTotalMultiplier(r){try{const i=lt(de);let c=r;const f=i.production.multipliers;for(const[g,y]of Object.entries(f))typeof y=="number"&&y>0&&(c*=y);return c}catch(i){return be.handleError(we.gameLogic("Failed to calculate total multiplier",{error:i})),r}}updateAverageClickRate(){const r=Date.now(),i=this.recentClicks.length,c=Math.min(1e4,r-this.productionStats.sessionStartTime);c>0&&(this.productionStats.averageClickRate=i/c*1e3)}triggerHapticFeedback(){try{lt(de).settings.hapticEnabled&&"vibrate"in navigator&&navigator.vibrate(10)}catch(r){console.debug("Haptic feedback not available:",r)}}}const Or=Vr.getInstance(),qo=Object.freeze(Object.defineProperty({__proto__:null,ProductionService:Vr,productionService:Or},Symbol.toStringTag,{value:"Module"}));class Gr{static instance;priceUpdateInterval=null;conditionCheckInterval=null;recentTrades=[];marketAnalysisCache=null;lastAnalysisTime=0;baseVolatility=.02;maxVolatility=.15;priceUpdateFrequency=5e3;conditionCheckFrequency=3e4;maxPriceHistory=100;marketConditions=[{id:"recession",name:"Economic Recession",description:"Demand for luxury items like matchsticks decreases",priceMultiplier:.7,demandLevel:"low",duration:12e4,probability:.05,triggers:["market_crash","oversupply"]},{id:"boom",name:"Economic Boom",description:"High demand for all goods including matchsticks",priceMultiplier:1.4,demandLevel:"high",duration:9e4,probability:.08,triggers:["market_boom","shortage"]},{id:"winter_season",name:"Winter Season",description:"Cold weather increases demand for fire-making tools",priceMultiplier:1.2,demandLevel:"high",duration:18e4,probability:.12,triggers:["seasonal","weather"]},{id:"fire_ban",name:"Fire Safety Restrictions",description:"Government restrictions reduce matchstick demand",priceMultiplier:.6,demandLevel:"low",duration:15e4,probability:.03,triggers:["regulation","safety"]},{id:"festival",name:"Festival Season",description:"Celebrations and events drive up matchstick demand",priceMultiplier:1.3,demandLevel:"peak",duration:6e4,probability:.1,triggers:["seasonal","celebration"]}];constructor(){this.startMarketSimulation()}static getInstance(){return Gr.instance||(Gr.instance=new Gr),Gr.instance}sellMatchsticks(r){try{const i=lt(de),c=i.resources.matchsticks;if(r<=0n)throw new Error("Amount must be greater than 0");if(r>c)throw new Error("Insufficient matchsticks");const f=this.getCurrentPrice(),g=this.calculateMarketImpact(r),y=f*g,P=Number(r)*y;if(!ge.sellMatchsticks(r))return{success:!1,revenue:0,pricePerUnit:f,remainingMatchsticks:c,marketShare:0};ge.addResources({money:P});const R=lt(de),$=Et.add(R.market.totalSold,r),K=R.market.totalRevenue+P;ge.updateMarket({totalSold:$,totalRevenue:K});const W={id:`trade_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:Date.now(),matchsticksSold:r,pricePerUnit:y,totalRevenue:P,marketCondition:i.market.condition?.description||"Normal",playerCash:R.resources.money,marketShare:this.calculateMarketShare($)};return this.recentTrades.unshift(W),this.recentTrades.length>50&&(this.recentTrades=this.recentTrades.slice(0,50)),this.updatePriceAfterTrade(r,y),ge.emitEvent({id:`trade_${Date.now()}`,type:"trade_executed",timestamp:Date.now(),data:{amount:r,revenue:P,pricePerUnit:y,marketShare:W.marketShare},source:"market_service"}),fr.checkAchievements(),{success:!0,revenue:P,pricePerUnit:y,remainingMatchsticks:R.resources.matchsticks,marketShare:W.marketShare,transaction:W}}catch(i){be.handleError(we.gameLogic("Failed to sell matchsticks",{error:i,amount:r.toString()}));const c=lt(de);return{success:!1,revenue:0,pricePerUnit:this.getCurrentPrice(),remainingMatchsticks:c.resources.matchsticks,marketShare:0}}}getCurrentPrice(){try{return lt(de).market.currentPrice}catch(r){return be.handleError(we.gameLogic("Failed to get current price",{error:r})),1}}getMarketAnalysis(){const r=Date.now();if(this.marketAnalysisCache&&r-this.lastAnalysisTime<1e4)return this.marketAnalysisCache;try{const i=lt(de),c=i.market.currentPrice,f=i.market.priceHistory,g=this.calculateTrend(f),y=this.calculateVolatility(f),{support:P,resistance:q}=this.calculateSupportResistance(f),R=this.calculateAverageVolume(),$=this.generateRecommendation(c,g,y,P,q);return this.marketAnalysisCache={currentPrice:c,priceHistory:f,trend:g,volatility:y,resistance:q,support:P,marketCap:c*Number(i.market.totalSold||0n),averageVolume:R,recommendation:$},this.lastAnalysisTime=r,this.marketAnalysisCache}catch(i){return be.handleError(we.gameLogic("Failed to generate market analysis",{error:i})),{currentPrice:this.getCurrentPrice(),priceHistory:[],trend:"stable",volatility:0,resistance:0,support:0,marketCap:0,averageVolume:0n,recommendation:"hold"}}}getRecentTrades(r=10){return this.recentTrades.slice(0,r)}getAvailableConditions(){return[...this.marketConditions]}triggerMarketCondition(r){try{const i=this.marketConditions.find(c=>c.id===r);return i?(this.applyMarketCondition(i),!0):!1}catch(i){return be.handleError(we.gameLogic("Failed to trigger market condition",{error:i,conditionId:r})),!1}}stopSimulation(){this.priceUpdateInterval&&(clearInterval(this.priceUpdateInterval),this.priceUpdateInterval=null),this.conditionCheckInterval&&(clearInterval(this.conditionCheckInterval),this.conditionCheckInterval=null)}startMarketSimulation(){this.priceUpdateInterval=setInterval(()=>{this.updateMarketPrice()},this.priceUpdateFrequency),this.conditionCheckInterval=setInterval(()=>{this.checkForMarketConditions()},this.conditionCheckFrequency)}updateMarketPrice(){try{const r=lt(de),i=r.market.currentPrice,c=r.market.basePrice,f=r.market.condition?.priceMultiplier||1;let g=this.baseVolatility;r.market.condition&&(g*=1+Math.abs(f-1));const y=(Math.random()-.5)*2,P=i*g*y,R=(c*f-i)*.1,$=Math.max(.1,i+P+R),K=[...r.market.priceHistory];K.push({timestamp:Date.now(),price:$,volume:0,condition:r.market.condition?.description||"Normal"}),K.length>this.maxPriceHistory&&K.shift(),ge.updateMarket({currentPrice:$,priceHistory:K}),ge.emitEvent({id:`price_change_${Date.now()}`,type:"price_change",timestamp:Date.now(),data:{previousPrice:i,newPrice:$,change:$-i,changePercent:($-i)/i*100},source:"market_service"})}catch(r){be.handleError(we.gameLogic("Failed to update market price",{error:r}))}}checkForMarketConditions(){try{const r=lt(de);if(r.market.condition&&Math.random()<.1){this.clearMarketCondition();return}if(r.market.condition)return;for(const i of this.marketConditions)if(Math.random()<i.probability){this.applyMarketCondition(i);break}}catch(r){be.handleError(we.gameLogic("Failed to check market conditions",{error:r}))}}applyMarketCondition(r){const i={priceMultiplier:r.priceMultiplier,demandLevel:r.demandLevel,trend:r.priceMultiplier>1?"rising":"falling",duration:r.duration,description:r.name};ge.updateMarket({condition:i}),ge.emitEvent({id:`condition_${r.id}_${Date.now()}`,type:"condition_change",timestamp:Date.now(),data:{conditionId:r.id,name:r.name,description:r.description,priceMultiplier:r.priceMultiplier,duration:r.duration},source:"market_service"})}clearMarketCondition(){ge.updateMarket({condition:void 0}),ge.emitEvent({id:`condition_cleared_${Date.now()}`,type:"condition_change",timestamp:Date.now(),data:{cleared:!0},source:"market_service"})}calculateMarketImpact(r){const i=Number(r),c=1e3;if(i<=c)return 1;const f=i-c;return 1-Math.min(.2,f/1e4)}updatePriceAfterTrade(r,i){const c=Number(r),f=Math.min(.05,c/5e3),g=i*(1-f);ge.updateMarket({currentPrice:Math.max(.1,g)})}calculateMarketShare(r){return Math.min(100,Number(r)/1e6*100)}calculateTrend(r){if(r.length<5)return"stable";const i=r.slice(-5),c=i[0].price,g=(i[i.length-1].price-c)/c;return g>.02?"rising":g<-.02?"falling":"stable"}calculateVolatility(r){if(r.length<10)return 0;const c=r.slice(-20).map(y=>y.price),f=c.reduce((y,P)=>y+P)/c.length,g=c.reduce((y,P)=>y+Math.pow(P-f,2),0)/c.length;return Math.sqrt(g)/f}calculateSupportResistance(r){if(r.length<20)return{support:0,resistance:0};const c=r.slice(-50).map(y=>y.price),f=Math.min(...c),g=Math.max(...c);return{support:f,resistance:g}}calculateAverageVolume(){return this.recentTrades.length===0?0n:this.recentTrades.reduce((i,c)=>Et.add(i,c.matchsticksSold),0n)/BigInt(this.recentTrades.length)}generateRecommendation(r,i,c,f,g){return i==="rising"&&r<g*.9?"buy":i==="falling"&&r>f*1.1?"sell":(c>.1,"hold")}}const an=Gr.getInstance(),Oo=Object.freeze(Object.defineProperty({__proto__:null,MarketService:Gr,marketService:an},Symbol.toStringTag,{value:"Module"}));class on{static instance;autoClickInterval=null;autoProductionInterval=null;autoSellInterval=null;maintenanceInterval=null;autoClickFrequency=1e3;autoProductionFrequency=1e3;autoSellFrequency=2e3;maintenanceFrequency=5e3;autoClickerConfigs=[{id:"basic_clicker",name:"Basic Auto-Clicker",description:"Automatically clicks once per second",baseCost:50,costMultiplier:1.15,baseClicksPerSecond:1,maxLevel:50},{id:"fast_clicker",name:"Fast Auto-Clicker",description:"Clicks 3 times per second with improved efficiency",baseCost:250,costMultiplier:1.2,baseClicksPerSecond:3,maxLevel:25,unlockRequirement:{totalProduced:1000n}},{id:"turbo_clicker",name:"Turbo Auto-Clicker",description:"High-speed clicking with 8 clicks per second",baseCost:1e3,costMultiplier:1.25,baseClicksPerSecond:8,maxLevel:10,unlockRequirement:{totalProduced:10000n,totalRevenue:1e3}},{id:"quantum_clicker",name:"Quantum Auto-Clicker",description:"Theoretical physics-powered clicking at 20/second",baseCost:5e3,costMultiplier:1.3,baseClicksPerSecond:20,maxLevel:5,unlockRequirement:{totalProduced:100000n,totalRevenue:1e4}}];facilityConfigs=[{id:"basic_factory",name:"Basic Matchstick Factory",description:"Produces 5 matchsticks per second automatically",cost:500,baseProduction:5n,owned:0,maxOwned:10,efficiency:1,maintenanceCost:2,unlockRequirement:{totalProduced:5000n}},{id:"advanced_factory",name:"Advanced Production Line",description:"High-efficiency production of 25 matchsticks/second",cost:2500,baseProduction:25n,owned:0,maxOwned:5,efficiency:1,maintenanceCost:8,unlockRequirement:{totalProduced:50000n,autoClickersOwned:5}},{id:"mega_plant",name:"Mega Production Plant",description:"Industrial-scale production at 100 matchsticks/second",cost:15e3,baseProduction:100n,owned:0,maxOwned:2,efficiency:1,maintenanceCost:30,unlockRequirement:{type:"resource",condition:"totalProduced",value:500000n,description:"Requires 500,000 total production"}}];constructor(){this.startAutomation()}static getInstance(){return on.instance||(on.instance=new on),on.instance}purchaseAutoClicker(r){try{const i=this.autoClickerConfigs.find(K=>K.id===r);if(!i)return{success:!1,error:"Auto-clicker not found"};const c=lt(de),f=c.automation.autoClickers.find(K=>K.id===r),g=f?.level||0;if(g>=i.maxLevel)return{success:!1,error:"Maximum level reached"};if(!this.checkUnlockRequirement(i.unlockRequirement,c))return{success:!1,error:"Unlock requirements not met"};const y=this.calculateAutoClickerCost(i,g);if(c.resources.money<y)return{success:!1,error:"Insufficient funds"};ge.addResources({money:-y});const P=g+1,q=[...c.automation.autoClickers];if(f){const K=q.findIndex(W=>W.id===r);q[K]={...f,level:P}}else q.push({id:r,level:P,isActive:!0,totalClicks:0n,efficiency:1});ge.updateAutomation({autoClickers:q});const $=(c.automation.totalMoneySpent||0)+y;return ge.updateAutomation({totalMoneySpent:$}),ge.emitEvent({id:`autoclicker_purchase_${Date.now()}`,type:"upgrade_purchased",timestamp:Date.now(),data:{itemType:"auto_clicker",itemId:r,cost:y,newLevel:P,totalSpent:$},source:"automation_service"}),fr.checkAchievements(),{success:!0,cost:y,newLevel:P}}catch(i){return be.handleError(we.gameLogic("Failed to purchase auto-clicker",{error:i,clickerId:r})),{success:!1,error:"Purchase failed"}}}purchaseFacility(r){try{const i=this.facilityConfigs.find(q=>q.id===r);if(!i)return{success:!1,error:"Facility not found"};const c=lt(de),f=i.owned;if(f>=i.maxOwned)return{success:!1,error:"Maximum facilities owned"};if(!this.checkUnlockRequirement(i.unlockRequirement,c))return{success:!1,error:"Unlock requirements not met"};const g=Math.floor(i.cost*Math.pow(1.5,f));if(c.resources.money<g)return{success:!1,error:"Insufficient funds"};ge.addResources({money:-g});const y=this.facilityConfigs.findIndex(q=>q.id===r);this.facilityConfigs[y].owned=f+1;const P=c.automation.totalMoneySpent+g;return ge.updateAutomation({totalMoneySpent:P}),ge.emitEvent({id:`facility_purchase_${Date.now()}`,type:"upgrade_purchased",timestamp:Date.now(),data:{itemType:"facility",itemId:r,cost:g,newCount:f+1,totalSpent:P},source:"automation_service"}),fr.checkAchievements(),{success:!0,cost:g,newCount:f+1}}catch(i){return be.handleError(we.gameLogic("Failed to purchase facility",{error:i,facilityId:r})),{success:!1,error:"Purchase failed"}}}configureAutoSell(r){try{if(r.threshold<=0n||r.percentage<=0||r.percentage>100||r.minPrice<0||r.maxPerSecond<=0n)return!1;const i=lt(de);return ge.updateMarket({autoSellEnabled:r.enabled,autoSellThreshold:Number(r.threshold)}),ge.updateAutomation({autoSellSettings:{threshold:r.threshold,percentage:r.percentage,minPrice:r.minPrice,maxPerSecond:r.maxPerSecond,enabled:r.enabled}}),!0}catch(i){return be.handleError(we.gameLogic("Failed to configure auto-sell",{error:i})),!1}}getAutomationStats(){try{const r=lt(de),i=r.automation.autoClickers.reduce(($,K)=>$+K.level,0),c=this.facilityConfigs.reduce(($,K)=>$+K.owned,0),f=this.facilityConfigs.reduce(($,K)=>Et.add($,Et.multiply(K.baseProduction,BigInt(K.owned))),0n),g=r.automation.autoClickers.reduce(($,K)=>{const W=this.autoClickerConfigs.find(ue=>ue.id===K.id);return $+(W?W.baseClicksPerSecond*K.level:0)},0),y=this.facilityConfigs.reduce(($,K)=>$+K.maintenanceCost*K.owned,0),P=this.calculateEfficiencyRating(i,c),q=BigInt(Math.floor(y*.5)),R=Et.subtract(f,q);return{totalAutoClickers:i,totalFacilities:c,autoProductionRate:f,autoClickRate:g,totalMoneySpent:r.automation.totalMoneySpent,efficiencyRating:P,maintenanceCost:y,netProduction:R>0n?R:0n}}catch(r){return be.handleError(we.gameLogic("Failed to get automation stats",{error:r})),{totalAutoClickers:0,totalFacilities:0,autoProductionRate:0n,autoClickRate:0,totalMoneySpent:0,efficiencyRating:0,maintenanceCost:0,netProduction:0n}}}getAvailableAutoClickers(){try{const r=lt(de);return this.autoClickerConfigs.map(i=>{const f=r.automation.autoClickers.find(q=>q.id===i.id)?.level||0,g=this.calculateAutoClickerCost(i,f),y=this.checkUnlockRequirement(i.unlockRequirement,r),P=f>=i.maxLevel;return{...i,cost:g,currentLevel:f,isUnlocked:y,isMaxed:P}})}catch(r){return be.handleError(we.gameLogic("Failed to get available auto-clickers",{error:r})),[]}}getAvailableFacilities(){try{const r=lt(de);return this.facilityConfigs.map(i=>{const c=Math.floor(i.cost*Math.pow(1.5,i.owned)),f=this.checkUnlockRequirement(i.unlockRequirement,r),g=i.owned>=i.maxOwned;return{...i,cost:c,isUnlocked:f,isMaxed:g}})}catch(r){return be.handleError(we.gameLogic("Failed to get available facilities",{error:r})),[]}}stopAutomation(){this.autoClickInterval&&(clearInterval(this.autoClickInterval),this.autoClickInterval=null),this.autoProductionInterval&&(clearInterval(this.autoProductionInterval),this.autoProductionInterval=null),this.autoSellInterval&&(clearInterval(this.autoSellInterval),this.autoSellInterval=null),this.maintenanceInterval&&(clearInterval(this.maintenanceInterval),this.maintenanceInterval=null)}startAutomation(){this.autoClickInterval=setInterval(()=>{this.processAutoClickers()},this.autoClickFrequency),this.autoProductionInterval=setInterval(()=>{this.processAutoProduction()},this.autoProductionFrequency),this.autoSellInterval=setInterval(()=>{this.processAutoSell()},this.autoSellFrequency),this.maintenanceInterval=setInterval(()=>{this.processMaintenance()},this.maintenanceFrequency)}async processAutoClickers(){try{const r=lt(de);for(const i of r.automation.autoClickers){if(!i.isActive)continue;const c=this.autoClickerConfigs.find(y=>y.id===i.id);if(!c)continue;const f=c.baseClicksPerSecond*(this.autoClickFrequency/1e3),g=Math.floor(f*i.level*i.efficiency);if(g>0){const P=(await yi(()=>Promise.resolve().then(()=>qo),void 0,import.meta.url)).productionService.produceMatchsticks(g),q=r.automation.autoClickers.map(R=>R.id===i.id?{...R,totalClicks:Et.add(R.totalClicks,BigInt(g))}:R);ge.updateAutomation({autoClickers:q})}}}catch(r){be.handleError(we.gameLogic("Auto-clicker processing failed",{error:r}))}}processAutoProduction(){try{const r=this.facilityConfigs.reduce((i,c)=>{const f=Et.multiply(c.baseProduction,BigInt(c.owned)),g=Et.divide(Et.multiply(f,BigInt(this.autoProductionFrequency)),1000n);return Et.add(i,g)},0n);if(r>0n){ge.addResources({matchsticks:r});const i=lt(de);ge.updateProduction({totalProduced:Et.add(i.production.totalProduced,r)})}}catch(r){be.handleError(we.gameLogic("Auto production processing failed",{error:r}))}}async processAutoSell(){try{const r=lt(de),i=r.automation.autoSellSettings;if(!i?.enabled||!r.market.autoSellEnabled)return;const c=r.resources.matchsticks;if(c<i.threshold||r.market.currentPrice<i.minPrice)return;const f=Et.divide(Et.multiply(c,BigInt(i.percentage)),100n),g=f>i.maxPerSecond?i.maxPerSecond:f;g>0n&&(await yi(()=>Promise.resolve().then(()=>Oo),void 0,import.meta.url)).marketService.sellMatchsticks(g)}catch(r){be.handleError(we.gameLogic("Auto-sell processing failed",{error:r}))}}processMaintenance(){try{const r=this.facilityConfigs.reduce((i,c)=>i+c.maintenanceCost*c.owned,0);if(r>0){const i=r*(this.maintenanceFrequency/1e3);lt(de).resources.money>=i?ge.addResources({money:-i}):this.reduceFacilityEfficiency()}}catch(r){be.handleError(we.gameLogic("Maintenance processing failed",{error:r}))}}reduceFacilityEfficiency(){this.facilityConfigs.forEach(r=>{r.efficiency=Math.max(.1,r.efficiency-.05)}),ge.emitEvent({id:`maintenance_warning_${Date.now()}`,type:"maintenance_required",timestamp:Date.now(),data:{message:"Facility efficiency reduced due to unpaid maintenance"},source:"automation_service"})}calculateAutoClickerCost(r,i){return Math.floor(r.baseCost*Math.pow(r.costMultiplier,i))}checkUnlockRequirement(r,i){return r?!(r.totalProduced&&i.production.totalProduced<r.totalProduced||r.totalRevenue&&i.market.totalRevenue<r.totalRevenue||r.autoClickersOwned&&i.automation.autoClickers.reduce((f,g)=>f+g.level,0)<r.autoClickersOwned||r.gamePhase&&i.progression.currentPhase!==r.gamePhase):!0}calculateEfficiencyRating(r,i){const c=Math.min(100,(r+i)*5),f=Math.min(20,Math.abs(r-i*2)<5?20:0);return Math.min(100,c+f)}}const qr=on.getInstance(),tn=Hr.getInstance();class cn{static instance;autoSaveInterval=null;config;initialized=!1;constructor(){this.config={autoSaveInterval:3e4,enableAutoSave:!0,debugMode:!1}}static getInstance(){return cn.instance||(cn.instance=new cn),cn.instance}async initialize(){try{console.log("ð® Initializing Matchstick Empire..."),await tn.initialize();const r=await tn.loadMostRecentSave();r?(ge.load(r.gameState),console.log("ð¾ Loaded existing save:",r.saveId),fr.syncWithGameState(),ge.emitEvent({id:`auto_loaded_${Date.now()}`,type:"game_auto_loaded",timestamp:Date.now(),data:{saveId:r.saveId},source:"game_manager"})):(this.initializeNewGame(),console.log("ð No existing saves found, new game initialized")),this.config.enableAutoSave&&this.startAutoSave(),this.initialized=!0,console.log("ð Game initialization complete")}catch(r){console.error("â Failed to initialize game:",r),this.initializeNewGame(),this.initialized=!0}}initializeNewGame(){ge.reset(),ge.emitEvent({id:`new_game_${Date.now()}`,type:"new_game_started",timestamp:Date.now(),data:{},source:"game_manager"})}startAutoSave(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval),this.autoSaveInterval=setInterval(async()=>{await this.saveGame("auto-save")},this.config.autoSaveInterval),this.config.debugMode&&console.log(`ð¾ Auto-save enabled (${this.config.autoSaveInterval/1e3}s interval)`)}stopAutoSave(){this.autoSaveInterval&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}async saveGame(r){try{if(!this.initialized)return console.warn("Cannot save: Game not initialized"),!1;const i=lt(de),c={...i,metadata:{...i.metadata,lastSaved:Date.now()}};ge.load(c);const f=r||`Save ${new Date().toLocaleString()}`,g=r==="auto-save"||r==="shutdown-save"||r==="tab-hidden-save",y=await tn.saveGame(c,f,g);return typeof y=="string"?(this.config.debugMode&&console.log("ð¾ Game saved:",f),ge.emitEvent({id:`game_saved_${Date.now()}`,type:"game_saved",timestamp:Date.now(),data:{saveName:f,saveId:y,isAutoSave:g},source:"game_manager"}),!0):!1}catch(i){return console.error("â Failed to save game:",i),!1}}async loadGame(r){try{const i=await tn.loadGame(r);return i?(ge.load(i),console.log("â Game loaded from save:",r),fr.syncWithGameState(),ge.emitEvent({id:`game_loaded_${Date.now()}`,type:"game_loaded",timestamp:Date.now(),data:{saveId:r},source:"game_manager"}),!0):!1}catch(i){return console.error("â Failed to load game:",i),!1}}async resetGame(){try{this.initializeNewGame(),console.log("ð Game reset to initial state"),ge.emitEvent({id:`game_reset_${Date.now()}`,type:"game_reset",timestamp:Date.now(),data:{},source:"game_manager"})}catch(r){console.error("â Failed to reset game:",r)}}shutdown(){this.config.debugMode&&console.log("ð Shutting down Game Manager..."),this.saveGame("shutdown-save"),this.stopAutoSave(),this.initialized=!1,this.config.debugMode&&console.log("ð Game Manager shutdown complete")}updateConfig(r){this.config={...this.config,...r},(r.autoSaveInterval!==void 0||r.enableAutoSave!==void 0)&&(this.stopAutoSave(),this.config.enableAutoSave&&this.startAutoSave())}getConfig(){return{...this.config}}isInitialized(){return this.initialized}async getSaves(){try{return await tn.listSaves()}catch(r){return console.error("â Failed to get saves:",r),[]}}async deleteSave(r){try{return await tn.deleteSave(r),!0}catch(i){return console.error("â Failed to delete save:",i),!1}}}const Fa=cn.getInstance();typeof window<"u"&&(window.addEventListener("beforeunload",()=>{Fa.shutdown()}),document.addEventListener("visibilitychange",()=>{document.hidden&&Fa.saveGame("tab-hidden-save")}));function xe(u){let r;if(typeof u=="bigint"){if(u>Number.MAX_SAFE_INTEGER)return Do(u);r=Number(u)}else r=u;if(r===0)return"0";const i=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc"],c=Math.floor(Math.log10(Math.abs(r))/3);if(c===0)return r.toLocaleString();if(c>=i.length)return r.toExponential(2);const f=i[c],g=Math.pow(10,c*3),y=r/g,P=y<10?2:y<100?1:0;return y.toFixed(P)+f}function Do(u){const r=u.toString(),i=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc"];if(r.length<=3)return r;const c=Math.floor((r.length-1)/3);if(c>=i.length)return`${r.slice(0,3)}...e${r.length-1}`;const f=r.length-c*3,g=r.slice(0,f),y=r.slice(f,f+2);let P=g;return y&&y!=="00"&&(P+="."+y.replace(/0+$/,"")),P+i[c]}function ct(u,r="$"){return!u||u===0?`${r}0.00`:Math.abs(u)>=1e3?`${r}${xe(u)}`:`${r}${u.toFixed(2)}`}function _r(u,r=1){return`${(u*100).toFixed(r)}%`}function Pi(u){if(u<1e3)return`${u}ms`;const r=Math.floor(u/1e3),i=Math.floor(r/60),c=Math.floor(i/60),f=Math.floor(c/24);return f>0?`${f}d ${c%24}h`:c>0?`${c}h ${i%60}m`:i>0?`${i}m ${r%60}s`:`${r}s`}function Ai(u,r="sec"){return`${xe(u)}/${r}`}function rn(u){return u===1?"1x":`${u.toFixed(u<10?2:1)}x`}function Un(u,r){return r===0?"100%":`${Math.min(u/r*100,100).toFixed(1)}% (${xe(u)}/${xe(r)})`}var $o=Fe('<div class="click-animation svelte-etcxcj"> </div>'),Fo=Fe('<div class="combo-display svelte-etcxcj"><span class="combo-count svelte-etcxcj"> </span> <span class="combo-multiplier svelte-etcxcj"> </span></div>'),Ko=Fe('<div class="multiplier-item svelte-etcxcj"><span class="multiplier-name svelte-etcxcj">Combo Bonus</span> <span class="multiplier-value svelte-etcxcj"> </span></div>'),No=Fe('<div class="production-panel svelte-etcxcj"><div class="panel-header svelte-etcxcj"><h2 class="svelte-etcxcj">ð¥ Production Center</h2> <p class="panel-description svelte-etcxcj">Click to create matchsticks and build your empire!</p></div> <div class="production-content svelte-etcxcj"><div class="production-main svelte-etcxcj"><div class="production-button-container svelte-etcxcj"><button><div class="button-background svelte-etcxcj"></div> <div class="button-content svelte-etcxcj"><div class="button-icon svelte-etcxcj">ð¥</div> <div class="button-text svelte-etcxcj"><span class="action-text svelte-etcxcj">Create Matchstick</span> <span class="rate-text svelte-etcxcj"> </span></div></div> <!> <!></button> <div class="keyboard-hint svelte-etcxcj">Press <kbd class="svelte-etcxcj">Space</kbd> to click</div></div> <div class="production-stats svelte-etcxcj"><div class="stat-grid svelte-etcxcj"><div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">ð</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Total Produced</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">â¡</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Production Rate</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">ð¯</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Total Clicks</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">ð¥</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Max Combo</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">â±ï¸</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Avg Click Rate</div> <div class="stat-value svelte-etcxcj"> </div></div></div> <div class="stat-card svelte-etcxcj"><div class="stat-icon svelte-etcxcj">ð</div> <div class="stat-content svelte-etcxcj"><div class="stat-label svelte-etcxcj">Session Production</div> <div class="stat-value svelte-etcxcj"> </div></div></div></div></div></div> <div class="production-sidebar svelte-etcxcj"><div class="session-info svelte-etcxcj"><h3 class="svelte-etcxcj">Current Session</h3> <div class="session-stats svelte-etcxcj"><div class="session-stat svelte-etcxcj"><span class="label svelte-etcxcj">Clicks:</span> <span class="value svelte-etcxcj"> </span></div> <div class="session-stat svelte-etcxcj"><span class="label svelte-etcxcj">Produced:</span> <span class="value svelte-etcxcj"> </span></div> <div class="session-stat svelte-etcxcj"><span class="label svelte-etcxcj">Current Combo:</span> <span class="value combo-highlight svelte-etcxcj"> </span></div></div></div> <div class="production-tips svelte-etcxcj"><h3 class="svelte-etcxcj">ð¡ Tips</h3> <ul class="tips-list svelte-etcxcj"><li class="svelte-etcxcj">Click rapidly to build up combo multipliers</li> <li class="svelte-etcxcj">Higher combos give exponential bonuses</li> <li class="svelte-etcxcj">Use the spacebar for faster clicking</li> <li class="svelte-etcxcj">Upgrade your automation to produce while away</li> <li class="svelte-etcxcj">Watch the market for optimal selling times</li></ul></div> <div class="multipliers-info svelte-etcxcj"><h3 class="svelte-etcxcj">ð Active Multipliers</h3> <div class="multipliers-list svelte-etcxcj"><!> <div class="multiplier-item svelte-etcxcj"><span class="multiplier-name svelte-etcxcj">Base Rate</span> <span class="multiplier-value svelte-etcxcj"> </span></div></div></div></div></div></div>');function Bo(u,r){wr(r,!1);const[i,c]=Xr(),f=()=>Fr(de,"$gameState",i),g=ze(),y=ze();let P=ze([]),q=ze(),R=ze({count:0,multiplier:1});Xn(()=>{const Ke=setInterval(()=>{ye(R,Or.getComboInfo())},100);return()=>{clearInterval(Ke)}});function $(Ke){const me=Date.now();if(Or.produceMatchsticks(1),o(q)){const F=o(q).getBoundingClientRect(),kt=Ke.clientX-F.left,ht=Ke.clientY-F.top,qt=`anim_${me}_${Math.random().toString(36).substr(2,9)}`;ye(P,[...o(P),{id:qt,x:kt,y:ht}]),setTimeout(()=>{ye(P,o(P).filter(N=>N.id!==qt))},1e3)}}function K(Ke){if(Ke.code==="Space"&&!Ke.repeat&&(Ke.preventDefault(),o(q))){const me=o(q).getBoundingClientRect(),F={clientX:me.left+me.width/2,clientY:me.top+me.height/2};$(F)}}Tt(()=>Or,()=>{ye(g,Or.getProductionStats())}),Tt(()=>Or,()=>{ye(y,Or.getCurrentProductionRate())}),un(),br();var W=No();Lt("keydown",Ni,K);var ue=p(v(W),2),X=v(ue),ee=v(X),te=v(ee);let ce;var oe=p(v(te),2),Se=p(v(oe),2),Ce=p(v(Se),2),ke=v(Ce);d(Ce),d(Se),d(oe);var V=p(oe,2);vr(V,1,()=>o(P),Ke=>Ke.id,(Ke,me)=>{var F=$o(),kt=v(F);d(F),Le(ht=>{Nt(F,`left: ${o(me),I(()=>o(me).x)??""}px; top: ${o(me),I(()=>o(me).y)??""}px;`),D(kt,`+${ht??""}`)},[()=>(ie(xe),o(y),I(()=>xe(o(y))))]),sr(3,F,()=>Ur,()=>({y:-50,duration:1e3,easing:Dr})),re(Ke,F)});var ne=p(V,2);{var Ie=Ke=>{var me=Fo(),F=v(me),kt=v(F);d(F);var ht=p(F,2),qt=v(ht,!0);d(ht),d(me),Le(N=>{D(kt,`${o(R),I(()=>o(R).count)??""}x`),D(qt,N)},[()=>(ie(rn),o(R),I(()=>rn(o(R).multiplier)))]),sr(3,me,()=>Ka,()=>({duration:200})),re(Ke,me)};pt(ne,Ke=>{o(R),I(()=>o(R).count>0)&&Ke(Ie)})}d(te),Qs(te,Ke=>ye(q,Ke),()=>o(q)),Vn(2),d(ee);var Ze=p(ee,2),ut=v(Ze),dt=v(ut),je=p(v(dt),2),Te=p(v(je),2),We=v(Te,!0);d(Te),d(je),d(dt);var et=p(dt,2),gt=p(v(et),2),St=p(v(gt),2),Xe=v(St);d(St),d(gt),d(et);var tt=p(et,2),se=p(v(tt),2),G=p(v(se),2),at=v(G,!0);d(G),d(se),d(tt);var _e=p(tt,2),it=p(v(_e),2),vt=p(v(it),2),st=v(vt);d(vt),d(it),d(_e);var _t=p(_e,2),Ct=p(v(_t),2),J=p(v(Ct),2),Mt=v(J,!0);d(J),d(Ct),d(_t);var le=p(_t,2),U=p(v(le),2),Ae=p(v(U),2),Re=v(Ae,!0);d(Ae),d(U),d(le),d(ut),d(Ze),d(X);var qe=p(X,2),Ve=v(qe),Ye=p(v(Ve),2),bt=v(Ye),wt=p(v(bt),2),ve=v(wt,!0);d(wt),d(bt);var z=p(bt,2),Pe=p(v(z),2),De=v(Pe,!0);d(Pe),d(z);var he=p(z,2),fe=p(v(he),2),pe=v(fe);d(fe),d(he),d(Ye),d(Ve);var Oe=p(Ve,4),Pt=p(v(Oe),2),ft=v(Pt);{var ot=Ke=>{var me=Ko(),F=p(v(me),2),kt=v(F,!0);d(F),d(me),Le(ht=>D(kt,ht),[()=>(ie(rn),o(R),I(()=>rn(o(R).multiplier)))]),re(Ke,me)};pt(ft,Ke=>{o(R),I(()=>o(R).multiplier>1)&&Ke(ot)})}var mt=p(ft,2),yt=p(v(mt),2),Rt=v(yt,!0);d(yt),d(mt),d(Pt),d(Oe),d(qe),d(ue),d(W),Le((Ke,me,F,kt,ht,qt,N,Gt,Qt,rr)=>{ce=gr(te,1,"production-button svelte-etcxcj",null,ce,Ke),Nt(te,`transform: scale(${me??""})`),D(ke,`+${F??""} per click`),D(We,kt),D(Xe,`${ht??""}/click`),D(at,qt),D(st,`${o(g),I(()=>o(g).maxCombo)??""}x`),D(Mt,N),D(Re,Gt),D(ve,(o(g),I(()=>o(g).sessionClicks))),D(De,Qt),D(pe,`${o(R),I(()=>o(R).count)??""}x`),D(Rt,rr)},[()=>({"combo-active":o(R).count>0}),()=>(o(R),I(()=>1+Math.min(o(R).count*.01,.2))),()=>(ie(xe),o(y),I(()=>xe(o(y)))),()=>(ie(xe),f(),I(()=>xe(f().production.totalProduced))),()=>(ie(xe),o(y),I(()=>xe(o(y)))),()=>(ie(xe),o(g),I(()=>xe(o(g).totalClicks))),()=>(ie(Ai),o(g),I(()=>Ai(o(g).averageClickRate,"min"))),()=>(ie(xe),o(g),I(()=>xe(o(g).sessionProduction))),()=>(ie(xe),o(g),I(()=>xe(o(g).sessionProduction))),()=>(ie(rn),f(),I(()=>rn(f().production.manualRate)))]),Lt("click",te,$),re(u,W),kr(),c()}var Lo=Fe('<div class="trade-item svelte-rkw790"><div class="trade-info svelte-rkw790"><span class="trade-amount svelte-rkw790"> </span> <span class="trade-separator svelte-rkw790">@</span> <span class="trade-price svelte-rkw790"> </span></div> <div class="trade-revenue svelte-rkw790"> </div> <div class="trade-time svelte-rkw790"> </div></div>'),zo=Fe('<div class="trades-list svelte-rkw790"></div>'),Uo=Fe('<div class="empty-trades svelte-rkw790"><span class="empty-icon svelte-rkw790">ð</span> <span class="empty-text svelte-rkw790">No trades yet. Start selling to see your trading history!</span></div>'),Ho=Fe('<div class="market-panel svelte-rkw790"><div class="panel-header svelte-rkw790"><h2 class="svelte-rkw790">ð Market Trading</h2> <p class="panel-description svelte-rkw790">Sell your matchsticks and track market trends!</p></div> <div class="market-content svelte-rkw790"><div class="market-section trading-section svelte-rkw790"><h3 class="svelte-rkw790">ð° Sell Matchsticks</h3> <div class="trading-container svelte-rkw790"><div class="price-display svelte-rkw790"><div class="price-info svelte-rkw790"><span class="price-label svelte-rkw790">Current Price:</span> <span class="price-value svelte-rkw790"> </span></div> <div class="trend-info svelte-rkw790"> </div></div> <div class="sell-controls svelte-rkw790"><div class="amount-input svelte-rkw790"><label for="sell-amount" class="svelte-rkw790">Amount to Sell:</label> <input id="sell-amount" type="text" placeholder="Enter amount" class="svelte-rkw790"/></div> <div class="quick-amounts svelte-rkw790"><button class="quick-btn svelte-rkw790">25%</button> <button class="quick-btn svelte-rkw790">50%</button> <button class="quick-btn svelte-rkw790">All</button></div></div> <div class="sale-preview svelte-rkw790"><div class="preview-item svelte-rkw790"><span class="label svelte-rkw790">Selling:</span> <span class="value svelte-rkw790"> </span></div> <div class="preview-item svelte-rkw790"><span class="label svelte-rkw790">Revenue:</span> <span class="value svelte-rkw790"> </span></div> <div class="preview-item svelte-rkw790"><span class="label svelte-rkw790">Remaining:</span> <span class="value svelte-rkw790"> </span></div></div> <button class="sell-button svelte-rkw790">Sell Matchsticks</button></div></div> <div class="market-section svelte-rkw790"><h3 class="svelte-rkw790">ð Market Analysis</h3> <div class="analysis-grid svelte-rkw790"><div class="analysis-card svelte-rkw790"><div class="analysis-header svelte-rkw790"><span class="analysis-icon svelte-rkw790">ð</span> <span class="analysis-title svelte-rkw790">Price Trend</span></div> <div class="analysis-value svelte-rkw790"> </div></div> <div class="analysis-card svelte-rkw790"><div class="analysis-header svelte-rkw790"><span class="analysis-icon svelte-rkw790">ð</span> <span class="analysis-title svelte-rkw790">Volatility</span></div> <div class="analysis-value svelte-rkw790"> </div></div> <div class="analysis-card svelte-rkw790"><div class="analysis-header svelte-rkw790"><span class="analysis-icon svelte-rkw790">ð¹</span> <span class="analysis-title svelte-rkw790">Volume</span></div> <div class="analysis-value svelte-rkw790"> </div></div> <div class="analysis-card svelte-rkw790"><div class="analysis-header svelte-rkw790"><span class="analysis-icon svelte-rkw790">ð¯</span> <span class="analysis-title svelte-rkw790">Recommendation</span></div> <div class="analysis-value svelte-rkw790"> </div></div></div></div> <div class="market-section svelte-rkw790"><h3 class="svelte-rkw790">ð Recent Trades</h3> <div class="trades-container svelte-rkw790"><!></div></div> <div class="market-section svelte-rkw790"><h3 class="svelte-rkw790">ð Market Statistics</h3> <div class="stats-grid svelte-rkw790"><div class="stat-card svelte-rkw790"><div class="stat-icon svelte-rkw790">ð°</div> <div class="stat-content svelte-rkw790"><div class="stat-label svelte-rkw790">Total Revenue</div> <div class="stat-value svelte-rkw790"> </div></div></div> <div class="stat-card svelte-rkw790"><div class="stat-icon svelte-rkw790">ð¦</div> <div class="stat-content svelte-rkw790"><div class="stat-label svelte-rkw790">Total Sold</div> <div class="stat-value svelte-rkw790"> </div></div></div> <div class="stat-card svelte-rkw790"><div class="stat-icon svelte-rkw790">ð</div> <div class="stat-content svelte-rkw790"><div class="stat-label svelte-rkw790">Avg Price</div> <div class="stat-value svelte-rkw790"> </div></div></div> <div class="stat-card svelte-rkw790"><div class="stat-icon svelte-rkw790">ð¯</div> <div class="stat-content svelte-rkw790"><div class="stat-label svelte-rkw790">Market Share</div> <div class="stat-value svelte-rkw790"> </div></div></div></div></div></div></div>');function Vo(u,r){wr(r,!1);const[i,c]=Xr(),f=()=>Fr(de,"$gameState",i),g=ze(),y=ze(),P=ze(),q=ze();let R=ze(1n),$=ze("1");function K(){if(o(R)>0n&&o(R)<=o(q)){const rt=an.sellMatchsticks(o(R));console.log("Sale result:",rt),ye(R,1n),ye($,"1")}}function W(rt){try{const It=BigInt(rt||"0");It>=0n&&(ye(R,It),ye($,rt))}catch{}}function ue(){ye(R,o(q)),ye($,o(q).toString())}function X(){const rt=o(q)/2n;ye(R,rt),ye($,rt.toString())}function ee(){const rt=o(q)/4n;ye(R,rt),ye($,rt.toString())}function te(rt){switch(rt){case"up":return"ð";case"down":return"ð";default:return"â¡ï¸"}}function ce(rt){switch(rt){case"up":return"#4caf50";case"down":return"#f44336";default:return"#78909c"}}Tt(()=>an,()=>{ye(g,an.getMarketAnalysis())}),Tt(()=>an,()=>{ye(y,an.getRecentTrades().slice(0,10))}),Tt(()=>f(),()=>{ye(P,f().market.currentPrice)}),Tt(()=>f(),()=>{ye(q,f().resources.matchsticks)}),un(),br();var oe=Ho(),Se=p(v(oe),2),Ce=v(Se),ke=p(v(Ce),2),V=v(ke),ne=v(V),Ie=p(v(ne),2),Ze=v(Ie,!0);d(Ie),d(ne);var ut=p(ne,2),dt=v(ut);d(ut),d(V);var je=p(V,2),Te=v(je),We=p(v(Te),2);io(We),d(Te);var et=p(Te,2),gt=v(et),St=p(gt,2),Xe=p(St,2);d(et),d(je);var tt=p(je,2),se=v(tt),G=p(v(se),2),at=v(G);d(G),d(se);var _e=p(se,2),it=p(v(_e),2),vt=v(it,!0);d(it),d(_e);var st=p(_e,2),_t=p(v(st),2),Ct=v(_t,!0);d(_t),d(st),d(tt);var J=p(tt,2);d(ke),d(Ce);var Mt=p(Ce,2),le=p(v(Mt),2),U=v(le),Ae=p(v(U),2),Re=v(Ae,!0);d(Ae),d(U);var qe=p(U,2),Ve=p(v(qe),2),Ye=v(Ve,!0);d(Ve),d(qe);var bt=p(qe,2),wt=p(v(bt),2),ve=v(wt,!0);d(wt),d(bt);var z=p(bt,2),Pe=p(v(z),2),De=v(Pe,!0);d(Pe),d(z),d(le),d(Mt);var he=p(Mt,2),fe=p(v(he),2),pe=v(fe);{var Oe=rt=>{var It=zo();vr(It,5,()=>o(y),Ir,(Wt,Be)=>{var Ge=Lo(),Ee=v(Ge),Qe=v(Ee),xt=v(Qe,!0);d(Qe);var Ot=p(Qe,4),Dt=v(Ot,!0);d(Ot),d(Ee);var Ft=p(Ee,2),Sr=v(Ft,!0);d(Ft);var Xt=p(Ft,2),lr=v(Xt,!0);d(Xt),d(Ge),Le((Kt,Jt,Kr,Zt)=>{D(xt,Kt),D(Dt,Jt),D(Sr,Kr),D(lr,Zt)},[()=>(ie(xe),o(Be),I(()=>xe(o(Be).matchsticksSold))),()=>(ie(ct),o(Be),I(()=>ct(o(Be).pricePerUnit))),()=>(ie(ct),o(Be),I(()=>ct(o(Be).totalRevenue))),()=>(o(Be),I(()=>new Date(o(Be).timestamp).toLocaleTimeString()))]),re(Wt,Ge)}),d(It),re(rt,It)},Pt=rt=>{var It=Uo();re(rt,It)};pt(pe,rt=>{o(y),I(()=>o(y).length>0)?rt(Oe):rt(Pt,!1)})}d(fe),d(he);var ft=p(he,2),ot=p(v(ft),2),mt=v(ot),yt=p(v(mt),2),Rt=p(v(yt),2),Ke=v(Rt,!0);d(Rt),d(yt),d(mt);var me=p(mt,2),F=p(v(me),2),kt=p(v(F),2),ht=v(kt,!0);d(kt),d(F),d(me);var qt=p(me,2),N=p(v(qt),2),Gt=p(v(N),2),Qt=v(Gt,!0);d(Gt),d(N),d(qt);var rr=p(qt,2),hr=p(v(rr),2),cr=p(v(hr),2),xr=v(cr,!0);d(cr),d(hr),d(rr),d(ot),d(ft),d(Se),d(oe),Le((rt,It,Wt,Be,Ge,Ee,Qe,xt,Ot,Dt,Ft,Sr)=>{D(Ze,rt),Nt(ut,`color: ${It??""}`),D(dt,`${Wt??""}
            ${f(),I(()=>f().market.trend||"stable")??""}`),D(at,`${Be??""} matchsticks`),D(vt,Ge),D(Ct,Ee),J.disabled=o(R)<=0n||o(R)>o(q)||o(q)===0n,D(Re,(o(g),I(()=>o(g)?.trend||"Stable"))),D(Ye,Qe),D(ve,xt),D(De,(o(g),I(()=>o(g)?.recommendation||"Hold"))),D(Ke,Ot),D(ht,Dt),D(Qt,Ft),D(xr,Sr)},[()=>(ie(ct),o(P),I(()=>ct(o(P)))),()=>(f(),I(()=>ce(f().market.trend))),()=>(f(),I(()=>te(f().market.trend))),()=>(ie(xe),o(R),I(()=>xe(o(R)))),()=>(ie(ct),o(R),o(P),I(()=>ct(Number(o(R))*o(P)))),()=>(ie(xe),o(q),o(R),I(()=>xe(o(q)-o(R)))),()=>(ie(_r),o(g),I(()=>_r(o(g)?.volatility||0))),()=>(ie(xe),o(g),I(()=>xe(o(g)?.averageVolume||0))),()=>(ie(ct),f(),I(()=>ct(f().market.totalRevenue))),()=>(ie(xe),f(),I(()=>xe(f().market.totalSold))),()=>(ie(ct),f(),I(()=>ct(f().market.totalRevenue/Number(f().market.totalSold||1n)))),()=>(ie(_r),I(()=>_r(.05)))]),fo(We,()=>o($),rt=>ye($,rt)),Lt("input",We,rt=>W(rt.target.value)),Lt("click",gt,ee),Lt("click",St,X),Lt("click",Xe,ue),Lt("click",J,K),re(u,oe),kr(),c()}var Go=Fe('<div class="unlock-requirement svelte-h067jd"> </div>'),Wo=Fe('<div><div class="card-header svelte-h067jd"><div class="card-icon svelte-h067jd"> </div> <div class="card-info svelte-h067jd"><h4 class="svelte-h067jd"> </h4> <p class="svelte-h067jd"> </p> <!></div></div> <div class="card-stats svelte-h067jd"><div class="stat svelte-h067jd"><span class="label svelte-h067jd">Rate:</span> <span class="value svelte-h067jd"> </span></div> <div class="stat svelte-h067jd"><span class="label svelte-h067jd">Level:</span> <span class="value svelte-h067jd"> </span></div></div> <button> </button></div>'),Xo=Fe('<div class="unlock-requirement svelte-h067jd"> </div>'),Yo=Fe('<div><div class="card-header svelte-h067jd"><div class="card-icon svelte-h067jd"> </div> <div class="card-info svelte-h067jd"><h4 class="svelte-h067jd"> </h4> <p class="svelte-h067jd"> </p> <!></div></div> <div class="card-stats svelte-h067jd"><div class="stat svelte-h067jd"><span class="label svelte-h067jd">Production:</span> <span class="value svelte-h067jd"> </span></div> <div class="stat svelte-h067jd"><span class="label svelte-h067jd">Owned:</span> <span class="value svelte-h067jd"> </span></div></div> <button> </button></div>'),Qo=Fe(`<div class="automation-panel svelte-h067jd"><div class="panel-header svelte-h067jd"><h2 class="svelte-h067jd">âï¸ Automation Center</h2> <p class="panel-description svelte-h067jd">Automate your production and scale your empire!</p></div> <div class="automation-content svelte-h067jd"><div class="automation-section svelte-h067jd"><h3 class="svelte-h067jd">ð±ï¸ Auto-Clickers</h3> <p class="section-description svelte-h067jd">Automatically click to produce matchsticks even when you're away</p> <div class="automation-grid svelte-h067jd"></div></div> <div class="automation-section svelte-h067jd"><h3 class="svelte-h067jd">ð­ Production Facilities</h3> <p class="section-description svelte-h067jd">Build facilities that automatically produce matchsticks</p> <div class="automation-grid svelte-h067jd"></div></div> <div class="automation-section svelte-h067jd"><h3 class="svelte-h067jd">ð Automation Statistics</h3> <div class="stats-grid svelte-h067jd"><div class="stat-card svelte-h067jd"><div class="stat-icon svelte-h067jd">ð°</div> <div class="stat-content svelte-h067jd"><div class="stat-label svelte-h067jd">Total Investment</div> <div class="stat-value svelte-h067jd"> </div></div></div> <div class="stat-card svelte-h067jd"><div class="stat-icon svelte-h067jd">â¡</div> <div class="stat-content svelte-h067jd"><div class="stat-label svelte-h067jd">Auto Production</div> <div class="stat-value svelte-h067jd"> </div></div></div> <div class="stat-card svelte-h067jd"><div class="stat-icon svelte-h067jd">ð­</div> <div class="stat-content svelte-h067jd"><div class="stat-label svelte-h067jd">Facilities</div> <div class="stat-value svelte-h067jd"> </div></div></div> <div class="stat-card svelte-h067jd"><div class="stat-icon svelte-h067jd">ð±ï¸</div> <div class="stat-content svelte-h067jd"><div class="stat-label svelte-h067jd">Auto-Clickers</div> <div class="stat-value svelte-h067jd"> </div></div></div></div></div></div></div>`);function Jo(u,r){wr(r,!1);const[i,c]=Xr(),f=()=>Fr(de,"$gameState",i),g=ze(),y=ze(),P=ze();function q(se){const G=qr.purchaseAutoClicker(se);console.log("Auto-clicker purchase result:",G)}function R(se){const G=qr.purchaseFacility(se);console.log("Facility purchase result:",G)}function $(se){if(!se)return"";const G=[];return se.totalProduced&&G.push(`${xe(Number(se.totalProduced))} total production`),se.totalRevenue&&G.push(`${ct(se.totalRevenue)} total revenue`),se.autoClickersOwned&&G.push(`${se.autoClickersOwned} auto-clickers owned`),se.gamePhase&&G.push(`${se.gamePhase} phase`),G.length>0?`Requires: ${G.join(" + ")}`:"Requirements not met"}function K(se,G){return se.isUnlocked?se.isMaxed?{text:G==="clicker"?`Max Level (${se.currentLevel}/${se.maxLevel})`:`Max Owned (${se.owned}/${se.maxOwned})`,disabled:!0,variant:"maxed"}:f().resources.money<se.cost?{text:`Buy for ${ct(se.cost)}`,disabled:!0,variant:"insufficient"}:{text:`Buy for ${ct(se.cost)}`,disabled:!1,variant:"available"}:{text:$(se.unlockRequirement),disabled:!0,variant:"locked"}}Tt(()=>(f(),qr),()=>{ye(g,f().automation&&qr.getAvailableAutoClickers())}),Tt(()=>(f(),qr),()=>{ye(y,f().automation&&qr.getAvailableFacilities())}),Tt(()=>(f(),qr),()=>{ye(P,f().automation&&qr.getAutomationStats())}),un(),br();var W=Qo(),ue=p(v(W),2),X=v(ue),ee=p(v(X),4);vr(ee,5,()=>o(g),Ir,(se,G)=>{var at=Wo();const _e=ln(()=>(o(G),I(()=>K(o(G),"clicker"))));let it;var vt=v(at),st=v(vt),_t=v(st,!0);d(st);var Ct=p(st,2),J=v(Ct),Mt=v(J,!0);d(J);var le=p(J,2),U=v(le,!0);d(le);var Ae=p(le,2);{var Re=fe=>{var pe=Go(),Oe=v(pe);d(pe),Le(Pt=>D(Oe,`ð ${Pt??""}`),[()=>(o(G),I(()=>$(o(G).unlockRequirement)))]),re(fe,pe)};pt(Ae,fe=>{o(G),I(()=>!o(G).isUnlocked)&&fe(Re)})}d(Ct),d(vt);var qe=p(vt,2),Ve=v(qe),Ye=p(v(Ve),2),bt=v(Ye);d(Ye),d(Ve);var wt=p(Ve,2),ve=p(v(wt),2),z=v(ve);d(ve),d(wt),d(qe);var Pe=p(qe,2);let De;var he=v(Pe,!0);d(Pe),d(at),Le((fe,pe,Oe)=>{it=gr(at,1,"automation-card svelte-h067jd",null,it,fe),D(_t,(o(G),I(()=>o(G).icon||"ð±ï¸"))),D(Mt,(o(G),I(()=>o(G).name))),D(U,(o(G),I(()=>o(G).description))),D(bt,`${pe??""}/sec`),D(z,`${o(G),I(()=>o(G).currentLevel)??""}/${o(G),I(()=>o(G).maxLevel)??""}`),De=gr(Pe,1,"purchase-button svelte-h067jd",null,De,Oe),Pe.disabled=(ie(o(_e)),I(()=>o(_e).disabled)),D(he,(ie(o(_e)),I(()=>o(_e).text)))},[()=>({locked:!o(G).isUnlocked,maxed:o(G).isMaxed}),()=>(ie(xe),o(G),I(()=>xe(o(G).baseClicksPerSecond))),()=>({locked:o(_e).variant==="locked",maxed:o(_e).variant==="maxed",insufficient:o(_e).variant==="insufficient",available:o(_e).variant==="available"})]),Lt("click",Pe,()=>q(o(G).id)),re(se,at)}),d(ee),d(X);var te=p(X,2),ce=p(v(te),4);vr(ce,5,()=>o(y),Ir,(se,G)=>{var at=Yo();const _e=ln(()=>(o(G),I(()=>K(o(G),"facility"))));let it;var vt=v(at),st=v(vt),_t=v(st,!0);d(st);var Ct=p(st,2),J=v(Ct),Mt=v(J,!0);d(J);var le=p(J,2),U=v(le,!0);d(le);var Ae=p(le,2);{var Re=fe=>{var pe=Xo(),Oe=v(pe);d(pe),Le(Pt=>D(Oe,`ð ${Pt??""}`),[()=>(o(G),I(()=>$(o(G).unlockRequirement)))]),re(fe,pe)};pt(Ae,fe=>{o(G),I(()=>!o(G).isUnlocked)&&fe(Re)})}d(Ct),d(vt);var qe=p(vt,2),Ve=v(qe),Ye=p(v(Ve),2),bt=v(Ye);d(Ye),d(Ve);var wt=p(Ve,2),ve=p(v(wt),2),z=v(ve);d(ve),d(wt),d(qe);var Pe=p(qe,2);let De;var he=v(Pe,!0);d(Pe),d(at),Le((fe,pe,Oe)=>{it=gr(at,1,"automation-card svelte-h067jd",null,it,fe),D(_t,(o(G),I(()=>o(G).icon||"ð­"))),D(Mt,(o(G),I(()=>o(G).name))),D(U,(o(G),I(()=>o(G).description))),D(bt,`${pe??""}/sec`),D(z,`${o(G),I(()=>o(G).owned)??""}/${o(G),I(()=>o(G).maxOwned)??""}`),De=gr(Pe,1,"purchase-button svelte-h067jd",null,De,Oe),Pe.disabled=(ie(o(_e)),I(()=>o(_e).disabled)),D(he,(ie(o(_e)),I(()=>o(_e).text)))},[()=>({locked:!o(G).isUnlocked,maxed:o(G).isMaxed}),()=>(ie(xe),o(G),I(()=>xe(Number(o(G).baseProduction)))),()=>({locked:o(_e).variant==="locked",maxed:o(_e).variant==="maxed",insufficient:o(_e).variant==="insufficient",available:o(_e).variant==="available"})]),Lt("click",Pe,()=>R(o(G).id)),re(se,at)}),d(ce),d(te);var oe=p(te,2),Se=p(v(oe),2),Ce=v(Se),ke=p(v(Ce),2),V=p(v(ke),2),ne=v(V,!0);d(V),d(ke),d(Ce);var Ie=p(Ce,2),Ze=p(v(Ie),2),ut=p(v(Ze),2),dt=v(ut);d(ut),d(Ze),d(Ie);var je=p(Ie,2),Te=p(v(je),2),We=p(v(Te),2),et=v(We,!0);d(We),d(Te),d(je);var gt=p(je,2),St=p(v(gt),2),Xe=p(v(St),2),tt=v(Xe,!0);d(Xe),d(St),d(gt),d(Se),d(oe),d(ue),d(W),Le((se,G)=>{D(ne,se),D(dt,`${G??""}/sec`),D(et,(o(P),I(()=>o(P).totalFacilities))),D(tt,(o(P),I(()=>o(P).totalAutoClickers)))},[()=>(ie(ct),o(P),I(()=>ct(o(P).totalMoneySpent))),()=>(ie(xe),o(P),I(()=>xe(Number(o(P).autoProductionRate))))]),re(u,W),kr(),c()}var Zo=Fe('<div class="category-card svelte-cf42y9"><div class="category-header svelte-cf42y9"><span class="category-icon svelte-cf42y9"> </span> <span class="category-name svelte-cf42y9"> </span></div> <div class="category-stats svelte-cf42y9"><span class="category-count svelte-cf42y9"> </span> <div class="category-bar svelte-cf42y9"><div class="category-fill svelte-cf42y9"></div></div></div></div>'),ec=Fe('<li class="svelte-cf42y9"> </li>'),tc=Fe('<div class="achievement-hints svelte-cf42y9"><strong>Hints:</strong> <ul class="svelte-cf42y9"></ul></div>'),rc=Fe('<div class="achievement-progress svelte-cf42y9"><div class="progress-header svelte-cf42y9"><span class="progress-label svelte-cf42y9">Progress:</span> <span class="progress-value svelte-cf42y9"> </span></div> <div class="progress-bar svelte-cf42y9"><div class="progress-fill svelte-cf42y9"></div></div></div>'),nc=Fe('<div class="achievement-unlocked svelte-cf42y9"><span class="unlocked-icon svelte-cf42y9">â</span> <span class="unlocked-text"> </span></div>'),ac=Fe('<div class="achievement-reward svelte-cf42y9"><span class="reward-label svelte-cf42y9">Reward:</span> <span class="reward-value svelte-cf42y9"><!></span></div>'),ic=Fe('<div><div class="achievement-main svelte-cf42y9"><div class="achievement-icon svelte-cf42y9"><!></div> <div class="achievement-info svelte-cf42y9"><div class="achievement-header svelte-cf42y9"><h4 class="achievement-name svelte-cf42y9"> </h4> <div class="achievement-badges svelte-cf42y9"><span class="difficulty-badge svelte-cf42y9"> </span> <span class="points-badge svelte-cf42y9"> </span></div></div> <p class="achievement-description svelte-cf42y9"> </p> <!></div></div> <!> <!> <!></div>'),sc=Fe('<div class="milestone-progress svelte-cf42y9"><span> </span> <div class="progress-bar small svelte-cf42y9"><div class="progress-fill svelte-cf42y9"></div></div></div>'),oc=Fe('<div class="milestone-card svelte-cf42y9"><div class="milestone-icon svelte-cf42y9"> </div> <div class="milestone-info svelte-cf42y9"><h4 class="svelte-cf42y9"> </h4> <p class="svelte-cf42y9"> </p> <!></div></div>'),cc=Fe('<div class="next-milestones svelte-cf42y9"><h3 class="svelte-cf42y9">ð¯ Upcoming Milestones</h3> <div class="milestone-list svelte-cf42y9"></div></div>'),lc=Fe('<div class="achievement-panel svelte-cf42y9"><div class="panel-header svelte-cf42y9"><h2 class="svelte-cf42y9">ð Achievements</h2> <p class="panel-description svelte-cf42y9">Track your progress and unlock rewards!</p></div> <div class="achievement-content svelte-cf42y9"><div class="stats-overview svelte-cf42y9"><div class="overview-card svelte-cf42y9"><div class="overview-header svelte-cf42y9"><span class="overview-icon svelte-cf42y9">ð</span> <span class="overview-title svelte-cf42y9">Total Progress</span></div> <div class="overview-value svelte-cf42y9"> </div> <div class="overview-progress svelte-cf42y9"><div class="progress-bar svelte-cf42y9"><div class="progress-fill svelte-cf42y9"></div></div> <span class="progress-text svelte-cf42y9"> </span></div></div> <div class="overview-card svelte-cf42y9"><div class="overview-header svelte-cf42y9"><span class="overview-icon svelte-cf42y9">â­</span> <span class="overview-title svelte-cf42y9">Achievement Points</span></div> <div class="overview-value svelte-cf42y9"> </div> <div class="overview-subtitle svelte-cf42y9">Total earned points</div></div> <div class="overview-card svelte-cf42y9"><div class="overview-header svelte-cf42y9"><span class="overview-icon svelte-cf42y9">ð¯</span> <span class="overview-title svelte-cf42y9">Recent Unlocks</span></div> <div class="overview-value svelte-cf42y9"> </div> <div class="overview-subtitle svelte-cf42y9">Last 10 achievements</div></div></div> <div class="category-progress svelte-cf42y9"><h3 class="svelte-cf42y9">ð Progress by Category</h3> <div class="category-grid svelte-cf42y9"></div></div> <div class="achievement-filters svelte-cf42y9"><div class="filter-group svelte-cf42y9"><label class="svelte-cf42y9">Category:</label> <select class="svelte-cf42y9"><option>All Categories</option><option>Production</option><option>Trading</option><option>Automation</option><option>Progression</option><option>Special</option><option>Hidden</option></select></div> <div class="filter-group svelte-cf42y9"><label class="svelte-cf42y9">Difficulty:</label> <select class="svelte-cf42y9"><option>All Difficulties</option><option>Easy</option><option>Medium</option><option>Hard</option><option>Extreme</option><option>Legendary</option></select></div></div> <div class="achievement-list svelte-cf42y9"></div> <!></div></div>');function uc(u,r){wr(r,!1);const[i,c]=Xr(),f=()=>Fr(de,"$gameState",i),g=ze(),y=ze(),P=ze(),q=ze();let R=ze("all"),$=ze("all");function K(ve){return o(P).some(z=>z.id===ve)}function W(ve){return fr.getAchievementProgress(ve)}function ue(ve){switch(ve){case"easy":return"#4caf50";case"medium":return"#ff9800";case"hard":return"#f44336";case"extreme":return"#9c27b0";case"legendary":return"#ffd700";default:return"#78909c"}}function X(ve){switch(ve){case"easy":return 10;case"medium":return 25;case"hard":return 50;case"extreme":return 100;case"legendary":return 250;default:return 10}}function ee(ve){switch(ve){case"production":return"ð¥";case"trading":return"ð°";case"automation":return"âï¸";case"progression":return"ð";case"special":return"â¨";case"hidden":return"ð";default:return"ð"}}Tt(()=>fr,()=>{ye(g,fr.getAvailableAchievements())}),Tt(()=>fr,()=>{ye(y,fr.getStats())}),Tt(()=>f(),()=>{ye(P,f().achievements.unlockedAchievements||[])}),Tt(()=>(o(g),o(R),o($)),()=>{ye(q,o(g).filter(ve=>{const z=o(R)==="all"||ve.category===o(R),Pe=o($)==="all"||ve.difficulty===o($);return z&&Pe}))}),un(),br();var te=lc(),ce=p(v(te),2),oe=v(ce),Se=v(oe),Ce=p(v(Se),2),ke=v(Ce);d(Ce);var V=p(Ce,2),ne=v(V),Ie=v(ne);d(ne);var Ze=p(ne,2),ut=v(Ze,!0);d(Ze),d(V),d(Se);var dt=p(Se,2),je=p(v(dt),2),Te=v(je,!0);d(je),Vn(2),d(dt);var We=p(dt,2),et=p(v(We),2),gt=v(et,!0);d(et),Vn(2),d(We),d(oe);var St=p(oe,2),Xe=p(v(St),2);vr(Xe,5,()=>(o(y),I(()=>Object.entries(o(y).categoryProgress||{}))),Ir,(ve,z)=>{var Pe=Xs(()=>Ys(o(z),2));let De=()=>o(Pe)[0],he=()=>o(Pe)[1];var fe=Zo(),pe=v(fe),Oe=v(pe),Pt=v(Oe,!0);d(Oe);var ft=p(Oe,2),ot=v(ft,!0);d(ft),d(pe);var mt=p(pe,2),yt=v(mt),Rt=v(yt);d(yt);var Ke=p(yt,2),me=v(Ke);d(Ke),d(mt),d(fe),Le(F=>{D(Pt,F),D(ot,De()),D(Rt,`${he(),I(()=>he().unlocked)??""}/${he(),I(()=>he().total)??""}`),Nt(me,`width: ${he(),I(()=>he().total>0?he().unlocked/he().total*100:0)??""}%`)},[()=>(De(),I(()=>ee(De())))]),re(ve,fe)}),d(Xe),d(St);var tt=p(St,2),se=v(tt),G=p(v(se),2);Le(()=>{o(R),mi(()=>{})});var at=v(G);at.value=at.__value="all";var _e=p(at);_e.value=_e.__value="production";var it=p(_e);it.value=it.__value="trading";var vt=p(it);vt.value=vt.__value="automation";var st=p(vt);st.value=st.__value="progression";var _t=p(st);_t.value=_t.__value="special";var Ct=p(_t);Ct.value=Ct.__value="hidden",d(G),d(se);var J=p(se,2),Mt=p(v(J),2);Le(()=>{o($),mi(()=>{})});var le=v(Mt);le.value=le.__value="all";var U=p(le);U.value=U.__value="easy";var Ae=p(U);Ae.value=Ae.__value="medium";var Re=p(Ae);Re.value=Re.__value="hard";var qe=p(Re);qe.value=qe.__value="extreme";var Ve=p(qe);Ve.value=Ve.__value="legendary",d(Mt),d(J),d(tt);var Ye=p(tt,2);vr(Ye,5,()=>o(q),Ir,(ve,z)=>{var Pe=ic();const De=ln(()=>(o(z),I(()=>K(o(z).id)))),he=ln(()=>(o(z),I(()=>W(o(z).id))));let fe;var pe=v(Pe),Oe=v(pe),Pt=v(Oe);{var ft=Be=>{var Ge=er();Le(()=>D(Ge,(o(z),I(()=>o(z).icon)))),re(Be,Ge)},ot=Be=>{var Ge=er("ð");re(Be,Ge)};pt(Pt,Be=>{o(De)?Be(ft):Be(ot,!1)})}d(Oe);var mt=p(Oe,2),yt=v(mt),Rt=v(yt),Ke=v(Rt,!0);d(Rt);var me=p(Rt,2),F=v(me),kt=v(F,!0);d(F);var ht=p(F,2),qt=v(ht);d(ht),d(me),d(yt);var N=p(yt,2),Gt=v(N,!0);d(N);var Qt=p(N,2);{var rr=Be=>{var Ge=tc(),Ee=p(v(Ge),2);vr(Ee,5,()=>(o(z),I(()=>o(z).hints)),Ir,(Qe,xt)=>{var Ot=ec(),Dt=v(Ot,!0);d(Ot),Le(()=>D(Dt,o(xt))),re(Qe,Ot)}),d(Ee),d(Ge),re(Be,Ge)};pt(Qt,Be=>{o(z),ie(o(De)),I(()=>o(z).hints&&!o(De)&&o(z).isHidden)&&Be(rr)})}d(mt),d(pe);var hr=p(pe,2);{var cr=Be=>{var Ge=rc(),Ee=v(Ge),Qe=p(v(Ee),2),xt=v(Qe,!0);d(Qe),d(Ee);var Ot=p(Ee,2),Dt=v(Ot);d(Ot),d(Ge),Le(Ft=>{D(xt,Ft),Nt(Dt,`width: ${ie(o(he)),I(()=>o(he).progress*100)??""}%`)},[()=>(ie(Un),ie(o(he)),I(()=>Un(o(he).currentValue,o(he).targetValue)))]),re(Be,Ge)};pt(hr,Be=>{!o(De)&&o(he)&&Be(cr)})}var xr=p(hr,2);{var rt=Be=>{var Ge=nc(),Ee=p(v(Ge),2),Qe=v(Ee);d(Ee),d(Ge),Le(xt=>D(Qe,`Unlocked ${xt??""}`),[()=>(o(P),o(z),I(()=>new Date(o(P).find(xt=>xt.id===o(z).id)?.unlockedAt||0).toLocaleDateString()))]),re(Be,Ge)};pt(xr,Be=>{o(De)&&Be(rt)})}var It=p(xr,2);{var Wt=Be=>{var Ge=ac(),Ee=p(v(Ge),2),Qe=v(Ee);{var xt=Dt=>{var Ft=er();Le(()=>D(Ft,`ð° $${o(z),I(()=>o(z).reward.amount)??""}`)),re(Dt,Ft)},Ot=Dt=>{var Ft=dr(),Sr=ir(Ft);{var Xt=Kt=>{var Jt=er();Le(()=>D(Jt,`â¡ ${o(z),I(()=>o(z).reward.amount)??""}x Production`)),re(Kt,Jt)},lr=Kt=>{var Jt=dr(),Kr=ir(Jt);{var Zt=zt=>{var Cr=er();Le(()=>D(Cr,`ð ${o(z),I(()=>o(z).reward.item)??""}`)),re(zt,Cr)},Yr=zt=>{var Cr=er("ð Special Reward");re(zt,Cr)};pt(Kr,zt=>{o(z),I(()=>o(z).reward.type==="special_unlock")?zt(Zt):zt(Yr,!1)},!0)}re(Kt,Jt)};pt(Sr,Kt=>{o(z),I(()=>o(z).reward.type==="production_multiplier")?Kt(Xt):Kt(lr,!1)},!0)}re(Dt,Ft)};pt(Qe,Dt=>{o(z),I(()=>o(z).reward.type==="money")?Dt(xt):Dt(Ot,!1)})}d(Ee),d(Ge),re(Be,Ge)};pt(It,Be=>{o(z),I(()=>o(z).reward)&&Be(Wt)})}d(Pe),Le((Be,Ge,Ee)=>{fe=gr(Pe,1,"achievement-card svelte-cf42y9",null,fe,Be),D(Ke,(ie(o(De)),o(z),I(()=>o(De)||!o(z).isHidden?o(z).name:"???"))),Nt(F,`background-color: ${Ge??""}; color: white;`),D(kt,(o(z),I(()=>o(z).difficulty))),D(qt,`${Ee??""} pts`),D(Gt,(ie(o(De)),o(z),I(()=>o(De)||!o(z).isHidden?o(z).description:"Hidden achievement - unlock to reveal!")))},[()=>({unlocked:o(De)}),()=>(o(z),I(()=>ue(o(z).difficulty))),()=>(o(z),I(()=>X(o(z).difficulty)))]),re(ve,Pe)}),d(Ye);var bt=p(Ye,2);{var wt=ve=>{var z=cc(),Pe=p(v(z),2);vr(Pe,5,()=>(o(y),I(()=>o(y).nextMilestones)),Ir,(De,he)=>{var fe=oc();const pe=ln(()=>(o(he),I(()=>W(o(he).id))));var Oe=v(fe),Pt=v(Oe,!0);d(Oe);var ft=p(Oe,2),ot=v(ft),mt=v(ot,!0);d(ot);var yt=p(ot,2),Rt=v(yt,!0);d(yt);var Ke=p(yt,2);{var me=F=>{var kt=sc(),ht=v(kt),qt=v(ht,!0);d(ht);var N=p(ht,2),Gt=v(N);d(N),d(kt),Le(Qt=>{D(qt,Qt),Nt(Gt,`width: ${ie(o(pe)),I(()=>o(pe).progress*100)??""}%`)},[()=>(ie(Un),ie(o(pe)),I(()=>Un(o(pe).currentValue,o(pe).targetValue)))]),re(F,kt)};pt(Ke,F=>{o(pe)&&F(me)})}d(ft),d(fe),Le(()=>{D(Pt,(o(he),I(()=>o(he).icon))),D(mt,(o(he),I(()=>o(he).name))),D(Rt,(o(he),I(()=>o(he).description)))}),re(De,fe)}),d(Pe),d(z),re(ve,z)};pt(bt,ve=>{o(y),I(()=>o(y).nextMilestones?.length>0)&&ve(wt)})}d(ce),d(te),Le((ve,z)=>{D(ke,`${o(y),I(()=>o(y).unlockedAchievements)??""}/${o(y),I(()=>o(y).totalAchievements)??""}`),Nt(Ie,`width: ${o(y),I(()=>o(y).completionPercentage)??""}%`),D(ut,ve),D(Te,z),D(gt,(o(y),I(()=>o(y).recentUnlocks?.length)))},[()=>(ie(_r),o(y),I(()=>_r(o(y).completionPercentage/100))),()=>(ie(xe),o(y),I(()=>xe(o(y).achievementPoints)))]),_i(G,()=>o(R),ve=>ye(R,ve)),_i(Mt,()=>o($),ve=>ye($,ve)),re(u,te),kr(),c()}var dc=Fe('<div class="stats-display svelte-1ghfqw"><h3 class="svelte-1ghfqw">ð Game Stats</h3> <div class="stats-grid svelte-1ghfqw"><div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">ð° Resources</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Net Worth:</span> <span class="stat-value important svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Cash:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Inventory:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">ð¥ Production</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Total Made:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Manual Rate:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">ð Market</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Price:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Total Sold:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Revenue:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">âï¸ Automation</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Auto-Clickers:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Total Spent:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Efficiency:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">ð Achievements</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Unlocked:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Points:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Progress:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div> <div class="stat-section svelte-1ghfqw"><h4 class="svelte-1ghfqw">â¡ Performance</h4> <div class="stat-items svelte-1ghfqw"><div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Game Version:</span> <span class="stat-value svelte-1ghfqw"> </span></div> <div class="stat-item svelte-1ghfqw"><span class="stat-label svelte-1ghfqw">Session Time:</span> <span class="stat-value svelte-1ghfqw"> </span></div></div></div></div> <div class="performance-indicators svelte-1ghfqw"><div class="indicator-item svelte-1ghfqw"><div class="indicator-label svelte-1ghfqw">Production</div> <div class="indicator-bar svelte-1ghfqw"><div class="indicator-fill production svelte-1ghfqw"></div></div></div> <div class="indicator-item svelte-1ghfqw"><div class="indicator-label svelte-1ghfqw">Automation</div> <div class="indicator-bar svelte-1ghfqw"><div class="indicator-fill automation svelte-1ghfqw"></div></div></div> <div class="indicator-item svelte-1ghfqw"><div class="indicator-label svelte-1ghfqw">Market</div> <div class="indicator-bar svelte-1ghfqw"><div class="indicator-fill market svelte-1ghfqw"></div></div></div> <div class="indicator-item svelte-1ghfqw"><div class="indicator-label svelte-1ghfqw">Achievements</div> <div class="indicator-bar svelte-1ghfqw"><div class="indicator-fill achievements svelte-1ghfqw"></div></div></div></div></div>');function vc(u,r){wr(r,!1);const[i,c]=Xr(),f=()=>Fr(de,"$gameState",i),g=ze(),y=ze(),P=ze(),q=ze(),R=ze(),$=ze(),K=ze(),W=ze();function ue(xt){return xt>=.9?"#4caf50":xt>=.7?"#ff9800":"#f44336"}function X(xt){return xt>=.8?"#ffd700":xt>=.5?"#64ffda":xt>=.2?"#2196f3":"#78909c"}Tt(()=>f(),()=>{ye(g,f().resources)}),Tt(()=>f(),()=>{ye(y,f().production)}),Tt(()=>f(),()=>{ye(P,f().market)}),Tt(()=>f(),()=>{ye(q,f().automation)}),Tt(()=>f(),()=>{ye(R,f().achievements)}),Tt(()=>(o(g),o(P)),()=>{ye($,o(g).money+Number(o(g).matchsticks)*o(P).currentPrice)}),Tt(()=>o(q),()=>{ye(K,o(q).autoClickers.length>0?o(q).autoClickers.reduce((xt,Ot)=>xt+Ot.efficiency,0)/o(q).autoClickers.length:0)}),Tt(()=>o(R),()=>{ye(W,o(R).totalPoints>0&&o(R).unlockedAchievements?o(R).unlockedAchievements.length/Math.max(1,20):0)}),un(),br();var ee=dc(),te=p(v(ee),2),ce=v(te),oe=p(v(ce),2),Se=v(oe),Ce=p(v(Se),2),ke=v(Ce,!0);d(Ce),d(Se);var V=p(Se,2),ne=p(v(V),2),Ie=v(ne,!0);d(ne),d(V);var Ze=p(V,2),ut=p(v(Ze),2),dt=v(ut,!0);d(ut),d(Ze),d(oe),d(ce);var je=p(ce,2),Te=p(v(je),2),We=v(Te),et=p(v(We),2),gt=v(et,!0);d(et),d(We);var St=p(We,2),Xe=p(v(St),2),tt=v(Xe);d(Xe),d(St),d(Te),d(je);var se=p(je,2),G=p(v(se),2),at=v(G),_e=p(v(at),2),it=v(_e,!0);d(_e),d(at);var vt=p(at,2),st=p(v(vt),2),_t=v(st,!0);d(st),d(vt);var Ct=p(vt,2),J=p(v(Ct),2),Mt=v(J,!0);d(J),d(Ct),d(G),d(se);var le=p(se,2),U=p(v(le),2),Ae=v(U),Re=p(v(Ae),2),qe=v(Re,!0);d(Re),d(Ae);var Ve=p(Ae,2),Ye=p(v(Ve),2),bt=v(Ye,!0);d(Ye),d(Ve);var wt=p(Ve,2),ve=p(v(wt),2),z=v(ve,!0);d(ve),d(wt),d(U),d(le);var Pe=p(le,2),De=p(v(Pe),2),he=v(De),fe=p(v(he),2),pe=v(fe,!0);d(fe),d(he);var Oe=p(he,2),Pt=p(v(Oe),2),ft=v(Pt,!0);d(Pt),d(Oe);var ot=p(Oe,2),mt=p(v(ot),2),yt=v(mt,!0);d(mt),d(ot),d(De),d(Pe);var Rt=p(Pe,2),Ke=p(v(Rt),2),me=v(Ke),F=p(v(me),2),kt=v(F,!0);d(F),d(me);var ht=p(me,2),qt=p(v(ht),2),N=v(qt,!0);d(qt),d(ht),d(Ke),d(Rt),d(te);var Gt=p(te,2),Qt=v(Gt),rr=p(v(Qt),2),hr=v(rr);d(rr),d(Qt);var cr=p(Qt,2),xr=p(v(cr),2),rt=v(xr);d(xr),d(cr);var It=p(cr,2),Wt=p(v(It),2),Be=v(Wt);d(Wt),d(It);var Ge=p(It,2),Ee=p(v(Ge),2),Qe=v(Ee);d(Ee),d(Ge),d(Gt),d(ee),Le((xt,Ot,Dt,Ft,Sr,Xt,lr,Kt,Jt,Kr,Zt,Yr,zt,Cr,dn,jt,Pr)=>{D(ke,xt),D(Ie,Ot),D(dt,Dt),D(gt,Ft),D(tt,`${Sr??""}/click`),D(it,Xt),D(_t,lr),D(Mt,Kt),D(qe,(o(q),I(()=>o(q).autoClickers.length))),D(bt,Jt),Nt(ve,`color: ${Kr??""}`),D(z,Zt),D(pe,(o(R),I(()=>o(R).unlockedAchievements?.length||0))),D(ft,(o(R),I(()=>o(R).totalPoints))),Nt(mt,`color: ${Yr??""}`),D(yt,zt),D(kt,(f(),I(()=>f().metadata.version||"1.0.0"))),D(N,Cr),Nt(hr,`width: ${dn??""}%`),Nt(rt,`width: ${jt??""}%`),Nt(Be,`width: ${Pr??""}%`),Nt(Qe,`width: ${o(W)*100}%`)},[()=>(ie(ct),o($),I(()=>ct(o($)))),()=>(ie(ct),o(g),I(()=>ct(o(g).money))),()=>(ie(xe),o(g),I(()=>xe(o(g).matchsticks))),()=>(ie(xe),o(y),I(()=>xe(o(y).totalProduced))),()=>(ie(xe),o(y),I(()=>xe(o(y).manualRate))),()=>(ie(ct),o(P),I(()=>ct(o(P).currentPrice))),()=>(ie(xe),o(P),I(()=>xe(o(P).totalSold))),()=>(ie(ct),o(P),I(()=>ct(o(P).totalRevenue))),()=>(ie(ct),o(q),I(()=>ct(o(q).totalMoneySpent))),()=>(o(K),I(()=>ue(o(K)))),()=>(ie(_r),o(K),I(()=>_r(o(K)))),()=>(o(W),I(()=>X(o(W)))),()=>(ie(_r),o(W),I(()=>_r(o(W)))),()=>(ie(Pi),f(),I(()=>Pi(Date.now()-(f().metadata.createdAt||Date.now())))),()=>(o(y),I(()=>Math.min(100,Number(o(y).totalProduced)/1e3*100))),()=>(o(q),I(()=>Math.min(100,o(q).autoClickers.length*10))),()=>(o(P),I(()=>Math.min(100,o(P).totalRevenue/1e3*100)))]),re(u,ee),kr(),c()}var fc=Fe('<div role="button" tabindex="0"><div class="toast-content svelte-17bor4s"><div class="toast-icon svelte-17bor4s"> </div> <div class="toast-text svelte-17bor4s"><div class="toast-title svelte-17bor4s"> </div> <div class="toast-message svelte-17bor4s"> </div></div> <button class="toast-close svelte-17bor4s">â</button></div> <div class="toast-progress svelte-17bor4s"><div class="progress-bar svelte-17bor4s"></div></div></div>');function hc(u,r){wr(r,!1);let i=Wr(r,"notification",8),c=Wr(r,"onClose",8),f,g=ze(100);Xn(()=>{const ke=i().duration||5e3;f=setTimeout(()=>{c()()},ke);const V=setInterval(()=>{ye(g,Math.max(0,o(g)-100/(ke/100))),o(g)<=0&&clearInterval(V)},100);return()=>{f&&clearTimeout(f),V&&clearInterval(V)}});function y(){f&&clearTimeout(f),c()()}function P(ke){switch(ke){case"achievement":return"ð";case"success":return"â";case"info":return"â¹ï¸";case"warning":return"â ï¸";case"error":return"â";default:return"ð¢"}}function q(ke){switch(ke){case"achievement":return"achievement";case"success":return"success";case"info":return"info";case"warning":return"warning";case"error":return"error";default:return"info"}}br();var R=fc(),$=v(R),K=v($),W=v(K,!0);d(K);var ue=p(K,2),X=v(ue),ee=v(X,!0);d(X);var te=p(X,2),ce=v(te,!0);d(te),d(ue);var oe=p(ue,2);d($);var Se=p($,2),Ce=v(Se);d(Se),d(R),Le((ke,V)=>{gr(R,1,`notification-toast ${ke??""}`,"svelte-17bor4s"),D(W,V),D(ee,(ie(i()),I(()=>i().title))),D(ce,(ie(i()),I(()=>i().message))),Nt(Ce,`width: ${o(g)??""}%`)},[()=>(ie(i()),I(()=>q(i().type))),()=>(ie(i()),I(()=>P(i().type)))]),Lt("click",oe,ho(y)),sr(3,R,()=>Ur,()=>({x:300,duration:300,easing:Dr})),Lt("click",R,y),re(u,R),kr()}var pc=Fe('<header class="game-header svelte-k8bmwt"><div class="header-content svelte-k8bmwt"><div class="title-section svelte-k8bmwt"><h1 class="game-title svelte-k8bmwt"><span class="title-icon svelte-k8bmwt">ð¥</span> Matchstick Empire</h1> <div class="version-badge svelte-k8bmwt"> </div></div> <div class="resources-section svelte-k8bmwt"><div class="resource-group svelte-k8bmwt"><div class="resource-item primary svelte-k8bmwt"><span class="resource-icon svelte-k8bmwt">ð¥</span> <div class="resource-details svelte-k8bmwt"><span class="resource-label svelte-k8bmwt">Matchsticks</span> <span class="resource-value svelte-k8bmwt"> </span></div></div> <div class="resource-item svelte-k8bmwt"><span class="resource-icon svelte-k8bmwt">ð°</span> <div class="resource-details svelte-k8bmwt"><span class="resource-label svelte-k8bmwt">Money</span> <span class="resource-value svelte-k8bmwt"> </span></div></div> <div class="resource-item svelte-k8bmwt"><span class="resource-icon svelte-k8bmwt">ð</span> <div class="resource-details svelte-k8bmwt"><span class="resource-label svelte-k8bmwt">Achievement Points</span> <span class="resource-value svelte-k8bmwt"> </span></div></div></div></div> <div class="controls-section svelte-k8bmwt"><button class="control-button svelte-k8bmwt" title="Help &amp; Tutorial"><span class="control-icon svelte-k8bmwt">â</span></button> <button class="control-button svelte-k8bmwt" title="Settings"><span class="control-icon svelte-k8bmwt">âï¸</span></button> <div class="achievement-progress svelte-k8bmwt" title="Achievement Progress"><div class="progress-ring svelte-k8bmwt"><div class="progress-fill svelte-k8bmwt"></div></div> <span class="progress-text svelte-k8bmwt"> </span></div></div></div> <div class="stats-bar svelte-k8bmwt"><div class="stat-item svelte-k8bmwt"><span class="stat-label svelte-k8bmwt">Production Rate:</span> <span class="stat-value svelte-k8bmwt"> </span></div> <div class="stat-item svelte-k8bmwt"><span class="stat-label svelte-k8bmwt">Market Price:</span> <span class="stat-value svelte-k8bmwt"> </span></div> <div class="stat-item svelte-k8bmwt"><span class="stat-label svelte-k8bmwt">Auto-Clickers:</span> <span class="stat-value svelte-k8bmwt"> </span></div> <div class="stat-item svelte-k8bmwt"><span class="stat-label svelte-k8bmwt">Total Produced:</span> <span class="stat-value svelte-k8bmwt"> </span></div></div></header>');function mc(u,r){wr(r,!1);const[i,c]=Xr(),f=()=>Fr(de,"$gameState",i),g=ze(),y=ze();function P(){console.log("Settings clicked")}function q(){console.log("Help clicked")}Tt(()=>f(),()=>{ye(g,f().resources)}),Tt(()=>f(),()=>{ye(y,f().achievements)}),un(),br();var R=pc(),$=v(R),K=v($),W=p(v(K),2),ue=v(W);d(W),d(K);var X=p(K,2),ee=v(X),te=v(ee),ce=p(v(te),2),oe=p(v(ce),2),Se=v(oe,!0);d(oe),d(ce),d(te);var Ce=p(te,2),ke=p(v(Ce),2),V=p(v(ke),2),ne=v(V,!0);d(V),d(ke),d(Ce);var Ie=p(Ce,2),Ze=p(v(Ie),2),ut=p(v(Ze),2),dt=v(ut,!0);d(ut),d(Ze),d(Ie),d(ee),d(X);var je=p(X,2),Te=v(je),We=p(Te,2),et=p(We,2),gt=v(et),St=v(gt);d(gt);var Xe=p(gt,2),tt=v(Xe);d(Xe),d(et),d(je),d($);var se=p($,2),G=v(se),at=p(v(G),2),_e=v(at);d(at),d(G);var it=p(G,2),vt=p(v(it),2),st=v(vt,!0);d(vt),d(it);var _t=p(it,2),Ct=p(v(_t),2),J=v(Ct,!0);d(Ct),d(_t);var Mt=p(_t,2),le=p(v(Mt),2),U=v(le,!0);d(le),d(Mt),d(se),d(R),Le((Ae,Re,qe,Ve,Ye,bt)=>{D(ue,`v${f(),I(()=>f().metadata.version||"1.0.0")??""}`),D(Se,Ae),D(ne,Re),D(dt,(o(y),I(()=>o(y).totalPoints))),Nt(St,`transform: rotate(${qe??""}deg)`),D(tt,`${o(y),I(()=>o(y).unlockedAchievements?.length||0)??""}/${o(y),I(()=>o(y).totalAchievements||0)??""}`),D(_e,`${Ve??""}/click`),D(st,Ye),D(J,(f(),I(()=>f().automation.autoClickers.length))),D(U,bt)},[()=>(ie(xe),o(g),I(()=>xe(o(g).matchsticks))),()=>(ie(ct),o(g),I(()=>ct(o(g).money))),()=>(o(y),I(()=>(o(y).unlockedAchievements?.length||0)/Math.max(1,o(y).totalAchievements||1)*360)),()=>(ie(xe),f(),I(()=>xe(f().production.manualRate))),()=>(ie(ct),f(),I(()=>ct(f().market.currentPrice))),()=>(ie(xe),f(),I(()=>xe(f().production.totalProduced)))]),Lt("click",Te,q),Lt("click",We,P),re(u,R),kr(),c()}var yc=Fe('<button><span class="tab-icon svelte-1t8fvmc"> </span> <span class="tab-label svelte-1t8fvmc"> </span> <span class="tab-shortcut svelte-1t8fvmc"> </span></button>'),gc=Fe('<nav class="tab-navigation svelte-1t8fvmc"><div class="tab-list svelte-1t8fvmc"></div> <div class="tab-indicator svelte-1t8fvmc"></div></nav>');function _c(u,r){wr(r,!1);let i=Wr(r,"activeTab",8),c=Wr(r,"onTabChange",8);const f=[{id:"production",label:"Production",icon:"ð¥",shortcut:"1"},{id:"automation",label:"Automation",icon:"âï¸",shortcut:"2"},{id:"market",label:"Market",icon:"ð",shortcut:"3"},{id:"achievements",label:"Achievements",icon:"ð",shortcut:"4"}];function g(R){c()(R)}br();var y=gc(),P=v(y);vr(P,5,()=>f,Ir,(R,$)=>{var K=yc();let W;var ue=v(K),X=v(ue,!0);d(ue);var ee=p(ue,2),te=v(ee,!0);d(ee);var ce=p(ee,2),oe=v(ce,!0);d(ce),d(K),Le(Se=>{W=gr(K,1,"tab-button svelte-1t8fvmc",null,W,Se),qa(K,"title",`${o($),I(()=>o($).label)??""} (Shortcut: ${o($),I(()=>o($).shortcut)??""})`),D(X,(o($),I(()=>o($).icon))),D(te,(o($),I(()=>o($).label))),D(oe,(o($),I(()=>o($).shortcut)))},[()=>({active:i()===o($).id})]),Lt("click",K,()=>g(o($).id)),re(R,K)}),d(P);var q=p(P,2);d(y),Le(R=>Nt(q,`transform: translateX(${R??""}%)`),[()=>(ie(i()),I(()=>f.findIndex(R=>R.id===i())*100))]),re(u,y),kr()}var bc=Fe('<p class="svelte-m8pzh0">ð¡ Tip: Click rapidly to build combo multipliers!</p>'),wc=Fe('<p class="svelte-m8pzh0">ð¡ Tip: Watch the market trends for optimal selling times!</p>'),kc=Fe('<p class="svelte-m8pzh0">ð¡ Tip: Automate your production to earn while away!</p>'),xc=Fe('<p class="svelte-m8pzh0">ð¡ Tip: Complete achievements to unlock special rewards!</p>'),Sc=Fe('<div class="floating-matchstick svelte-m8pzh0">ð¥</div>'),Cc=Fe('<div class="loading-overlay svelte-m8pzh0"><div class="loading-container svelte-m8pzh0"><div class="loading-icon svelte-m8pzh0"><div class="matchstick-container svelte-m8pzh0"><div class="matchstick svelte-m8pzh0"><div class="matchstick-head svelte-m8pzh0"></div> <div class="matchstick-body svelte-m8pzh0"></div></div> <div>ð¥</div></div></div> <h1 class="loading-title svelte-m8pzh0"><span class="title-word svelte-m8pzh0">Matchstick</span> <span class="title-word empire svelte-m8pzh0">Empire</span></h1> <div class="loading-message svelte-m8pzh0"> </div> <div class="progress-container svelte-m8pzh0"><div class="progress-bar svelte-m8pzh0"><div class="progress-fill svelte-m8pzh0"></div></div> <div class="progress-text svelte-m8pzh0"> </div></div> <div class="loading-tips svelte-m8pzh0"><!></div> <div class="version-info svelte-m8pzh0">v1.0.0 â¢ Built with ð and Svelte</div></div> <div class="background-animation svelte-m8pzh0"></div></div>');function Pc(u,r){wr(r,!1);let i=Wr(r,"show",8,!0),c=Wr(r,"message",8,"Initializing Matchstick Empire..."),f=Wr(r,"progress",8,0),g=ze(""),y;Xn(()=>{let $=0;const K=setInterval(()=>{$=($+1)%4,ye(g,".".repeat($))},500);let W=0;const ue=()=>{W<f()&&(W+=Math.random()*2,W>f()&&(W=f())),y=requestAnimationFrame(ue)};return ue(),()=>{clearInterval(K),y&&cancelAnimationFrame(y)}}),br();var P=dr(),q=ir(P);{var R=$=>{var K=Cc(),W=v(K),ue=v(W),X=v(ue),ee=p(v(X),2);let te;d(X),d(ue);var ce=p(ue,4),oe=v(ce);d(ce);var Se=p(ce,2),Ce=v(Se),ke=v(Ce);d(Ce);var V=p(Ce,2),ne=v(V);d(V),d(Se);var Ie=p(Se,2),Ze=v(Ie);{var ut=Te=>{var We=bc();re(Te,We)},dt=Te=>{var We=dr(),et=ir(We);{var gt=Xe=>{var tt=wc();re(Xe,tt)},St=Xe=>{var tt=dr(),se=ir(tt);{var G=_e=>{var it=kc();re(_e,it)},at=_e=>{var it=xc();re(_e,it)};pt(se,_e=>{f()<75?_e(G):_e(at,!1)},!0)}re(Xe,tt)};pt(et,Xe=>{f()<50?Xe(gt):Xe(St,!1)},!0)}re(Te,We)};pt(Ze,Te=>{f()<25?Te(ut):Te(dt,!1)})}d(Ie),Vn(2),d(W);var je=p(W,2);vr(je,4,()=>Array(20),Ir,(Te,We)=>{var et=Sc();Nt(et,`
            left: ${I(()=>Math.random()*100)??""}%;
            animation-delay: ${I(()=>Math.random()*5)??""}s;
            animation-duration: ${I(()=>5+Math.random()*5)??""}s;
          `),re(Te,et)}),d(je),d(K),Le((Te,We)=>{te=gr(ee,1,"flame svelte-m8pzh0",null,te,Te),D(oe,`${c()??""}${o(g)??""}`),Nt(ke,`width: ${f()??""}%`),D(ne,`${We??""}%`)},[()=>({burning:f()>20}),()=>(ie(f()),I(()=>Math.round(f())))]),sr(3,W,()=>Ka,()=>({duration:800,easing:Dr})),sr(3,K,()=>Da,()=>({duration:500})),re($,K)};pt(q,$=>{i()&&$(R)})}re(u,P),kr()}var Ac=Fe('<div class="svelte-1reukpy"><!></div>'),Ec=Fe('<div class="svelte-1reukpy"><!></div>'),Mc=Fe('<div class="svelte-1reukpy"><!></div>'),Ic=Fe('<div class="svelte-1reukpy"><!></div>'),jc=Fe('<div class="activity-item svelte-1reukpy"><span class="activity-time svelte-1reukpy"> </span> <span class="activity-text svelte-1reukpy"><!></span></div>'),Tc=Fe('<div class="svelte-1reukpy"><!></div>'),Rc=Fe('<div class="celebration-overlay svelte-1reukpy"><div class="celebration-modal svelte-1reukpy"><div class="celebration-content svelte-1reukpy"><div class="celebration-icon svelte-1reukpy">ð</div> <h2 class="svelte-1reukpy">Achievement Unlocked!</h2> <h3 class="svelte-1reukpy"> </h3> <p class="svelte-1reukpy"> </p> <div class="celebration-reward svelte-1reukpy"><!></div> <button class="celebration-close svelte-1reukpy">Continue</button></div></div></div>'),qc=Fe('<!> <main class="game-container svelte-1reukpy"><!> <div class="game-content svelte-1reukpy"><aside class="sidebar left-sidebar svelte-1reukpy"><!> <div class="quick-actions svelte-1reukpy"><button class="production-button svelte-1reukpy"><div class="button-content svelte-1reukpy"><span class="icon svelte-1reukpy">ð¥</span> <span class="text svelte-1reukpy">Make Matchstick</span> <span class="shortcut svelte-1reukpy">[Space]</span></div></button></div></aside> <div class="main-content svelte-1reukpy"><!> <div class="content-panel svelte-1reukpy"><!></div></div> <aside class="sidebar right-sidebar svelte-1reukpy"><div class="market-summary svelte-1reukpy"><h3 class="svelte-1reukpy">Market Summary</h3> <div class="price-display svelte-1reukpy"><span class="label svelte-1reukpy">Current Price:</span> <span class="value svelte-1reukpy"> </span></div> <div> </div></div> <div class="recent-activity svelte-1reukpy"><h3 class="svelte-1reukpy">Recent Activity</h3> <div class="activity-feed svelte-1reukpy"></div></div></aside></div> <div class="notifications svelte-1reukpy"></div> <!></main>',1);function Yc(u,r){wr(r,!1);const[i,c]=Xr(),f=()=>Fr(de,"$gameState",i),g=()=>Fr(Sn,"$gameEvents",i);let y=ze("production"),P=ze(new Set),q=ze(!1),R=ze(null),$=ze(!0),K=ze(0),W=ze("Initializing Matchstick Empire..."),ue=new Set,X;Xn(async()=>{const le=[{progress:20,message:"Loading storage system..."},{progress:40,message:"Starting market simulation..."},{progress:60,message:"Initializing automation..."},{progress:80,message:"Loading achievements..."},{progress:95,message:"Finishing setup..."},{progress:100,message:"Ready to play!"}];for(const U of le)ye(K,U.progress),ye(W,U.message),await new Promise(Ae=>setTimeout(Ae,300));await Fa.initialize(),await new Promise(U=>setTimeout(U,500)),ye($,!1),X=Sn.subscribe(U=>{if(U.filter(Re=>!ue.has(Re.id)).forEach(Re=>{if(ue.add(Re.id),Re.type==="achievement_unlocked"){ye(q,!0),ye(R,Re.data);const qe={id:`notif_${Re.id}`,type:"achievement",title:"ð Achievement Unlocked!",message:`${Re.data.name}`,timestamp:Re.timestamp,duration:5e3};o(P).add(qe),ye(P,o(P))}else if(Re.type==="trade_executed"){const qe={id:`notif_${Re.id}`,type:"success",title:"ð° Sale Complete",message:`Sold ${Re.data.amount} matchsticks for $${Re.data.revenue.toFixed(2)}`,timestamp:Re.timestamp,duration:3e3};o(P).add(qe),ye(P,o(P))}}),ue.size>200){const qe=Array.from(ue).slice(-100);ue=new Set(qe)}})}),ms(()=>{X&&X()});function ee(le){const U=Array.from(o(P)).find(Ae=>Ae.id===le);U&&(o(P).delete(U),ye(P,o(P)))}function te(){ye(q,!1),ye(R,null)}function ce(le){ye(y,le)}function oe(le){if(!le.altKey)switch(le.key){case"1":ce("production");break;case"2":ce("automation");break;case"3":ce("market");break;case"4":ce("achievements");break}}br();var Se=qc();Lt("keydown",Ni,oe);var Ce=ir(Se);Pc(Ce,{get show(){return o($)},get message(){return o(W)},get progress(){return o(K)}});var ke=p(Ce,2),V=v(ke);mc(V,{});var ne=p(V,2),Ie=v(ne),Ze=v(Ie);vc(Ze,{});var ut=p(Ze,2),dt=v(ut);d(ut),d(Ie);var je=p(Ie,2),Te=v(je);_c(Te,{get activeTab(){return o(y)},onTabChange:ce});var We=p(Te,2),et=v(We);{var gt=le=>{var U=Ac(),Ae=v(U);Bo(Ae,{}),d(U),sr(1,U,()=>Ur,()=>({x:-300,duration:300,easing:Dr})),re(le,U)},St=le=>{var U=dr(),Ae=ir(U);{var Re=Ve=>{var Ye=Ec(),bt=v(Ye);Jo(bt,{}),d(Ye),sr(1,Ye,()=>Ur,()=>({x:-300,duration:300,easing:Dr})),re(Ve,Ye)},qe=Ve=>{var Ye=dr(),bt=ir(Ye);{var wt=z=>{var Pe=Mc(),De=v(Pe);Vo(De,{}),d(Pe),sr(1,Pe,()=>Ur,()=>({x:-300,duration:300,easing:Dr})),re(z,Pe)},ve=z=>{var Pe=dr(),De=ir(Pe);{var he=fe=>{var pe=Ic(),Oe=v(pe);uc(Oe,{}),d(pe),sr(1,pe,()=>Ur,()=>({x:-300,duration:300,easing:Dr})),re(fe,pe)};pt(De,fe=>{o(y)==="achievements"&&fe(he)},!0)}re(z,Pe)};pt(bt,z=>{o(y)==="market"?z(wt):z(ve,!1)},!0)}re(Ve,Ye)};pt(Ae,Ve=>{o(y)==="automation"?Ve(Re):Ve(qe,!1)},!0)}re(le,U)};pt(et,le=>{o(y)==="production"?le(gt):le(St,!1)})}d(We),d(je);var Xe=p(je,2),tt=v(Xe),se=p(v(tt),2),G=p(v(se),2),at=v(G);d(G),d(se);var _e=p(se,2);let it;var vt=v(_e);d(_e),d(tt);var st=p(tt,2),_t=p(v(st),2);vr(_t,5,()=>g().slice(0,5),le=>le.id,(le,U)=>{var Ae=jc(),Re=v(Ae),qe=v(Re,!0);d(Re);var Ve=p(Re,2),Ye=v(Ve);{var bt=ve=>{var z=er();Le(()=>D(z,`ð¥ Produced ${o(U).data.amount??""} matchsticks`)),re(ve,z)},wt=ve=>{var z=dr(),Pe=ir(z);{var De=fe=>{var pe=er();Le(Oe=>D(pe,`ð° Sold ${o(U).data.amount??""} for $${Oe??""}`),[()=>o(U).data.revenue.toFixed(2)]),re(fe,pe)},he=fe=>{var pe=dr(),Oe=ir(pe);{var Pt=ot=>{var mt=er();Le(()=>D(mt,`ð Unlocked: ${o(U).data.name??""}`)),re(ot,mt)},ft=ot=>{var mt=dr(),yt=ir(mt);{var Rt=me=>{var F=er();Le(()=>D(F,`âï¸ Purchased: ${o(U).data.itemId??""}`)),re(me,F)},Ke=me=>{var F=er();Le(()=>D(F,`ð ${o(U).type??""}`)),re(me,F)};pt(yt,me=>{o(U).type==="upgrade_purchased"?me(Rt):me(Ke,!1)},!0)}re(ot,mt)};pt(Oe,ot=>{o(U).type==="achievement_unlocked"?ot(Pt):ot(ft,!1)},!0)}re(fe,pe)};pt(Pe,fe=>{o(U).type==="matchsticks_sold"?fe(De):fe(he,!1)},!0)}re(ve,z)};pt(Ye,ve=>{o(U).type==="matchsticks_produced"?ve(bt):ve(wt,!1)})}d(Ve),d(Ae),Le(ve=>D(qe,ve),[()=>new Date(o(U).timestamp).toLocaleTimeString()]),sr(3,Ae,()=>Da),re(le,Ae)}),d(_t),d(st),d(Xe),d(ne);var Ct=p(ne,2);vr(Ct,5,()=>Array.from(o(P)),le=>le.id,(le,U)=>{var Ae=Tc(),Re=v(Ae);hc(Re,{get notification(){return o(U)},onClose:()=>ee(o(U).id)}),d(Ae),sr(3,Ae,()=>Ur,()=>({y:-50,duration:300})),re(le,Ae)}),d(Ct);var J=p(Ct,2);{var Mt=le=>{var U=Rc(),Ae=v(U),Re=v(Ae),qe=p(v(Re),4),Ve=v(qe,!0);d(qe);var Ye=p(qe,2),bt=v(Ye,!0);d(Ye);var wt=p(Ye,2),ve=v(wt);{var z=he=>{var fe=er();Le(()=>D(fe,`ð° Earned $${o(R).reward.amount??""}`)),re(he,fe)},Pe=he=>{var fe=dr(),pe=ir(fe);{var Oe=ft=>{var ot=er();Le(()=>D(ot,`â¡ Production boost: ${o(R).reward.amount??""}x`)),re(ft,ot)},Pt=ft=>{var ot=er("ð Special reward unlocked!");re(ft,ot)};pt(pe,ft=>{o(R).reward?.type==="production_multiplier"?ft(Oe):ft(Pt,!1)},!0)}re(he,fe)};pt(ve,he=>{o(R).reward?.type==="money"?he(z):he(Pe,!1)})}d(wt);var De=p(wt,2);d(Re),d(Ae),d(U),Le(()=>{D(Ve,o(R).name),D(bt,o(R).description)}),Lt("click",De,te),sr(3,Ae,()=>Ka,()=>({duration:500,easing:Dr})),sr(3,U,()=>Da),re(le,U)};pt(J,le=>{o(q)&&o(R)&&le(Mt)})}d(ke),Le((le,U)=>{D(at,`$${le??""}`),it=gr(_e,1,"trend-indicator svelte-1reukpy",null,it,U),D(vt,`${f().market.trend==="up"?"ð":f().market.trend==="down"?"ð":"â¡ï¸"}
          ${f().market.trend||"stable"}`)},[()=>f().market.currentPrice.toFixed(3),()=>({positive:f().market.trend==="up",negative:f().market.trend==="down"})]),Lt("click",dt,()=>Or.produceMatchsticks(1)),re(u,Se),kr(),c()}export{Yc as component};
